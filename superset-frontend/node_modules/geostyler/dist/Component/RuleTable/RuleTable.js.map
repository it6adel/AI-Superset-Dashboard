{"version":3,"file":"RuleTable.js","sourceRoot":"","sources":["../../../src/Component/RuleTable/RuleTable.tsx"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable camelcase */\n/* Released under the BSD 2-Clause License\n *\n * Copyright © 2018-present, terrestris GmbH & Co. KG and GeoStyler contributors\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * * Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n *\n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport { CqlParser } from 'geostyler-cql-parser';\n\nimport _get from 'lodash/get';\nimport _set from 'lodash/set';\nimport _isEqual from 'lodash/isEqual';\nimport _cloneDeep from 'lodash/cloneDeep';\n\nimport {\n  Table,\n  Input,\n  InputNumber,\n  Popover,\n  Tooltip,\n} from 'antd';\n\nimport {\n  Rule as GsRule,\n  Symbolizer as GsSymbolizer,\n  Filter as GsFilter,\n  Symbolizer\n} from 'geostyler-style';\n\nimport {\n  Data\n} from 'geostyler-data';\n\nimport { localize } from '../LocaleWrapper/LocaleWrapper';\nimport en_US from '../../locale/en_US';\n\nimport './RuleTable.less';\nimport { OlRendererProps } from '../Renderer/OlRenderer/OlRenderer';\nimport FilterEditorWindow from '../Filter/FilterEditorWindow/FilterEditorWindow';\nimport SymbolizerEditorWindow from '../Symbolizer/SymbolizerEditorWindow/SymbolizerEditorWindow';\nimport { TableProps, ColumnProps } from 'antd/lib/table';\nimport FilterUtil, { CountResult } from '../../Util/FilterUtil';\nimport { SLDRendererAdditonalProps } from '../Renderer/SLDRenderer/SLDRenderer';\nimport { ComparisonFilterProps } from '../Filter/ComparisonFilter/ComparisonFilter';\nimport { IconLibrary } from '../Symbolizer/IconSelector/IconSelector';\nimport DataUtil from '../../Util/DataUtil';\nimport RuleReorderButtons from './RuleReorderButtons/RuleReorderButtons';\nimport { BgColorsOutlined, BlockOutlined, EditOutlined } from '@ant-design/icons';\nimport { GeoStylerLocale } from '../../locale/locale';\nimport Renderer from '../Renderer/Renderer/Renderer';\n\n// i18n\nexport interface RuleTableLocale {\n  symbolizersColumnTitle: string;\n  nameColumnTitle: string;\n  filterColumnTitle: string;\n  minScaleColumnTitle: string;\n  maxScaleColumnTitle: string;\n  amountColumnTitle: string;\n  duplicatesColumnTitle: string;\n  // locale from antd\n  filterConfirm?: string;\n  filterReset?: string;\n  emptyText?: string;\n}\n\nexport interface RuleRecord extends GsRule {\n  key: number;\n  amount?: number;\n  duplicates?: number;\n  maxScale?: number;\n  minScale?: number;\n}\n\n// default props\ninterface RuleTableDefaultProps extends Partial<TableProps<RuleRecord>> {\n  /** Locale object containing translated text snippets */\n  locale: GeoStylerLocale['RuleTable'];\n  /** The renderer to use */\n  rendererType: 'SLD' | 'OpenLayers';\n  /** Display the number of features that match a rule */\n  showAmountColumn: boolean;\n  /** Display the number of features that match more than one rule */\n  showDuplicatesColumn: boolean;\n}\n\n// non default props\nexport interface RuleTableProps extends Partial<RuleTableDefaultProps> {\n  /** Reference to internal data object (holding schema and example features) */\n  data?: Data;\n  /** List of rules to display in rule table */\n  rules: GsRule[];\n  /** Properties of the SLD renderer */\n  sldRendererProps?: SLDRendererAdditonalProps;\n  /** Properties of the OpenLayers renderer */\n  oLRendererProps?: Partial<OlRendererProps>;\n  /** The footer of the rule table */\n  footer?: (currentPageData?: any) => React.ReactNode;\n  /** The callback function that is triggered when the rules change */\n  onRulesChange?: (rules: GsRule[]) => void;\n  /** The callback function that is triggered when the selection changes */\n  onSelectionChange?: (selectedRowKeys: string[], selectedRows: any[]) => void;\n  /** Properties that will be passed to the Comparison Filters */\n  filterUiProps?: Partial<ComparisonFilterProps>;\n  /** List of supported icons ordered as library */\n  iconLibraries?: IconLibrary[];\n  /** Object containing predefined color ramps */\n  colorRamps?: {\n    [name: string]: string[];\n  };\n}\n\nconst COMPONENTNAME = 'RuleTable';\n\n// export class RuleTable extends React.Component<RuleTableProps, RuleTableState> {\nexport const RuleTable: React.FC<RuleTableProps> = ({\n  locale = en_US.RuleTable,\n  rendererType = 'OpenLayers',\n  showAmountColumn = true,\n  showDuplicatesColumn = true,\n  data: dataProp,\n  rules: rulesProp,\n  onRulesChange,\n  filterUiProps,\n  iconLibraries,\n  colorRamps,\n  sldRendererProps,\n  oLRendererProps,\n  ...restProps\n}) => {\n\n  const [ruleEditIndex, setRuleEditIndex] = useState<number>();\n  const [symbolizerEditorVisible, setSymbolizerEditorVisible] = useState<boolean>();\n  const [symbolizerEditorPosition, setSymbolizerEditorPosition] = useState<DOMRect>();\n  const [filterEditorVisible, setFilterEditorVisible] = useState<boolean>();\n  const [filterEditorPosition, setFilterEditorPosition] = useState<DOMRect>();\n  const [hasError, setHasError] = useState<boolean>();\n  const [data, setData] = useState<Data>();\n  const [rules, setRules] = useState<GsRule[]>();\n  const [counts, setCounts] = useState<number[]>();\n  const [duplicates, setDuplicates] = useState<number[]>();\n\n  /**\n   * The Parser to read and write CQL Filter\n   *\n   */\n  const { current: cqlParser} = useRef(new CqlParser());\n\n  useEffect(() => {\n    let countsAndDuplicates: CountResult = {};\n    try {\n      if (dataProp && DataUtil.isVector(dataProp)) {\n        countsAndDuplicates = FilterUtil.calculateCountAndDuplicates(rulesProp, dataProp);\n      } else {\n        countsAndDuplicates = {};\n      }\n    } catch (e) {\n      setHasError(true);\n      // make sure to update state when checks/calculation fails\n    }\n    setData(dataProp);\n    setRules(rulesProp);\n    setCounts(countsAndDuplicates?.counts);\n    setDuplicates(countsAndDuplicates?.duplicates);\n  }, [rulesProp, dataProp]);\n\n  const ruleRecords = rules?.map((rule: GsRule, index: number): RuleRecord => {\n    return {\n      key: index,\n      ...rule\n    };\n  });\n\n  const onSymbolizerClick = (record: RuleRecord, newSymbolizerEditorPosition: DOMRect) => {\n    setRuleEditIndex(record.key);\n    setSymbolizerEditorVisible(true);\n    setSymbolizerEditorPosition(newSymbolizerEditorPosition);\n    setFilterEditorVisible(false);\n  };\n\n  const symbolizerRenderer = (text: string, record: RuleRecord) => {\n    const onSymbolizerRendererClick = (symbolizers: Symbolizer[], event: any) => {\n      const filterPosition = event.target.getBoundingClientRect();\n      onSymbolizerClick(record, filterPosition);\n    };\n\n    return (\n      <Renderer\n        rendererType={rendererType}\n        data={data}\n        symbolizers={record.symbolizers}\n        onClick={onSymbolizerRendererClick}\n        {...sldRendererProps}\n        {...oLRendererProps}\n      />\n    );\n  };\n\n  // TODO: Refactor to stand alone component\n  const nameRenderer = (text: string, record: RuleRecord) => {\n    return (\n      <Popover\n        content={record.name}\n        title={locale.nameColumnTitle}\n      >\n        <Input\n          value={record.name}\n          name=\"name-renderer\"\n          onChange={(event) => {\n            const target = event.target;\n            setValueForRule(record.key, 'name', target.value);\n          }}\n        />\n      </Popover>\n    );\n  };\n\n  // TODO: Refactor to stand alone component\n  const filterRenderer = (text: string, record: RuleRecord) => {\n    const cql = cqlParser.write(record.filter) as string;\n    let filterCell: React.ReactNode;\n    const inputSearch = (\n      <Input.Search\n        className=\"gs-rule-table-filter-cell\"\n        name=\"filter-renderer\"\n        value={cql}\n        onChange={() => {\n          // TODO The CQL representation is currently not editable\n          // const value = event.target.value;\n          // try {\n          //   const newFilter = FilterUtil.readFromCql(value);\n          //   this.setValueForRule(record.key, 'filter', newFilter);\n          // } catch (error) {\n          //   // TODO Feedback\n          // }\n        }}\n        enterButton={<EditOutlined />}\n        onSearch={(value, event: any) => {\n          const filterPosition = event.target.getBoundingClientRect();\n          onFilterEditClick(record.key, filterPosition);\n        }}\n      />);\n    if (cql && cql.length > 0) {\n      filterCell = (\n        <Popover\n          content={cql}\n          title={locale.filterColumnTitle}\n        >\n          {inputSearch}\n        </Popover>);\n    } else {\n      filterCell = inputSearch;\n    }\n    return filterCell;\n  };\n\n  const onFilterEditClick = (newRuleEditIndex: number, newFilterEditorPosition: DOMRect) => {\n    setRuleEditIndex(newRuleEditIndex);\n    setFilterEditorPosition(newFilterEditorPosition);\n    setSymbolizerEditorVisible(false);\n    setFilterEditorVisible(true);\n  };\n\n  // TODO: Refactor to stand alone component\n  const minScaleRenderer = (text: string, record: RuleRecord) => {\n    const minScaleDenominator = _get(record, 'scaleDenominator.min');\n    const value = minScaleDenominator ? parseFloat(minScaleDenominator as any) : undefined;\n    return (\n      <InputNumber\n        className=\"scale-denominator min-scale-denominator\"\n        name=\"min-scale-renderer\"\n        value={value}\n        min={0}\n        formatter={val => val ? `1:${val}` : ''}\n        parser={(val: string) => parseFloat(val.replace('1:', ''))}\n        onChange={(newValue: number) => {\n          setValueForRule(record.key, 'scaleDenominator.min', newValue);\n        }}\n      />\n    );\n  };\n\n  // TODO: Refactor to stand alone component\n  const maxScaleRenderer = (text: string, record: RuleRecord) => {\n    const maxScaleDenominator = _get(record, 'scaleDenominator.max');\n    const value = maxScaleDenominator ? parseFloat(maxScaleDenominator as any) : undefined;\n    return (\n      <InputNumber\n        className=\"scale-denominator max-scale-denominator\"\n        name=\"max-scale-renderer\"\n        value={value}\n        min={0}\n        formatter={val => val ? `1:${val}` : ''}\n        parser={(val: string) => parseFloat(val.replace('1:', ''))}\n        onChange={(newValue: number) => {\n          setValueForRule(record.key, 'scaleDenominator.max', newValue);\n        }}\n      />\n    );\n  };\n\n  // TODO: Refactor to stand alone component\n  const amountRenderer = (text: string, record: RuleRecord) => {\n    let amount: (number|'-') = '-';\n    const filter: GsFilter|undefined = record.filter;\n    if (data && filter) {\n      try {\n        amount = counts[record?.key] || 0;\n      } catch (error) {\n        amount = '-';\n      }\n    } else if (data && DataUtil.isVector(data)) {\n      amount = data.exampleFeatures.features.length;\n    }\n    return (\n      <div className=\"ant-input gs-rule-table-numeric-cell amount-renderer\">\n        {amount}\n      </div>\n    );\n  };\n\n  // TODO: Refactor to stand alone component\n  const duplicatesRenderer = (text: string, record: RuleRecord) => {\n    let calculatedDuplicates: (number|'-') = '-';\n    if (data && rules) {\n      try {\n        calculatedDuplicates = duplicates[record.key];\n      } catch (error) {\n        calculatedDuplicates = '-';\n      }\n    }\n    return (\n      <div className=\"ant-input gs-rule-table-numeric-cell duplicates-renderer\">\n        {calculatedDuplicates}\n      </div>\n    );\n  };\n\n  const ruleReorderRenderer = (record: RuleRecord) => {\n    return (\n      <RuleReorderButtons\n        ruleIndex={record.key}\n        rules={rules}\n        onRulesMove={onRulesChange}\n      />\n    );\n  };\n\n  const onSymbolizersChange = (symbolizers: GsSymbolizer[]) => {\n    setValueForRule(ruleEditIndex, 'symbolizers', symbolizers);\n  };\n\n  const onFilterChange = (filter: GsFilter) => {\n    setValueForRule(ruleEditIndex, 'filter', filter);\n  };\n\n  const setValueForRule = (ruleIndex: number, key: string, value: any) => {\n    const rulesClone = _cloneDeep(rules);\n    _set(rulesClone[ruleIndex], key, value);\n    if (onRulesChange) {\n      onRulesChange(rulesClone);\n    }\n  };\n\n  const onSymbolizerEditorWindowClose = () => {\n    setSymbolizerEditorVisible(false);\n  };\n\n  const onFilterEditorWindowClose = () => {\n    setFilterEditorVisible(false);\n  };\n\n  const columns: ColumnProps<RuleRecord>[] = [{\n    dataIndex: '',\n    width: 70,\n    render: ruleReorderRenderer\n  },\n  {\n    title: (\n      <Tooltip title={locale.symbolizersColumnTitle}>\n        <BgColorsOutlined />\n      </Tooltip>),\n    dataIndex: 'symbolizers',\n    render: symbolizerRenderer\n  }, {\n    title: locale.nameColumnTitle,\n    dataIndex: 'name',\n    render: nameRenderer\n  }, {\n    title: locale.filterColumnTitle,\n    dataIndex: 'filter',\n    render: filterRenderer\n  }, {\n    title: locale.minScaleColumnTitle,\n    dataIndex: 'minScale',\n    render: minScaleRenderer\n  }, {\n    title: locale.maxScaleColumnTitle,\n    dataIndex: 'maxScale',\n    render: maxScaleRenderer\n  }];\n\n  if (showAmountColumn) {\n    columns.push({\n      title: (<Tooltip title={locale.amountColumnTitle}>Σ</Tooltip>),\n      dataIndex: 'amount',\n      render: amountRenderer\n    });\n  }\n  if (showDuplicatesColumn) {\n    columns.push({\n      title: (\n        <Tooltip title={locale.duplicatesColumnTitle}>\n          <BlockOutlined />\n        </Tooltip>),\n      dataIndex: 'duplicates',\n      render: duplicatesRenderer\n    });\n  };\n\n  if (hasError) {\n    return <h1>An error occurred in the RuleTable UI.</h1>;\n  }\n\n  return (\n    <div className=\"gs-rule-table\">\n      <Table\n        columns={columns}\n        dataSource={ruleRecords}\n        pagination={false}\n        {...restProps}\n      />\n      {\n        !symbolizerEditorVisible ? null :\n          <SymbolizerEditorWindow\n            x={\n              symbolizerEditorPosition\n                ? symbolizerEditorPosition.x + symbolizerEditorPosition.width\n                : undefined\n            }\n            y={symbolizerEditorPosition ? symbolizerEditorPosition.y : undefined}\n            onClose={onSymbolizerEditorWindowClose}\n            internalDataDef={data}\n            symbolizers={rules[ruleEditIndex]?.symbolizers}\n            onSymbolizersChange={onSymbolizersChange}\n            iconLibraries={iconLibraries}\n            colorRamps={colorRamps}\n          />\n      }\n      {\n        !filterEditorVisible ? null :\n          <FilterEditorWindow\n            x={filterEditorPosition ? filterEditorPosition.x : undefined}\n            y={\n              filterEditorPosition\n                ? filterEditorPosition.y + filterEditorPosition.height\n                : undefined\n            }\n            onClose={onFilterEditorWindowClose}\n            filter={rules[ruleEditIndex].filter}\n            onFilterChange={onFilterChange}\n            filterUiProps={filterUiProps}\n            internalDataDef={data && DataUtil.isVector(data) ? data : undefined}\n          />\n      }\n    </div>\n  );\n};\n\nexport default localize(RuleTable, COMPONENTNAME);\n"]}