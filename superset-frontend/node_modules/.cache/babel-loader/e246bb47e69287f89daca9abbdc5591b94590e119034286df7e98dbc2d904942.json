{"ast":null,"code":"/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { SEPARATOR } from './fetchTimeRange';\nconst iso8601 = String.raw`\\d{4}-\\d\\d-\\d\\dT\\d\\d:\\d\\d:\\d\\d(?:\\.\\d+)?(?:(?:[+-]\\d\\d:\\d\\d)|Z)?`;\nconst datetimeConstant = String.raw`(?:TODAY|NOW)`;\nconst grainValue = String.raw`[+-]?[1-9][0-9]*`;\nconst grain = String.raw`YEAR|QUARTER|MONTH|WEEK|DAY|HOUR|MINUTE|SECOND`;\nconst CUSTOM_RANGE_EXPRESSION = RegExp(String.raw`^DATEADD\\(DATETIME\\(\"(${iso8601}|${datetimeConstant})\"\\),\\s(${grainValue}),\\s(${grain})\\)$`, 'i');\nexport const ISO8601_AND_CONSTANT = RegExp(String.raw`^${iso8601}$|^${datetimeConstant}$`, 'i');\nconst DATETIME_CONSTANT = ['now', 'today'];\nconst SEVEN_DAYS_AGO = new Date();\nSEVEN_DAYS_AGO.setHours(0, 0, 0, 0);\nconst MIDNIGHT = new Date();\nMIDNIGHT.setHours(0, 0, 0, 0);\nconst defaultCustomRange = {\n  sinceDatetime: SEVEN_DAYS_AGO.setDate(SEVEN_DAYS_AGO.getDate() - 7).toString(),\n  sinceMode: 'relative',\n  sinceGrain: 'day',\n  sinceGrainValue: -7,\n  untilDatetime: MIDNIGHT.toString(),\n  untilMode: 'specific',\n  untilGrain: 'day',\n  untilGrainValue: 7,\n  anchorMode: 'now',\n  anchorValue: 'now'\n};\nexport const customTimeRangeDecode = (timeRange) => {\n  const splitDateRange = timeRange.split(SEPARATOR);\n  if (splitDateRange.length === 2) {\n    const [since, until] = splitDateRange;\n    // specific : specific\n    if (ISO8601_AND_CONSTANT.test(since) && ISO8601_AND_CONSTANT.test(until)) {\n      const sinceMode = DATETIME_CONSTANT.includes(since) ? since : 'specific';\n      const untilMode = DATETIME_CONSTANT.includes(until) ? until : 'specific';\n      return {\n        customRange: {\n          ...defaultCustomRange,\n          sinceDatetime: since,\n          untilDatetime: until,\n          sinceMode,\n          untilMode\n        },\n        matchedFlag: true\n      };\n    }\n    // relative : specific\n    const sinceCapturedGroup = since.match(CUSTOM_RANGE_EXPRESSION);\n    if (sinceCapturedGroup &&\n    ISO8601_AND_CONSTANT.test(until) &&\n    since.includes(until)) {\n      const [dttm, grainValue, grain] = sinceCapturedGroup.slice(1);\n      const untilMode = DATETIME_CONSTANT.includes(until) ? until : 'specific';\n      return {\n        customRange: {\n          ...defaultCustomRange,\n          sinceGrain: grain,\n          sinceGrainValue: parseInt(grainValue, 10),\n          sinceDatetime: dttm,\n          untilDatetime: dttm,\n          sinceMode: 'relative',\n          untilMode\n        },\n        matchedFlag: true\n      };\n    }\n    // specific : relative\n    const untilCapturedGroup = until.match(CUSTOM_RANGE_EXPRESSION);\n    if (ISO8601_AND_CONSTANT.test(since) &&\n    untilCapturedGroup &&\n    until.includes(since)) {\n      const [dttm, grainValue, grain] = [...untilCapturedGroup.slice(1)];\n      const sinceMode = DATETIME_CONSTANT.includes(since) ? since : 'specific';\n      return {\n        customRange: {\n          ...defaultCustomRange,\n          untilGrain: grain,\n          untilGrainValue: parseInt(grainValue, 10),\n          sinceDatetime: dttm,\n          untilDatetime: dttm,\n          untilMode: 'relative',\n          sinceMode\n        },\n        matchedFlag: true\n      };\n    }\n    // relative : relative\n    if (sinceCapturedGroup && untilCapturedGroup) {\n      const [sinceDttm, sinceGrainValue, sinceGrain] = [\n      ...sinceCapturedGroup.slice(1)];\n\n      const [untilDttm, untilGrainValue, untilGrain] = [\n      ...untilCapturedGroup.slice(1)];\n\n      if (sinceDttm === untilDttm) {\n        return {\n          customRange: {\n            ...defaultCustomRange,\n            sinceGrain: sinceGrain,\n            sinceGrainValue: parseInt(sinceGrainValue, 10),\n            sinceDatetime: sinceDttm,\n            untilGrain: untilGrain,\n            untilGrainValue: parseInt(untilGrainValue, 10),\n            untilDatetime: untilDttm,\n            anchorValue: sinceDttm,\n            sinceMode: 'relative',\n            untilMode: 'relative',\n            anchorMode: sinceDttm === 'now' ? 'now' : 'specific'\n          },\n          matchedFlag: true\n        };\n      }\n    }\n  }\n  return {\n    customRange: defaultCustomRange,\n    matchedFlag: false\n  };\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}