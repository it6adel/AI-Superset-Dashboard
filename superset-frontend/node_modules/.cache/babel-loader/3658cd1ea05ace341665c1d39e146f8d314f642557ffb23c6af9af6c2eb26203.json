{"ast":null,"code":"/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { VizType } from '@superset-ui/core';\nimport isTruthy from './utils/isTruthy';\nimport {\n  tokenizeToNumericArray,\n  tokenizeToStringArray } from\n'./utils/tokenize';\nimport { formatLabel } from './utils';\n\nconst NOOP = () => {};\n\nconst grabD3Format = (datasource, targetMetric) => {\n  let foundFormatter;\n  const { metrics = [] } = datasource || {};\n  metrics.forEach((metric) => {\n    if (metric.d3format && metric.metric_name === targetMetric) {\n      foundFormatter = metric.d3format;\n    }\n  });\n\n  return foundFormatter;\n};\n\nexport default function transformProps(chartProps) {\n  const {\n    width,\n    height,\n    annotationData,\n    datasource,\n    formData,\n    hooks,\n    queriesData\n  } = chartProps;\n\n  const { onAddFilter = NOOP, onError = NOOP } = hooks;\n\n  const {\n    annotationLayers,\n    barStacked,\n    bottomMargin,\n    colorPicker,\n    colorScheme,\n    comparisonType,\n    contribution,\n    donut,\n    entity,\n    labelsOutside,\n    leftMargin,\n    lineInterpolation,\n    maxBubbleSize,\n    metric,\n    orderBars,\n    pieLabelType,\n    reduceXTicks,\n    richTooltip,\n    sendTimeRange,\n    showBarValue,\n    showBrush,\n    showControls,\n    showLabels,\n    showLegend,\n    showMarkers,\n    size,\n    stackedStyle,\n    vizType,\n    x,\n    xAxisFormat,\n    xAxisLabel,\n    xAxisShowminmax,\n    xLogScale,\n    xTicksLayout,\n    y,\n    yAxisBounds,\n    yAxis2Bounds,\n    yAxisLabel,\n    yAxisFormat,\n    yAxisShowminmax,\n    yAxis2Showminmax,\n    yLogScale,\n    sliceId\n  } = formData;\n\n  let {\n    markerLabels,\n    markerLines,\n    markerLineLabels,\n    markers,\n    numberFormat,\n    rangeLabels,\n    ranges\n  } = formData;\n\n  const rawData = queriesData[0].data || [];\n  const data = Array.isArray(rawData) ?\n  rawData.map((row) => ({\n    ...row,\n    values: Array.isArray(row.values) ?\n    row.values.map((value) => ({ ...value })) :\n    row.values,\n    key: formatLabel(row.key, datasource.verboseMap)\n  })) :\n  rawData;\n\n  if (vizType === VizType.Pie) {\n    numberFormat = numberFormat || grabD3Format(datasource, metric);\n  } else if (vizType === VizType.Bullet) {\n    ranges = tokenizeToNumericArray(ranges) || [0, data.measures * 1.1];\n    rangeLabels = tokenizeToStringArray(rangeLabels);\n    markerLabels = tokenizeToStringArray(markerLabels);\n    markerLines = tokenizeToNumericArray(markerLines);\n    markerLineLabels = tokenizeToStringArray(markerLineLabels);\n    markers = tokenizeToNumericArray(markers);\n  }\n\n  return {\n    width,\n    height,\n    data,\n    annotationData,\n    annotationLayers,\n    areaStackedStyle: stackedStyle,\n    baseColor: colorPicker,\n    bottomMargin,\n    colorScheme,\n    comparisonType,\n    contribution,\n    entity,\n    isBarStacked: barStacked,\n    isDonut: donut,\n    isPieLabelOutside: labelsOutside,\n    leftMargin,\n    lineInterpolation,\n    markerLabels,\n    markerLines,\n    markerLineLabels,\n    markers,\n    maxBubbleSize: parseInt(maxBubbleSize, 10),\n    numberFormat,\n    onBrushEnd: isTruthy(sendTimeRange) ?\n    (timeRange) => {\n      onAddFilter('__time_range', timeRange, false, true);\n    } :\n    undefined,\n    onError,\n    orderBars,\n    pieLabelType,\n    rangeLabels,\n    ranges,\n    reduceXTicks,\n    showBarValue,\n    showBrush,\n    showControls,\n    showLabels,\n    showLegend,\n    showMarkers,\n    sizeField: size,\n    useRichTooltip: richTooltip,\n    vizType,\n    xAxisFormat,\n    xAxisLabel,\n    xAxisShowMinMax: xAxisShowminmax,\n    xField: x,\n    xIsLogScale: xLogScale,\n    xTicksLayout,\n    yAxisFormat,\n    yAxisBounds,\n    yAxis2Bounds,\n    yAxisLabel,\n    yAxisShowMinMax: yAxisShowminmax,\n    yAxis2ShowMinMax: yAxis2Showminmax,\n    yField: y,\n    yIsLogScale: yLogScale,\n    sliceId\n  };\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}