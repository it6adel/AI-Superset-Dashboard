{"ast":null,"code":"/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useState, useEffect } from 'react';\nimport { css, styled, t, useTheme } from '@superset-ui/core';\nimport { useSingleViewResource } from 'src/views/CRUD/hooks';\nimport Icons from 'src/components/Icons';\nimport Modal from 'src/components/Modal';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport { CssEditor } from 'src/components/AsyncAceEditor';import { jsx as _jsx, jsxs as _jsxs } from \"@emotion/react/jsx-runtime\";\nconst StyledCssTemplateTitle = styled.div(({ theme }) => css`\n    margin: ${theme.gridUnit * 2}px auto ${theme.gridUnit * 4}px auto;\n  `);\nconst StyledCssEditor = styled(CssEditor)`\n  ${({ theme }) => css`\n    border-radius: ${theme.borderRadius}px;\n    border: 1px solid ${theme.colors.secondary.light2};\n  `}\n`;\nconst TemplateContainer = styled.div(({ theme }) => css`\n    margin-bottom: ${theme.gridUnit * 10}px;\n\n    .control-label {\n      margin-bottom: ${theme.gridUnit * 2}px;\n    }\n\n    .required {\n      margin-left: ${theme.gridUnit / 2}px;\n      color: ${theme.colors.error.base};\n    }\n\n    input[type='text'] {\n      padding: ${theme.gridUnit * 1.5}px ${theme.gridUnit * 2}px;\n      border: 1px solid ${theme.colors.grayscale.light2};\n      border-radius: ${theme.gridUnit}px;\n      width: 50%;\n    }\n  `);\nconst CssTemplateModal = ({ addDangerToast, onCssTemplateAdd, onHide, show, cssTemplate = null }) => {\n  const theme = useTheme();\n  const [disableSave, setDisableSave] = useState(true);\n  const [currentCssTemplate, setCurrentCssTemplate] = useState(null);\n  const [isHidden, setIsHidden] = useState(true);\n  const isEditMode = cssTemplate !== null;\n  // cssTemplate fetch logic\n  const { state: { loading, resource }, fetchResource, createResource, updateResource } = useSingleViewResource('css_template', t('css_template'), addDangerToast);\n  // Functions\n  const hide = () => {\n    setIsHidden(true);\n    onHide();\n  };\n  const onSave = () => {\n    if (isEditMode) {\n      // Edit\n      if (currentCssTemplate != null && currentCssTemplate.id) {\n        const update_id = currentCssTemplate.id;\n        delete currentCssTemplate.id;\n        delete currentCssTemplate.created_by;\n        delete currentCssTemplate.changed_by;\n        delete currentCssTemplate.changed_on_delta_humanized;\n        updateResource(update_id, currentCssTemplate).then((response) => {\n          if (!response) {\n            return;\n          }\n          if (onCssTemplateAdd) {\n            onCssTemplateAdd();\n          }\n          hide();\n        });\n      }\n    } else\n    if (currentCssTemplate) {\n      // Create\n      createResource(currentCssTemplate).then((response) => {\n        if (!response) {\n          return;\n        }\n        if (onCssTemplateAdd) {\n          onCssTemplateAdd();\n        }\n        hide();\n      });\n    }\n  };\n  const onTemplateNameChange = (event) => {\n    const { target } = event;\n    const data = {\n      ...currentCssTemplate,\n      template_name: currentCssTemplate ? currentCssTemplate.template_name : '',\n      css: currentCssTemplate ? currentCssTemplate.css : ''\n    };\n    data[target.name] = target.value;\n    setCurrentCssTemplate(data);\n  };\n  const onCssChange = (css) => {\n    const data = {\n      ...currentCssTemplate,\n      template_name: currentCssTemplate ? currentCssTemplate.template_name : '',\n      css\n    };\n    setCurrentCssTemplate(data);\n  };\n  const validate = () => {var _currentCssTemplate$c;\n    if (currentCssTemplate != null && currentCssTemplate.template_name.length &&\n    currentCssTemplate != null && (_currentCssTemplate$c = currentCssTemplate.css) != null && _currentCssTemplate$c.length) {\n      setDisableSave(false);\n    } else\n    {\n      setDisableSave(true);\n    }\n  };\n  // Initialize\n  useEffect(() => {\n    if (isEditMode && (\n    !(currentCssTemplate != null && currentCssTemplate.id) ||\n    cssTemplate && (cssTemplate == null ? void 0 : cssTemplate.id) !== currentCssTemplate.id ||\n    isHidden && show)) {\n      if ((cssTemplate == null ? void 0 : cssTemplate.id) !== null && !loading) {\n        const id = cssTemplate.id || 0;\n        fetchResource(id);\n      }\n    } else\n    if (!isEditMode && (\n    !currentCssTemplate || currentCssTemplate.id || isHidden && show)) {\n      setCurrentCssTemplate({\n        template_name: '',\n        css: ''\n      });\n    }\n  }, [cssTemplate]);\n  useEffect(() => {\n    if (resource) {\n      setCurrentCssTemplate(resource);\n    }\n  }, [resource]);\n  // Validation\n  useEffect(() => {\n    validate();\n  }, [\n  currentCssTemplate ? currentCssTemplate.template_name : '',\n  currentCssTemplate ? currentCssTemplate.css : '']\n  );\n  // Show/hide\n  if (isHidden && show) {\n    setIsHidden(false);\n  }\n  return _jsxs(Modal, { disablePrimaryButton: disableSave, onHandledPrimaryAction: onSave, onHide: hide, primaryButtonName: isEditMode ? t('Save') : t('Add'), show: show, width: \"55%\", title: _jsxs(\"h4\", { children: [\n      isEditMode ? _jsx(Icons.EditOutlined, { iconSize: \"l\", css: css`\n                margin: auto ${theme.gridUnit * 2}px auto 0;\n              ` }) : _jsx(Icons.PlusOutlined, { iconSize: \"l\", css: css`\n                margin: auto ${theme.gridUnit * 2}px auto 0;\n              ` }),\n      isEditMode ?\n      t('Edit CSS template properties') :\n      t('Add CSS template')] }\n    ), children: [\n    _jsx(StyledCssTemplateTitle, { children:\n      _jsx(\"h4\", { children: t('Basic information') }) }\n    ),\n    _jsxs(TemplateContainer, { children: [\n      _jsxs(\"div\", { className: \"control-label\", children: [\n        t('Name'),\n        _jsx(\"span\", { className: \"required\", children: \"*\" })] }\n      ),\n      _jsx(\"input\", { name: \"template_name\", onChange: onTemplateNameChange, type: \"text\", value: currentCssTemplate == null ? void 0 : currentCssTemplate.template_name })] }\n    ),\n    _jsxs(TemplateContainer, { children: [\n      _jsxs(\"div\", { className: \"control-label\", children: [\n        t('css'),\n        _jsx(\"span\", { className: \"required\", children: \"*\" })] }\n      ),\n      _jsx(StyledCssEditor, { onChange: onCssChange, value: currentCssTemplate == null ? void 0 : currentCssTemplate.css, width: \"100%\" })] }\n    )] }\n  );\n};\nexport default withToasts(CssTemplateModal);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}