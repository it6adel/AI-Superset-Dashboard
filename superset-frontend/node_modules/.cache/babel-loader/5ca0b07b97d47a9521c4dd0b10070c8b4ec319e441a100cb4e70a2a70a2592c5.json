{"ast":null,"code":"/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-env browser */\nimport { extendedDayjs } from 'src/utils/dates';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport {\n  styled,\n  css,\n  isFeatureEnabled,\n  FeatureFlag,\n  t,\n  getExtensionsRegistry,\n  useTheme } from\n'@superset-ui/core';\nimport { Global } from '@emotion/react';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport {\n  LOG_ACTIONS_PERIODIC_RENDER_DASHBOARD,\n  LOG_ACTIONS_FORCE_REFRESH_DASHBOARD,\n  LOG_ACTIONS_TOGGLE_EDIT_DASHBOARD } from\n'src/logger/LogUtils';\nimport Icons from 'src/components/Icons';\nimport { Button } from 'src/components/';\nimport { findPermission } from 'src/utils/findPermission';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport PublishedStatus from 'src/dashboard/components/PublishedStatus';\nimport UndoRedoKeyListeners from 'src/dashboard/components/UndoRedoKeyListeners';\nimport PropertiesModal from 'src/dashboard/components/PropertiesModal';\nimport {\n  UNDO_LIMIT,\n  SAVE_TYPE_OVERWRITE,\n  DASHBOARD_POSITION_DATA_LIMIT,\n  DASHBOARD_HEADER_ID } from\n'src/dashboard/util/constants';\nimport setPeriodicRunner, {\n  stopPeriodicRender } from\n'src/dashboard/util/setPeriodicRunner';\nimport ReportModal from 'src/features/reports/ReportModal';\nimport DeleteModal from 'src/components/DeleteModal';\nimport { deleteActiveReport } from 'src/features/reports/ReportModal/actions';\nimport { PageHeaderWithActions } from 'src/components/PageHeaderWithActions';\nimport DashboardEmbedModal from '../EmbeddedModal';\nimport OverwriteConfirm from '../OverwriteConfirm';\nimport {\n  addDangerToast,\n  addSuccessToast,\n  addWarningToast } from\n'../../../components/MessageToasts/actions';\nimport {\n  dashboardTitleChanged,\n  redoLayoutAction,\n  undoLayoutAction,\n  updateDashboardTitle,\n  clearDashboardHistory } from\n'../../actions/dashboardLayout';\nimport {\n  fetchCharts,\n  fetchFaveStar,\n  maxUndoHistoryToast,\n  onChange,\n  onRefresh,\n  saveDashboardRequest,\n  saveFaveStar,\n  savePublished,\n  setEditMode,\n  setMaxUndoHistoryExceeded,\n  setRefreshFrequency,\n  setUnsavedChanges,\n  updateCss } from\n'../../actions/dashboardState';\nimport { logEvent } from '../../../logger/actions';\nimport { dashboardInfoChanged } from '../../actions/dashboardInfo';\nimport isDashboardLoading from '../../util/isDashboardLoading';\nimport { useChartIds } from '../../util/charts/useChartIds';\nimport { useDashboardMetadataBar } from './useDashboardMetadataBar';\nimport { useHeaderActionsMenu } from './useHeaderActionsDropdownMenu';import { jsx as _jsx, jsxs as _jsxs } from \"@emotion/react/jsx-runtime\";\n\nconst extensionsRegistry = getExtensionsRegistry();\n\nconst headerContainerStyle = (theme) => css`\n  border-bottom: 1px solid ${theme.colors.grayscale.light2};\n`;\n\nconst editButtonStyle = (theme) => css`\n  color: ${theme.colors.primary.dark2};\n`;\n\nconst actionButtonsStyle = (theme) => css`\n  display: flex;\n  align-items: center;\n\n  .action-schedule-report {\n    margin-left: ${theme.gridUnit * 2}px;\n  }\n\n  .undoRedo {\n    display: flex;\n    margin-right: ${theme.gridUnit * 2}px;\n  }\n`;\n\nconst StyledUndoRedoButton = styled(Button)`\n  // TODO: check if we need this\n  padding: 0;\n  &:hover {\n    background: transparent;\n  }\n`;\n\nconst undoRedoStyle = (theme) => css`\n  color: ${theme.colors.grayscale.light1};\n  &:hover {\n    color: ${theme.colors.grayscale.base};\n  }\n`;\n\nconst undoRedoEmphasized = (theme) => css`\n  color: ${theme.colors.grayscale.base};\n`;\n\nconst undoRedoDisabled = (theme) => css`\n  color: ${theme.colors.grayscale.light2};\n`;\n\nconst saveBtnStyle = (theme) => css`\n  min-width: ${theme.gridUnit * 17}px;\n  height: ${theme.gridUnit * 8}px;\n  span > :first-of-type {\n    margin-right: 0;\n  }\n`;\n\nconst discardBtnStyle = (theme) => css`\n  min-width: ${theme.gridUnit * 22}px;\n  height: ${theme.gridUnit * 8}px;\n`;\n\nconst discardChanges = () => {\n  const url = new URL(window.location.href);\n\n  url.searchParams.delete('edit');\n  window.location.assign(url);\n};\n\nconst Header = () => {var _layout$DASHBOARD_HEA, _layout$DASHBOARD_HEA2, _dashboardInfo$common7, _dashboardInfo$common8, _dashboardInfo$common9, _dashboardInfo$common10, _dashboardInfo$common11, _dashboardInfo$common12;\n  const theme = useTheme();\n  const dispatch = useDispatch();\n  const [didNotifyMaxUndoHistoryToast, setDidNotifyMaxUndoHistoryToast] =\n  useState(false);\n  const [emphasizeUndo, setEmphasizeUndo] = useState(false);\n  const [emphasizeRedo, setEmphasizeRedo] = useState(false);\n  const [showingPropertiesModal, setShowingPropertiesModal] = useState(false);\n  const [showingEmbedModal, setShowingEmbedModal] = useState(false);\n  const [showingReportModal, setShowingReportModal] = useState(false);\n  const [currentReportDeleting, setCurrentReportDeleting] = useState(null);\n  const dashboardInfo = useSelector((state) => state.dashboardInfo);\n  const layout = useSelector((state) => state.dashboardLayout.present);\n  const undoLength = useSelector((state) => state.dashboardLayout.past.length);\n  const redoLength = useSelector((state) => state.dashboardLayout.future.length);\n  const dataMask = useSelector((state) => state.dataMask);\n  const user = useSelector((state) => state.user);\n  const chartIds = useChartIds();\n\n  const {\n    expandedSlices,\n    refreshFrequency,\n    shouldPersistRefreshFrequency,\n    customCss,\n    colorNamespace,\n    colorScheme,\n    isStarred,\n    isPublished,\n    hasUnsavedChanges,\n    maxUndoHistoryExceeded,\n    editMode,\n    lastModifiedTime\n  } = useSelector(\n    (state) => ({\n      expandedSlices: state.dashboardState.expandedSlices,\n      refreshFrequency: state.dashboardState.refreshFrequency,\n      shouldPersistRefreshFrequency:\n      !!state.dashboardState.shouldPersistRefreshFrequency,\n      customCss: state.dashboardState.css,\n      colorNamespace: state.dashboardState.colorNamespace,\n      colorScheme: state.dashboardState.colorScheme,\n      isStarred: !!state.dashboardState.isStarred,\n      isPublished: !!state.dashboardState.isPublished,\n      hasUnsavedChanges: !!state.dashboardState.hasUnsavedChanges,\n      maxUndoHistoryExceeded: !!state.dashboardState.maxUndoHistoryExceeded,\n      editMode: !!state.dashboardState.editMode,\n      lastModifiedTime: state.lastModifiedTime\n    }),\n    shallowEqual\n  );\n  const isLoading = useSelector((state) => isDashboardLoading(state.charts));\n\n  const refreshTimer = useRef(0);\n  const ctrlYTimeout = useRef(0);\n  const ctrlZTimeout = useRef(0);\n\n  const dashboardTitle = (_layout$DASHBOARD_HEA = layout[DASHBOARD_HEADER_ID]) == null ? void 0 : (_layout$DASHBOARD_HEA2 = _layout$DASHBOARD_HEA.meta) == null ? void 0 : _layout$DASHBOARD_HEA2.text;\n  const { slug } = dashboardInfo;\n  const actualLastModifiedTime = Math.max(\n    lastModifiedTime,\n    dashboardInfo.last_modified_time\n  );\n  const boundActionCreators = useMemo(\n    () =>\n    bindActionCreators(\n      {\n        addSuccessToast,\n        addDangerToast,\n        addWarningToast,\n        onUndo: undoLayoutAction,\n        onRedo: redoLayoutAction,\n        clearDashboardHistory,\n        setEditMode,\n        setUnsavedChanges,\n        fetchFaveStar,\n        saveFaveStar,\n        savePublished,\n        fetchCharts,\n        updateDashboardTitle,\n        updateCss,\n        onChange,\n        onSave: saveDashboardRequest,\n        setMaxUndoHistoryExceeded,\n        maxUndoHistoryToast,\n        logEvent,\n        setRefreshFrequency,\n        onRefresh,\n        dashboardInfoChanged,\n        dashboardTitleChanged\n      },\n      dispatch\n    ),\n    [dispatch]\n  );\n\n  const startPeriodicRender = useCallback(\n    (interval) => {\n      let intervalMessage;\n\n      if (interval) {var _dashboardInfo$common, _dashboardInfo$common2;\n        const periodicRefreshOptions = (_dashboardInfo$common =\n        dashboardInfo.common) == null ? void 0 : (_dashboardInfo$common2 = _dashboardInfo$common.conf) == null ? void 0 : _dashboardInfo$common2.DASHBOARD_AUTO_REFRESH_INTERVALS;\n        const predefinedValue = periodicRefreshOptions.find(\n          (option) => Number(option[0]) === interval / 1000\n        );\n\n        if (predefinedValue) {\n          intervalMessage = t(predefinedValue[1]);\n        } else {\n          intervalMessage = extendedDayjs.\n          duration(interval, 'millisecond').\n          humanize();\n        }\n      }\n\n      const fetchCharts = (charts, force = false) =>\n      boundActionCreators.fetchCharts(\n        charts,\n        force,\n        interval * 0.2,\n        dashboardInfo.id\n      );\n\n      const periodicRender = () => {var _dashboardInfo$common3, _dashboardInfo$common4;\n        const { metadata } = dashboardInfo;\n        const immune = metadata.timed_refresh_immune_slices || [];\n        const affectedCharts = chartIds.filter(\n          (chartId) => immune.indexOf(chartId) === -1\n        );\n\n        boundActionCreators.logEvent(LOG_ACTIONS_PERIODIC_RENDER_DASHBOARD, {\n          interval,\n          chartCount: affectedCharts.length\n        });\n        boundActionCreators.addWarningToast(\n          t(\n            `This dashboard is currently auto refreshing; the next auto refresh will be in %s.`,\n            intervalMessage\n          )\n        );\n        if (\n        ((_dashboardInfo$common3 = dashboardInfo.common) == null ? void 0 : (_dashboardInfo$common4 = _dashboardInfo$common3.conf) == null ? void 0 : _dashboardInfo$common4.DASHBOARD_AUTO_REFRESH_MODE) === 'fetch')\n        {\n          // force-refresh while auto-refresh in dashboard\n          return fetchCharts(affectedCharts);\n        }\n        return fetchCharts(affectedCharts, true);\n      };\n\n      refreshTimer.current = setPeriodicRunner({\n        interval,\n        periodicRender,\n        refreshTimer: refreshTimer.current\n      });\n    },\n    [boundActionCreators, chartIds, dashboardInfo]\n  );\n\n  useEffect(() => {\n    startPeriodicRender(refreshFrequency * 1000);\n  }, [refreshFrequency, startPeriodicRender]);\n\n  useEffect(() => {\n    if (UNDO_LIMIT - undoLength <= 0 && !didNotifyMaxUndoHistoryToast) {\n      setDidNotifyMaxUndoHistoryToast(true);\n      boundActionCreators.maxUndoHistoryToast();\n    }\n    if (undoLength > UNDO_LIMIT && !maxUndoHistoryExceeded) {\n      boundActionCreators.setMaxUndoHistoryExceeded();\n    }\n  }, [\n  boundActionCreators,\n  didNotifyMaxUndoHistoryToast,\n  maxUndoHistoryExceeded,\n  undoLength]\n  );\n\n  useEffect(\n    () => () => {\n      stopPeriodicRender(refreshTimer.current);\n      boundActionCreators.setRefreshFrequency(0);\n      clearTimeout(ctrlYTimeout.current);\n      clearTimeout(ctrlZTimeout.current);\n    },\n    [boundActionCreators]\n  );\n\n  const handleChangeText = useCallback(\n    (nextText) => {\n      if (nextText && dashboardTitle !== nextText) {\n        boundActionCreators.updateDashboardTitle(nextText);\n        boundActionCreators.onChange();\n      }\n    },\n    [boundActionCreators, dashboardTitle]\n  );\n\n  const handleCtrlY = useCallback(() => {\n    boundActionCreators.onRedo();\n    setEmphasizeRedo(true);\n    if (ctrlYTimeout.current) {\n      clearTimeout(ctrlYTimeout.current);\n    }\n    ctrlYTimeout.current = setTimeout(() => {\n      setEmphasizeRedo(false);\n    }, 100);\n  }, [boundActionCreators]);\n\n  const handleCtrlZ = useCallback(() => {\n    boundActionCreators.onUndo();\n    setEmphasizeUndo(true);\n    if (ctrlZTimeout.current) {\n      clearTimeout(ctrlZTimeout.current);\n    }\n    ctrlZTimeout.current = setTimeout(() => {\n      setEmphasizeUndo(false);\n    }, 100);\n  }, [boundActionCreators]);\n\n  const forceRefresh = useCallback(() => {\n    if (!isLoading) {\n      boundActionCreators.logEvent(LOG_ACTIONS_FORCE_REFRESH_DASHBOARD, {\n        force: true,\n        interval: 0,\n        chartCount: chartIds.length\n      });\n      return boundActionCreators.onRefresh(chartIds, true, 0, dashboardInfo.id);\n    }\n    return false;\n  }, [boundActionCreators, chartIds, dashboardInfo.id, isLoading]);\n\n  const toggleEditMode = useCallback(() => {\n    boundActionCreators.logEvent(LOG_ACTIONS_TOGGLE_EDIT_DASHBOARD, {\n      edit_mode: !editMode\n    });\n    boundActionCreators.setEditMode(!editMode);\n  }, [boundActionCreators, editMode]);\n\n  const overwriteDashboard = useCallback(() => {var _dashboardInfo$metada, _dashboardInfo$metada2, _dashboardInfo$metada3, _dashboardInfo$common5, _dashboardInfo$common6;\n    const currentColorNamespace =\n    (dashboardInfo == null ? void 0 : (_dashboardInfo$metada = dashboardInfo.metadata) == null ? void 0 : _dashboardInfo$metada.color_namespace) || colorNamespace;\n    const currentColorScheme =\n    (dashboardInfo == null ? void 0 : (_dashboardInfo$metada2 = dashboardInfo.metadata) == null ? void 0 : _dashboardInfo$metada2.color_scheme) || colorScheme;\n\n    const data = {\n      certified_by: dashboardInfo.certified_by,\n      certification_details: dashboardInfo.certification_details,\n      css: customCss,\n      dashboard_title: dashboardTitle,\n      last_modified_time: actualLastModifiedTime,\n      owners: dashboardInfo.owners,\n      roles: dashboardInfo.roles,\n      slug,\n      metadata: {\n        ...(dashboardInfo == null ? void 0 : dashboardInfo.metadata),\n        color_namespace: currentColorNamespace,\n        color_scheme: currentColorScheme,\n        positions: layout,\n        refresh_frequency: shouldPersistRefreshFrequency ?\n        refreshFrequency : (_dashboardInfo$metada3 =\n        dashboardInfo.metadata) == null ? void 0 : _dashboardInfo$metada3.refresh_frequency\n      }\n    };\n\n    // make sure positions data less than DB storage limitation:\n    const positionJSONLength = safeStringify(layout).length;\n    const limit =\n    ((_dashboardInfo$common5 = dashboardInfo.common) == null ? void 0 : (_dashboardInfo$common6 = _dashboardInfo$common5.conf) == null ? void 0 : _dashboardInfo$common6.SUPERSET_DASHBOARD_POSITION_DATA_LIMIT) ||\n    DASHBOARD_POSITION_DATA_LIMIT;\n    if (positionJSONLength >= limit) {\n      boundActionCreators.addDangerToast(\n        t(\n          'Your dashboard is too large. Please reduce its size before saving it.'\n        )\n      );\n    } else {\n      if (positionJSONLength >= limit * 0.9) {\n        boundActionCreators.addWarningToast(\n          t('Your dashboard is near the size limit.')\n        );\n      }\n\n      boundActionCreators.onSave(data, dashboardInfo.id, SAVE_TYPE_OVERWRITE);\n    }\n  }, [\n  actualLastModifiedTime,\n  boundActionCreators,\n  colorNamespace,\n  colorScheme,\n  customCss,\n  dashboardInfo.certification_details,\n  dashboardInfo.certified_by, (_dashboardInfo$common7 =\n  dashboardInfo.common) == null ? void 0 : (_dashboardInfo$common8 = _dashboardInfo$common7.conf) == null ? void 0 : _dashboardInfo$common8.SUPERSET_DASHBOARD_POSITION_DATA_LIMIT,\n  dashboardInfo.id,\n  dashboardInfo.metadata,\n  dashboardInfo.owners,\n  dashboardInfo.roles,\n  dashboardTitle,\n  layout,\n  refreshFrequency,\n  shouldPersistRefreshFrequency,\n  slug]\n  );\n\n  const showPropertiesModal = useCallback(() => {\n    setShowingPropertiesModal(true);\n  }, []);\n\n  const hidePropertiesModal = useCallback(() => {\n    setShowingPropertiesModal(false);\n  }, []);\n\n  const showEmbedModal = useCallback(() => {\n    setShowingEmbedModal(true);\n  }, []);\n\n  const hideEmbedModal = useCallback(() => {\n    setShowingEmbedModal(false);\n  }, []);\n\n  const showReportModal = useCallback(() => {\n    setShowingReportModal(true);\n  }, []);\n\n  const hideReportModal = useCallback(() => {\n    setShowingReportModal(false);\n  }, []);\n\n  const metadataBar = useDashboardMetadataBar(dashboardInfo);\n\n  const userCanEdit =\n  dashboardInfo.dash_edit_perm && !dashboardInfo.is_managed_externally;\n  const userCanShare = dashboardInfo.dash_share_perm;\n  const userCanSaveAs = dashboardInfo.dash_save_perm;\n  const userCanCurate =\n  isFeatureEnabled(FeatureFlag.EmbeddedSuperset) &&\n  findPermission('can_set_embedded', 'Dashboard', user.roles);\n  const refreshLimit = (_dashboardInfo$common9 =\n  dashboardInfo.common) == null ? void 0 : (_dashboardInfo$common10 = _dashboardInfo$common9.conf) == null ? void 0 : _dashboardInfo$common10.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_LIMIT;\n  const refreshWarning = (_dashboardInfo$common11 =\n  dashboardInfo.common) == null ? void 0 : (_dashboardInfo$common12 = _dashboardInfo$common11.conf) == null ? void 0 : _dashboardInfo$common12.\n  SUPERSET_DASHBOARD_PERIODICAL_REFRESH_WARNING_MESSAGE;\n  const isEmbedded = !(dashboardInfo != null && dashboardInfo.userId);\n\n  const handleOnPropertiesChange = useCallback(\n    (updates) => {\n      boundActionCreators.dashboardInfoChanged({\n        slug: updates.slug,\n        metadata: JSON.parse(updates.jsonMetadata || '{}'),\n        certified_by: updates.certifiedBy,\n        certification_details: updates.certificationDetails,\n        owners: updates.owners,\n        roles: updates.roles\n      });\n      boundActionCreators.setUnsavedChanges(true);\n      boundActionCreators.dashboardTitleChanged(updates.title);\n    },\n    [boundActionCreators]\n  );\n\n  const NavExtension = extensionsRegistry.get('dashboard.nav.right');\n\n  const editableTitleProps = useMemo(\n    () => ({\n      title: dashboardTitle,\n      canEdit: userCanEdit && editMode,\n      onSave: handleChangeText,\n      placeholder: t('Add the name of the dashboard'),\n      label: t('Dashboard title'),\n      showTooltip: false\n    }),\n    [dashboardTitle, editMode, handleChangeText, userCanEdit]\n  );\n\n  const certifiedBadgeProps = useMemo(\n    () => ({\n      certifiedBy: dashboardInfo.certified_by,\n      details: dashboardInfo.certification_details\n    }),\n    [dashboardInfo.certification_details, dashboardInfo.certified_by]\n  );\n\n  const faveStarProps = useMemo(\n    () => ({\n      itemId: dashboardInfo.id,\n      fetchFaveStar: boundActionCreators.fetchFaveStar,\n      saveFaveStar: boundActionCreators.saveFaveStar,\n      isStarred,\n      showTooltip: true\n    }),\n    [\n    boundActionCreators.fetchFaveStar,\n    boundActionCreators.saveFaveStar,\n    dashboardInfo.id,\n    isStarred]\n\n  );\n\n  const titlePanelAdditionalItems = useMemo(\n    () => [\n    !editMode &&\n    _jsx(PublishedStatus, {\n      dashboardId: dashboardInfo.id,\n      isPublished: isPublished,\n      savePublished: boundActionCreators.savePublished,\n      userCanEdit: userCanEdit,\n      userCanSave: userCanSaveAs,\n      visible: !editMode }\n    ),\n\n    !editMode && !isEmbedded && metadataBar],\n\n    [\n    boundActionCreators.savePublished,\n    dashboardInfo.id,\n    editMode,\n    metadataBar,\n    isEmbedded,\n    isPublished,\n    userCanEdit,\n    userCanSaveAs]\n\n  );\n\n  const rightPanelAdditionalItems = useMemo(\n    () =>\n    _jsxs(\"div\", { className: \"button-container\", children: [\n      userCanSaveAs &&\n      _jsx(\"div\", { className: \"button-container\", children:\n        editMode &&\n        _jsxs(\"div\", { css: actionButtonsStyle, children: [\n          _jsxs(\"div\", { className: \"undoRedo\", children: [\n            _jsx(Tooltip, {\n              id: \"dashboard-undo-tooltip\",\n              title: t('Undo the action'), children:\n\n              _jsx(StyledUndoRedoButton, {\n                buttonStyle: \"link\",\n                disabled: undoLength < 1,\n                onClick: undoLength && boundActionCreators.onUndo, children:\n\n                _jsx(Icons.Undo, {\n                  css: [\n                  undoRedoStyle,\n                  emphasizeUndo && undoRedoEmphasized,\n                  undoLength < 1 && undoRedoDisabled, process.env.NODE_ENV === \"production\" ? \"\" : \";label:rightPanelAdditionalItems;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2FkZWwvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2Rhc2hib2FyZC9jb21wb25lbnRzL0hlYWRlci9pbmRleC5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBNGxCd0IiLCJmaWxlIjoiL2hvbWUvYWRlbC9zdXBlcnNldC9zdXBlcnNldC1mcm9udGVuZC9zcmMvZGFzaGJvYXJkL2NvbXBvbmVudHMvSGVhZGVyL2luZGV4LmpzeCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qIGVzbGludC1lbnYgYnJvd3NlciAqL1xuaW1wb3J0IHsgZXh0ZW5kZWREYXlqcyB9IGZyb20gJ3NyYy91dGlscy9kYXRlcyc7XG5pbXBvcnQgeyB1c2VDYWxsYmFjaywgdXNlRWZmZWN0LCB1c2VNZW1vLCB1c2VSZWYsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtcbiAgc3R5bGVkLFxuICBjc3MsXG4gIGlzRmVhdHVyZUVuYWJsZWQsXG4gIEZlYXR1cmVGbGFnLFxuICB0LFxuICBnZXRFeHRlbnNpb25zUmVnaXN0cnksXG4gIHVzZVRoZW1lLFxufSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgeyBHbG9iYWwgfSBmcm9tICdAZW1vdGlvbi9yZWFjdCc7XG5pbXBvcnQgeyBzaGFsbG93RXF1YWwsIHVzZURpc3BhdGNoLCB1c2VTZWxlY3RvciB9IGZyb20gJ3JlYWN0LXJlZHV4JztcbmltcG9ydCB7IGJpbmRBY3Rpb25DcmVhdG9ycyB9IGZyb20gJ3JlZHV4JztcbmltcG9ydCB7XG4gIExPR19BQ1RJT05TX1BFUklPRElDX1JFTkRFUl9EQVNIQk9BUkQsXG4gIExPR19BQ1RJT05TX0ZPUkNFX1JFRlJFU0hfREFTSEJPQVJELFxuICBMT0dfQUNUSU9OU19UT0dHTEVfRURJVF9EQVNIQk9BUkQsXG59IGZyb20gJ3NyYy9sb2dnZXIvTG9nVXRpbHMnO1xuaW1wb3J0IEljb25zIGZyb20gJ3NyYy9jb21wb25lbnRzL0ljb25zJztcbmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gJ3NyYy9jb21wb25lbnRzLyc7XG5pbXBvcnQgeyBmaW5kUGVybWlzc2lvbiB9IGZyb20gJ3NyYy91dGlscy9maW5kUGVybWlzc2lvbic7XG5pbXBvcnQgeyBUb29sdGlwIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvVG9vbHRpcCc7XG5pbXBvcnQgeyBzYWZlU3RyaW5naWZ5IH0gZnJvbSAnc3JjL3V0aWxzL3NhZmVTdHJpbmdpZnknO1xuaW1wb3J0IFB1Ymxpc2hlZFN0YXR1cyBmcm9tICdzcmMvZGFzaGJvYXJkL2NvbXBvbmVudHMvUHVibGlzaGVkU3RhdHVzJztcbmltcG9ydCBVbmRvUmVkb0tleUxpc3RlbmVycyBmcm9tICdzcmMvZGFzaGJvYXJkL2NvbXBvbmVudHMvVW5kb1JlZG9LZXlMaXN0ZW5lcnMnO1xuaW1wb3J0IFByb3BlcnRpZXNNb2RhbCBmcm9tICdzcmMvZGFzaGJvYXJkL2NvbXBvbmVudHMvUHJvcGVydGllc01vZGFsJztcbmltcG9ydCB7XG4gIFVORE9fTElNSVQsXG4gIFNBVkVfVFlQRV9PVkVSV1JJVEUsXG4gIERBU0hCT0FSRF9QT1NJVElPTl9EQVRBX0xJTUlULFxuICBEQVNIQk9BUkRfSEVBREVSX0lELFxufSBmcm9tICdzcmMvZGFzaGJvYXJkL3V0aWwvY29uc3RhbnRzJztcbmltcG9ydCBzZXRQZXJpb2RpY1J1bm5lciwge1xuICBzdG9wUGVyaW9kaWNSZW5kZXIsXG59IGZyb20gJ3NyYy9kYXNoYm9hcmQvdXRpbC9zZXRQZXJpb2RpY1J1bm5lcic7XG5pbXBvcnQgUmVwb3J0TW9kYWwgZnJvbSAnc3JjL2ZlYXR1cmVzL3JlcG9ydHMvUmVwb3J0TW9kYWwnO1xuaW1wb3J0IERlbGV0ZU1vZGFsIGZyb20gJ3NyYy9jb21wb25lbnRzL0RlbGV0ZU1vZGFsJztcbmltcG9ydCB7IGRlbGV0ZUFjdGl2ZVJlcG9ydCB9IGZyb20gJ3NyYy9mZWF0dXJlcy9yZXBvcnRzL1JlcG9ydE1vZGFsL2FjdGlvbnMnO1xuaW1wb3J0IHsgUGFnZUhlYWRlcldpdGhBY3Rpb25zIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvUGFnZUhlYWRlcldpdGhBY3Rpb25zJztcbmltcG9ydCBEYXNoYm9hcmRFbWJlZE1vZGFsIGZyb20gJy4uL0VtYmVkZGVkTW9kYWwnO1xuaW1wb3J0IE92ZXJ3cml0ZUNvbmZpcm0gZnJvbSAnLi4vT3ZlcndyaXRlQ29uZmlybSc7XG5pbXBvcnQge1xuICBhZGREYW5nZXJUb2FzdCxcbiAgYWRkU3VjY2Vzc1RvYXN0LFxuICBhZGRXYXJuaW5nVG9hc3QsXG59IGZyb20gJy4uLy4uLy4uL2NvbXBvbmVudHMvTWVzc2FnZVRvYXN0cy9hY3Rpb25zJztcbmltcG9ydCB7XG4gIGRhc2hib2FyZFRpdGxlQ2hhbmdlZCxcbiAgcmVkb0xheW91dEFjdGlvbixcbiAgdW5kb0xheW91dEFjdGlvbixcbiAgdXBkYXRlRGFzaGJvYXJkVGl0bGUsXG4gIGNsZWFyRGFzaGJvYXJkSGlzdG9yeSxcbn0gZnJvbSAnLi4vLi4vYWN0aW9ucy9kYXNoYm9hcmRMYXlvdXQnO1xuaW1wb3J0IHtcbiAgZmV0Y2hDaGFydHMsXG4gIGZldGNoRmF2ZVN0YXIsXG4gIG1heFVuZG9IaXN0b3J5VG9hc3QsXG4gIG9uQ2hhbmdlLFxuICBvblJlZnJlc2gsXG4gIHNhdmVEYXNoYm9hcmRSZXF1ZXN0LFxuICBzYXZlRmF2ZVN0YXIsXG4gIHNhdmVQdWJsaXNoZWQsXG4gIHNldEVkaXRNb2RlLFxuICBzZXRNYXhVbmRvSGlzdG9yeUV4Y2VlZGVkLFxuICBzZXRSZWZyZXNoRnJlcXVlbmN5LFxuICBzZXRVbnNhdmVkQ2hhbmdlcyxcbiAgdXBkYXRlQ3NzLFxufSBmcm9tICcuLi8uLi9hY3Rpb25zL2Rhc2hib2FyZFN0YXRlJztcbmltcG9ydCB7IGxvZ0V2ZW50IH0gZnJvbSAnLi4vLi4vLi4vbG9nZ2VyL2FjdGlvbnMnO1xuaW1wb3J0IHsgZGFzaGJvYXJkSW5mb0NoYW5nZWQgfSBmcm9tICcuLi8uLi9hY3Rpb25zL2Rhc2hib2FyZEluZm8nO1xuaW1wb3J0IGlzRGFzaGJvYXJkTG9hZGluZyBmcm9tICcuLi8uLi91dGlsL2lzRGFzaGJvYXJkTG9hZGluZyc7XG5pbXBvcnQgeyB1c2VDaGFydElkcyB9IGZyb20gJy4uLy4uL3V0aWwvY2hhcnRzL3VzZUNoYXJ0SWRzJztcbmltcG9ydCB7IHVzZURhc2hib2FyZE1ldGFkYXRhQmFyIH0gZnJvbSAnLi91c2VEYXNoYm9hcmRNZXRhZGF0YUJhcic7XG5pbXBvcnQgeyB1c2VIZWFkZXJBY3Rpb25zTWVudSB9IGZyb20gJy4vdXNlSGVhZGVyQWN0aW9uc0Ryb3Bkb3duTWVudSc7XG5cbmNvbnN0IGV4dGVuc2lvbnNSZWdpc3RyeSA9IGdldEV4dGVuc2lvbnNSZWdpc3RyeSgpO1xuXG5jb25zdCBoZWFkZXJDb250YWluZXJTdHlsZSA9IHRoZW1lID0+IGNzc2BcbiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICR7dGhlbWUuY29sb3JzLmdyYXlzY2FsZS5saWdodDJ9O1xuYDtcblxuY29uc3QgZWRpdEJ1dHRvblN0eWxlID0gdGhlbWUgPT4gY3NzYFxuICBjb2xvcjogJHt0aGVtZS5jb2xvcnMucHJpbWFyeS5kYXJrMn07XG5gO1xuXG5jb25zdCBhY3Rpb25CdXR0b25zU3R5bGUgPSB0aGVtZSA9PiBjc3NgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG5cbiAgLmFjdGlvbi1zY2hlZHVsZS1yZXBvcnQge1xuICAgIG1hcmdpbi1sZWZ0OiAke3RoZW1lLmdyaWRVbml0ICogMn1weDtcbiAgfVxuXG4gIC51bmRvUmVkbyB7XG4gICAgZGlzcGxheTogZmxleDtcbiAgICBtYXJnaW4tcmlnaHQ6ICR7dGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICB9XG5gO1xuXG5jb25zdCBTdHlsZWRVbmRvUmVkb0J1dHRvbiA9IHN0eWxlZChCdXR0b24pYFxuICAvLyBUT0RPOiBjaGVjayBpZiB3ZSBuZWVkIHRoaXNcbiAgcGFkZGluZzogMDtcbiAgJjpob3ZlciB7XG4gICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7XG4gIH1cbmA7XG5cbmNvbnN0IHVuZG9SZWRvU3R5bGUgPSB0aGVtZSA9PiBjc3NgXG4gIGNvbG9yOiAke3RoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQxfTtcbiAgJjpob3ZlciB7XG4gICAgY29sb3I6ICR7dGhlbWUuY29sb3JzLmdyYXlzY2FsZS5iYXNlfTtcbiAgfVxuYDtcblxuY29uc3QgdW5kb1JlZG9FbXBoYXNpemVkID0gdGhlbWUgPT4gY3NzYFxuICBjb2xvcjogJHt0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmJhc2V9O1xuYDtcblxuY29uc3QgdW5kb1JlZG9EaXNhYmxlZCA9IHRoZW1lID0+IGNzc2BcbiAgY29sb3I6ICR7dGhlbWUuY29sb3JzLmdyYXlzY2FsZS5saWdodDJ9O1xuYDtcblxuY29uc3Qgc2F2ZUJ0blN0eWxlID0gdGhlbWUgPT4gY3NzYFxuICBtaW4td2lkdGg6ICR7dGhlbWUuZ3JpZFVuaXQgKiAxN31weDtcbiAgaGVpZ2h0OiAke3RoZW1lLmdyaWRVbml0ICogOH1weDtcbiAgc3BhbiA+IDpmaXJzdC1vZi10eXBlIHtcbiAgICBtYXJnaW4tcmlnaHQ6IDA7XG4gIH1cbmA7XG5cbmNvbnN0IGRpc2NhcmRCdG5TdHlsZSA9IHRoZW1lID0+IGNzc2BcbiAgbWluLXdpZHRoOiAke3RoZW1lLmdyaWRVbml0ICogMjJ9cHg7XG4gIGhlaWdodDogJHt0aGVtZS5ncmlkVW5pdCAqIDh9cHg7XG5gO1xuXG5jb25zdCBkaXNjYXJkQ2hhbmdlcyA9ICgpID0+IHtcbiAgY29uc3QgdXJsID0gbmV3IFVSTCh3aW5kb3cubG9jYXRpb24uaHJlZik7XG5cbiAgdXJsLnNlYXJjaFBhcmFtcy5kZWxldGUoJ2VkaXQnKTtcbiAgd2luZG93LmxvY2F0aW9uLmFzc2lnbih1cmwpO1xufTtcblxuY29uc3QgSGVhZGVyID0gKCkgPT4ge1xuICBjb25zdCB0aGVtZSA9IHVzZVRoZW1lKCk7XG4gIGNvbnN0IGRpc3BhdGNoID0gdXNlRGlzcGF0Y2goKTtcbiAgY29uc3QgW2RpZE5vdGlmeU1heFVuZG9IaXN0b3J5VG9hc3QsIHNldERpZE5vdGlmeU1heFVuZG9IaXN0b3J5VG9hc3RdID1cbiAgICB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtlbXBoYXNpemVVbmRvLCBzZXRFbXBoYXNpemVVbmRvXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW2VtcGhhc2l6ZVJlZG8sIHNldEVtcGhhc2l6ZVJlZG9dID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbc2hvd2luZ1Byb3BlcnRpZXNNb2RhbCwgc2V0U2hvd2luZ1Byb3BlcnRpZXNNb2RhbF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtzaG93aW5nRW1iZWRNb2RhbCwgc2V0U2hvd2luZ0VtYmVkTW9kYWxdID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbc2hvd2luZ1JlcG9ydE1vZGFsLCBzZXRTaG93aW5nUmVwb3J0TW9kYWxdID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbY3VycmVudFJlcG9ydERlbGV0aW5nLCBzZXRDdXJyZW50UmVwb3J0RGVsZXRpbmddID0gdXNlU3RhdGUobnVsbCk7XG4gIGNvbnN0IGRhc2hib2FyZEluZm8gPSB1c2VTZWxlY3RvcihzdGF0ZSA9PiBzdGF0ZS5kYXNoYm9hcmRJbmZvKTtcbiAgY29uc3QgbGF5b3V0ID0gdXNlU2VsZWN0b3Ioc3RhdGUgPT4gc3RhdGUuZGFzaGJvYXJkTGF5b3V0LnByZXNlbnQpO1xuICBjb25zdCB1bmRvTGVuZ3RoID0gdXNlU2VsZWN0b3Ioc3RhdGUgPT4gc3RhdGUuZGFzaGJvYXJkTGF5b3V0LnBhc3QubGVuZ3RoKTtcbiAgY29uc3QgcmVkb0xlbmd0aCA9IHVzZVNlbGVjdG9yKHN0YXRlID0+IHN0YXRlLmRhc2hib2FyZExheW91dC5mdXR1cmUubGVuZ3RoKTtcbiAgY29uc3QgZGF0YU1hc2sgPSB1c2VTZWxlY3RvcihzdGF0ZSA9PiBzdGF0ZS5kYXRhTWFzayk7XG4gIGNvbnN0IHVzZXIgPSB1c2VTZWxlY3RvcihzdGF0ZSA9PiBzdGF0ZS51c2VyKTtcbiAgY29uc3QgY2hhcnRJZHMgPSB1c2VDaGFydElkcygpO1xuXG4gIGNvbnN0IHtcbiAgICBleHBhbmRlZFNsaWNlcyxcbiAgICByZWZyZXNoRnJlcXVlbmN5LFxuICAgIHNob3VsZFBlcnNpc3RSZWZyZXNoRnJlcXVlbmN5LFxuICAgIGN1c3RvbUNzcyxcbiAgICBjb2xvck5hbWVzcGFjZSxcbiAgICBjb2xvclNjaGVtZSxcbiAgICBpc1N0YXJyZWQsXG4gICAgaXNQdWJsaXNoZWQsXG4gICAgaGFzVW5zYXZlZENoYW5nZXMsXG4gICAgbWF4VW5kb0hpc3RvcnlFeGNlZWRlZCxcbiAgICBlZGl0TW9kZSxcbiAgICBsYXN0TW9kaWZpZWRUaW1lLFxuICB9ID0gdXNlU2VsZWN0b3IoXG4gICAgc3RhdGUgPT4gKHtcbiAgICAgIGV4cGFuZGVkU2xpY2VzOiBzdGF0ZS5kYXNoYm9hcmRTdGF0ZS5leHBhbmRlZFNsaWNlcyxcbiAgICAgIHJlZnJlc2hGcmVxdWVuY3k6IHN0YXRlLmRhc2hib2FyZFN0YXRlLnJlZnJlc2hGcmVxdWVuY3ksXG4gICAgICBzaG91bGRQZXJzaXN0UmVmcmVzaEZyZXF1ZW5jeTpcbiAgICAgICAgISFzdGF0ZS5kYXNoYm9hcmRTdGF0ZS5zaG91bGRQZXJzaXN0UmVmcmVzaEZyZXF1ZW5jeSxcbiAgICAgIGN1c3RvbUNzczogc3RhdGUuZGFzaGJvYXJkU3RhdGUuY3NzLFxuICAgICAgY29sb3JOYW1lc3BhY2U6IHN0YXRlLmRhc2hib2FyZFN0YXRlLmNvbG9yTmFtZXNwYWNlLFxuICAgICAgY29sb3JTY2hlbWU6IHN0YXRlLmRhc2hib2FyZFN0YXRlLmNvbG9yU2NoZW1lLFxuICAgICAgaXNTdGFycmVkOiAhIXN0YXRlLmRhc2hib2FyZFN0YXRlLmlzU3RhcnJlZCxcbiAgICAgIGlzUHVibGlzaGVkOiAhIXN0YXRlLmRhc2hib2FyZFN0YXRlLmlzUHVibGlzaGVkLFxuICAgICAgaGFzVW5zYXZlZENoYW5nZXM6ICEhc3RhdGUuZGFzaGJvYXJkU3RhdGUuaGFzVW5zYXZlZENoYW5nZXMsXG4gICAgICBtYXhVbmRvSGlzdG9yeUV4Y2VlZGVkOiAhIXN0YXRlLmRhc2hib2FyZFN0YXRlLm1heFVuZG9IaXN0b3J5RXhjZWVkZWQsXG4gICAgICBlZGl0TW9kZTogISFzdGF0ZS5kYXNoYm9hcmRTdGF0ZS5lZGl0TW9kZSxcbiAgICAgIGxhc3RNb2RpZmllZFRpbWU6IHN0YXRlLmxhc3RNb2RpZmllZFRpbWUsXG4gICAgfSksXG4gICAgc2hhbGxvd0VxdWFsLFxuICApO1xuICBjb25zdCBpc0xvYWRpbmcgPSB1c2VTZWxlY3RvcihzdGF0ZSA9PiBpc0Rhc2hib2FyZExvYWRpbmcoc3RhdGUuY2hhcnRzKSk7XG5cbiAgY29uc3QgcmVmcmVzaFRpbWVyID0gdXNlUmVmKDApO1xuICBjb25zdCBjdHJsWVRpbWVvdXQgPSB1c2VSZWYoMCk7XG4gIGNvbnN0IGN0cmxaVGltZW91dCA9IHVzZVJlZigwKTtcblxuICBjb25zdCBkYXNoYm9hcmRUaXRsZSA9IGxheW91dFtEQVNIQk9BUkRfSEVBREVSX0lEXT8ubWV0YT8udGV4dDtcbiAgY29uc3QgeyBzbHVnIH0gPSBkYXNoYm9hcmRJbmZvO1xuICBjb25zdCBhY3R1YWxMYXN0TW9kaWZpZWRUaW1lID0gTWF0aC5tYXgoXG4gICAgbGFzdE1vZGlmaWVkVGltZSxcbiAgICBkYXNoYm9hcmRJbmZvLmxhc3RfbW9kaWZpZWRfdGltZSxcbiAgKTtcbiAgY29uc3QgYm91bmRBY3Rpb25DcmVhdG9ycyA9IHVzZU1lbW8oXG4gICAgKCkgPT5cbiAgICAgIGJpbmRBY3Rpb25DcmVhdG9ycyhcbiAgICAgICAge1xuICAgICAgICAgIGFkZFN1Y2Nlc3NUb2FzdCxcbiAgICAgICAgICBhZGREYW5nZXJUb2FzdCxcbiAgICAgICAgICBhZGRXYXJuaW5nVG9hc3QsXG4gICAgICAgICAgb25VbmRvOiB1bmRvTGF5b3V0QWN0aW9uLFxuICAgICAgICAgIG9uUmVkbzogcmVkb0xheW91dEFjdGlvbixcbiAgICAgICAgICBjbGVhckRhc2hib2FyZEhpc3RvcnksXG4gICAgICAgICAgc2V0RWRpdE1vZGUsXG4gICAgICAgICAgc2V0VW5zYXZlZENoYW5nZXMsXG4gICAgICAgICAgZmV0Y2hGYXZlU3RhcixcbiAgICAgICAgICBzYXZlRmF2ZVN0YXIsXG4gICAgICAgICAgc2F2ZVB1Ymxpc2hlZCxcbiAgICAgICAgICBmZXRjaENoYXJ0cyxcbiAgICAgICAgICB1cGRhdGVEYXNoYm9hcmRUaXRsZSxcbiAgICAgICAgICB1cGRhdGVDc3MsXG4gICAgICAgICAgb25DaGFuZ2UsXG4gICAgICAgICAgb25TYXZlOiBzYXZlRGFzaGJvYXJkUmVxdWVzdCxcbiAgICAgICAgICBzZXRNYXhVbmRvSGlzdG9yeUV4Y2VlZGVkLFxuICAgICAgICAgIG1heFVuZG9IaXN0b3J5VG9hc3QsXG4gICAgICAgICAgbG9nRXZlbnQsXG4gICAgICAgICAgc2V0UmVmcmVzaEZyZXF1ZW5jeSxcbiAgICAgICAgICBvblJlZnJlc2gsXG4gICAgICAgICAgZGFzaGJvYXJkSW5mb0NoYW5nZWQsXG4gICAgICAgICAgZGFzaGJvYXJkVGl0bGVDaGFuZ2VkLFxuICAgICAgICB9LFxuICAgICAgICBkaXNwYXRjaCxcbiAgICAgICksXG4gICAgW2Rpc3BhdGNoXSxcbiAgKTtcblxuICBjb25zdCBzdGFydFBlcmlvZGljUmVuZGVyID0gdXNlQ2FsbGJhY2soXG4gICAgaW50ZXJ2YWwgPT4ge1xuICAgICAgbGV0IGludGVydmFsTWVzc2FnZTtcblxuICAgICAgaWYgKGludGVydmFsKSB7XG4gICAgICAgIGNvbnN0IHBlcmlvZGljUmVmcmVzaE9wdGlvbnMgPVxuICAgICAgICAgIGRhc2hib2FyZEluZm8uY29tbW9uPy5jb25mPy5EQVNIQk9BUkRfQVVUT19SRUZSRVNIX0lOVEVSVkFMUztcbiAgICAgICAgY29uc3QgcHJlZGVmaW5lZFZhbHVlID0gcGVyaW9kaWNSZWZyZXNoT3B0aW9ucy5maW5kKFxuICAgICAgICAgIG9wdGlvbiA9PiBOdW1iZXIob3B0aW9uWzBdKSA9PT0gaW50ZXJ2YWwgLyAxMDAwLFxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChwcmVkZWZpbmVkVmFsdWUpIHtcbiAgICAgICAgICBpbnRlcnZhbE1lc3NhZ2UgPSB0KHByZWRlZmluZWRWYWx1ZVsxXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaW50ZXJ2YWxNZXNzYWdlID0gZXh0ZW5kZWREYXlqc1xuICAgICAgICAgICAgLmR1cmF0aW9uKGludGVydmFsLCAnbWlsbGlzZWNvbmQnKVxuICAgICAgICAgICAgLmh1bWFuaXplKCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgZmV0Y2hDaGFydHMgPSAoY2hhcnRzLCBmb3JjZSA9IGZhbHNlKSA9PlxuICAgICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLmZldGNoQ2hhcnRzKFxuICAgICAgICAgIGNoYXJ0cyxcbiAgICAgICAgICBmb3JjZSxcbiAgICAgICAgICBpbnRlcnZhbCAqIDAuMixcbiAgICAgICAgICBkYXNoYm9hcmRJbmZvLmlkLFxuICAgICAgICApO1xuXG4gICAgICBjb25zdCBwZXJpb2RpY1JlbmRlciA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyBtZXRhZGF0YSB9ID0gZGFzaGJvYXJkSW5mbztcbiAgICAgICAgY29uc3QgaW1tdW5lID0gbWV0YWRhdGEudGltZWRfcmVmcmVzaF9pbW11bmVfc2xpY2VzIHx8IFtdO1xuICAgICAgICBjb25zdCBhZmZlY3RlZENoYXJ0cyA9IGNoYXJ0SWRzLmZpbHRlcihcbiAgICAgICAgICBjaGFydElkID0+IGltbXVuZS5pbmRleE9mKGNoYXJ0SWQpID09PSAtMSxcbiAgICAgICAgKTtcblxuICAgICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLmxvZ0V2ZW50KExPR19BQ1RJT05TX1BFUklPRElDX1JFTkRFUl9EQVNIQk9BUkQsIHtcbiAgICAgICAgICBpbnRlcnZhbCxcbiAgICAgICAgICBjaGFydENvdW50OiBhZmZlY3RlZENoYXJ0cy5sZW5ndGgsXG4gICAgICAgIH0pO1xuICAgICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLmFkZFdhcm5pbmdUb2FzdChcbiAgICAgICAgICB0KFxuICAgICAgICAgICAgYFRoaXMgZGFzaGJvYXJkIGlzIGN1cnJlbnRseSBhdXRvIHJlZnJlc2hpbmc7IHRoZSBuZXh0IGF1dG8gcmVmcmVzaCB3aWxsIGJlIGluICVzLmAsXG4gICAgICAgICAgICBpbnRlcnZhbE1lc3NhZ2UsXG4gICAgICAgICAgKSxcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGRhc2hib2FyZEluZm8uY29tbW9uPy5jb25mPy5EQVNIQk9BUkRfQVVUT19SRUZSRVNIX01PREUgPT09ICdmZXRjaCdcbiAgICAgICAgKSB7XG4gICAgICAgICAgLy8gZm9yY2UtcmVmcmVzaCB3aGlsZSBhdXRvLXJlZnJlc2ggaW4gZGFzaGJvYXJkXG4gICAgICAgICAgcmV0dXJuIGZldGNoQ2hhcnRzKGFmZmVjdGVkQ2hhcnRzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmV0Y2hDaGFydHMoYWZmZWN0ZWRDaGFydHMsIHRydWUpO1xuICAgICAgfTtcblxuICAgICAgcmVmcmVzaFRpbWVyLmN1cnJlbnQgPSBzZXRQZXJpb2RpY1J1bm5lcih7XG4gICAgICAgIGludGVydmFsLFxuICAgICAgICBwZXJpb2RpY1JlbmRlcixcbiAgICAgICAgcmVmcmVzaFRpbWVyOiByZWZyZXNoVGltZXIuY3VycmVudCxcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgW2JvdW5kQWN0aW9uQ3JlYXRvcnMsIGNoYXJ0SWRzLCBkYXNoYm9hcmRJbmZvXSxcbiAgKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHN0YXJ0UGVyaW9kaWNSZW5kZXIocmVmcmVzaEZyZXF1ZW5jeSAqIDEwMDApO1xuICB9LCBbcmVmcmVzaEZyZXF1ZW5jeSwgc3RhcnRQZXJpb2RpY1JlbmRlcl0pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKFVORE9fTElNSVQgLSB1bmRvTGVuZ3RoIDw9IDAgJiYgIWRpZE5vdGlmeU1heFVuZG9IaXN0b3J5VG9hc3QpIHtcbiAgICAgIHNldERpZE5vdGlmeU1heFVuZG9IaXN0b3J5VG9hc3QodHJ1ZSk7XG4gICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLm1heFVuZG9IaXN0b3J5VG9hc3QoKTtcbiAgICB9XG4gICAgaWYgKHVuZG9MZW5ndGggPiBVTkRPX0xJTUlUICYmICFtYXhVbmRvSGlzdG9yeUV4Y2VlZGVkKSB7XG4gICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLnNldE1heFVuZG9IaXN0b3J5RXhjZWVkZWQoKTtcbiAgICB9XG4gIH0sIFtcbiAgICBib3VuZEFjdGlvbkNyZWF0b3JzLFxuICAgIGRpZE5vdGlmeU1heFVuZG9IaXN0b3J5VG9hc3QsXG4gICAgbWF4VW5kb0hpc3RvcnlFeGNlZWRlZCxcbiAgICB1bmRvTGVuZ3RoLFxuICBdKTtcblxuICB1c2VFZmZlY3QoXG4gICAgKCkgPT4gKCkgPT4ge1xuICAgICAgc3RvcFBlcmlvZGljUmVuZGVyKHJlZnJlc2hUaW1lci5jdXJyZW50KTtcbiAgICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMuc2V0UmVmcmVzaEZyZXF1ZW5jeSgwKTtcbiAgICAgIGNsZWFyVGltZW91dChjdHJsWVRpbWVvdXQuY3VycmVudCk7XG4gICAgICBjbGVhclRpbWVvdXQoY3RybFpUaW1lb3V0LmN1cnJlbnQpO1xuICAgIH0sXG4gICAgW2JvdW5kQWN0aW9uQ3JlYXRvcnNdLFxuICApO1xuXG4gIGNvbnN0IGhhbmRsZUNoYW5nZVRleHQgPSB1c2VDYWxsYmFjayhcbiAgICBuZXh0VGV4dCA9PiB7XG4gICAgICBpZiAobmV4dFRleHQgJiYgZGFzaGJvYXJkVGl0bGUgIT09IG5leHRUZXh0KSB7XG4gICAgICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMudXBkYXRlRGFzaGJvYXJkVGl0bGUobmV4dFRleHQpO1xuICAgICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLm9uQ2hhbmdlKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBbYm91bmRBY3Rpb25DcmVhdG9ycywgZGFzaGJvYXJkVGl0bGVdLFxuICApO1xuXG4gIGNvbnN0IGhhbmRsZUN0cmxZID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMub25SZWRvKCk7XG4gICAgc2V0RW1waGFzaXplUmVkbyh0cnVlKTtcbiAgICBpZiAoY3RybFlUaW1lb3V0LmN1cnJlbnQpIHtcbiAgICAgIGNsZWFyVGltZW91dChjdHJsWVRpbWVvdXQuY3VycmVudCk7XG4gICAgfVxuICAgIGN0cmxZVGltZW91dC5jdXJyZW50ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBzZXRFbXBoYXNpemVSZWRvKGZhbHNlKTtcbiAgICB9LCAxMDApO1xuICB9LCBbYm91bmRBY3Rpb25DcmVhdG9yc10pO1xuXG4gIGNvbnN0IGhhbmRsZUN0cmxaID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMub25VbmRvKCk7XG4gICAgc2V0RW1waGFzaXplVW5kbyh0cnVlKTtcbiAgICBpZiAoY3RybFpUaW1lb3V0LmN1cnJlbnQpIHtcbiAgICAgIGNsZWFyVGltZW91dChjdHJsWlRpbWVvdXQuY3VycmVudCk7XG4gICAgfVxuICAgIGN0cmxaVGltZW91dC5jdXJyZW50ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBzZXRFbXBoYXNpemVVbmRvKGZhbHNlKTtcbiAgICB9LCAxMDApO1xuICB9LCBbYm91bmRBY3Rpb25DcmVhdG9yc10pO1xuXG4gIGNvbnN0IGZvcmNlUmVmcmVzaCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAoIWlzTG9hZGluZykge1xuICAgICAgYm91bmRBY3Rpb25DcmVhdG9ycy5sb2dFdmVudChMT0dfQUNUSU9OU19GT1JDRV9SRUZSRVNIX0RBU0hCT0FSRCwge1xuICAgICAgICBmb3JjZTogdHJ1ZSxcbiAgICAgICAgaW50ZXJ2YWw6IDAsXG4gICAgICAgIGNoYXJ0Q291bnQ6IGNoYXJ0SWRzLmxlbmd0aCxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGJvdW5kQWN0aW9uQ3JlYXRvcnMub25SZWZyZXNoKGNoYXJ0SWRzLCB0cnVlLCAwLCBkYXNoYm9hcmRJbmZvLmlkKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LCBbYm91bmRBY3Rpb25DcmVhdG9ycywgY2hhcnRJZHMsIGRhc2hib2FyZEluZm8uaWQsIGlzTG9hZGluZ10pO1xuXG4gIGNvbnN0IHRvZ2dsZUVkaXRNb2RlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMubG9nRXZlbnQoTE9HX0FDVElPTlNfVE9HR0xFX0VESVRfREFTSEJPQVJELCB7XG4gICAgICBlZGl0X21vZGU6ICFlZGl0TW9kZSxcbiAgICB9KTtcbiAgICBib3VuZEFjdGlvbkNyZWF0b3JzLnNldEVkaXRNb2RlKCFlZGl0TW9kZSk7XG4gIH0sIFtib3VuZEFjdGlvbkNyZWF0b3JzLCBlZGl0TW9kZV0pO1xuXG4gIGNvbnN0IG92ZXJ3cml0ZURhc2hib2FyZCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBjb25zdCBjdXJyZW50Q29sb3JOYW1lc3BhY2UgPVxuICAgICAgZGFzaGJvYXJkSW5mbz8ubWV0YWRhdGE/LmNvbG9yX25hbWVzcGFjZSB8fCBjb2xvck5hbWVzcGFjZTtcbiAgICBjb25zdCBjdXJyZW50Q29sb3JTY2hlbWUgPVxuICAgICAgZGFzaGJvYXJkSW5mbz8ubWV0YWRhdGE/LmNvbG9yX3NjaGVtZSB8fCBjb2xvclNjaGVtZTtcblxuICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICBjZXJ0aWZpZWRfYnk6IGRhc2hib2FyZEluZm8uY2VydGlmaWVkX2J5LFxuICAgICAgY2VydGlmaWNhdGlvbl9kZXRhaWxzOiBkYXNoYm9hcmRJbmZvLmNlcnRpZmljYXRpb25fZGV0YWlscyxcbiAgICAgIGNzczogY3VzdG9tQ3NzLFxuICAgICAgZGFzaGJvYXJkX3RpdGxlOiBkYXNoYm9hcmRUaXRsZSxcbiAgICAgIGxhc3RfbW9kaWZpZWRfdGltZTogYWN0dWFsTGFzdE1vZGlmaWVkVGltZSxcbiAgICAgIG93bmVyczogZGFzaGJvYXJkSW5mby5vd25lcnMsXG4gICAgICByb2xlczogZGFzaGJvYXJkSW5mby5yb2xlcyxcbiAgICAgIHNsdWcsXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICAuLi5kYXNoYm9hcmRJbmZvPy5tZXRhZGF0YSxcbiAgICAgICAgY29sb3JfbmFtZXNwYWNlOiBjdXJyZW50Q29sb3JOYW1lc3BhY2UsXG4gICAgICAgIGNvbG9yX3NjaGVtZTogY3VycmVudENvbG9yU2NoZW1lLFxuICAgICAgICBwb3NpdGlvbnM6IGxheW91dCxcbiAgICAgICAgcmVmcmVzaF9mcmVxdWVuY3k6IHNob3VsZFBlcnNpc3RSZWZyZXNoRnJlcXVlbmN5XG4gICAgICAgICAgPyByZWZyZXNoRnJlcXVlbmN5XG4gICAgICAgICAgOiBkYXNoYm9hcmRJbmZvLm1ldGFkYXRhPy5yZWZyZXNoX2ZyZXF1ZW5jeSxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIC8vIG1ha2Ugc3VyZSBwb3NpdGlvbnMgZGF0YSBsZXNzIHRoYW4gREIgc3RvcmFnZSBsaW1pdGF0aW9uOlxuICAgIGNvbnN0IHBvc2l0aW9uSlNPTkxlbmd0aCA9IHNhZmVTdHJpbmdpZnkobGF5b3V0KS5sZW5ndGg7XG4gICAgY29uc3QgbGltaXQgPVxuICAgICAgZGFzaGJvYXJkSW5mby5jb21tb24/LmNvbmY/LlNVUEVSU0VUX0RBU0hCT0FSRF9QT1NJVElPTl9EQVRBX0xJTUlUIHx8XG4gICAgICBEQVNIQk9BUkRfUE9TSVRJT05fREFUQV9MSU1JVDtcbiAgICBpZiAocG9zaXRpb25KU09OTGVuZ3RoID49IGxpbWl0KSB7XG4gICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLmFkZERhbmdlclRvYXN0KFxuICAgICAgICB0KFxuICAgICAgICAgICdZb3VyIGRhc2hib2FyZCBpcyB0b28gbGFyZ2UuIFBsZWFzZSByZWR1Y2UgaXRzIHNpemUgYmVmb3JlIHNhdmluZyBpdC4nLFxuICAgICAgICApLFxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHBvc2l0aW9uSlNPTkxlbmd0aCA+PSBsaW1pdCAqIDAuOSkge1xuICAgICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLmFkZFdhcm5pbmdUb2FzdChcbiAgICAgICAgICB0KCdZb3VyIGRhc2hib2FyZCBpcyBuZWFyIHRoZSBzaXplIGxpbWl0LicpLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLm9uU2F2ZShkYXRhLCBkYXNoYm9hcmRJbmZvLmlkLCBTQVZFX1RZUEVfT1ZFUldSSVRFKTtcbiAgICB9XG4gIH0sIFtcbiAgICBhY3R1YWxMYXN0TW9kaWZpZWRUaW1lLFxuICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMsXG4gICAgY29sb3JOYW1lc3BhY2UsXG4gICAgY29sb3JTY2hlbWUsXG4gICAgY3VzdG9tQ3NzLFxuICAgIGRhc2hib2FyZEluZm8uY2VydGlmaWNhdGlvbl9kZXRhaWxzLFxuICAgIGRhc2hib2FyZEluZm8uY2VydGlmaWVkX2J5LFxuICAgIGRhc2hib2FyZEluZm8uY29tbW9uPy5jb25mPy5TVVBFUlNFVF9EQVNIQk9BUkRfUE9TSVRJT05fREFUQV9MSU1JVCxcbiAgICBkYXNoYm9hcmRJbmZvLmlkLFxuICAgIGRhc2hib2FyZEluZm8ubWV0YWRhdGEsXG4gICAgZGFzaGJvYXJkSW5mby5vd25lcnMsXG4gICAgZGFzaGJvYXJkSW5mby5yb2xlcyxcbiAgICBkYXNoYm9hcmRUaXRsZSxcbiAgICBsYXlvdXQsXG4gICAgcmVmcmVzaEZyZXF1ZW5jeSxcbiAgICBzaG91bGRQZXJzaXN0UmVmcmVzaEZyZXF1ZW5jeSxcbiAgICBzbHVnLFxuICBdKTtcblxuICBjb25zdCBzaG93UHJvcGVydGllc01vZGFsID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHNldFNob3dpbmdQcm9wZXJ0aWVzTW9kYWwodHJ1ZSk7XG4gIH0sIFtdKTtcblxuICBjb25zdCBoaWRlUHJvcGVydGllc01vZGFsID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHNldFNob3dpbmdQcm9wZXJ0aWVzTW9kYWwoZmFsc2UpO1xuICB9LCBbXSk7XG5cbiAgY29uc3Qgc2hvd0VtYmVkTW9kYWwgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgc2V0U2hvd2luZ0VtYmVkTW9kYWwodHJ1ZSk7XG4gIH0sIFtdKTtcblxuICBjb25zdCBoaWRlRW1iZWRNb2RhbCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBzZXRTaG93aW5nRW1iZWRNb2RhbChmYWxzZSk7XG4gIH0sIFtdKTtcblxuICBjb25zdCBzaG93UmVwb3J0TW9kYWwgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgc2V0U2hvd2luZ1JlcG9ydE1vZGFsKHRydWUpO1xuICB9LCBbXSk7XG5cbiAgY29uc3QgaGlkZVJlcG9ydE1vZGFsID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHNldFNob3dpbmdSZXBvcnRNb2RhbChmYWxzZSk7XG4gIH0sIFtdKTtcblxuICBjb25zdCBtZXRhZGF0YUJhciA9IHVzZURhc2hib2FyZE1ldGFkYXRhQmFyKGRhc2hib2FyZEluZm8pO1xuXG4gIGNvbnN0IHVzZXJDYW5FZGl0ID1cbiAgICBkYXNoYm9hcmRJbmZvLmRhc2hfZWRpdF9wZXJtICYmICFkYXNoYm9hcmRJbmZvLmlzX21hbmFnZWRfZXh0ZXJuYWxseTtcbiAgY29uc3QgdXNlckNhblNoYXJlID0gZGFzaGJvYXJkSW5mby5kYXNoX3NoYXJlX3Blcm07XG4gIGNvbnN0IHVzZXJDYW5TYXZlQXMgPSBkYXNoYm9hcmRJbmZvLmRhc2hfc2F2ZV9wZXJtO1xuICBjb25zdCB1c2VyQ2FuQ3VyYXRlID1cbiAgICBpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLkVtYmVkZGVkU3VwZXJzZXQpICYmXG4gICAgZmluZFBlcm1pc3Npb24oJ2Nhbl9zZXRfZW1iZWRkZWQnLCAnRGFzaGJvYXJkJywgdXNlci5yb2xlcyk7XG4gIGNvbnN0IHJlZnJlc2hMaW1pdCA9XG4gICAgZGFzaGJvYXJkSW5mby5jb21tb24/LmNvbmY/LlNVUEVSU0VUX0RBU0hCT0FSRF9QRVJJT0RJQ0FMX1JFRlJFU0hfTElNSVQ7XG4gIGNvbnN0IHJlZnJlc2hXYXJuaW5nID1cbiAgICBkYXNoYm9hcmRJbmZvLmNvbW1vbj8uY29uZlxuICAgICAgPy5TVVBFUlNFVF9EQVNIQk9BUkRfUEVSSU9ESUNBTF9SRUZSRVNIX1dBUk5JTkdfTUVTU0FHRTtcbiAgY29uc3QgaXNFbWJlZGRlZCA9ICFkYXNoYm9hcmRJbmZvPy51c2VySWQ7XG5cbiAgY29uc3QgaGFuZGxlT25Qcm9wZXJ0aWVzQ2hhbmdlID0gdXNlQ2FsbGJhY2soXG4gICAgdXBkYXRlcyA9PiB7XG4gICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLmRhc2hib2FyZEluZm9DaGFuZ2VkKHtcbiAgICAgICAgc2x1ZzogdXBkYXRlcy5zbHVnLFxuICAgICAgICBtZXRhZGF0YTogSlNPTi5wYXJzZSh1cGRhdGVzLmpzb25NZXRhZGF0YSB8fCAne30nKSxcbiAgICAgICAgY2VydGlmaWVkX2J5OiB1cGRhdGVzLmNlcnRpZmllZEJ5LFxuICAgICAgICBjZXJ0aWZpY2F0aW9uX2RldGFpbHM6IHVwZGF0ZXMuY2VydGlmaWNhdGlvbkRldGFpbHMsXG4gICAgICAgIG93bmVyczogdXBkYXRlcy5vd25lcnMsXG4gICAgICAgIHJvbGVzOiB1cGRhdGVzLnJvbGVzLFxuICAgICAgfSk7XG4gICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLnNldFVuc2F2ZWRDaGFuZ2VzKHRydWUpO1xuICAgICAgYm91bmRBY3Rpb25DcmVhdG9ycy5kYXNoYm9hcmRUaXRsZUNoYW5nZWQodXBkYXRlcy50aXRsZSk7XG4gICAgfSxcbiAgICBbYm91bmRBY3Rpb25DcmVhdG9yc10sXG4gICk7XG5cbiAgY29uc3QgTmF2RXh0ZW5zaW9uID0gZXh0ZW5zaW9uc1JlZ2lzdHJ5LmdldCgnZGFzaGJvYXJkLm5hdi5yaWdodCcpO1xuXG4gIGNvbnN0IGVkaXRhYmxlVGl0bGVQcm9wcyA9IHVzZU1lbW8oXG4gICAgKCkgPT4gKHtcbiAgICAgIHRpdGxlOiBkYXNoYm9hcmRUaXRsZSxcbiAgICAgIGNhbkVkaXQ6IHVzZXJDYW5FZGl0ICYmIGVkaXRNb2RlLFxuICAgICAgb25TYXZlOiBoYW5kbGVDaGFuZ2VUZXh0LFxuICAgICAgcGxhY2Vob2xkZXI6IHQoJ0FkZCB0aGUgbmFtZSBvZiB0aGUgZGFzaGJvYXJkJyksXG4gICAgICBsYWJlbDogdCgnRGFzaGJvYXJkIHRpdGxlJyksXG4gICAgICBzaG93VG9vbHRpcDogZmFsc2UsXG4gICAgfSksXG4gICAgW2Rhc2hib2FyZFRpdGxlLCBlZGl0TW9kZSwgaGFuZGxlQ2hhbmdlVGV4dCwgdXNlckNhbkVkaXRdLFxuICApO1xuXG4gIGNvbnN0IGNlcnRpZmllZEJhZGdlUHJvcHMgPSB1c2VNZW1vKFxuICAgICgpID0+ICh7XG4gICAgICBjZXJ0aWZpZWRCeTogZGFzaGJvYXJkSW5mby5jZXJ0aWZpZWRfYnksXG4gICAgICBkZXRhaWxzOiBkYXNoYm9hcmRJbmZvLmNlcnRpZmljYXRpb25fZGV0YWlscyxcbiAgICB9KSxcbiAgICBbZGFzaGJvYXJkSW5mby5jZXJ0aWZpY2F0aW9uX2RldGFpbHMsIGRhc2hib2FyZEluZm8uY2VydGlmaWVkX2J5XSxcbiAgKTtcblxuICBjb25zdCBmYXZlU3RhclByb3BzID0gdXNlTWVtbyhcbiAgICAoKSA9PiAoe1xuICAgICAgaXRlbUlkOiBkYXNoYm9hcmRJbmZvLmlkLFxuICAgICAgZmV0Y2hGYXZlU3RhcjogYm91bmRBY3Rpb25DcmVhdG9ycy5mZXRjaEZhdmVTdGFyLFxuICAgICAgc2F2ZUZhdmVTdGFyOiBib3VuZEFjdGlvbkNyZWF0b3JzLnNhdmVGYXZlU3RhcixcbiAgICAgIGlzU3RhcnJlZCxcbiAgICAgIHNob3dUb29sdGlwOiB0cnVlLFxuICAgIH0pLFxuICAgIFtcbiAgICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMuZmV0Y2hGYXZlU3RhcixcbiAgICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMuc2F2ZUZhdmVTdGFyLFxuICAgICAgZGFzaGJvYXJkSW5mby5pZCxcbiAgICAgIGlzU3RhcnJlZCxcbiAgICBdLFxuICApO1xuXG4gIGNvbnN0IHRpdGxlUGFuZWxBZGRpdGlvbmFsSXRlbXMgPSB1c2VNZW1vKFxuICAgICgpID0+IFtcbiAgICAgICFlZGl0TW9kZSAmJiAoXG4gICAgICAgIDxQdWJsaXNoZWRTdGF0dXNcbiAgICAgICAgICBkYXNoYm9hcmRJZD17ZGFzaGJvYXJkSW5mby5pZH1cbiAgICAgICAgICBpc1B1Ymxpc2hlZD17aXNQdWJsaXNoZWR9XG4gICAgICAgICAgc2F2ZVB1Ymxpc2hlZD17Ym91bmRBY3Rpb25DcmVhdG9ycy5zYXZlUHVibGlzaGVkfVxuICAgICAgICAgIHVzZXJDYW5FZGl0PXt1c2VyQ2FuRWRpdH1cbiAgICAgICAgICB1c2VyQ2FuU2F2ZT17dXNlckNhblNhdmVBc31cbiAgICAgICAgICB2aXNpYmxlPXshZWRpdE1vZGV9XG4gICAgICAgIC8+XG4gICAgICApLFxuICAgICAgIWVkaXRNb2RlICYmICFpc0VtYmVkZGVkICYmIG1ldGFkYXRhQmFyLFxuICAgIF0sXG4gICAgW1xuICAgICAgYm91bmRBY3Rpb25DcmVhdG9ycy5zYXZlUHVibGlzaGVkLFxuICAgICAgZGFzaGJvYXJkSW5mby5pZCxcbiAgICAgIGVkaXRNb2RlLFxuICAgICAgbWV0YWRhdGFCYXIsXG4gICAgICBpc0VtYmVkZGVkLFxuICAgICAgaXNQdWJsaXNoZWQsXG4gICAgICB1c2VyQ2FuRWRpdCxcbiAgICAgIHVzZXJDYW5TYXZlQXMsXG4gICAgXSxcbiAgKTtcblxuICBjb25zdCByaWdodFBhbmVsQWRkaXRpb25hbEl0ZW1zID0gdXNlTWVtbyhcbiAgICAoKSA9PiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImJ1dHRvbi1jb250YWluZXJcIj5cbiAgICAgICAge3VzZXJDYW5TYXZlQXMgJiYgKFxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiYnV0dG9uLWNvbnRhaW5lclwiIGRhdGEtdGVzdD1cImRhc2hib2FyZC1lZGl0LWFjdGlvbnNcIj5cbiAgICAgICAgICAgIHtlZGl0TW9kZSAmJiAoXG4gICAgICAgICAgICAgIDxkaXYgY3NzPXthY3Rpb25CdXR0b25zU3R5bGV9PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidW5kb1JlZG9cIj5cbiAgICAgICAgICAgICAgICAgIDxUb29sdGlwXG4gICAgICAgICAgICAgICAgICAgIGlkPVwiZGFzaGJvYXJkLXVuZG8tdG9vbHRpcFwiXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlPXt0KCdVbmRvIHRoZSBhY3Rpb24nKX1cbiAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgPFN0eWxlZFVuZG9SZWRvQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgYnV0dG9uU3R5bGU9XCJsaW5rXCJcbiAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17dW5kb0xlbmd0aCA8IDF9XG4gICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dW5kb0xlbmd0aCAmJiBib3VuZEFjdGlvbkNyZWF0b3JzLm9uVW5kb31cbiAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgIDxJY29ucy5VbmRvXG4gICAgICAgICAgICAgICAgICAgICAgICBjc3M9e1tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdW5kb1JlZG9TdHlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZW1waGFzaXplVW5kbyAmJiB1bmRvUmVkb0VtcGhhc2l6ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHVuZG9MZW5ndGggPCAxICYmIHVuZG9SZWRvRGlzYWJsZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBdfVxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS10ZXN0PVwidW5kby1hY3Rpb25cIlxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvblNpemU9XCJ4bFwiXG4gICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgPC9TdHlsZWRVbmRvUmVkb0J1dHRvbj5cbiAgICAgICAgICAgICAgICAgIDwvVG9vbHRpcD5cbiAgICAgICAgICAgICAgICAgIDxUb29sdGlwXG4gICAgICAgICAgICAgICAgICAgIGlkPVwiZGFzaGJvYXJkLXJlZG8tdG9vbHRpcFwiXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlPXt0KCdSZWRvIHRoZSBhY3Rpb24nKX1cbiAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgPFN0eWxlZFVuZG9SZWRvQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgYnV0dG9uU3R5bGU9XCJsaW5rXCJcbiAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17cmVkb0xlbmd0aCA8IDF9XG4gICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17cmVkb0xlbmd0aCAmJiBib3VuZEFjdGlvbkNyZWF0b3JzLm9uUmVkb31cbiAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgIDxJY29ucy5SZWRvXG4gICAgICAgICAgICAgICAgICAgICAgICBjc3M9e1tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdW5kb1JlZG9TdHlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZW1waGFzaXplUmVkbyAmJiB1bmRvUmVkb0VtcGhhc2l6ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJlZG9MZW5ndGggPCAxICYmIHVuZG9SZWRvRGlzYWJsZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBdfVxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS10ZXN0PVwicmVkby1hY3Rpb25cIlxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvblNpemU9XCJ4bFwiXG4gICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgPC9TdHlsZWRVbmRvUmVkb0J1dHRvbj5cbiAgICAgICAgICAgICAgICAgIDwvVG9vbHRpcD5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgICAgICBjc3M9e2Rpc2NhcmRCdG5TdHlsZX1cbiAgICAgICAgICAgICAgICAgIGJ1dHRvblNpemU9XCJzbWFsbFwiXG4gICAgICAgICAgICAgICAgICBvbkNsaWNrPXtkaXNjYXJkQ2hhbmdlc31cbiAgICAgICAgICAgICAgICAgIGJ1dHRvblN0eWxlPVwiZGVmYXVsdFwiXG4gICAgICAgICAgICAgICAgICBkYXRhLXRlc3Q9XCJkaXNjYXJkLWNoYW5nZXMtYnV0dG9uXCJcbiAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9e3QoJ0Rpc2NhcmQnKX1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICB7dCgnRGlzY2FyZCcpfVxuICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgICAgIGNzcz17c2F2ZUJ0blN0eWxlfVxuICAgICAgICAgICAgICAgICAgYnV0dG9uU2l6ZT1cInNtYWxsXCJcbiAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXshaGFzVW5zYXZlZENoYW5nZXN9XG4gICAgICAgICAgICAgICAgICBidXR0b25TdHlsZT1cInByaW1hcnlcIlxuICAgICAgICAgICAgICAgICAgb25DbGljaz17b3ZlcndyaXRlRGFzaGJvYXJkfVxuICAgICAgICAgICAgICAgICAgZGF0YS10ZXN0PVwiaGVhZGVyLXNhdmUtYnV0dG9uXCJcbiAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9e3QoJ1NhdmUnKX1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICA8SWNvbnMuU2F2ZU91dGxpbmVkXG4gICAgICAgICAgICAgICAgICAgIGljb25Db2xvcj17aGFzVW5zYXZlZENoYW5nZXMgJiYgdGhlbWUuY29sb3JzLnByaW1hcnkubGlnaHQ1fVxuICAgICAgICAgICAgICAgICAgICBpY29uU2l6ZT1cIm1cIlxuICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgIHt0KCdTYXZlJyl9XG4gICAgICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKX1cbiAgICAgICAge2VkaXRNb2RlID8gKFxuICAgICAgICAgIDxVbmRvUmVkb0tleUxpc3RlbmVycyBvblVuZG89e2hhbmRsZUN0cmxafSBvblJlZG89e2hhbmRsZUN0cmxZfSAvPlxuICAgICAgICApIDogKFxuICAgICAgICAgIDxkaXYgY3NzPXthY3Rpb25CdXR0b25zU3R5bGV9PlxuICAgICAgICAgICAge05hdkV4dGVuc2lvbiAmJiA8TmF2RXh0ZW5zaW9uIC8+fVxuICAgICAgICAgICAge3VzZXJDYW5FZGl0ICYmIChcbiAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgIGJ1dHRvblN0eWxlPVwic2Vjb25kYXJ5XCJcbiAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICB0b2dnbGVFZGl0TW9kZSgpO1xuICAgICAgICAgICAgICAgICAgYm91bmRBY3Rpb25DcmVhdG9ycy5jbGVhckRhc2hib2FyZEhpc3Rvcnk/LigpOyAvLyBSZXNldHMgdGhlIGBwYXN0YCBhcyBhbiBlbXB0eSBhcnJheVxuICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgZGF0YS10ZXN0PVwiZWRpdC1kYXNoYm9hcmQtYnV0dG9uXCJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJhY3Rpb24tYnV0dG9uXCJcbiAgICAgICAgICAgICAgICBjc3M9e2VkaXRCdXR0b25TdHlsZX1cbiAgICAgICAgICAgICAgICBhcmlhLWxhYmVsPXt0KCdFZGl0IGRhc2hib2FyZCcpfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAge3QoJ0VkaXQgZGFzaGJvYXJkJyl9XG4gICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKX1cbiAgICAgIDwvZGl2PlxuICAgICksXG4gICAgW1xuICAgICAgTmF2RXh0ZW5zaW9uLFxuICAgICAgYm91bmRBY3Rpb25DcmVhdG9ycy5vblJlZG8sXG4gICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLm9uVW5kbyxcbiAgICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMuY2xlYXJEYXNoYm9hcmRIaXN0b3J5LFxuICAgICAgZWRpdE1vZGUsXG4gICAgICBlbXBoYXNpemVSZWRvLFxuICAgICAgZW1waGFzaXplVW5kbyxcbiAgICAgIGhhbmRsZUN0cmxZLFxuICAgICAgaGFuZGxlQ3RybFosXG4gICAgICBoYXNVbnNhdmVkQ2hhbmdlcyxcbiAgICAgIG92ZXJ3cml0ZURhc2hib2FyZCxcbiAgICAgIHJlZG9MZW5ndGgsXG4gICAgICB0b2dnbGVFZGl0TW9kZSxcbiAgICAgIHVuZG9MZW5ndGgsXG4gICAgICB1c2VyQ2FuRWRpdCxcbiAgICAgIHVzZXJDYW5TYXZlQXMsXG4gICAgXSxcbiAgKTtcblxuICBjb25zdCBoYW5kbGVSZXBvcnREZWxldGUgPSBhc3luYyByZXBvcnQgPT4ge1xuICAgIGF3YWl0IGRpc3BhdGNoKGRlbGV0ZUFjdGl2ZVJlcG9ydChyZXBvcnQpKTtcbiAgICBzZXRDdXJyZW50UmVwb3J0RGVsZXRpbmcobnVsbCk7XG4gIH07XG5cbiAgY29uc3QgW21lbnUsIGlzRHJvcGRvd25WaXNpYmxlLCBzZXRJc0Ryb3Bkb3duVmlzaWJsZV0gPSB1c2VIZWFkZXJBY3Rpb25zTWVudSh7XG4gICAgYWRkU3VjY2Vzc1RvYXN0OiBib3VuZEFjdGlvbkNyZWF0b3JzLmFkZFN1Y2Nlc3NUb2FzdCxcbiAgICBhZGREYW5nZXJUb2FzdDogYm91bmRBY3Rpb25DcmVhdG9ycy5hZGREYW5nZXJUb2FzdCxcbiAgICBkYXNoYm9hcmRJbmZvLFxuICAgIGRhc2hib2FyZElkOiBkYXNoYm9hcmRJbmZvLmlkLFxuICAgIGRhc2hib2FyZFRpdGxlLFxuICAgIGRhdGFNYXNrLFxuICAgIGxheW91dCxcbiAgICBleHBhbmRlZFNsaWNlcyxcbiAgICBjdXN0b21Dc3MsXG4gICAgY29sb3JOYW1lc3BhY2UsXG4gICAgY29sb3JTY2hlbWUsXG4gICAgb25TYXZlOiBib3VuZEFjdGlvbkNyZWF0b3JzLm9uU2F2ZSxcbiAgICBvbkNoYW5nZTogYm91bmRBY3Rpb25DcmVhdG9ycy5vbkNoYW5nZSxcbiAgICBmb3JjZVJlZnJlc2hBbGxDaGFydHM6IGZvcmNlUmVmcmVzaCxcbiAgICBzdGFydFBlcmlvZGljUmVuZGVyLFxuICAgIHJlZnJlc2hGcmVxdWVuY3ksXG4gICAgc2hvdWxkUGVyc2lzdFJlZnJlc2hGcmVxdWVuY3ksXG4gICAgc2V0UmVmcmVzaEZyZXF1ZW5jeTogYm91bmRBY3Rpb25DcmVhdG9ycy5zZXRSZWZyZXNoRnJlcXVlbmN5LFxuICAgIHVwZGF0ZUNzczogYm91bmRBY3Rpb25DcmVhdG9ycy51cGRhdGVDc3MsXG4gICAgZWRpdE1vZGUsXG4gICAgaGFzVW5zYXZlZENoYW5nZXMsXG4gICAgdXNlckNhbkVkaXQsXG4gICAgdXNlckNhblNoYXJlLFxuICAgIHVzZXJDYW5TYXZlOiB1c2VyQ2FuU2F2ZUFzLFxuICAgIHVzZXJDYW5DdXJhdGUsXG4gICAgaXNMb2FkaW5nLFxuICAgIHNob3dSZXBvcnRNb2RhbCxcbiAgICBzaG93UHJvcGVydGllc01vZGFsLFxuICAgIHNldEN1cnJlbnRSZXBvcnREZWxldGluZyxcbiAgICBtYW5hZ2VFbWJlZGRlZDogc2hvd0VtYmVkTW9kYWwsXG4gICAgcmVmcmVzaExpbWl0LFxuICAgIHJlZnJlc2hXYXJuaW5nLFxuICAgIGxhc3RNb2RpZmllZFRpbWU6IGFjdHVhbExhc3RNb2RpZmllZFRpbWUsXG4gICAgbG9nRXZlbnQ6IGJvdW5kQWN0aW9uQ3JlYXRvcnMubG9nRXZlbnQsXG4gIH0pO1xuICByZXR1cm4gKFxuICAgIDxkaXZcbiAgICAgIGNzcz17aGVhZGVyQ29udGFpbmVyU3R5bGV9XG4gICAgICBkYXRhLXRlc3Q9XCJkYXNoYm9hcmQtaGVhZGVyLWNvbnRhaW5lclwiXG4gICAgICBkYXRhLXRlc3QtaWQ9e2Rhc2hib2FyZEluZm8uaWR9XG4gICAgICBjbGFzc05hbWU9XCJkYXNoYm9hcmQtaGVhZGVyLWNvbnRhaW5lclwiXG4gICAgPlxuICAgICAgPFBhZ2VIZWFkZXJXaXRoQWN0aW9uc1xuICAgICAgICBlZGl0YWJsZVRpdGxlUHJvcHM9e2VkaXRhYmxlVGl0bGVQcm9wc31cbiAgICAgICAgY2VydGlmaWNhdGllZEJhZGdlUHJvcHM9e2NlcnRpZmllZEJhZGdlUHJvcHN9XG4gICAgICAgIGZhdmVTdGFyUHJvcHM9e2ZhdmVTdGFyUHJvcHN9XG4gICAgICAgIHRpdGxlUGFuZWxBZGRpdGlvbmFsSXRlbXM9e3RpdGxlUGFuZWxBZGRpdGlvbmFsSXRlbXN9XG4gICAgICAgIHJpZ2h0UGFuZWxBZGRpdGlvbmFsSXRlbXM9e3JpZ2h0UGFuZWxBZGRpdGlvbmFsSXRlbXN9XG4gICAgICAgIG1lbnVEcm9wZG93blByb3BzPXt7XG4gICAgICAgICAgb3BlbjogaXNEcm9wZG93blZpc2libGUsXG4gICAgICAgICAgb25PcGVuQ2hhbmdlOiBzZXRJc0Ryb3Bkb3duVmlzaWJsZSxcbiAgICAgICAgfX1cbiAgICAgICAgYWRkaXRpb25hbEFjdGlvbnNNZW51PXttZW51fVxuICAgICAgICBzaG93RmF2ZVN0YXI9e3VzZXI/LnVzZXJJZCAmJiBkYXNoYm9hcmRJbmZvPy5pZH1cbiAgICAgICAgc2hvd1RpdGxlUGFuZWxJdGVtc1xuICAgICAgLz5cbiAgICAgIHtzaG93aW5nUHJvcGVydGllc01vZGFsICYmIChcbiAgICAgICAgPFByb3BlcnRpZXNNb2RhbFxuICAgICAgICAgIGRhc2hib2FyZElkPXtkYXNoYm9hcmRJbmZvLmlkfVxuICAgICAgICAgIGRhc2hib2FyZEluZm89e2Rhc2hib2FyZEluZm99XG4gICAgICAgICAgZGFzaGJvYXJkVGl0bGU9e2Rhc2hib2FyZFRpdGxlfVxuICAgICAgICAgIHNob3c9e3Nob3dpbmdQcm9wZXJ0aWVzTW9kYWx9XG4gICAgICAgICAgb25IaWRlPXtoaWRlUHJvcGVydGllc01vZGFsfVxuICAgICAgICAgIGNvbG9yU2NoZW1lPXtjb2xvclNjaGVtZX1cbiAgICAgICAgICBvblN1Ym1pdD17aGFuZGxlT25Qcm9wZXJ0aWVzQ2hhbmdlfVxuICAgICAgICAgIG9ubHlBcHBseVxuICAgICAgICAvPlxuICAgICAgKX1cblxuICAgICAgPFJlcG9ydE1vZGFsXG4gICAgICAgIHVzZXJJZD17dXNlci51c2VySWR9XG4gICAgICAgIHNob3c9e3Nob3dpbmdSZXBvcnRNb2RhbH1cbiAgICAgICAgb25IaWRlPXtoaWRlUmVwb3J0TW9kYWx9XG4gICAgICAgIHVzZXJFbWFpbD17dXNlci5lbWFpbH1cbiAgICAgICAgZGFzaGJvYXJkSWQ9e2Rhc2hib2FyZEluZm8uaWR9XG4gICAgICAgIGNyZWF0aW9uTWV0aG9kPVwiZGFzaGJvYXJkc1wiXG4gICAgICAvPlxuXG4gICAgICB7Y3VycmVudFJlcG9ydERlbGV0aW5nICYmIChcbiAgICAgICAgPERlbGV0ZU1vZGFsXG4gICAgICAgICAgZGVzY3JpcHRpb249e3QoXG4gICAgICAgICAgICAnVGhpcyBhY3Rpb24gd2lsbCBwZXJtYW5lbnRseSBkZWxldGUgJXMuJyxcbiAgICAgICAgICAgIGN1cnJlbnRSZXBvcnREZWxldGluZz8ubmFtZSxcbiAgICAgICAgICApfVxuICAgICAgICAgIG9uQ29uZmlybT17KCkgPT4ge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRSZXBvcnREZWxldGluZykge1xuICAgICAgICAgICAgICBoYW5kbGVSZXBvcnREZWxldGUoY3VycmVudFJlcG9ydERlbGV0aW5nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9fVxuICAgICAgICAgIG9uSGlkZT17KCkgPT4gc2V0Q3VycmVudFJlcG9ydERlbGV0aW5nKG51bGwpfVxuICAgICAgICAgIG9wZW5cbiAgICAgICAgICB0aXRsZT17dCgnRGVsZXRlIFJlcG9ydD8nKX1cbiAgICAgICAgLz5cbiAgICAgICl9XG5cbiAgICAgIDxPdmVyd3JpdGVDb25maXJtIC8+XG5cbiAgICAgIHt1c2VyQ2FuQ3VyYXRlICYmIChcbiAgICAgICAgPERhc2hib2FyZEVtYmVkTW9kYWxcbiAgICAgICAgICBzaG93PXtzaG93aW5nRW1iZWRNb2RhbH1cbiAgICAgICAgICBvbkhpZGU9e2hpZGVFbWJlZE1vZGFsfVxuICAgICAgICAgIGRhc2hib2FyZElkPXtkYXNoYm9hcmRJbmZvLmlkfVxuICAgICAgICAvPlxuICAgICAgKX1cbiAgICAgIDxHbG9iYWxcbiAgICAgICAgc3R5bGVzPXtjc3NgXG4gICAgICAgICAgLmFudGQ1LW1lbnUtdmVydGljYWwge1xuICAgICAgICAgICAgYm9yZGVyLXJpZ2h0OiBub25lO1xuICAgICAgICAgIH1cbiAgICAgICAgYH1cbiAgICAgIC8+XG4gICAgPC9kaXY+XG4gICk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBIZWFkZXI7XG4iXX0= */\"],\n\n\n                  iconSize: \"xl\" }\n                ) }\n              ) }\n            ),\n            _jsx(Tooltip, {\n              id: \"dashboard-redo-tooltip\",\n              title: t('Redo the action'), children:\n\n              _jsx(StyledUndoRedoButton, {\n                buttonStyle: \"link\",\n                disabled: redoLength < 1,\n                onClick: redoLength && boundActionCreators.onRedo, children:\n\n                _jsx(Icons.Redo, {\n                  css: [\n                  undoRedoStyle,\n                  emphasizeRedo && undoRedoEmphasized,\n                  redoLength < 1 && undoRedoDisabled, process.env.NODE_ENV === \"production\" ? \"\" : \";label:rightPanelAdditionalItems;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2FkZWwvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2Rhc2hib2FyZC9jb21wb25lbnRzL0hlYWRlci9pbmRleC5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBZ25Cd0IiLCJmaWxlIjoiL2hvbWUvYWRlbC9zdXBlcnNldC9zdXBlcnNldC1mcm9udGVuZC9zcmMvZGFzaGJvYXJkL2NvbXBvbmVudHMvSGVhZGVyL2luZGV4LmpzeCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qIGVzbGludC1lbnYgYnJvd3NlciAqL1xuaW1wb3J0IHsgZXh0ZW5kZWREYXlqcyB9IGZyb20gJ3NyYy91dGlscy9kYXRlcyc7XG5pbXBvcnQgeyB1c2VDYWxsYmFjaywgdXNlRWZmZWN0LCB1c2VNZW1vLCB1c2VSZWYsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtcbiAgc3R5bGVkLFxuICBjc3MsXG4gIGlzRmVhdHVyZUVuYWJsZWQsXG4gIEZlYXR1cmVGbGFnLFxuICB0LFxuICBnZXRFeHRlbnNpb25zUmVnaXN0cnksXG4gIHVzZVRoZW1lLFxufSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgeyBHbG9iYWwgfSBmcm9tICdAZW1vdGlvbi9yZWFjdCc7XG5pbXBvcnQgeyBzaGFsbG93RXF1YWwsIHVzZURpc3BhdGNoLCB1c2VTZWxlY3RvciB9IGZyb20gJ3JlYWN0LXJlZHV4JztcbmltcG9ydCB7IGJpbmRBY3Rpb25DcmVhdG9ycyB9IGZyb20gJ3JlZHV4JztcbmltcG9ydCB7XG4gIExPR19BQ1RJT05TX1BFUklPRElDX1JFTkRFUl9EQVNIQk9BUkQsXG4gIExPR19BQ1RJT05TX0ZPUkNFX1JFRlJFU0hfREFTSEJPQVJELFxuICBMT0dfQUNUSU9OU19UT0dHTEVfRURJVF9EQVNIQk9BUkQsXG59IGZyb20gJ3NyYy9sb2dnZXIvTG9nVXRpbHMnO1xuaW1wb3J0IEljb25zIGZyb20gJ3NyYy9jb21wb25lbnRzL0ljb25zJztcbmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gJ3NyYy9jb21wb25lbnRzLyc7XG5pbXBvcnQgeyBmaW5kUGVybWlzc2lvbiB9IGZyb20gJ3NyYy91dGlscy9maW5kUGVybWlzc2lvbic7XG5pbXBvcnQgeyBUb29sdGlwIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvVG9vbHRpcCc7XG5pbXBvcnQgeyBzYWZlU3RyaW5naWZ5IH0gZnJvbSAnc3JjL3V0aWxzL3NhZmVTdHJpbmdpZnknO1xuaW1wb3J0IFB1Ymxpc2hlZFN0YXR1cyBmcm9tICdzcmMvZGFzaGJvYXJkL2NvbXBvbmVudHMvUHVibGlzaGVkU3RhdHVzJztcbmltcG9ydCBVbmRvUmVkb0tleUxpc3RlbmVycyBmcm9tICdzcmMvZGFzaGJvYXJkL2NvbXBvbmVudHMvVW5kb1JlZG9LZXlMaXN0ZW5lcnMnO1xuaW1wb3J0IFByb3BlcnRpZXNNb2RhbCBmcm9tICdzcmMvZGFzaGJvYXJkL2NvbXBvbmVudHMvUHJvcGVydGllc01vZGFsJztcbmltcG9ydCB7XG4gIFVORE9fTElNSVQsXG4gIFNBVkVfVFlQRV9PVkVSV1JJVEUsXG4gIERBU0hCT0FSRF9QT1NJVElPTl9EQVRBX0xJTUlULFxuICBEQVNIQk9BUkRfSEVBREVSX0lELFxufSBmcm9tICdzcmMvZGFzaGJvYXJkL3V0aWwvY29uc3RhbnRzJztcbmltcG9ydCBzZXRQZXJpb2RpY1J1bm5lciwge1xuICBzdG9wUGVyaW9kaWNSZW5kZXIsXG59IGZyb20gJ3NyYy9kYXNoYm9hcmQvdXRpbC9zZXRQZXJpb2RpY1J1bm5lcic7XG5pbXBvcnQgUmVwb3J0TW9kYWwgZnJvbSAnc3JjL2ZlYXR1cmVzL3JlcG9ydHMvUmVwb3J0TW9kYWwnO1xuaW1wb3J0IERlbGV0ZU1vZGFsIGZyb20gJ3NyYy9jb21wb25lbnRzL0RlbGV0ZU1vZGFsJztcbmltcG9ydCB7IGRlbGV0ZUFjdGl2ZVJlcG9ydCB9IGZyb20gJ3NyYy9mZWF0dXJlcy9yZXBvcnRzL1JlcG9ydE1vZGFsL2FjdGlvbnMnO1xuaW1wb3J0IHsgUGFnZUhlYWRlcldpdGhBY3Rpb25zIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvUGFnZUhlYWRlcldpdGhBY3Rpb25zJztcbmltcG9ydCBEYXNoYm9hcmRFbWJlZE1vZGFsIGZyb20gJy4uL0VtYmVkZGVkTW9kYWwnO1xuaW1wb3J0IE92ZXJ3cml0ZUNvbmZpcm0gZnJvbSAnLi4vT3ZlcndyaXRlQ29uZmlybSc7XG5pbXBvcnQge1xuICBhZGREYW5nZXJUb2FzdCxcbiAgYWRkU3VjY2Vzc1RvYXN0LFxuICBhZGRXYXJuaW5nVG9hc3QsXG59IGZyb20gJy4uLy4uLy4uL2NvbXBvbmVudHMvTWVzc2FnZVRvYXN0cy9hY3Rpb25zJztcbmltcG9ydCB7XG4gIGRhc2hib2FyZFRpdGxlQ2hhbmdlZCxcbiAgcmVkb0xheW91dEFjdGlvbixcbiAgdW5kb0xheW91dEFjdGlvbixcbiAgdXBkYXRlRGFzaGJvYXJkVGl0bGUsXG4gIGNsZWFyRGFzaGJvYXJkSGlzdG9yeSxcbn0gZnJvbSAnLi4vLi4vYWN0aW9ucy9kYXNoYm9hcmRMYXlvdXQnO1xuaW1wb3J0IHtcbiAgZmV0Y2hDaGFydHMsXG4gIGZldGNoRmF2ZVN0YXIsXG4gIG1heFVuZG9IaXN0b3J5VG9hc3QsXG4gIG9uQ2hhbmdlLFxuICBvblJlZnJlc2gsXG4gIHNhdmVEYXNoYm9hcmRSZXF1ZXN0LFxuICBzYXZlRmF2ZVN0YXIsXG4gIHNhdmVQdWJsaXNoZWQsXG4gIHNldEVkaXRNb2RlLFxuICBzZXRNYXhVbmRvSGlzdG9yeUV4Y2VlZGVkLFxuICBzZXRSZWZyZXNoRnJlcXVlbmN5LFxuICBzZXRVbnNhdmVkQ2hhbmdlcyxcbiAgdXBkYXRlQ3NzLFxufSBmcm9tICcuLi8uLi9hY3Rpb25zL2Rhc2hib2FyZFN0YXRlJztcbmltcG9ydCB7IGxvZ0V2ZW50IH0gZnJvbSAnLi4vLi4vLi4vbG9nZ2VyL2FjdGlvbnMnO1xuaW1wb3J0IHsgZGFzaGJvYXJkSW5mb0NoYW5nZWQgfSBmcm9tICcuLi8uLi9hY3Rpb25zL2Rhc2hib2FyZEluZm8nO1xuaW1wb3J0IGlzRGFzaGJvYXJkTG9hZGluZyBmcm9tICcuLi8uLi91dGlsL2lzRGFzaGJvYXJkTG9hZGluZyc7XG5pbXBvcnQgeyB1c2VDaGFydElkcyB9IGZyb20gJy4uLy4uL3V0aWwvY2hhcnRzL3VzZUNoYXJ0SWRzJztcbmltcG9ydCB7IHVzZURhc2hib2FyZE1ldGFkYXRhQmFyIH0gZnJvbSAnLi91c2VEYXNoYm9hcmRNZXRhZGF0YUJhcic7XG5pbXBvcnQgeyB1c2VIZWFkZXJBY3Rpb25zTWVudSB9IGZyb20gJy4vdXNlSGVhZGVyQWN0aW9uc0Ryb3Bkb3duTWVudSc7XG5cbmNvbnN0IGV4dGVuc2lvbnNSZWdpc3RyeSA9IGdldEV4dGVuc2lvbnNSZWdpc3RyeSgpO1xuXG5jb25zdCBoZWFkZXJDb250YWluZXJTdHlsZSA9IHRoZW1lID0+IGNzc2BcbiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICR7dGhlbWUuY29sb3JzLmdyYXlzY2FsZS5saWdodDJ9O1xuYDtcblxuY29uc3QgZWRpdEJ1dHRvblN0eWxlID0gdGhlbWUgPT4gY3NzYFxuICBjb2xvcjogJHt0aGVtZS5jb2xvcnMucHJpbWFyeS5kYXJrMn07XG5gO1xuXG5jb25zdCBhY3Rpb25CdXR0b25zU3R5bGUgPSB0aGVtZSA9PiBjc3NgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG5cbiAgLmFjdGlvbi1zY2hlZHVsZS1yZXBvcnQge1xuICAgIG1hcmdpbi1sZWZ0OiAke3RoZW1lLmdyaWRVbml0ICogMn1weDtcbiAgfVxuXG4gIC51bmRvUmVkbyB7XG4gICAgZGlzcGxheTogZmxleDtcbiAgICBtYXJnaW4tcmlnaHQ6ICR7dGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICB9XG5gO1xuXG5jb25zdCBTdHlsZWRVbmRvUmVkb0J1dHRvbiA9IHN0eWxlZChCdXR0b24pYFxuICAvLyBUT0RPOiBjaGVjayBpZiB3ZSBuZWVkIHRoaXNcbiAgcGFkZGluZzogMDtcbiAgJjpob3ZlciB7XG4gICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7XG4gIH1cbmA7XG5cbmNvbnN0IHVuZG9SZWRvU3R5bGUgPSB0aGVtZSA9PiBjc3NgXG4gIGNvbG9yOiAke3RoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQxfTtcbiAgJjpob3ZlciB7XG4gICAgY29sb3I6ICR7dGhlbWUuY29sb3JzLmdyYXlzY2FsZS5iYXNlfTtcbiAgfVxuYDtcblxuY29uc3QgdW5kb1JlZG9FbXBoYXNpemVkID0gdGhlbWUgPT4gY3NzYFxuICBjb2xvcjogJHt0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmJhc2V9O1xuYDtcblxuY29uc3QgdW5kb1JlZG9EaXNhYmxlZCA9IHRoZW1lID0+IGNzc2BcbiAgY29sb3I6ICR7dGhlbWUuY29sb3JzLmdyYXlzY2FsZS5saWdodDJ9O1xuYDtcblxuY29uc3Qgc2F2ZUJ0blN0eWxlID0gdGhlbWUgPT4gY3NzYFxuICBtaW4td2lkdGg6ICR7dGhlbWUuZ3JpZFVuaXQgKiAxN31weDtcbiAgaGVpZ2h0OiAke3RoZW1lLmdyaWRVbml0ICogOH1weDtcbiAgc3BhbiA+IDpmaXJzdC1vZi10eXBlIHtcbiAgICBtYXJnaW4tcmlnaHQ6IDA7XG4gIH1cbmA7XG5cbmNvbnN0IGRpc2NhcmRCdG5TdHlsZSA9IHRoZW1lID0+IGNzc2BcbiAgbWluLXdpZHRoOiAke3RoZW1lLmdyaWRVbml0ICogMjJ9cHg7XG4gIGhlaWdodDogJHt0aGVtZS5ncmlkVW5pdCAqIDh9cHg7XG5gO1xuXG5jb25zdCBkaXNjYXJkQ2hhbmdlcyA9ICgpID0+IHtcbiAgY29uc3QgdXJsID0gbmV3IFVSTCh3aW5kb3cubG9jYXRpb24uaHJlZik7XG5cbiAgdXJsLnNlYXJjaFBhcmFtcy5kZWxldGUoJ2VkaXQnKTtcbiAgd2luZG93LmxvY2F0aW9uLmFzc2lnbih1cmwpO1xufTtcblxuY29uc3QgSGVhZGVyID0gKCkgPT4ge1xuICBjb25zdCB0aGVtZSA9IHVzZVRoZW1lKCk7XG4gIGNvbnN0IGRpc3BhdGNoID0gdXNlRGlzcGF0Y2goKTtcbiAgY29uc3QgW2RpZE5vdGlmeU1heFVuZG9IaXN0b3J5VG9hc3QsIHNldERpZE5vdGlmeU1heFVuZG9IaXN0b3J5VG9hc3RdID1cbiAgICB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtlbXBoYXNpemVVbmRvLCBzZXRFbXBoYXNpemVVbmRvXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW2VtcGhhc2l6ZVJlZG8sIHNldEVtcGhhc2l6ZVJlZG9dID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbc2hvd2luZ1Byb3BlcnRpZXNNb2RhbCwgc2V0U2hvd2luZ1Byb3BlcnRpZXNNb2RhbF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtzaG93aW5nRW1iZWRNb2RhbCwgc2V0U2hvd2luZ0VtYmVkTW9kYWxdID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbc2hvd2luZ1JlcG9ydE1vZGFsLCBzZXRTaG93aW5nUmVwb3J0TW9kYWxdID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbY3VycmVudFJlcG9ydERlbGV0aW5nLCBzZXRDdXJyZW50UmVwb3J0RGVsZXRpbmddID0gdXNlU3RhdGUobnVsbCk7XG4gIGNvbnN0IGRhc2hib2FyZEluZm8gPSB1c2VTZWxlY3RvcihzdGF0ZSA9PiBzdGF0ZS5kYXNoYm9hcmRJbmZvKTtcbiAgY29uc3QgbGF5b3V0ID0gdXNlU2VsZWN0b3Ioc3RhdGUgPT4gc3RhdGUuZGFzaGJvYXJkTGF5b3V0LnByZXNlbnQpO1xuICBjb25zdCB1bmRvTGVuZ3RoID0gdXNlU2VsZWN0b3Ioc3RhdGUgPT4gc3RhdGUuZGFzaGJvYXJkTGF5b3V0LnBhc3QubGVuZ3RoKTtcbiAgY29uc3QgcmVkb0xlbmd0aCA9IHVzZVNlbGVjdG9yKHN0YXRlID0+IHN0YXRlLmRhc2hib2FyZExheW91dC5mdXR1cmUubGVuZ3RoKTtcbiAgY29uc3QgZGF0YU1hc2sgPSB1c2VTZWxlY3RvcihzdGF0ZSA9PiBzdGF0ZS5kYXRhTWFzayk7XG4gIGNvbnN0IHVzZXIgPSB1c2VTZWxlY3RvcihzdGF0ZSA9PiBzdGF0ZS51c2VyKTtcbiAgY29uc3QgY2hhcnRJZHMgPSB1c2VDaGFydElkcygpO1xuXG4gIGNvbnN0IHtcbiAgICBleHBhbmRlZFNsaWNlcyxcbiAgICByZWZyZXNoRnJlcXVlbmN5LFxuICAgIHNob3VsZFBlcnNpc3RSZWZyZXNoRnJlcXVlbmN5LFxuICAgIGN1c3RvbUNzcyxcbiAgICBjb2xvck5hbWVzcGFjZSxcbiAgICBjb2xvclNjaGVtZSxcbiAgICBpc1N0YXJyZWQsXG4gICAgaXNQdWJsaXNoZWQsXG4gICAgaGFzVW5zYXZlZENoYW5nZXMsXG4gICAgbWF4VW5kb0hpc3RvcnlFeGNlZWRlZCxcbiAgICBlZGl0TW9kZSxcbiAgICBsYXN0TW9kaWZpZWRUaW1lLFxuICB9ID0gdXNlU2VsZWN0b3IoXG4gICAgc3RhdGUgPT4gKHtcbiAgICAgIGV4cGFuZGVkU2xpY2VzOiBzdGF0ZS5kYXNoYm9hcmRTdGF0ZS5leHBhbmRlZFNsaWNlcyxcbiAgICAgIHJlZnJlc2hGcmVxdWVuY3k6IHN0YXRlLmRhc2hib2FyZFN0YXRlLnJlZnJlc2hGcmVxdWVuY3ksXG4gICAgICBzaG91bGRQZXJzaXN0UmVmcmVzaEZyZXF1ZW5jeTpcbiAgICAgICAgISFzdGF0ZS5kYXNoYm9hcmRTdGF0ZS5zaG91bGRQZXJzaXN0UmVmcmVzaEZyZXF1ZW5jeSxcbiAgICAgIGN1c3RvbUNzczogc3RhdGUuZGFzaGJvYXJkU3RhdGUuY3NzLFxuICAgICAgY29sb3JOYW1lc3BhY2U6IHN0YXRlLmRhc2hib2FyZFN0YXRlLmNvbG9yTmFtZXNwYWNlLFxuICAgICAgY29sb3JTY2hlbWU6IHN0YXRlLmRhc2hib2FyZFN0YXRlLmNvbG9yU2NoZW1lLFxuICAgICAgaXNTdGFycmVkOiAhIXN0YXRlLmRhc2hib2FyZFN0YXRlLmlzU3RhcnJlZCxcbiAgICAgIGlzUHVibGlzaGVkOiAhIXN0YXRlLmRhc2hib2FyZFN0YXRlLmlzUHVibGlzaGVkLFxuICAgICAgaGFzVW5zYXZlZENoYW5nZXM6ICEhc3RhdGUuZGFzaGJvYXJkU3RhdGUuaGFzVW5zYXZlZENoYW5nZXMsXG4gICAgICBtYXhVbmRvSGlzdG9yeUV4Y2VlZGVkOiAhIXN0YXRlLmRhc2hib2FyZFN0YXRlLm1heFVuZG9IaXN0b3J5RXhjZWVkZWQsXG4gICAgICBlZGl0TW9kZTogISFzdGF0ZS5kYXNoYm9hcmRTdGF0ZS5lZGl0TW9kZSxcbiAgICAgIGxhc3RNb2RpZmllZFRpbWU6IHN0YXRlLmxhc3RNb2RpZmllZFRpbWUsXG4gICAgfSksXG4gICAgc2hhbGxvd0VxdWFsLFxuICApO1xuICBjb25zdCBpc0xvYWRpbmcgPSB1c2VTZWxlY3RvcihzdGF0ZSA9PiBpc0Rhc2hib2FyZExvYWRpbmcoc3RhdGUuY2hhcnRzKSk7XG5cbiAgY29uc3QgcmVmcmVzaFRpbWVyID0gdXNlUmVmKDApO1xuICBjb25zdCBjdHJsWVRpbWVvdXQgPSB1c2VSZWYoMCk7XG4gIGNvbnN0IGN0cmxaVGltZW91dCA9IHVzZVJlZigwKTtcblxuICBjb25zdCBkYXNoYm9hcmRUaXRsZSA9IGxheW91dFtEQVNIQk9BUkRfSEVBREVSX0lEXT8ubWV0YT8udGV4dDtcbiAgY29uc3QgeyBzbHVnIH0gPSBkYXNoYm9hcmRJbmZvO1xuICBjb25zdCBhY3R1YWxMYXN0TW9kaWZpZWRUaW1lID0gTWF0aC5tYXgoXG4gICAgbGFzdE1vZGlmaWVkVGltZSxcbiAgICBkYXNoYm9hcmRJbmZvLmxhc3RfbW9kaWZpZWRfdGltZSxcbiAgKTtcbiAgY29uc3QgYm91bmRBY3Rpb25DcmVhdG9ycyA9IHVzZU1lbW8oXG4gICAgKCkgPT5cbiAgICAgIGJpbmRBY3Rpb25DcmVhdG9ycyhcbiAgICAgICAge1xuICAgICAgICAgIGFkZFN1Y2Nlc3NUb2FzdCxcbiAgICAgICAgICBhZGREYW5nZXJUb2FzdCxcbiAgICAgICAgICBhZGRXYXJuaW5nVG9hc3QsXG4gICAgICAgICAgb25VbmRvOiB1bmRvTGF5b3V0QWN0aW9uLFxuICAgICAgICAgIG9uUmVkbzogcmVkb0xheW91dEFjdGlvbixcbiAgICAgICAgICBjbGVhckRhc2hib2FyZEhpc3RvcnksXG4gICAgICAgICAgc2V0RWRpdE1vZGUsXG4gICAgICAgICAgc2V0VW5zYXZlZENoYW5nZXMsXG4gICAgICAgICAgZmV0Y2hGYXZlU3RhcixcbiAgICAgICAgICBzYXZlRmF2ZVN0YXIsXG4gICAgICAgICAgc2F2ZVB1Ymxpc2hlZCxcbiAgICAgICAgICBmZXRjaENoYXJ0cyxcbiAgICAgICAgICB1cGRhdGVEYXNoYm9hcmRUaXRsZSxcbiAgICAgICAgICB1cGRhdGVDc3MsXG4gICAgICAgICAgb25DaGFuZ2UsXG4gICAgICAgICAgb25TYXZlOiBzYXZlRGFzaGJvYXJkUmVxdWVzdCxcbiAgICAgICAgICBzZXRNYXhVbmRvSGlzdG9yeUV4Y2VlZGVkLFxuICAgICAgICAgIG1heFVuZG9IaXN0b3J5VG9hc3QsXG4gICAgICAgICAgbG9nRXZlbnQsXG4gICAgICAgICAgc2V0UmVmcmVzaEZyZXF1ZW5jeSxcbiAgICAgICAgICBvblJlZnJlc2gsXG4gICAgICAgICAgZGFzaGJvYXJkSW5mb0NoYW5nZWQsXG4gICAgICAgICAgZGFzaGJvYXJkVGl0bGVDaGFuZ2VkLFxuICAgICAgICB9LFxuICAgICAgICBkaXNwYXRjaCxcbiAgICAgICksXG4gICAgW2Rpc3BhdGNoXSxcbiAgKTtcblxuICBjb25zdCBzdGFydFBlcmlvZGljUmVuZGVyID0gdXNlQ2FsbGJhY2soXG4gICAgaW50ZXJ2YWwgPT4ge1xuICAgICAgbGV0IGludGVydmFsTWVzc2FnZTtcblxuICAgICAgaWYgKGludGVydmFsKSB7XG4gICAgICAgIGNvbnN0IHBlcmlvZGljUmVmcmVzaE9wdGlvbnMgPVxuICAgICAgICAgIGRhc2hib2FyZEluZm8uY29tbW9uPy5jb25mPy5EQVNIQk9BUkRfQVVUT19SRUZSRVNIX0lOVEVSVkFMUztcbiAgICAgICAgY29uc3QgcHJlZGVmaW5lZFZhbHVlID0gcGVyaW9kaWNSZWZyZXNoT3B0aW9ucy5maW5kKFxuICAgICAgICAgIG9wdGlvbiA9PiBOdW1iZXIob3B0aW9uWzBdKSA9PT0gaW50ZXJ2YWwgLyAxMDAwLFxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChwcmVkZWZpbmVkVmFsdWUpIHtcbiAgICAgICAgICBpbnRlcnZhbE1lc3NhZ2UgPSB0KHByZWRlZmluZWRWYWx1ZVsxXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaW50ZXJ2YWxNZXNzYWdlID0gZXh0ZW5kZWREYXlqc1xuICAgICAgICAgICAgLmR1cmF0aW9uKGludGVydmFsLCAnbWlsbGlzZWNvbmQnKVxuICAgICAgICAgICAgLmh1bWFuaXplKCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgZmV0Y2hDaGFydHMgPSAoY2hhcnRzLCBmb3JjZSA9IGZhbHNlKSA9PlxuICAgICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLmZldGNoQ2hhcnRzKFxuICAgICAgICAgIGNoYXJ0cyxcbiAgICAgICAgICBmb3JjZSxcbiAgICAgICAgICBpbnRlcnZhbCAqIDAuMixcbiAgICAgICAgICBkYXNoYm9hcmRJbmZvLmlkLFxuICAgICAgICApO1xuXG4gICAgICBjb25zdCBwZXJpb2RpY1JlbmRlciA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyBtZXRhZGF0YSB9ID0gZGFzaGJvYXJkSW5mbztcbiAgICAgICAgY29uc3QgaW1tdW5lID0gbWV0YWRhdGEudGltZWRfcmVmcmVzaF9pbW11bmVfc2xpY2VzIHx8IFtdO1xuICAgICAgICBjb25zdCBhZmZlY3RlZENoYXJ0cyA9IGNoYXJ0SWRzLmZpbHRlcihcbiAgICAgICAgICBjaGFydElkID0+IGltbXVuZS5pbmRleE9mKGNoYXJ0SWQpID09PSAtMSxcbiAgICAgICAgKTtcblxuICAgICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLmxvZ0V2ZW50KExPR19BQ1RJT05TX1BFUklPRElDX1JFTkRFUl9EQVNIQk9BUkQsIHtcbiAgICAgICAgICBpbnRlcnZhbCxcbiAgICAgICAgICBjaGFydENvdW50OiBhZmZlY3RlZENoYXJ0cy5sZW5ndGgsXG4gICAgICAgIH0pO1xuICAgICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLmFkZFdhcm5pbmdUb2FzdChcbiAgICAgICAgICB0KFxuICAgICAgICAgICAgYFRoaXMgZGFzaGJvYXJkIGlzIGN1cnJlbnRseSBhdXRvIHJlZnJlc2hpbmc7IHRoZSBuZXh0IGF1dG8gcmVmcmVzaCB3aWxsIGJlIGluICVzLmAsXG4gICAgICAgICAgICBpbnRlcnZhbE1lc3NhZ2UsXG4gICAgICAgICAgKSxcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGRhc2hib2FyZEluZm8uY29tbW9uPy5jb25mPy5EQVNIQk9BUkRfQVVUT19SRUZSRVNIX01PREUgPT09ICdmZXRjaCdcbiAgICAgICAgKSB7XG4gICAgICAgICAgLy8gZm9yY2UtcmVmcmVzaCB3aGlsZSBhdXRvLXJlZnJlc2ggaW4gZGFzaGJvYXJkXG4gICAgICAgICAgcmV0dXJuIGZldGNoQ2hhcnRzKGFmZmVjdGVkQ2hhcnRzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmV0Y2hDaGFydHMoYWZmZWN0ZWRDaGFydHMsIHRydWUpO1xuICAgICAgfTtcblxuICAgICAgcmVmcmVzaFRpbWVyLmN1cnJlbnQgPSBzZXRQZXJpb2RpY1J1bm5lcih7XG4gICAgICAgIGludGVydmFsLFxuICAgICAgICBwZXJpb2RpY1JlbmRlcixcbiAgICAgICAgcmVmcmVzaFRpbWVyOiByZWZyZXNoVGltZXIuY3VycmVudCxcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgW2JvdW5kQWN0aW9uQ3JlYXRvcnMsIGNoYXJ0SWRzLCBkYXNoYm9hcmRJbmZvXSxcbiAgKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHN0YXJ0UGVyaW9kaWNSZW5kZXIocmVmcmVzaEZyZXF1ZW5jeSAqIDEwMDApO1xuICB9LCBbcmVmcmVzaEZyZXF1ZW5jeSwgc3RhcnRQZXJpb2RpY1JlbmRlcl0pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKFVORE9fTElNSVQgLSB1bmRvTGVuZ3RoIDw9IDAgJiYgIWRpZE5vdGlmeU1heFVuZG9IaXN0b3J5VG9hc3QpIHtcbiAgICAgIHNldERpZE5vdGlmeU1heFVuZG9IaXN0b3J5VG9hc3QodHJ1ZSk7XG4gICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLm1heFVuZG9IaXN0b3J5VG9hc3QoKTtcbiAgICB9XG4gICAgaWYgKHVuZG9MZW5ndGggPiBVTkRPX0xJTUlUICYmICFtYXhVbmRvSGlzdG9yeUV4Y2VlZGVkKSB7XG4gICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLnNldE1heFVuZG9IaXN0b3J5RXhjZWVkZWQoKTtcbiAgICB9XG4gIH0sIFtcbiAgICBib3VuZEFjdGlvbkNyZWF0b3JzLFxuICAgIGRpZE5vdGlmeU1heFVuZG9IaXN0b3J5VG9hc3QsXG4gICAgbWF4VW5kb0hpc3RvcnlFeGNlZWRlZCxcbiAgICB1bmRvTGVuZ3RoLFxuICBdKTtcblxuICB1c2VFZmZlY3QoXG4gICAgKCkgPT4gKCkgPT4ge1xuICAgICAgc3RvcFBlcmlvZGljUmVuZGVyKHJlZnJlc2hUaW1lci5jdXJyZW50KTtcbiAgICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMuc2V0UmVmcmVzaEZyZXF1ZW5jeSgwKTtcbiAgICAgIGNsZWFyVGltZW91dChjdHJsWVRpbWVvdXQuY3VycmVudCk7XG4gICAgICBjbGVhclRpbWVvdXQoY3RybFpUaW1lb3V0LmN1cnJlbnQpO1xuICAgIH0sXG4gICAgW2JvdW5kQWN0aW9uQ3JlYXRvcnNdLFxuICApO1xuXG4gIGNvbnN0IGhhbmRsZUNoYW5nZVRleHQgPSB1c2VDYWxsYmFjayhcbiAgICBuZXh0VGV4dCA9PiB7XG4gICAgICBpZiAobmV4dFRleHQgJiYgZGFzaGJvYXJkVGl0bGUgIT09IG5leHRUZXh0KSB7XG4gICAgICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMudXBkYXRlRGFzaGJvYXJkVGl0bGUobmV4dFRleHQpO1xuICAgICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLm9uQ2hhbmdlKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBbYm91bmRBY3Rpb25DcmVhdG9ycywgZGFzaGJvYXJkVGl0bGVdLFxuICApO1xuXG4gIGNvbnN0IGhhbmRsZUN0cmxZID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMub25SZWRvKCk7XG4gICAgc2V0RW1waGFzaXplUmVkbyh0cnVlKTtcbiAgICBpZiAoY3RybFlUaW1lb3V0LmN1cnJlbnQpIHtcbiAgICAgIGNsZWFyVGltZW91dChjdHJsWVRpbWVvdXQuY3VycmVudCk7XG4gICAgfVxuICAgIGN0cmxZVGltZW91dC5jdXJyZW50ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBzZXRFbXBoYXNpemVSZWRvKGZhbHNlKTtcbiAgICB9LCAxMDApO1xuICB9LCBbYm91bmRBY3Rpb25DcmVhdG9yc10pO1xuXG4gIGNvbnN0IGhhbmRsZUN0cmxaID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMub25VbmRvKCk7XG4gICAgc2V0RW1waGFzaXplVW5kbyh0cnVlKTtcbiAgICBpZiAoY3RybFpUaW1lb3V0LmN1cnJlbnQpIHtcbiAgICAgIGNsZWFyVGltZW91dChjdHJsWlRpbWVvdXQuY3VycmVudCk7XG4gICAgfVxuICAgIGN0cmxaVGltZW91dC5jdXJyZW50ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBzZXRFbXBoYXNpemVVbmRvKGZhbHNlKTtcbiAgICB9LCAxMDApO1xuICB9LCBbYm91bmRBY3Rpb25DcmVhdG9yc10pO1xuXG4gIGNvbnN0IGZvcmNlUmVmcmVzaCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAoIWlzTG9hZGluZykge1xuICAgICAgYm91bmRBY3Rpb25DcmVhdG9ycy5sb2dFdmVudChMT0dfQUNUSU9OU19GT1JDRV9SRUZSRVNIX0RBU0hCT0FSRCwge1xuICAgICAgICBmb3JjZTogdHJ1ZSxcbiAgICAgICAgaW50ZXJ2YWw6IDAsXG4gICAgICAgIGNoYXJ0Q291bnQ6IGNoYXJ0SWRzLmxlbmd0aCxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGJvdW5kQWN0aW9uQ3JlYXRvcnMub25SZWZyZXNoKGNoYXJ0SWRzLCB0cnVlLCAwLCBkYXNoYm9hcmRJbmZvLmlkKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LCBbYm91bmRBY3Rpb25DcmVhdG9ycywgY2hhcnRJZHMsIGRhc2hib2FyZEluZm8uaWQsIGlzTG9hZGluZ10pO1xuXG4gIGNvbnN0IHRvZ2dsZUVkaXRNb2RlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMubG9nRXZlbnQoTE9HX0FDVElPTlNfVE9HR0xFX0VESVRfREFTSEJPQVJELCB7XG4gICAgICBlZGl0X21vZGU6ICFlZGl0TW9kZSxcbiAgICB9KTtcbiAgICBib3VuZEFjdGlvbkNyZWF0b3JzLnNldEVkaXRNb2RlKCFlZGl0TW9kZSk7XG4gIH0sIFtib3VuZEFjdGlvbkNyZWF0b3JzLCBlZGl0TW9kZV0pO1xuXG4gIGNvbnN0IG92ZXJ3cml0ZURhc2hib2FyZCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBjb25zdCBjdXJyZW50Q29sb3JOYW1lc3BhY2UgPVxuICAgICAgZGFzaGJvYXJkSW5mbz8ubWV0YWRhdGE/LmNvbG9yX25hbWVzcGFjZSB8fCBjb2xvck5hbWVzcGFjZTtcbiAgICBjb25zdCBjdXJyZW50Q29sb3JTY2hlbWUgPVxuICAgICAgZGFzaGJvYXJkSW5mbz8ubWV0YWRhdGE/LmNvbG9yX3NjaGVtZSB8fCBjb2xvclNjaGVtZTtcblxuICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICBjZXJ0aWZpZWRfYnk6IGRhc2hib2FyZEluZm8uY2VydGlmaWVkX2J5LFxuICAgICAgY2VydGlmaWNhdGlvbl9kZXRhaWxzOiBkYXNoYm9hcmRJbmZvLmNlcnRpZmljYXRpb25fZGV0YWlscyxcbiAgICAgIGNzczogY3VzdG9tQ3NzLFxuICAgICAgZGFzaGJvYXJkX3RpdGxlOiBkYXNoYm9hcmRUaXRsZSxcbiAgICAgIGxhc3RfbW9kaWZpZWRfdGltZTogYWN0dWFsTGFzdE1vZGlmaWVkVGltZSxcbiAgICAgIG93bmVyczogZGFzaGJvYXJkSW5mby5vd25lcnMsXG4gICAgICByb2xlczogZGFzaGJvYXJkSW5mby5yb2xlcyxcbiAgICAgIHNsdWcsXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICAuLi5kYXNoYm9hcmRJbmZvPy5tZXRhZGF0YSxcbiAgICAgICAgY29sb3JfbmFtZXNwYWNlOiBjdXJyZW50Q29sb3JOYW1lc3BhY2UsXG4gICAgICAgIGNvbG9yX3NjaGVtZTogY3VycmVudENvbG9yU2NoZW1lLFxuICAgICAgICBwb3NpdGlvbnM6IGxheW91dCxcbiAgICAgICAgcmVmcmVzaF9mcmVxdWVuY3k6IHNob3VsZFBlcnNpc3RSZWZyZXNoRnJlcXVlbmN5XG4gICAgICAgICAgPyByZWZyZXNoRnJlcXVlbmN5XG4gICAgICAgICAgOiBkYXNoYm9hcmRJbmZvLm1ldGFkYXRhPy5yZWZyZXNoX2ZyZXF1ZW5jeSxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIC8vIG1ha2Ugc3VyZSBwb3NpdGlvbnMgZGF0YSBsZXNzIHRoYW4gREIgc3RvcmFnZSBsaW1pdGF0aW9uOlxuICAgIGNvbnN0IHBvc2l0aW9uSlNPTkxlbmd0aCA9IHNhZmVTdHJpbmdpZnkobGF5b3V0KS5sZW5ndGg7XG4gICAgY29uc3QgbGltaXQgPVxuICAgICAgZGFzaGJvYXJkSW5mby5jb21tb24/LmNvbmY/LlNVUEVSU0VUX0RBU0hCT0FSRF9QT1NJVElPTl9EQVRBX0xJTUlUIHx8XG4gICAgICBEQVNIQk9BUkRfUE9TSVRJT05fREFUQV9MSU1JVDtcbiAgICBpZiAocG9zaXRpb25KU09OTGVuZ3RoID49IGxpbWl0KSB7XG4gICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLmFkZERhbmdlclRvYXN0KFxuICAgICAgICB0KFxuICAgICAgICAgICdZb3VyIGRhc2hib2FyZCBpcyB0b28gbGFyZ2UuIFBsZWFzZSByZWR1Y2UgaXRzIHNpemUgYmVmb3JlIHNhdmluZyBpdC4nLFxuICAgICAgICApLFxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHBvc2l0aW9uSlNPTkxlbmd0aCA+PSBsaW1pdCAqIDAuOSkge1xuICAgICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLmFkZFdhcm5pbmdUb2FzdChcbiAgICAgICAgICB0KCdZb3VyIGRhc2hib2FyZCBpcyBuZWFyIHRoZSBzaXplIGxpbWl0LicpLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLm9uU2F2ZShkYXRhLCBkYXNoYm9hcmRJbmZvLmlkLCBTQVZFX1RZUEVfT1ZFUldSSVRFKTtcbiAgICB9XG4gIH0sIFtcbiAgICBhY3R1YWxMYXN0TW9kaWZpZWRUaW1lLFxuICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMsXG4gICAgY29sb3JOYW1lc3BhY2UsXG4gICAgY29sb3JTY2hlbWUsXG4gICAgY3VzdG9tQ3NzLFxuICAgIGRhc2hib2FyZEluZm8uY2VydGlmaWNhdGlvbl9kZXRhaWxzLFxuICAgIGRhc2hib2FyZEluZm8uY2VydGlmaWVkX2J5LFxuICAgIGRhc2hib2FyZEluZm8uY29tbW9uPy5jb25mPy5TVVBFUlNFVF9EQVNIQk9BUkRfUE9TSVRJT05fREFUQV9MSU1JVCxcbiAgICBkYXNoYm9hcmRJbmZvLmlkLFxuICAgIGRhc2hib2FyZEluZm8ubWV0YWRhdGEsXG4gICAgZGFzaGJvYXJkSW5mby5vd25lcnMsXG4gICAgZGFzaGJvYXJkSW5mby5yb2xlcyxcbiAgICBkYXNoYm9hcmRUaXRsZSxcbiAgICBsYXlvdXQsXG4gICAgcmVmcmVzaEZyZXF1ZW5jeSxcbiAgICBzaG91bGRQZXJzaXN0UmVmcmVzaEZyZXF1ZW5jeSxcbiAgICBzbHVnLFxuICBdKTtcblxuICBjb25zdCBzaG93UHJvcGVydGllc01vZGFsID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHNldFNob3dpbmdQcm9wZXJ0aWVzTW9kYWwodHJ1ZSk7XG4gIH0sIFtdKTtcblxuICBjb25zdCBoaWRlUHJvcGVydGllc01vZGFsID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHNldFNob3dpbmdQcm9wZXJ0aWVzTW9kYWwoZmFsc2UpO1xuICB9LCBbXSk7XG5cbiAgY29uc3Qgc2hvd0VtYmVkTW9kYWwgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgc2V0U2hvd2luZ0VtYmVkTW9kYWwodHJ1ZSk7XG4gIH0sIFtdKTtcblxuICBjb25zdCBoaWRlRW1iZWRNb2RhbCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBzZXRTaG93aW5nRW1iZWRNb2RhbChmYWxzZSk7XG4gIH0sIFtdKTtcblxuICBjb25zdCBzaG93UmVwb3J0TW9kYWwgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgc2V0U2hvd2luZ1JlcG9ydE1vZGFsKHRydWUpO1xuICB9LCBbXSk7XG5cbiAgY29uc3QgaGlkZVJlcG9ydE1vZGFsID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHNldFNob3dpbmdSZXBvcnRNb2RhbChmYWxzZSk7XG4gIH0sIFtdKTtcblxuICBjb25zdCBtZXRhZGF0YUJhciA9IHVzZURhc2hib2FyZE1ldGFkYXRhQmFyKGRhc2hib2FyZEluZm8pO1xuXG4gIGNvbnN0IHVzZXJDYW5FZGl0ID1cbiAgICBkYXNoYm9hcmRJbmZvLmRhc2hfZWRpdF9wZXJtICYmICFkYXNoYm9hcmRJbmZvLmlzX21hbmFnZWRfZXh0ZXJuYWxseTtcbiAgY29uc3QgdXNlckNhblNoYXJlID0gZGFzaGJvYXJkSW5mby5kYXNoX3NoYXJlX3Blcm07XG4gIGNvbnN0IHVzZXJDYW5TYXZlQXMgPSBkYXNoYm9hcmRJbmZvLmRhc2hfc2F2ZV9wZXJtO1xuICBjb25zdCB1c2VyQ2FuQ3VyYXRlID1cbiAgICBpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLkVtYmVkZGVkU3VwZXJzZXQpICYmXG4gICAgZmluZFBlcm1pc3Npb24oJ2Nhbl9zZXRfZW1iZWRkZWQnLCAnRGFzaGJvYXJkJywgdXNlci5yb2xlcyk7XG4gIGNvbnN0IHJlZnJlc2hMaW1pdCA9XG4gICAgZGFzaGJvYXJkSW5mby5jb21tb24/LmNvbmY/LlNVUEVSU0VUX0RBU0hCT0FSRF9QRVJJT0RJQ0FMX1JFRlJFU0hfTElNSVQ7XG4gIGNvbnN0IHJlZnJlc2hXYXJuaW5nID1cbiAgICBkYXNoYm9hcmRJbmZvLmNvbW1vbj8uY29uZlxuICAgICAgPy5TVVBFUlNFVF9EQVNIQk9BUkRfUEVSSU9ESUNBTF9SRUZSRVNIX1dBUk5JTkdfTUVTU0FHRTtcbiAgY29uc3QgaXNFbWJlZGRlZCA9ICFkYXNoYm9hcmRJbmZvPy51c2VySWQ7XG5cbiAgY29uc3QgaGFuZGxlT25Qcm9wZXJ0aWVzQ2hhbmdlID0gdXNlQ2FsbGJhY2soXG4gICAgdXBkYXRlcyA9PiB7XG4gICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLmRhc2hib2FyZEluZm9DaGFuZ2VkKHtcbiAgICAgICAgc2x1ZzogdXBkYXRlcy5zbHVnLFxuICAgICAgICBtZXRhZGF0YTogSlNPTi5wYXJzZSh1cGRhdGVzLmpzb25NZXRhZGF0YSB8fCAne30nKSxcbiAgICAgICAgY2VydGlmaWVkX2J5OiB1cGRhdGVzLmNlcnRpZmllZEJ5LFxuICAgICAgICBjZXJ0aWZpY2F0aW9uX2RldGFpbHM6IHVwZGF0ZXMuY2VydGlmaWNhdGlvbkRldGFpbHMsXG4gICAgICAgIG93bmVyczogdXBkYXRlcy5vd25lcnMsXG4gICAgICAgIHJvbGVzOiB1cGRhdGVzLnJvbGVzLFxuICAgICAgfSk7XG4gICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLnNldFVuc2F2ZWRDaGFuZ2VzKHRydWUpO1xuICAgICAgYm91bmRBY3Rpb25DcmVhdG9ycy5kYXNoYm9hcmRUaXRsZUNoYW5nZWQodXBkYXRlcy50aXRsZSk7XG4gICAgfSxcbiAgICBbYm91bmRBY3Rpb25DcmVhdG9yc10sXG4gICk7XG5cbiAgY29uc3QgTmF2RXh0ZW5zaW9uID0gZXh0ZW5zaW9uc1JlZ2lzdHJ5LmdldCgnZGFzaGJvYXJkLm5hdi5yaWdodCcpO1xuXG4gIGNvbnN0IGVkaXRhYmxlVGl0bGVQcm9wcyA9IHVzZU1lbW8oXG4gICAgKCkgPT4gKHtcbiAgICAgIHRpdGxlOiBkYXNoYm9hcmRUaXRsZSxcbiAgICAgIGNhbkVkaXQ6IHVzZXJDYW5FZGl0ICYmIGVkaXRNb2RlLFxuICAgICAgb25TYXZlOiBoYW5kbGVDaGFuZ2VUZXh0LFxuICAgICAgcGxhY2Vob2xkZXI6IHQoJ0FkZCB0aGUgbmFtZSBvZiB0aGUgZGFzaGJvYXJkJyksXG4gICAgICBsYWJlbDogdCgnRGFzaGJvYXJkIHRpdGxlJyksXG4gICAgICBzaG93VG9vbHRpcDogZmFsc2UsXG4gICAgfSksXG4gICAgW2Rhc2hib2FyZFRpdGxlLCBlZGl0TW9kZSwgaGFuZGxlQ2hhbmdlVGV4dCwgdXNlckNhbkVkaXRdLFxuICApO1xuXG4gIGNvbnN0IGNlcnRpZmllZEJhZGdlUHJvcHMgPSB1c2VNZW1vKFxuICAgICgpID0+ICh7XG4gICAgICBjZXJ0aWZpZWRCeTogZGFzaGJvYXJkSW5mby5jZXJ0aWZpZWRfYnksXG4gICAgICBkZXRhaWxzOiBkYXNoYm9hcmRJbmZvLmNlcnRpZmljYXRpb25fZGV0YWlscyxcbiAgICB9KSxcbiAgICBbZGFzaGJvYXJkSW5mby5jZXJ0aWZpY2F0aW9uX2RldGFpbHMsIGRhc2hib2FyZEluZm8uY2VydGlmaWVkX2J5XSxcbiAgKTtcblxuICBjb25zdCBmYXZlU3RhclByb3BzID0gdXNlTWVtbyhcbiAgICAoKSA9PiAoe1xuICAgICAgaXRlbUlkOiBkYXNoYm9hcmRJbmZvLmlkLFxuICAgICAgZmV0Y2hGYXZlU3RhcjogYm91bmRBY3Rpb25DcmVhdG9ycy5mZXRjaEZhdmVTdGFyLFxuICAgICAgc2F2ZUZhdmVTdGFyOiBib3VuZEFjdGlvbkNyZWF0b3JzLnNhdmVGYXZlU3RhcixcbiAgICAgIGlzU3RhcnJlZCxcbiAgICAgIHNob3dUb29sdGlwOiB0cnVlLFxuICAgIH0pLFxuICAgIFtcbiAgICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMuZmV0Y2hGYXZlU3RhcixcbiAgICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMuc2F2ZUZhdmVTdGFyLFxuICAgICAgZGFzaGJvYXJkSW5mby5pZCxcbiAgICAgIGlzU3RhcnJlZCxcbiAgICBdLFxuICApO1xuXG4gIGNvbnN0IHRpdGxlUGFuZWxBZGRpdGlvbmFsSXRlbXMgPSB1c2VNZW1vKFxuICAgICgpID0+IFtcbiAgICAgICFlZGl0TW9kZSAmJiAoXG4gICAgICAgIDxQdWJsaXNoZWRTdGF0dXNcbiAgICAgICAgICBkYXNoYm9hcmRJZD17ZGFzaGJvYXJkSW5mby5pZH1cbiAgICAgICAgICBpc1B1Ymxpc2hlZD17aXNQdWJsaXNoZWR9XG4gICAgICAgICAgc2F2ZVB1Ymxpc2hlZD17Ym91bmRBY3Rpb25DcmVhdG9ycy5zYXZlUHVibGlzaGVkfVxuICAgICAgICAgIHVzZXJDYW5FZGl0PXt1c2VyQ2FuRWRpdH1cbiAgICAgICAgICB1c2VyQ2FuU2F2ZT17dXNlckNhblNhdmVBc31cbiAgICAgICAgICB2aXNpYmxlPXshZWRpdE1vZGV9XG4gICAgICAgIC8+XG4gICAgICApLFxuICAgICAgIWVkaXRNb2RlICYmICFpc0VtYmVkZGVkICYmIG1ldGFkYXRhQmFyLFxuICAgIF0sXG4gICAgW1xuICAgICAgYm91bmRBY3Rpb25DcmVhdG9ycy5zYXZlUHVibGlzaGVkLFxuICAgICAgZGFzaGJvYXJkSW5mby5pZCxcbiAgICAgIGVkaXRNb2RlLFxuICAgICAgbWV0YWRhdGFCYXIsXG4gICAgICBpc0VtYmVkZGVkLFxuICAgICAgaXNQdWJsaXNoZWQsXG4gICAgICB1c2VyQ2FuRWRpdCxcbiAgICAgIHVzZXJDYW5TYXZlQXMsXG4gICAgXSxcbiAgKTtcblxuICBjb25zdCByaWdodFBhbmVsQWRkaXRpb25hbEl0ZW1zID0gdXNlTWVtbyhcbiAgICAoKSA9PiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImJ1dHRvbi1jb250YWluZXJcIj5cbiAgICAgICAge3VzZXJDYW5TYXZlQXMgJiYgKFxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiYnV0dG9uLWNvbnRhaW5lclwiIGRhdGEtdGVzdD1cImRhc2hib2FyZC1lZGl0LWFjdGlvbnNcIj5cbiAgICAgICAgICAgIHtlZGl0TW9kZSAmJiAoXG4gICAgICAgICAgICAgIDxkaXYgY3NzPXthY3Rpb25CdXR0b25zU3R5bGV9PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidW5kb1JlZG9cIj5cbiAgICAgICAgICAgICAgICAgIDxUb29sdGlwXG4gICAgICAgICAgICAgICAgICAgIGlkPVwiZGFzaGJvYXJkLXVuZG8tdG9vbHRpcFwiXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlPXt0KCdVbmRvIHRoZSBhY3Rpb24nKX1cbiAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgPFN0eWxlZFVuZG9SZWRvQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgYnV0dG9uU3R5bGU9XCJsaW5rXCJcbiAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17dW5kb0xlbmd0aCA8IDF9XG4gICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dW5kb0xlbmd0aCAmJiBib3VuZEFjdGlvbkNyZWF0b3JzLm9uVW5kb31cbiAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgIDxJY29ucy5VbmRvXG4gICAgICAgICAgICAgICAgICAgICAgICBjc3M9e1tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdW5kb1JlZG9TdHlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZW1waGFzaXplVW5kbyAmJiB1bmRvUmVkb0VtcGhhc2l6ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHVuZG9MZW5ndGggPCAxICYmIHVuZG9SZWRvRGlzYWJsZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBdfVxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS10ZXN0PVwidW5kby1hY3Rpb25cIlxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvblNpemU9XCJ4bFwiXG4gICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgPC9TdHlsZWRVbmRvUmVkb0J1dHRvbj5cbiAgICAgICAgICAgICAgICAgIDwvVG9vbHRpcD5cbiAgICAgICAgICAgICAgICAgIDxUb29sdGlwXG4gICAgICAgICAgICAgICAgICAgIGlkPVwiZGFzaGJvYXJkLXJlZG8tdG9vbHRpcFwiXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlPXt0KCdSZWRvIHRoZSBhY3Rpb24nKX1cbiAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgPFN0eWxlZFVuZG9SZWRvQnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgYnV0dG9uU3R5bGU9XCJsaW5rXCJcbiAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17cmVkb0xlbmd0aCA8IDF9XG4gICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17cmVkb0xlbmd0aCAmJiBib3VuZEFjdGlvbkNyZWF0b3JzLm9uUmVkb31cbiAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgIDxJY29ucy5SZWRvXG4gICAgICAgICAgICAgICAgICAgICAgICBjc3M9e1tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdW5kb1JlZG9TdHlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZW1waGFzaXplUmVkbyAmJiB1bmRvUmVkb0VtcGhhc2l6ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJlZG9MZW5ndGggPCAxICYmIHVuZG9SZWRvRGlzYWJsZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBdfVxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS10ZXN0PVwicmVkby1hY3Rpb25cIlxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvblNpemU9XCJ4bFwiXG4gICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgPC9TdHlsZWRVbmRvUmVkb0J1dHRvbj5cbiAgICAgICAgICAgICAgICAgIDwvVG9vbHRpcD5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgICAgICBjc3M9e2Rpc2NhcmRCdG5TdHlsZX1cbiAgICAgICAgICAgICAgICAgIGJ1dHRvblNpemU9XCJzbWFsbFwiXG4gICAgICAgICAgICAgICAgICBvbkNsaWNrPXtkaXNjYXJkQ2hhbmdlc31cbiAgICAgICAgICAgICAgICAgIGJ1dHRvblN0eWxlPVwiZGVmYXVsdFwiXG4gICAgICAgICAgICAgICAgICBkYXRhLXRlc3Q9XCJkaXNjYXJkLWNoYW5nZXMtYnV0dG9uXCJcbiAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9e3QoJ0Rpc2NhcmQnKX1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICB7dCgnRGlzY2FyZCcpfVxuICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgICAgIGNzcz17c2F2ZUJ0blN0eWxlfVxuICAgICAgICAgICAgICAgICAgYnV0dG9uU2l6ZT1cInNtYWxsXCJcbiAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXshaGFzVW5zYXZlZENoYW5nZXN9XG4gICAgICAgICAgICAgICAgICBidXR0b25TdHlsZT1cInByaW1hcnlcIlxuICAgICAgICAgICAgICAgICAgb25DbGljaz17b3ZlcndyaXRlRGFzaGJvYXJkfVxuICAgICAgICAgICAgICAgICAgZGF0YS10ZXN0PVwiaGVhZGVyLXNhdmUtYnV0dG9uXCJcbiAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9e3QoJ1NhdmUnKX1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICA8SWNvbnMuU2F2ZU91dGxpbmVkXG4gICAgICAgICAgICAgICAgICAgIGljb25Db2xvcj17aGFzVW5zYXZlZENoYW5nZXMgJiYgdGhlbWUuY29sb3JzLnByaW1hcnkubGlnaHQ1fVxuICAgICAgICAgICAgICAgICAgICBpY29uU2l6ZT1cIm1cIlxuICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgIHt0KCdTYXZlJyl9XG4gICAgICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKX1cbiAgICAgICAge2VkaXRNb2RlID8gKFxuICAgICAgICAgIDxVbmRvUmVkb0tleUxpc3RlbmVycyBvblVuZG89e2hhbmRsZUN0cmxafSBvblJlZG89e2hhbmRsZUN0cmxZfSAvPlxuICAgICAgICApIDogKFxuICAgICAgICAgIDxkaXYgY3NzPXthY3Rpb25CdXR0b25zU3R5bGV9PlxuICAgICAgICAgICAge05hdkV4dGVuc2lvbiAmJiA8TmF2RXh0ZW5zaW9uIC8+fVxuICAgICAgICAgICAge3VzZXJDYW5FZGl0ICYmIChcbiAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgIGJ1dHRvblN0eWxlPVwic2Vjb25kYXJ5XCJcbiAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICB0b2dnbGVFZGl0TW9kZSgpO1xuICAgICAgICAgICAgICAgICAgYm91bmRBY3Rpb25DcmVhdG9ycy5jbGVhckRhc2hib2FyZEhpc3Rvcnk/LigpOyAvLyBSZXNldHMgdGhlIGBwYXN0YCBhcyBhbiBlbXB0eSBhcnJheVxuICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgZGF0YS10ZXN0PVwiZWRpdC1kYXNoYm9hcmQtYnV0dG9uXCJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJhY3Rpb24tYnV0dG9uXCJcbiAgICAgICAgICAgICAgICBjc3M9e2VkaXRCdXR0b25TdHlsZX1cbiAgICAgICAgICAgICAgICBhcmlhLWxhYmVsPXt0KCdFZGl0IGRhc2hib2FyZCcpfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAge3QoJ0VkaXQgZGFzaGJvYXJkJyl9XG4gICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKX1cbiAgICAgIDwvZGl2PlxuICAgICksXG4gICAgW1xuICAgICAgTmF2RXh0ZW5zaW9uLFxuICAgICAgYm91bmRBY3Rpb25DcmVhdG9ycy5vblJlZG8sXG4gICAgICBib3VuZEFjdGlvbkNyZWF0b3JzLm9uVW5kbyxcbiAgICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnMuY2xlYXJEYXNoYm9hcmRIaXN0b3J5LFxuICAgICAgZWRpdE1vZGUsXG4gICAgICBlbXBoYXNpemVSZWRvLFxuICAgICAgZW1waGFzaXplVW5kbyxcbiAgICAgIGhhbmRsZUN0cmxZLFxuICAgICAgaGFuZGxlQ3RybFosXG4gICAgICBoYXNVbnNhdmVkQ2hhbmdlcyxcbiAgICAgIG92ZXJ3cml0ZURhc2hib2FyZCxcbiAgICAgIHJlZG9MZW5ndGgsXG4gICAgICB0b2dnbGVFZGl0TW9kZSxcbiAgICAgIHVuZG9MZW5ndGgsXG4gICAgICB1c2VyQ2FuRWRpdCxcbiAgICAgIHVzZXJDYW5TYXZlQXMsXG4gICAgXSxcbiAgKTtcblxuICBjb25zdCBoYW5kbGVSZXBvcnREZWxldGUgPSBhc3luYyByZXBvcnQgPT4ge1xuICAgIGF3YWl0IGRpc3BhdGNoKGRlbGV0ZUFjdGl2ZVJlcG9ydChyZXBvcnQpKTtcbiAgICBzZXRDdXJyZW50UmVwb3J0RGVsZXRpbmcobnVsbCk7XG4gIH07XG5cbiAgY29uc3QgW21lbnUsIGlzRHJvcGRvd25WaXNpYmxlLCBzZXRJc0Ryb3Bkb3duVmlzaWJsZV0gPSB1c2VIZWFkZXJBY3Rpb25zTWVudSh7XG4gICAgYWRkU3VjY2Vzc1RvYXN0OiBib3VuZEFjdGlvbkNyZWF0b3JzLmFkZFN1Y2Nlc3NUb2FzdCxcbiAgICBhZGREYW5nZXJUb2FzdDogYm91bmRBY3Rpb25DcmVhdG9ycy5hZGREYW5nZXJUb2FzdCxcbiAgICBkYXNoYm9hcmRJbmZvLFxuICAgIGRhc2hib2FyZElkOiBkYXNoYm9hcmRJbmZvLmlkLFxuICAgIGRhc2hib2FyZFRpdGxlLFxuICAgIGRhdGFNYXNrLFxuICAgIGxheW91dCxcbiAgICBleHBhbmRlZFNsaWNlcyxcbiAgICBjdXN0b21Dc3MsXG4gICAgY29sb3JOYW1lc3BhY2UsXG4gICAgY29sb3JTY2hlbWUsXG4gICAgb25TYXZlOiBib3VuZEFjdGlvbkNyZWF0b3JzLm9uU2F2ZSxcbiAgICBvbkNoYW5nZTogYm91bmRBY3Rpb25DcmVhdG9ycy5vbkNoYW5nZSxcbiAgICBmb3JjZVJlZnJlc2hBbGxDaGFydHM6IGZvcmNlUmVmcmVzaCxcbiAgICBzdGFydFBlcmlvZGljUmVuZGVyLFxuICAgIHJlZnJlc2hGcmVxdWVuY3ksXG4gICAgc2hvdWxkUGVyc2lzdFJlZnJlc2hGcmVxdWVuY3ksXG4gICAgc2V0UmVmcmVzaEZyZXF1ZW5jeTogYm91bmRBY3Rpb25DcmVhdG9ycy5zZXRSZWZyZXNoRnJlcXVlbmN5LFxuICAgIHVwZGF0ZUNzczogYm91bmRBY3Rpb25DcmVhdG9ycy51cGRhdGVDc3MsXG4gICAgZWRpdE1vZGUsXG4gICAgaGFzVW5zYXZlZENoYW5nZXMsXG4gICAgdXNlckNhbkVkaXQsXG4gICAgdXNlckNhblNoYXJlLFxuICAgIHVzZXJDYW5TYXZlOiB1c2VyQ2FuU2F2ZUFzLFxuICAgIHVzZXJDYW5DdXJhdGUsXG4gICAgaXNMb2FkaW5nLFxuICAgIHNob3dSZXBvcnRNb2RhbCxcbiAgICBzaG93UHJvcGVydGllc01vZGFsLFxuICAgIHNldEN1cnJlbnRSZXBvcnREZWxldGluZyxcbiAgICBtYW5hZ2VFbWJlZGRlZDogc2hvd0VtYmVkTW9kYWwsXG4gICAgcmVmcmVzaExpbWl0LFxuICAgIHJlZnJlc2hXYXJuaW5nLFxuICAgIGxhc3RNb2RpZmllZFRpbWU6IGFjdHVhbExhc3RNb2RpZmllZFRpbWUsXG4gICAgbG9nRXZlbnQ6IGJvdW5kQWN0aW9uQ3JlYXRvcnMubG9nRXZlbnQsXG4gIH0pO1xuICByZXR1cm4gKFxuICAgIDxkaXZcbiAgICAgIGNzcz17aGVhZGVyQ29udGFpbmVyU3R5bGV9XG4gICAgICBkYXRhLXRlc3Q9XCJkYXNoYm9hcmQtaGVhZGVyLWNvbnRhaW5lclwiXG4gICAgICBkYXRhLXRlc3QtaWQ9e2Rhc2hib2FyZEluZm8uaWR9XG4gICAgICBjbGFzc05hbWU9XCJkYXNoYm9hcmQtaGVhZGVyLWNvbnRhaW5lclwiXG4gICAgPlxuICAgICAgPFBhZ2VIZWFkZXJXaXRoQWN0aW9uc1xuICAgICAgICBlZGl0YWJsZVRpdGxlUHJvcHM9e2VkaXRhYmxlVGl0bGVQcm9wc31cbiAgICAgICAgY2VydGlmaWNhdGllZEJhZGdlUHJvcHM9e2NlcnRpZmllZEJhZGdlUHJvcHN9XG4gICAgICAgIGZhdmVTdGFyUHJvcHM9e2ZhdmVTdGFyUHJvcHN9XG4gICAgICAgIHRpdGxlUGFuZWxBZGRpdGlvbmFsSXRlbXM9e3RpdGxlUGFuZWxBZGRpdGlvbmFsSXRlbXN9XG4gICAgICAgIHJpZ2h0UGFuZWxBZGRpdGlvbmFsSXRlbXM9e3JpZ2h0UGFuZWxBZGRpdGlvbmFsSXRlbXN9XG4gICAgICAgIG1lbnVEcm9wZG93blByb3BzPXt7XG4gICAgICAgICAgb3BlbjogaXNEcm9wZG93blZpc2libGUsXG4gICAgICAgICAgb25PcGVuQ2hhbmdlOiBzZXRJc0Ryb3Bkb3duVmlzaWJsZSxcbiAgICAgICAgfX1cbiAgICAgICAgYWRkaXRpb25hbEFjdGlvbnNNZW51PXttZW51fVxuICAgICAgICBzaG93RmF2ZVN0YXI9e3VzZXI/LnVzZXJJZCAmJiBkYXNoYm9hcmRJbmZvPy5pZH1cbiAgICAgICAgc2hvd1RpdGxlUGFuZWxJdGVtc1xuICAgICAgLz5cbiAgICAgIHtzaG93aW5nUHJvcGVydGllc01vZGFsICYmIChcbiAgICAgICAgPFByb3BlcnRpZXNNb2RhbFxuICAgICAgICAgIGRhc2hib2FyZElkPXtkYXNoYm9hcmRJbmZvLmlkfVxuICAgICAgICAgIGRhc2hib2FyZEluZm89e2Rhc2hib2FyZEluZm99XG4gICAgICAgICAgZGFzaGJvYXJkVGl0bGU9e2Rhc2hib2FyZFRpdGxlfVxuICAgICAgICAgIHNob3c9e3Nob3dpbmdQcm9wZXJ0aWVzTW9kYWx9XG4gICAgICAgICAgb25IaWRlPXtoaWRlUHJvcGVydGllc01vZGFsfVxuICAgICAgICAgIGNvbG9yU2NoZW1lPXtjb2xvclNjaGVtZX1cbiAgICAgICAgICBvblN1Ym1pdD17aGFuZGxlT25Qcm9wZXJ0aWVzQ2hhbmdlfVxuICAgICAgICAgIG9ubHlBcHBseVxuICAgICAgICAvPlxuICAgICAgKX1cblxuICAgICAgPFJlcG9ydE1vZGFsXG4gICAgICAgIHVzZXJJZD17dXNlci51c2VySWR9XG4gICAgICAgIHNob3c9e3Nob3dpbmdSZXBvcnRNb2RhbH1cbiAgICAgICAgb25IaWRlPXtoaWRlUmVwb3J0TW9kYWx9XG4gICAgICAgIHVzZXJFbWFpbD17dXNlci5lbWFpbH1cbiAgICAgICAgZGFzaGJvYXJkSWQ9e2Rhc2hib2FyZEluZm8uaWR9XG4gICAgICAgIGNyZWF0aW9uTWV0aG9kPVwiZGFzaGJvYXJkc1wiXG4gICAgICAvPlxuXG4gICAgICB7Y3VycmVudFJlcG9ydERlbGV0aW5nICYmIChcbiAgICAgICAgPERlbGV0ZU1vZGFsXG4gICAgICAgICAgZGVzY3JpcHRpb249e3QoXG4gICAgICAgICAgICAnVGhpcyBhY3Rpb24gd2lsbCBwZXJtYW5lbnRseSBkZWxldGUgJXMuJyxcbiAgICAgICAgICAgIGN1cnJlbnRSZXBvcnREZWxldGluZz8ubmFtZSxcbiAgICAgICAgICApfVxuICAgICAgICAgIG9uQ29uZmlybT17KCkgPT4ge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRSZXBvcnREZWxldGluZykge1xuICAgICAgICAgICAgICBoYW5kbGVSZXBvcnREZWxldGUoY3VycmVudFJlcG9ydERlbGV0aW5nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9fVxuICAgICAgICAgIG9uSGlkZT17KCkgPT4gc2V0Q3VycmVudFJlcG9ydERlbGV0aW5nKG51bGwpfVxuICAgICAgICAgIG9wZW5cbiAgICAgICAgICB0aXRsZT17dCgnRGVsZXRlIFJlcG9ydD8nKX1cbiAgICAgICAgLz5cbiAgICAgICl9XG5cbiAgICAgIDxPdmVyd3JpdGVDb25maXJtIC8+XG5cbiAgICAgIHt1c2VyQ2FuQ3VyYXRlICYmIChcbiAgICAgICAgPERhc2hib2FyZEVtYmVkTW9kYWxcbiAgICAgICAgICBzaG93PXtzaG93aW5nRW1iZWRNb2RhbH1cbiAgICAgICAgICBvbkhpZGU9e2hpZGVFbWJlZE1vZGFsfVxuICAgICAgICAgIGRhc2hib2FyZElkPXtkYXNoYm9hcmRJbmZvLmlkfVxuICAgICAgICAvPlxuICAgICAgKX1cbiAgICAgIDxHbG9iYWxcbiAgICAgICAgc3R5bGVzPXtjc3NgXG4gICAgICAgICAgLmFudGQ1LW1lbnUtdmVydGljYWwge1xuICAgICAgICAgICAgYm9yZGVyLXJpZ2h0OiBub25lO1xuICAgICAgICAgIH1cbiAgICAgICAgYH1cbiAgICAgIC8+XG4gICAgPC9kaXY+XG4gICk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBIZWFkZXI7XG4iXX0= */\"],\n\n\n                  iconSize: \"xl\" }\n                ) }\n              ) }\n            )] }\n          ),\n          _jsx(Button, {\n            css: discardBtnStyle,\n            buttonSize: \"small\",\n            onClick: discardChanges,\n            buttonStyle: \"default\",\n\n            \"aria-label\": t('Discard'), children:\n\n            t('Discard') }\n          ),\n          _jsxs(Button, {\n            css: saveBtnStyle,\n            buttonSize: \"small\",\n            disabled: !hasUnsavedChanges,\n            buttonStyle: \"primary\",\n            onClick: overwriteDashboard,\n\n            \"aria-label\": t('Save'), children: [\n\n            _jsx(Icons.SaveOutlined, {\n              iconColor: hasUnsavedChanges && theme.colors.primary.light5,\n              iconSize: \"m\" }\n            ),\n            t('Save')] }\n          )] }\n        ) }\n\n      ),\n\n      editMode ?\n      _jsx(UndoRedoKeyListeners, { onUndo: handleCtrlZ, onRedo: handleCtrlY }) :\n\n      _jsxs(\"div\", { css: actionButtonsStyle, children: [\n        NavExtension && _jsx(NavExtension, {}),\n        userCanEdit &&\n        _jsx(Button, {\n          buttonStyle: \"secondary\",\n          onClick: () => {\n            toggleEditMode();\n            boundActionCreators.clearDashboardHistory == null ? void 0 : boundActionCreators.clearDashboardHistory(); // Resets the `past` as an empty array\n          },\n\n          className: \"action-button\",\n          css: editButtonStyle,\n          \"aria-label\": t('Edit dashboard'), children:\n\n          t('Edit dashboard') }\n        )] }\n\n      )] }\n\n    ),\n\n    [\n    NavExtension,\n    boundActionCreators.onRedo,\n    boundActionCreators.onUndo,\n    boundActionCreators.clearDashboardHistory,\n    editMode,\n    emphasizeRedo,\n    emphasizeUndo,\n    handleCtrlY,\n    handleCtrlZ,\n    hasUnsavedChanges,\n    overwriteDashboard,\n    redoLength,\n    toggleEditMode,\n    undoLength,\n    userCanEdit,\n    userCanSaveAs]\n\n  );\n\n  const handleReportDelete = async (report) => {\n    await dispatch(deleteActiveReport(report));\n    setCurrentReportDeleting(null);\n  };\n\n  const [menu, isDropdownVisible, setIsDropdownVisible] = useHeaderActionsMenu({\n    addSuccessToast: boundActionCreators.addSuccessToast,\n    addDangerToast: boundActionCreators.addDangerToast,\n    dashboardInfo,\n    dashboardId: dashboardInfo.id,\n    dashboardTitle,\n    dataMask,\n    layout,\n    expandedSlices,\n    customCss,\n    colorNamespace,\n    colorScheme,\n    onSave: boundActionCreators.onSave,\n    onChange: boundActionCreators.onChange,\n    forceRefreshAllCharts: forceRefresh,\n    startPeriodicRender,\n    refreshFrequency,\n    shouldPersistRefreshFrequency,\n    setRefreshFrequency: boundActionCreators.setRefreshFrequency,\n    updateCss: boundActionCreators.updateCss,\n    editMode,\n    hasUnsavedChanges,\n    userCanEdit,\n    userCanShare,\n    userCanSave: userCanSaveAs,\n    userCanCurate,\n    isLoading,\n    showReportModal,\n    showPropertiesModal,\n    setCurrentReportDeleting,\n    manageEmbedded: showEmbedModal,\n    refreshLimit,\n    refreshWarning,\n    lastModifiedTime: actualLastModifiedTime,\n    logEvent: boundActionCreators.logEvent\n  });\n  return (\n    _jsxs(\"div\", {\n      css: headerContainerStyle,\n\n      \"data-test-id\": dashboardInfo.id,\n      className: \"dashboard-header-container\", children: [\n\n      _jsx(PageHeaderWithActions, {\n        editableTitleProps: editableTitleProps,\n        certificatiedBadgeProps: certifiedBadgeProps,\n        faveStarProps: faveStarProps,\n        titlePanelAdditionalItems: titlePanelAdditionalItems,\n        rightPanelAdditionalItems: rightPanelAdditionalItems,\n        menuDropdownProps: {\n          open: isDropdownVisible,\n          onOpenChange: setIsDropdownVisible\n        },\n        additionalActionsMenu: menu,\n        showFaveStar: (user == null ? void 0 : user.userId) && (dashboardInfo == null ? void 0 : dashboardInfo.id),\n        showTitlePanelItems: true }\n      ),\n      showingPropertiesModal &&\n      _jsx(PropertiesModal, {\n        dashboardId: dashboardInfo.id,\n        dashboardInfo: dashboardInfo,\n        dashboardTitle: dashboardTitle,\n        show: showingPropertiesModal,\n        onHide: hidePropertiesModal,\n        colorScheme: colorScheme,\n        onSubmit: handleOnPropertiesChange,\n        onlyApply: true }\n      ),\n\n\n      _jsx(ReportModal, {\n        userId: user.userId,\n        show: showingReportModal,\n        onHide: hideReportModal,\n        userEmail: user.email,\n        dashboardId: dashboardInfo.id,\n        creationMethod: \"dashboards\" }\n      ),\n\n      currentReportDeleting &&\n      _jsx(DeleteModal, {\n        description: t(\n          'This action will permanently delete %s.',\n          currentReportDeleting == null ? void 0 : currentReportDeleting.name\n        ),\n        onConfirm: () => {\n          if (currentReportDeleting) {\n            handleReportDelete(currentReportDeleting);\n          }\n        },\n        onHide: () => setCurrentReportDeleting(null),\n        open: true,\n        title: t('Delete Report?') }\n      ),\n\n\n      _jsx(OverwriteConfirm, {}),\n\n      userCanCurate &&\n      _jsx(DashboardEmbedModal, {\n        show: showingEmbedModal,\n        onHide: hideEmbedModal,\n        dashboardId: dashboardInfo.id }\n      ),\n\n      _jsx(Global, {\n        styles: css`\n          .antd5-menu-vertical {\n            border-right: none;\n          }\n        ` }\n      )] }\n    ));\n\n};\n\nexport default Header;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}