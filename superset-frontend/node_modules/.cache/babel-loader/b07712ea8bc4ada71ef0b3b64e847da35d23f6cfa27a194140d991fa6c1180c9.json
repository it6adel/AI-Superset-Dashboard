{"ast":null,"code":"import { css as _css } from \"@emotion/react\"; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { forwardRef, useCallback, useImperativeHandle, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Behavior, ensureIsArray, FeatureFlag, getChartMetadataRegistry, isFeatureEnabled, t, useTheme } from '@superset-ui/core';\nimport { Menu } from 'src/components/Menu';\nimport { usePermissions } from 'src/hooks/usePermissions';\nimport { Dropdown } from 'src/components/Dropdown';\nimport { updateDataMask } from 'src/dataMask/actions';\nimport DrillByModal from 'src/components/Chart/DrillBy/DrillByModal';\nimport { useVerboseMap } from 'src/hooks/apiResources/datasets';\nimport { DrillDetailMenuItems } from '../DrillDetail';\nimport { getMenuAdjustedY } from '../utils';\nimport { MenuItemTooltip } from '../DisabledMenuItemTooltip';\nimport { DrillByMenuItems } from '../DrillBy/DrillByMenuItems';\nimport DrillDetailModal from '../DrillDetail/DrillDetailModal';import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from \"@emotion/react/jsx-runtime\";\nexport var ContextMenuItem;\n(function (ContextMenuItem) {\n  ContextMenuItem[ContextMenuItem[\"CrossFilter\"] = 0] = \"CrossFilter\";\n  ContextMenuItem[ContextMenuItem[\"DrillToDetail\"] = 1] = \"DrillToDetail\";\n  ContextMenuItem[ContextMenuItem[\"DrillBy\"] = 2] = \"DrillBy\";\n  ContextMenuItem[ContextMenuItem[\"All\"] = 3] = \"All\";\n})(ContextMenuItem || (ContextMenuItem = {}));\nconst ChartContextMenu = ({ id, formData, onSelection, onClose, displayedItems = ContextMenuItem.All, additionalConfig }, ref) => {var _getChartMetadataRegi, _getChartMetadataRegi2;\n  const theme = useTheme();\n  const dispatch = useDispatch();\n  const { canDrillToDetail, canDrillBy, canDownload } = usePermissions();\n  const crossFiltersEnabled = useSelector(({ dashboardInfo }) => dashboardInfo.crossFiltersEnabled);\n  const [openKeys, setOpenKeys] = useState([]);\n  const [modalFilters, setFilters] = useState([]);\n  const [visible, setVisible] = useState(false);\n  const isDisplayed = (item) => displayedItems === ContextMenuItem.All ||\n  ensureIsArray(displayedItems).includes(item);\n  const [{ filters, clientX, clientY }, setState] = useState({ clientX: 0, clientY: 0 });\n  const [drillModalIsOpen, setDrillModalIsOpen] = useState(false);\n  const [drillByColumn, setDrillByColumn] = useState();\n  const [showDrillByModal, setShowDrillByModal] = useState(false);\n  const [dataset, setDataset] = useState();\n  const verboseMap = useVerboseMap(dataset);\n  const handleDrillBy = useCallback((column, dataset) => {\n    setDrillByColumn(column);\n    setDataset(dataset); // Save dataset when drilling\n    setShowDrillByModal(true);\n  }, []);\n  const handleCloseDrillByModal = useCallback(() => {\n    setShowDrillByModal(false);\n  }, []);\n  const menuItems = [];\n  const showDrillToDetail = isFeatureEnabled(FeatureFlag.DrillToDetail) &&\n  canDrillToDetail &&\n  isDisplayed(ContextMenuItem.DrillToDetail);\n  const showDrillBy = isFeatureEnabled(FeatureFlag.DrillBy) &&\n  canDrillBy &&\n  isDisplayed(ContextMenuItem.DrillBy);\n  const showCrossFilters = isDisplayed(ContextMenuItem.CrossFilter);\n  const isCrossFilteringSupportedByChart = (_getChartMetadataRegi = getChartMetadataRegistry().\n  get(formData.viz_type)) == null ? void 0 : (_getChartMetadataRegi2 = _getChartMetadataRegi.\n  behaviors) == null ? void 0 : _getChartMetadataRegi2.includes(Behavior.InteractiveChart);\n  let itemsCount = 0;\n  if (showCrossFilters) {\n    itemsCount += 1;\n  }\n  if (showDrillToDetail) {\n    itemsCount += 2; // Drill to detail always has 2 top-level menu items\n  }\n  if (showDrillBy) {\n    itemsCount += 1;\n  }\n  if (itemsCount === 0) {\n    itemsCount = 1; // \"No actions\" appears if no actions in menu\n  }\n  if (showCrossFilters) {var _filters$crossFilter;\n    const isCrossFilterDisabled = !isCrossFilteringSupportedByChart ||\n    !crossFiltersEnabled ||\n    !(filters != null && filters.crossFilter);\n    let crossFilteringTooltipTitle = null;\n    if (!isCrossFilterDisabled) {\n      crossFilteringTooltipTitle = _jsxs(_Fragment, { children: [\n        _jsx(\"div\", { children:\n          t('Cross-filter will be applied to all of the charts that use this dataset.') }\n        ),\n        _jsx(\"div\", { children:\n          t('You can also just click on the chart to apply cross-filter.') }\n        )] }\n      );\n    } else\n    if (!crossFiltersEnabled) {\n      crossFilteringTooltipTitle = _jsx(_Fragment, { children:\n        _jsx(\"div\", { children: t('Cross-filtering is not enabled for this dashboard.') }) }\n      );\n    } else\n    if (!isCrossFilteringSupportedByChart) {\n      crossFilteringTooltipTitle = _jsx(_Fragment, { children:\n        _jsx(\"div\", { children:\n          t('This visualization type does not support cross-filtering.') }\n        ) }\n      );\n    } else\n    if (!(filters != null && filters.crossFilter)) {\n      crossFilteringTooltipTitle = _jsx(_Fragment, { children:\n        _jsx(\"div\", { children: t(`You can't apply cross-filter on this data point.`) }) }\n      );\n    }\n    menuItems.push(_jsxs(_Fragment, { children: [\n      _jsx(Menu.Item, { disabled: isCrossFilterDisabled, onClick: () => {\n          if (filters != null && filters.crossFilter) {\n            dispatch(updateDataMask(id, filters.crossFilter.dataMask));\n          }\n        }, children:\n        filters != null && (_filters$crossFilter = filters.crossFilter) != null && _filters$crossFilter.isCurrentValueSelected ? t('Remove cross-filter') : _jsxs(\"div\", { children: [\n          t('Add cross-filter'),\n          _jsx(MenuItemTooltip, { title: crossFilteringTooltipTitle, color: !isCrossFilterDisabled ?\n            theme.colors.grayscale.base :\n            undefined })] }\n        ) }, \"cross-filtering-menu-item\"\n      ),\n      itemsCount > 1 && _jsx(Menu.Divider, {})] }\n    ));\n  }\n  if (showDrillToDetail) {\n    menuItems.push(_jsx(DrillDetailMenuItems, { formData: formData, filters: filters == null ? void 0 : filters.drillToDetail, setFilters: setFilters, isContextMenu: true, contextMenuY: clientY, onSelection: onSelection, submenuIndex: showCrossFilters ? 2 : 1, setShowModal: setDrillModalIsOpen, ...((additionalConfig == null ? void 0 : additionalConfig.drillToDetail) || {}) }));\n  }\n  if (showDrillBy) {\n    let submenuIndex = 0;\n    if (showCrossFilters) {\n      submenuIndex += 1;\n    }\n    if (showDrillToDetail) {\n      submenuIndex += 2;\n    }\n    menuItems.push(_jsx(DrillByMenuItems, { drillByConfig: filters == null ? void 0 : filters.drillBy, onSelection: onSelection, formData: formData, contextMenuY: clientY, submenuIndex: submenuIndex, open: openKeys.includes('drill-by-submenu'), onDrillBy: handleDrillBy, ...((additionalConfig == null ? void 0 : additionalConfig.drillBy) || {}) }, \"drill-by-submenu\"));\n  }\n  const open = useCallback((clientX, clientY, filters) => {var _document$getElementB;\n    const adjustedY = getMenuAdjustedY(clientY, itemsCount);\n    setState({\n      clientX,\n      clientY: adjustedY,\n      filters\n    });\n    // Since Ant Design's Dropdown does not offer an imperative API\n    // and we can't attach event triggers to charts SVG elements, we\n    // use a hidden span that gets clicked on when receiving click events\n    // from the charts.\n    (_document$getElementB = document.getElementById(`hidden-span-${id}`)) == null ? void 0 : _document$getElementB.click();\n  }, [id, itemsCount]);\n  useImperativeHandle(ref, () => ({\n    open\n  }), [open]);\n  return /*#__PURE__*/ReactDOM.createPortal(_jsxs(_Fragment, { children: [\n    _jsx(Dropdown, { dropdownRender: () => _jsx(Menu, { className: \"chart-context-menu\", onOpenChange: setOpenKeys, onClick: () => {\n          setVisible(false);\n          onClose();\n        }, children:\n        menuItems.length ? menuItems : _jsx(Menu.Item, { disabled: true, children: t('No actions') }) }\n      ), trigger: ['click'], onOpenChange: (value) => {\n        setVisible(value);\n        if (!value) {\n          setOpenKeys([]);\n        }\n      }, open: visible, children:\n      _jsx(\"span\", { id: `hidden-span-${id}`, css: /*#__PURE__*/_css({\n          visibility: 'hidden',\n          position: 'fixed',\n          top: clientY,\n          left: clientX,\n          width: 1,\n          height: 1\n        }, process.env.NODE_ENV === \"production\" ? \"\" : \";label:ChartContextMenu;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2FkZWwvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2NvbXBvbmVudHMvQ2hhcnQvQ2hhcnRDb250ZXh0TWVudS9DaGFydENvbnRleHRNZW51LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFpTHVDIiwiZmlsZSI6Ii9ob21lL2FkZWwvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2NvbXBvbmVudHMvQ2hhcnQvQ2hhcnRDb250ZXh0TWVudS9DaGFydENvbnRleHRNZW51LnRzeCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCB7IGZvcndhcmRSZWYsIHVzZUNhbGxiYWNrLCB1c2VJbXBlcmF0aXZlSGFuZGxlLCB1c2VTdGF0ZSwgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCB7IHVzZURpc3BhdGNoLCB1c2VTZWxlY3RvciB9IGZyb20gJ3JlYWN0LXJlZHV4JztcbmltcG9ydCB7IEJlaGF2aW9yLCBlbnN1cmVJc0FycmF5LCBGZWF0dXJlRmxhZywgZ2V0Q2hhcnRNZXRhZGF0YVJlZ2lzdHJ5LCBpc0ZlYXR1cmVFbmFibGVkLCB0LCB1c2VUaGVtZSwgfSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgeyBNZW51IH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvTWVudSc7XG5pbXBvcnQgeyB1c2VQZXJtaXNzaW9ucyB9IGZyb20gJ3NyYy9ob29rcy91c2VQZXJtaXNzaW9ucyc7XG5pbXBvcnQgeyBEcm9wZG93biB9IGZyb20gJ3NyYy9jb21wb25lbnRzL0Ryb3Bkb3duJztcbmltcG9ydCB7IHVwZGF0ZURhdGFNYXNrIH0gZnJvbSAnc3JjL2RhdGFNYXNrL2FjdGlvbnMnO1xuaW1wb3J0IERyaWxsQnlNb2RhbCBmcm9tICdzcmMvY29tcG9uZW50cy9DaGFydC9EcmlsbEJ5L0RyaWxsQnlNb2RhbCc7XG5pbXBvcnQgeyB1c2VWZXJib3NlTWFwIH0gZnJvbSAnc3JjL2hvb2tzL2FwaVJlc291cmNlcy9kYXRhc2V0cyc7XG5pbXBvcnQgeyBEcmlsbERldGFpbE1lbnVJdGVtcyB9IGZyb20gJy4uL0RyaWxsRGV0YWlsJztcbmltcG9ydCB7IGdldE1lbnVBZGp1c3RlZFkgfSBmcm9tICcuLi91dGlscyc7XG5pbXBvcnQgeyBNZW51SXRlbVRvb2x0aXAgfSBmcm9tICcuLi9EaXNhYmxlZE1lbnVJdGVtVG9vbHRpcCc7XG5pbXBvcnQgeyBEcmlsbEJ5TWVudUl0ZW1zIH0gZnJvbSAnLi4vRHJpbGxCeS9EcmlsbEJ5TWVudUl0ZW1zJztcbmltcG9ydCBEcmlsbERldGFpbE1vZGFsIGZyb20gJy4uL0RyaWxsRGV0YWlsL0RyaWxsRGV0YWlsTW9kYWwnO1xuZXhwb3J0IHZhciBDb250ZXh0TWVudUl0ZW07XG4oZnVuY3Rpb24gKENvbnRleHRNZW51SXRlbSkge1xuICAgIENvbnRleHRNZW51SXRlbVtDb250ZXh0TWVudUl0ZW1bXCJDcm9zc0ZpbHRlclwiXSA9IDBdID0gXCJDcm9zc0ZpbHRlclwiO1xuICAgIENvbnRleHRNZW51SXRlbVtDb250ZXh0TWVudUl0ZW1bXCJEcmlsbFRvRGV0YWlsXCJdID0gMV0gPSBcIkRyaWxsVG9EZXRhaWxcIjtcbiAgICBDb250ZXh0TWVudUl0ZW1bQ29udGV4dE1lbnVJdGVtW1wiRHJpbGxCeVwiXSA9IDJdID0gXCJEcmlsbEJ5XCI7XG4gICAgQ29udGV4dE1lbnVJdGVtW0NvbnRleHRNZW51SXRlbVtcIkFsbFwiXSA9IDNdID0gXCJBbGxcIjtcbn0pKENvbnRleHRNZW51SXRlbSB8fCAoQ29udGV4dE1lbnVJdGVtID0ge30pKTtcbmNvbnN0IENoYXJ0Q29udGV4dE1lbnUgPSAoeyBpZCwgZm9ybURhdGEsIG9uU2VsZWN0aW9uLCBvbkNsb3NlLCBkaXNwbGF5ZWRJdGVtcyA9IENvbnRleHRNZW51SXRlbS5BbGwsIGFkZGl0aW9uYWxDb25maWcsIH0sIHJlZikgPT4ge1xuICAgIGNvbnN0IHRoZW1lID0gdXNlVGhlbWUoKTtcbiAgICBjb25zdCBkaXNwYXRjaCA9IHVzZURpc3BhdGNoKCk7XG4gICAgY29uc3QgeyBjYW5EcmlsbFRvRGV0YWlsLCBjYW5EcmlsbEJ5LCBjYW5Eb3dubG9hZCB9ID0gdXNlUGVybWlzc2lvbnMoKTtcbiAgICBjb25zdCBjcm9zc0ZpbHRlcnNFbmFibGVkID0gdXNlU2VsZWN0b3IoKHsgZGFzaGJvYXJkSW5mbyB9KSA9PiBkYXNoYm9hcmRJbmZvLmNyb3NzRmlsdGVyc0VuYWJsZWQpO1xuICAgIGNvbnN0IFtvcGVuS2V5cywgc2V0T3BlbktleXNdID0gdXNlU3RhdGUoW10pO1xuICAgIGNvbnN0IFttb2RhbEZpbHRlcnMsIHNldEZpbHRlcnNdID0gdXNlU3RhdGUoW10pO1xuICAgIGNvbnN0IFt2aXNpYmxlLCBzZXRWaXNpYmxlXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBpc0Rpc3BsYXllZCA9IChpdGVtKSA9PiBkaXNwbGF5ZWRJdGVtcyA9PT0gQ29udGV4dE1lbnVJdGVtLkFsbCB8fFxuICAgICAgICBlbnN1cmVJc0FycmF5KGRpc3BsYXllZEl0ZW1zKS5pbmNsdWRlcyhpdGVtKTtcbiAgICBjb25zdCBbeyBmaWx0ZXJzLCBjbGllbnRYLCBjbGllbnRZIH0sIHNldFN0YXRlXSA9IHVzZVN0YXRlKHsgY2xpZW50WDogMCwgY2xpZW50WTogMCB9KTtcbiAgICBjb25zdCBbZHJpbGxNb2RhbElzT3Blbiwgc2V0RHJpbGxNb2RhbElzT3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgW2RyaWxsQnlDb2x1bW4sIHNldERyaWxsQnlDb2x1bW5dID0gdXNlU3RhdGUoKTtcbiAgICBjb25zdCBbc2hvd0RyaWxsQnlNb2RhbCwgc2V0U2hvd0RyaWxsQnlNb2RhbF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgW2RhdGFzZXQsIHNldERhdGFzZXRdID0gdXNlU3RhdGUoKTtcbiAgICBjb25zdCB2ZXJib3NlTWFwID0gdXNlVmVyYm9zZU1hcChkYXRhc2V0KTtcbiAgICBjb25zdCBoYW5kbGVEcmlsbEJ5ID0gdXNlQ2FsbGJhY2soKGNvbHVtbiwgZGF0YXNldCkgPT4ge1xuICAgICAgICBzZXREcmlsbEJ5Q29sdW1uKGNvbHVtbik7XG4gICAgICAgIHNldERhdGFzZXQoZGF0YXNldCk7IC8vIFNhdmUgZGF0YXNldCB3aGVuIGRyaWxsaW5nXG4gICAgICAgIHNldFNob3dEcmlsbEJ5TW9kYWwodHJ1ZSk7XG4gICAgfSwgW10pO1xuICAgIGNvbnN0IGhhbmRsZUNsb3NlRHJpbGxCeU1vZGFsID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgICBzZXRTaG93RHJpbGxCeU1vZGFsKGZhbHNlKTtcbiAgICB9LCBbXSk7XG4gICAgY29uc3QgbWVudUl0ZW1zID0gW107XG4gICAgY29uc3Qgc2hvd0RyaWxsVG9EZXRhaWwgPSBpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLkRyaWxsVG9EZXRhaWwpICYmXG4gICAgICAgIGNhbkRyaWxsVG9EZXRhaWwgJiZcbiAgICAgICAgaXNEaXNwbGF5ZWQoQ29udGV4dE1lbnVJdGVtLkRyaWxsVG9EZXRhaWwpO1xuICAgIGNvbnN0IHNob3dEcmlsbEJ5ID0gaXNGZWF0dXJlRW5hYmxlZChGZWF0dXJlRmxhZy5EcmlsbEJ5KSAmJlxuICAgICAgICBjYW5EcmlsbEJ5ICYmXG4gICAgICAgIGlzRGlzcGxheWVkKENvbnRleHRNZW51SXRlbS5EcmlsbEJ5KTtcbiAgICBjb25zdCBzaG93Q3Jvc3NGaWx0ZXJzID0gaXNEaXNwbGF5ZWQoQ29udGV4dE1lbnVJdGVtLkNyb3NzRmlsdGVyKTtcbiAgICBjb25zdCBpc0Nyb3NzRmlsdGVyaW5nU3VwcG9ydGVkQnlDaGFydCA9IGdldENoYXJ0TWV0YWRhdGFSZWdpc3RyeSgpXG4gICAgICAgIC5nZXQoZm9ybURhdGEudml6X3R5cGUpXG4gICAgICAgID8uYmVoYXZpb3JzPy5pbmNsdWRlcyhCZWhhdmlvci5JbnRlcmFjdGl2ZUNoYXJ0KTtcbiAgICBsZXQgaXRlbXNDb3VudCA9IDA7XG4gICAgaWYgKHNob3dDcm9zc0ZpbHRlcnMpIHtcbiAgICAgICAgaXRlbXNDb3VudCArPSAxO1xuICAgIH1cbiAgICBpZiAoc2hvd0RyaWxsVG9EZXRhaWwpIHtcbiAgICAgICAgaXRlbXNDb3VudCArPSAyOyAvLyBEcmlsbCB0byBkZXRhaWwgYWx3YXlzIGhhcyAyIHRvcC1sZXZlbCBtZW51IGl0ZW1zXG4gICAgfVxuICAgIGlmIChzaG93RHJpbGxCeSkge1xuICAgICAgICBpdGVtc0NvdW50ICs9IDE7XG4gICAgfVxuICAgIGlmIChpdGVtc0NvdW50ID09PSAwKSB7XG4gICAgICAgIGl0ZW1zQ291bnQgPSAxOyAvLyBcIk5vIGFjdGlvbnNcIiBhcHBlYXJzIGlmIG5vIGFjdGlvbnMgaW4gbWVudVxuICAgIH1cbiAgICBpZiAoc2hvd0Nyb3NzRmlsdGVycykge1xuICAgICAgICBjb25zdCBpc0Nyb3NzRmlsdGVyRGlzYWJsZWQgPSAhaXNDcm9zc0ZpbHRlcmluZ1N1cHBvcnRlZEJ5Q2hhcnQgfHxcbiAgICAgICAgICAgICFjcm9zc0ZpbHRlcnNFbmFibGVkIHx8XG4gICAgICAgICAgICAhZmlsdGVycz8uY3Jvc3NGaWx0ZXI7XG4gICAgICAgIGxldCBjcm9zc0ZpbHRlcmluZ1Rvb2x0aXBUaXRsZSA9IG51bGw7XG4gICAgICAgIGlmICghaXNDcm9zc0ZpbHRlckRpc2FibGVkKSB7XG4gICAgICAgICAgICBjcm9zc0ZpbHRlcmluZ1Rvb2x0aXBUaXRsZSA9ICg8PlxuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICB7dCgnQ3Jvc3MtZmlsdGVyIHdpbGwgYmUgYXBwbGllZCB0byBhbGwgb2YgdGhlIGNoYXJ0cyB0aGF0IHVzZSB0aGlzIGRhdGFzZXQuJyl9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIHt0KCdZb3UgY2FuIGFsc28ganVzdCBjbGljayBvbiB0aGUgY2hhcnQgdG8gYXBwbHkgY3Jvc3MtZmlsdGVyLicpfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8Lz4pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFjcm9zc0ZpbHRlcnNFbmFibGVkKSB7XG4gICAgICAgICAgICBjcm9zc0ZpbHRlcmluZ1Rvb2x0aXBUaXRsZSA9ICg8PlxuICAgICAgICAgIDxkaXY+e3QoJ0Nyb3NzLWZpbHRlcmluZyBpcyBub3QgZW5hYmxlZCBmb3IgdGhpcyBkYXNoYm9hcmQuJyl9PC9kaXY+XG4gICAgICAgIDwvPik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIWlzQ3Jvc3NGaWx0ZXJpbmdTdXBwb3J0ZWRCeUNoYXJ0KSB7XG4gICAgICAgICAgICBjcm9zc0ZpbHRlcmluZ1Rvb2x0aXBUaXRsZSA9ICg8PlxuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICB7dCgnVGhpcyB2aXN1YWxpemF0aW9uIHR5cGUgZG9lcyBub3Qgc3VwcG9ydCBjcm9zcy1maWx0ZXJpbmcuJyl9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvPik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIWZpbHRlcnM/LmNyb3NzRmlsdGVyKSB7XG4gICAgICAgICAgICBjcm9zc0ZpbHRlcmluZ1Rvb2x0aXBUaXRsZSA9ICg8PlxuICAgICAgICAgIDxkaXY+e3QoYFlvdSBjYW4ndCBhcHBseSBjcm9zcy1maWx0ZXIgb24gdGhpcyBkYXRhIHBvaW50LmApfTwvZGl2PlxuICAgICAgICA8Lz4pO1xuICAgICAgICB9XG4gICAgICAgIG1lbnVJdGVtcy5wdXNoKDw+XG4gICAgICAgIDxNZW51Lkl0ZW0ga2V5PVwiY3Jvc3MtZmlsdGVyaW5nLW1lbnUtaXRlbVwiIGRpc2FibGVkPXtpc0Nyb3NzRmlsdGVyRGlzYWJsZWR9IG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVycz8uY3Jvc3NGaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2godXBkYXRlRGF0YU1hc2soaWQsIGZpbHRlcnMuY3Jvc3NGaWx0ZXIuZGF0YU1hc2spKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9fT5cbiAgICAgICAgICB7ZmlsdGVycz8uY3Jvc3NGaWx0ZXI/LmlzQ3VycmVudFZhbHVlU2VsZWN0ZWQgPyAodCgnUmVtb3ZlIGNyb3NzLWZpbHRlcicpKSA6ICg8ZGl2PlxuICAgICAgICAgICAgICB7dCgnQWRkIGNyb3NzLWZpbHRlcicpfVxuICAgICAgICAgICAgICA8TWVudUl0ZW1Ub29sdGlwIHRpdGxlPXtjcm9zc0ZpbHRlcmluZ1Rvb2x0aXBUaXRsZX0gY29sb3I9eyFpc0Nyb3NzRmlsdGVyRGlzYWJsZWRcbiAgICAgICAgICAgICAgICAgICAgPyB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmJhc2VcbiAgICAgICAgICAgICAgICAgICAgOiB1bmRlZmluZWR9Lz5cbiAgICAgICAgICAgIDwvZGl2Pil9XG4gICAgICAgIDwvTWVudS5JdGVtPlxuICAgICAgICB7aXRlbXNDb3VudCA+IDEgJiYgPE1lbnUuRGl2aWRlciAvPn1cbiAgICAgIDwvPik7XG4gICAgfVxuICAgIGlmIChzaG93RHJpbGxUb0RldGFpbCkge1xuICAgICAgICBtZW51SXRlbXMucHVzaCg8RHJpbGxEZXRhaWxNZW51SXRlbXMgZm9ybURhdGE9e2Zvcm1EYXRhfSBmaWx0ZXJzPXtmaWx0ZXJzPy5kcmlsbFRvRGV0YWlsfSBzZXRGaWx0ZXJzPXtzZXRGaWx0ZXJzfSBpc0NvbnRleHRNZW51IGNvbnRleHRNZW51WT17Y2xpZW50WX0gb25TZWxlY3Rpb249e29uU2VsZWN0aW9ufSBzdWJtZW51SW5kZXg9e3Nob3dDcm9zc0ZpbHRlcnMgPyAyIDogMX0gc2V0U2hvd01vZGFsPXtzZXREcmlsbE1vZGFsSXNPcGVufSB7Li4uKGFkZGl0aW9uYWxDb25maWc/LmRyaWxsVG9EZXRhaWwgfHwge30pfS8+KTtcbiAgICB9XG4gICAgaWYgKHNob3dEcmlsbEJ5KSB7XG4gICAgICAgIGxldCBzdWJtZW51SW5kZXggPSAwO1xuICAgICAgICBpZiAoc2hvd0Nyb3NzRmlsdGVycykge1xuICAgICAgICAgICAgc3VibWVudUluZGV4ICs9IDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNob3dEcmlsbFRvRGV0YWlsKSB7XG4gICAgICAgICAgICBzdWJtZW51SW5kZXggKz0gMjtcbiAgICAgICAgfVxuICAgICAgICBtZW51SXRlbXMucHVzaCg8RHJpbGxCeU1lbnVJdGVtcyBkcmlsbEJ5Q29uZmlnPXtmaWx0ZXJzPy5kcmlsbEJ5fSBvblNlbGVjdGlvbj17b25TZWxlY3Rpb259IGZvcm1EYXRhPXtmb3JtRGF0YX0gY29udGV4dE1lbnVZPXtjbGllbnRZfSBzdWJtZW51SW5kZXg9e3N1Ym1lbnVJbmRleH0gb3Blbj17b3BlbktleXMuaW5jbHVkZXMoJ2RyaWxsLWJ5LXN1Ym1lbnUnKX0ga2V5PVwiZHJpbGwtYnktc3VibWVudVwiIG9uRHJpbGxCeT17aGFuZGxlRHJpbGxCeX0gey4uLihhZGRpdGlvbmFsQ29uZmlnPy5kcmlsbEJ5IHx8IHt9KX0vPik7XG4gICAgfVxuICAgIGNvbnN0IG9wZW4gPSB1c2VDYWxsYmFjaygoY2xpZW50WCwgY2xpZW50WSwgZmlsdGVycykgPT4ge1xuICAgICAgICBjb25zdCBhZGp1c3RlZFkgPSBnZXRNZW51QWRqdXN0ZWRZKGNsaWVudFksIGl0ZW1zQ291bnQpO1xuICAgICAgICBzZXRTdGF0ZSh7XG4gICAgICAgICAgICBjbGllbnRYLFxuICAgICAgICAgICAgY2xpZW50WTogYWRqdXN0ZWRZLFxuICAgICAgICAgICAgZmlsdGVycyxcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFNpbmNlIEFudCBEZXNpZ24ncyBEcm9wZG93biBkb2VzIG5vdCBvZmZlciBhbiBpbXBlcmF0aXZlIEFQSVxuICAgICAgICAvLyBhbmQgd2UgY2FuJ3QgYXR0YWNoIGV2ZW50IHRyaWdnZXJzIHRvIGNoYXJ0cyBTVkcgZWxlbWVudHMsIHdlXG4gICAgICAgIC8vIHVzZSBhIGhpZGRlbiBzcGFuIHRoYXQgZ2V0cyBjbGlja2VkIG9uIHdoZW4gcmVjZWl2aW5nIGNsaWNrIGV2ZW50c1xuICAgICAgICAvLyBmcm9tIHRoZSBjaGFydHMuXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBoaWRkZW4tc3Bhbi0ke2lkfWApPy5jbGljaygpO1xuICAgIH0sIFtpZCwgaXRlbXNDb3VudF0pO1xuICAgIHVzZUltcGVyYXRpdmVIYW5kbGUocmVmLCAoKSA9PiAoe1xuICAgICAgICBvcGVuLFxuICAgIH0pLCBbb3Blbl0pO1xuICAgIHJldHVybiBSZWFjdERPTS5jcmVhdGVQb3J0YWwoPD5cbiAgICAgIDxEcm9wZG93biBkcm9wZG93blJlbmRlcj17KCkgPT4gKDxNZW51IGNsYXNzTmFtZT1cImNoYXJ0LWNvbnRleHQtbWVudVwiIGRhdGEtdGVzdD1cImNoYXJ0LWNvbnRleHQtbWVudVwiIG9uT3BlbkNoYW5nZT17c2V0T3BlbktleXN9IG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgICBzZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBvbkNsb3NlKCk7XG4gICAgICAgICAgICB9fT5cbiAgICAgICAgICAgIHttZW51SXRlbXMubGVuZ3RoID8gKG1lbnVJdGVtcykgOiAoPE1lbnUuSXRlbSBkaXNhYmxlZD57dCgnTm8gYWN0aW9ucycpfTwvTWVudS5JdGVtPil9XG4gICAgICAgICAgPC9NZW51Pil9IHRyaWdnZXI9e1snY2xpY2snXX0gb25PcGVuQ2hhbmdlPXt2YWx1ZSA9PiB7XG4gICAgICAgICAgICBzZXRWaXNpYmxlKHZhbHVlKTtcbiAgICAgICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBzZXRPcGVuS2V5cyhbXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH19IG9wZW49e3Zpc2libGV9PlxuICAgICAgICA8c3BhbiBpZD17YGhpZGRlbi1zcGFuLSR7aWR9YH0gY3NzPXt7XG4gICAgICAgICAgICB2aXNpYmlsaXR5OiAnaGlkZGVuJyxcbiAgICAgICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgICAgICAgICAgdG9wOiBjbGllbnRZLFxuICAgICAgICAgICAgbGVmdDogY2xpZW50WCxcbiAgICAgICAgICAgIHdpZHRoOiAxLFxuICAgICAgICAgICAgaGVpZ2h0OiAxLFxuICAgICAgICB9fS8+XG4gICAgICA8L0Ryb3Bkb3duPlxuICAgICAge3Nob3dEcmlsbFRvRGV0YWlsICYmICg8RHJpbGxEZXRhaWxNb2RhbCBpbml0aWFsRmlsdGVycz17bW9kYWxGaWx0ZXJzfSBjaGFydElkPXtpZH0gZm9ybURhdGE9e2Zvcm1EYXRhfSBzaG93TW9kYWw9e2RyaWxsTW9kYWxJc09wZW59IG9uSGlkZU1vZGFsPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2V0RHJpbGxNb2RhbElzT3BlbihmYWxzZSk7XG4gICAgICAgICAgICB9fS8+KX1cbiAgICAgIHtzaG93RHJpbGxCeU1vZGFsICYmIGRyaWxsQnlDb2x1bW4gJiYgZGF0YXNldCAmJiBmaWx0ZXJzPy5kcmlsbEJ5ICYmICg8RHJpbGxCeU1vZGFsIGNvbHVtbj17ZHJpbGxCeUNvbHVtbn0gZHJpbGxCeUNvbmZpZz17ZmlsdGVycz8uZHJpbGxCeX0gZm9ybURhdGE9e2Zvcm1EYXRhfSBvbkhpZGVNb2RhbD17aGFuZGxlQ2xvc2VEcmlsbEJ5TW9kYWx9IGRhdGFzZXQ9e3sgLi4uZGF0YXNldCwgdmVyYm9zZV9tYXA6IHZlcmJvc2VNYXAgfX0gY2FuRG93bmxvYWQ9e2NhbkRvd25sb2FkfS8+KX1cbiAgICA8Lz4sIGRvY3VtZW50LmJvZHkpO1xufTtcbmV4cG9ydCBkZWZhdWx0IGZvcndhcmRSZWYoQ2hhcnRDb250ZXh0TWVudSk7XG4iXX0= */\") }) }\n    ),\n    showDrillToDetail && _jsx(DrillDetailModal, { initialFilters: modalFilters, chartId: id, formData: formData, showModal: drillModalIsOpen, onHideModal: () => {\n        setDrillModalIsOpen(false);\n      } }),\n    showDrillByModal && drillByColumn && dataset && (filters == null ? void 0 : filters.drillBy) && _jsx(DrillByModal, { column: drillByColumn, drillByConfig: filters == null ? void 0 : filters.drillBy, formData: formData, onHideModal: handleCloseDrillByModal, dataset: { ...dataset, verbose_map: verboseMap }, canDownload: canDownload })] }\n  ), document.body);\n};\nexport default /*#__PURE__*/forwardRef(ChartContextMenu);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}