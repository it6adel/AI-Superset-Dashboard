{"ast":null,"code":"/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ContourLayer } from '@deck.gl/aggregation-layers';\nimport { t } from '@superset-ui/core';\nimport { commonLayerProps } from '../common';\nimport sandboxedEval from '../../utils/sandbox';\nimport { createDeckGLComponent } from '../../factory';\nimport TooltipRow from '../../TooltipRow';import { jsx as _jsx, jsxs as _jsxs } from \"@emotion/react/jsx-runtime\";\nfunction setTooltipContent(o) {var _o$object, _o$object$contour;\n  return _jsxs(\"div\", { className: \"deckgl-tooltip\", children: [\n    _jsx(TooltipRow, { label: t('Centroid (Longitude and Latitude): '), value: `(${o == null ? void 0 : o.coordinate[0]}, ${o == null ? void 0 : o.coordinate[1]})` }),\n    _jsx(TooltipRow, { label: t('Threshold: '), value: `${o == null ? void 0 : (_o$object = o.object) == null ? void 0 : (_o$object$contour = _o$object.contour) == null ? void 0 : _o$object$contour.threshold}` })] }\n  );\n}\nexport const getLayer = function (formData, payload, onAddFilter, setTooltip) {\n  const fd = formData;\n  const { aggregation = 'SUM', js_data_mutator: jsFnMutator, contours: rawContours, cellSize = '200' } = fd;\n  let data = payload.data.features;\n  const contours = rawContours == null ? void 0 : rawContours.map((contour) => {\n    const { lowerThreshold, upperThreshold, color, strokeWidth } = contour;\n    if (upperThreshold) {\n      // Isoband format\n      return {\n        threshold: [lowerThreshold, upperThreshold],\n        color: [color.r, color.g, color.b]\n      };\n    }\n    // Isoline format\n    return {\n      threshold: lowerThreshold,\n      color: [color.r, color.g, color.b],\n      strokeWidth\n    };\n  });\n  if (jsFnMutator) {\n    // Applying user defined data mutator if defined\n    const jsFnMutatorFunction = sandboxedEval(fd.js_data_mutator);\n    data = jsFnMutatorFunction(data);\n  }\n  return new ContourLayer({\n    id: `contourLayer-${fd.slice_id}`,\n    data,\n    contours,\n    cellSize: Number(cellSize || '200'),\n    aggregation: aggregation.toUpperCase(),\n    getPosition: (d) => d.position,\n    getWeight: (d) => d.weight || 0,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent)\n  });\n};\nfunction getPoints(data) {\n  return data.map((d) => d.position);\n}\nexport default createDeckGLComponent(getLayer, getPoints);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}