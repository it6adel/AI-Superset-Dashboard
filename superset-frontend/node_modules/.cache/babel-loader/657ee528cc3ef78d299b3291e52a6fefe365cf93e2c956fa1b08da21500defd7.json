{"ast":null,"code":"import { css as _css } from \"@emotion/react\";import _isEmpty from \"lodash/isEmpty\";import _throttle from \"lodash/throttle\";import _debounce from \"lodash/debounce\";var _bootstrapData$common, _bootstrapData$common2;function _EMOTION_STRINGIFIED_CSS_ERROR__() {return \"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).\";} /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable jsx-a11y/anchor-is-valid */\n/* eslint-disable jsx-a11y/no-static-element-interactions */\nimport { useState, useEffect, useMemo, useRef, useCallback } from 'react';\nimport useEffectEvent from 'src/hooks/useEffectEvent';\nimport { CSSTransition } from 'react-transition-group';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport Split from 'react-split';\nimport { css, FeatureFlag, isFeatureEnabled, styled, t, useTheme, getExtensionsRegistry } from '@superset-ui/core';\n\nimport Modal from 'src/components/Modal';\nimport Mousetrap from 'mousetrap';\nimport Button from 'src/components/Button';\nimport Timer from 'src/components/Timer';\nimport ResizableSidebar from 'src/components/ResizableSidebar';\nimport { Dropdown } from 'src/components/Dropdown';\nimport { Skeleton } from 'src/components';\nimport { Switch } from 'src/components/Switch';\nimport { Input } from 'src/components/Input';\nimport { Menu } from 'src/components/Menu';\nimport Icons from 'src/components/Icons';\nimport { detectOS } from 'src/utils/common';\nimport { addNewQueryEditor, CtasEnum, estimateQueryCost, persistEditorHeight, postStopQuery, queryEditorSetAutorun, queryEditorSetSql, queryEditorSetCursorPosition, queryEditorSetAndSaveSql, queryEditorSetTemplateParams, runQueryFromSqlEditor, saveQuery, addSavedQueryToTabState, scheduleQuery, setActiveSouthPaneTab, updateSavedQuery, formatQuery, fetchQueryEditor, switchQueryEditor } from 'src/SqlLab/actions/sqlLab';\nimport { STATE_TYPE_MAP, SQL_EDITOR_GUTTER_HEIGHT, SQL_EDITOR_GUTTER_MARGIN, SQL_TOOLBAR_HEIGHT, SQL_EDITOR_LEFTBAR_WIDTH, SQL_EDITOR_PADDING, INITIAL_NORTH_PERCENT, INITIAL_SOUTH_PERCENT, SET_QUERY_EDITOR_SQL_DEBOUNCE_MS, WINDOW_RESIZE_THROTTLE_MS } from 'src/SqlLab/constants';\nimport { getItem, LocalStorageKeys, setItem } from 'src/utils/localStorageHelpers';\nimport { EmptyState } from 'src/components/EmptyState';\nimport Alert from 'src/components/Alert';\nimport getBootstrapData from 'src/utils/getBootstrapData';\nimport useLogAction from 'src/logger/useLogAction';\nimport { LOG_ACTIONS_SQLLAB_CREATE_TABLE_AS, LOG_ACTIONS_SQLLAB_CREATE_VIEW_AS, LOG_ACTIONS_SQLLAB_ESTIMATE_QUERY_COST, LOG_ACTIONS_SQLLAB_FORMAT_SQL, LOG_ACTIONS_SQLLAB_LOAD_TAB_STATE, LOG_ACTIONS_SQLLAB_RUN_QUERY, LOG_ACTIONS_SQLLAB_STOP_QUERY, Logger } from 'src/logger/LogUtils';\nimport TemplateParamsEditor from '../TemplateParamsEditor';\nimport SouthPane from '../SouthPane';\nimport SaveQuery from '../SaveQuery';\nimport ScheduleQueryButton from '../ScheduleQueryButton';\nimport EstimateQueryCostButton from '../EstimateQueryCostButton';\nimport ShareSqlLabQuery from '../ShareSqlLabQuery';\nimport SqlEditorLeftBar from '../SqlEditorLeftBar';\nimport AceEditorWrapper from '../AceEditorWrapper';\nimport RunQueryActionButton from '../RunQueryActionButton';\nimport QueryLimitSelect from '../QueryLimitSelect';\nimport KeyboardShortcutButton, { KEY_MAP, KeyboardShortcut } from '../KeyboardShortcutButton';import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"@emotion/react/jsx-runtime\";\nconst bootstrapData = getBootstrapData();\nconst scheduledQueriesConf = bootstrapData == null ? void 0 : (_bootstrapData$common = bootstrapData.common) == null ? void 0 : (_bootstrapData$common2 = _bootstrapData$common.conf) == null ? void 0 : _bootstrapData$common2.SCHEDULED_QUERIES;\nconst StyledToolbar = styled.div`\n  padding: ${({ theme }) => theme.gridUnit * 2}px;\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  display: flex;\n  justify-content: space-between;\n  border: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  border-top: 0;\n  column-gap: ${({ theme }) => theme.gridUnit}px;\n\n  form {\n    margin-block-end: 0;\n  }\n\n  .leftItems,\n  .rightItems {\n    display: flex;\n    align-items: center;\n    & > span {\n      margin-right: ${({ theme }) => theme.gridUnit * 2}px;\n      display: inline-block;\n\n      &:last-child {\n        margin-right: 0;\n      }\n    }\n  }\n\n  .limitDropdown {\n    white-space: nowrap;\n  }\n`;\nconst StyledSidebar = styled.div`\n  flex: 0 0 ${({ width }) => width}px;\n  width: ${({ width }) => width}px;\n  padding: ${({ theme, hide }) => hide ? 0 : theme.gridUnit * 2.5}px;\n  border-right: 1px solid\n    ${({ theme, hide }) => hide ? 'transparent' : theme.colors.grayscale.light2};\n`;\nconst StyledSqlEditor = styled.div`\n  ${({ theme }) => css`\n    display: flex;\n    flex-direction: row;\n    height: 100%;\n\n    .schemaPane {\n      transition: transform ${theme.transitionTiming}s ease-in-out;\n    }\n\n    .queryPane {\n      flex: 1 1 auto;\n      padding: ${theme.gridUnit * 2}px;\n      overflow-y: auto;\n      overflow-x: scroll;\n    }\n\n    .schemaPane-enter-done,\n    .schemaPane-exit {\n      transform: translateX(0);\n      z-index: 7;\n    }\n\n    .schemaPane-exit-active {\n      transform: translateX(-120%);\n    }\n\n    .schemaPane-enter-active {\n      transform: translateX(0);\n      max-width: ${theme.gridUnit * 75}px;\n    }\n\n    .schemaPane-enter,\n    .schemaPane-exit-done {\n      max-width: 0;\n      transform: translateX(-120%);\n      overflow: hidden;\n    }\n\n    .schemaPane-exit-done + .queryPane {\n      margin-left: 0;\n    }\n\n    .gutter {\n      border-top: 1px solid ${theme.colors.grayscale.light2};\n      border-bottom: 1px solid ${theme.colors.grayscale.light2};\n      width: 3%;\n      margin: ${SQL_EDITOR_GUTTER_MARGIN}px 47%;\n    }\n\n    .gutter.gutter-vertical {\n      cursor: row-resize;\n    }\n  `}\n`;\nconst extensionsRegistry = getExtensionsRegistry();\nconst elementStyle = (dimension, elementSize, gutterSize) => ({\n  [dimension]: `calc(${elementSize}% - ${gutterSize + SQL_EDITOR_GUTTER_MARGIN}px)`\n});var _ref = process.env.NODE_ENV === \"production\" ? { name: \"1eoy87d\", styles: \"display:flex;justify-content:space-between\" } : { name: \"1egglng-renderDropdown\", styles: \"display:flex;justify-content:space-between;label:renderDropdown;/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2FkZWwvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL1NxbExhYi9jb21wb25lbnRzL1NxbEVkaXRvci9pbmRleC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBeWZtQiIsImZpbGUiOiIvaG9tZS9hZGVsL3N1cGVyc2V0L3N1cGVyc2V0LWZyb250ZW5kL3NyYy9TcWxMYWIvY29tcG9uZW50cy9TcWxFZGl0b3IvaW5kZXgudHN4Iiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyogZXNsaW50LWRpc2FibGUganN4LWExMXkvYW5jaG9yLWlzLXZhbGlkICovXG4vKiBlc2xpbnQtZGlzYWJsZSBqc3gtYTExeS9uby1zdGF0aWMtZWxlbWVudC1pbnRlcmFjdGlvbnMgKi9cbmltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZU1lbW8sIHVzZVJlZiwgdXNlQ2FsbGJhY2ssIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHVzZUVmZmVjdEV2ZW50IGZyb20gJ3NyYy9ob29rcy91c2VFZmZlY3RFdmVudCc7XG5pbXBvcnQgeyBDU1NUcmFuc2l0aW9uIH0gZnJvbSAncmVhY3QtdHJhbnNpdGlvbi1ncm91cCc7XG5pbXBvcnQgeyBzaGFsbG93RXF1YWwsIHVzZURpc3BhdGNoLCB1c2VTZWxlY3RvciB9IGZyb20gJ3JlYWN0LXJlZHV4JztcbmltcG9ydCBTcGxpdCBmcm9tICdyZWFjdC1zcGxpdCc7XG5pbXBvcnQgeyBjc3MsIEZlYXR1cmVGbGFnLCBpc0ZlYXR1cmVFbmFibGVkLCBzdHlsZWQsIHQsIHVzZVRoZW1lLCBnZXRFeHRlbnNpb25zUmVnaXN0cnksIH0gZnJvbSAnQHN1cGVyc2V0LXVpL2NvcmUnO1xuaW1wb3J0IHsgZGVib3VuY2UsIHRocm90dGxlLCBpc0VtcHR5IH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBNb2RhbCBmcm9tICdzcmMvY29tcG9uZW50cy9Nb2RhbCc7XG5pbXBvcnQgTW91c2V0cmFwIGZyb20gJ21vdXNldHJhcCc7XG5pbXBvcnQgQnV0dG9uIGZyb20gJ3NyYy9jb21wb25lbnRzL0J1dHRvbic7XG5pbXBvcnQgVGltZXIgZnJvbSAnc3JjL2NvbXBvbmVudHMvVGltZXInO1xuaW1wb3J0IFJlc2l6YWJsZVNpZGViYXIgZnJvbSAnc3JjL2NvbXBvbmVudHMvUmVzaXphYmxlU2lkZWJhcic7XG5pbXBvcnQgeyBEcm9wZG93biB9IGZyb20gJ3NyYy9jb21wb25lbnRzL0Ryb3Bkb3duJztcbmltcG9ydCB7IFNrZWxldG9uIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMnO1xuaW1wb3J0IHsgU3dpdGNoIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvU3dpdGNoJztcbmltcG9ydCB7IElucHV0IH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvSW5wdXQnO1xuaW1wb3J0IHsgTWVudSB9IGZyb20gJ3NyYy9jb21wb25lbnRzL01lbnUnO1xuaW1wb3J0IEljb25zIGZyb20gJ3NyYy9jb21wb25lbnRzL0ljb25zJztcbmltcG9ydCB7IGRldGVjdE9TIH0gZnJvbSAnc3JjL3V0aWxzL2NvbW1vbic7XG5pbXBvcnQgeyBhZGROZXdRdWVyeUVkaXRvciwgQ3Rhc0VudW0sIGVzdGltYXRlUXVlcnlDb3N0LCBwZXJzaXN0RWRpdG9ySGVpZ2h0LCBwb3N0U3RvcFF1ZXJ5LCBxdWVyeUVkaXRvclNldEF1dG9ydW4sIHF1ZXJ5RWRpdG9yU2V0U3FsLCBxdWVyeUVkaXRvclNldEN1cnNvclBvc2l0aW9uLCBxdWVyeUVkaXRvclNldEFuZFNhdmVTcWwsIHF1ZXJ5RWRpdG9yU2V0VGVtcGxhdGVQYXJhbXMsIHJ1blF1ZXJ5RnJvbVNxbEVkaXRvciwgc2F2ZVF1ZXJ5LCBhZGRTYXZlZFF1ZXJ5VG9UYWJTdGF0ZSwgc2NoZWR1bGVRdWVyeSwgc2V0QWN0aXZlU291dGhQYW5lVGFiLCB1cGRhdGVTYXZlZFF1ZXJ5LCBmb3JtYXRRdWVyeSwgZmV0Y2hRdWVyeUVkaXRvciwgc3dpdGNoUXVlcnlFZGl0b3IsIH0gZnJvbSAnc3JjL1NxbExhYi9hY3Rpb25zL3NxbExhYic7XG5pbXBvcnQgeyBTVEFURV9UWVBFX01BUCwgU1FMX0VESVRPUl9HVVRURVJfSEVJR0hULCBTUUxfRURJVE9SX0dVVFRFUl9NQVJHSU4sIFNRTF9UT09MQkFSX0hFSUdIVCwgU1FMX0VESVRPUl9MRUZUQkFSX1dJRFRILCBTUUxfRURJVE9SX1BBRERJTkcsIElOSVRJQUxfTk9SVEhfUEVSQ0VOVCwgSU5JVElBTF9TT1VUSF9QRVJDRU5ULCBTRVRfUVVFUllfRURJVE9SX1NRTF9ERUJPVU5DRV9NUywgV0lORE9XX1JFU0laRV9USFJPVFRMRV9NUywgfSBmcm9tICdzcmMvU3FsTGFiL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBnZXRJdGVtLCBMb2NhbFN0b3JhZ2VLZXlzLCBzZXRJdGVtLCB9IGZyb20gJ3NyYy91dGlscy9sb2NhbFN0b3JhZ2VIZWxwZXJzJztcbmltcG9ydCB7IEVtcHR5U3RhdGUgfSBmcm9tICdzcmMvY29tcG9uZW50cy9FbXB0eVN0YXRlJztcbmltcG9ydCBBbGVydCBmcm9tICdzcmMvY29tcG9uZW50cy9BbGVydCc7XG5pbXBvcnQgZ2V0Qm9vdHN0cmFwRGF0YSBmcm9tICdzcmMvdXRpbHMvZ2V0Qm9vdHN0cmFwRGF0YSc7XG5pbXBvcnQgdXNlTG9nQWN0aW9uIGZyb20gJ3NyYy9sb2dnZXIvdXNlTG9nQWN0aW9uJztcbmltcG9ydCB7IExPR19BQ1RJT05TX1NRTExBQl9DUkVBVEVfVEFCTEVfQVMsIExPR19BQ1RJT05TX1NRTExBQl9DUkVBVEVfVklFV19BUywgTE9HX0FDVElPTlNfU1FMTEFCX0VTVElNQVRFX1FVRVJZX0NPU1QsIExPR19BQ1RJT05TX1NRTExBQl9GT1JNQVRfU1FMLCBMT0dfQUNUSU9OU19TUUxMQUJfTE9BRF9UQUJfU1RBVEUsIExPR19BQ1RJT05TX1NRTExBQl9SVU5fUVVFUlksIExPR19BQ1RJT05TX1NRTExBQl9TVE9QX1FVRVJZLCBMb2dnZXIsIH0gZnJvbSAnc3JjL2xvZ2dlci9Mb2dVdGlscyc7XG5pbXBvcnQgVGVtcGxhdGVQYXJhbXNFZGl0b3IgZnJvbSAnLi4vVGVtcGxhdGVQYXJhbXNFZGl0b3InO1xuaW1wb3J0IFNvdXRoUGFuZSBmcm9tICcuLi9Tb3V0aFBhbmUnO1xuaW1wb3J0IFNhdmVRdWVyeSBmcm9tICcuLi9TYXZlUXVlcnknO1xuaW1wb3J0IFNjaGVkdWxlUXVlcnlCdXR0b24gZnJvbSAnLi4vU2NoZWR1bGVRdWVyeUJ1dHRvbic7XG5pbXBvcnQgRXN0aW1hdGVRdWVyeUNvc3RCdXR0b24gZnJvbSAnLi4vRXN0aW1hdGVRdWVyeUNvc3RCdXR0b24nO1xuaW1wb3J0IFNoYXJlU3FsTGFiUXVlcnkgZnJvbSAnLi4vU2hhcmVTcWxMYWJRdWVyeSc7XG5pbXBvcnQgU3FsRWRpdG9yTGVmdEJhciBmcm9tICcuLi9TcWxFZGl0b3JMZWZ0QmFyJztcbmltcG9ydCBBY2VFZGl0b3JXcmFwcGVyIGZyb20gJy4uL0FjZUVkaXRvcldyYXBwZXInO1xuaW1wb3J0IFJ1blF1ZXJ5QWN0aW9uQnV0dG9uIGZyb20gJy4uL1J1blF1ZXJ5QWN0aW9uQnV0dG9uJztcbmltcG9ydCBRdWVyeUxpbWl0U2VsZWN0IGZyb20gJy4uL1F1ZXJ5TGltaXRTZWxlY3QnO1xuaW1wb3J0IEtleWJvYXJkU2hvcnRjdXRCdXR0b24sIHsgS0VZX01BUCwgS2V5Ym9hcmRTaG9ydGN1dCwgfSBmcm9tICcuLi9LZXlib2FyZFNob3J0Y3V0QnV0dG9uJztcbmNvbnN0IGJvb3RzdHJhcERhdGEgPSBnZXRCb290c3RyYXBEYXRhKCk7XG5jb25zdCBzY2hlZHVsZWRRdWVyaWVzQ29uZiA9IGJvb3RzdHJhcERhdGE/LmNvbW1vbj8uY29uZj8uU0NIRURVTEVEX1FVRVJJRVM7XG5jb25zdCBTdHlsZWRUb29sYmFyID0gc3R5bGVkLmRpdiBgXG4gIHBhZGRpbmc6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICBiYWNrZ3JvdW5kOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQ1fTtcbiAgZGlzcGxheTogZmxleDtcbiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuICBib3JkZXI6IDFweCBzb2xpZCAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbiAgYm9yZGVyLXRvcDogMDtcbiAgY29sdW1uLWdhcDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdH1weDtcblxuICBmb3JtIHtcbiAgICBtYXJnaW4tYmxvY2stZW5kOiAwO1xuICB9XG5cbiAgLmxlZnRJdGVtcyxcbiAgLnJpZ2h0SXRlbXMge1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAmID4gc3BhbiB7XG4gICAgICBtYXJnaW4tcmlnaHQ6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuXG4gICAgICAmOmxhc3QtY2hpbGQge1xuICAgICAgICBtYXJnaW4tcmlnaHQ6IDA7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLmxpbWl0RHJvcGRvd24ge1xuICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7XG4gIH1cbmA7XG5jb25zdCBTdHlsZWRTaWRlYmFyID0gc3R5bGVkLmRpdiBgXG4gIGZsZXg6IDAgMCAkeyh7IHdpZHRoIH0pID0+IHdpZHRofXB4O1xuICB3aWR0aDogJHsoeyB3aWR0aCB9KSA9PiB3aWR0aH1weDtcbiAgcGFkZGluZzogJHsoeyB0aGVtZSwgaGlkZSB9KSA9PiAoaGlkZSA/IDAgOiB0aGVtZS5ncmlkVW5pdCAqIDIuNSl9cHg7XG4gIGJvcmRlci1yaWdodDogMXB4IHNvbGlkXG4gICAgJHsoeyB0aGVtZSwgaGlkZSB9KSA9PiBoaWRlID8gJ3RyYW5zcGFyZW50JyA6IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbmA7XG5jb25zdCBTdHlsZWRTcWxFZGl0b3IgPSBzdHlsZWQuZGl2IGBcbiAgJHsoeyB0aGVtZSB9KSA9PiBjc3MgYFxuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IHJvdztcbiAgICBoZWlnaHQ6IDEwMCU7XG5cbiAgICAuc2NoZW1hUGFuZSB7XG4gICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gJHt0aGVtZS50cmFuc2l0aW9uVGltaW5nfXMgZWFzZS1pbi1vdXQ7XG4gICAgfVxuXG4gICAgLnF1ZXJ5UGFuZSB7XG4gICAgICBmbGV4OiAxIDEgYXV0bztcbiAgICAgIHBhZGRpbmc6ICR7dGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICAgICAgb3ZlcmZsb3cteTogYXV0bztcbiAgICAgIG92ZXJmbG93LXg6IHNjcm9sbDtcbiAgICB9XG5cbiAgICAuc2NoZW1hUGFuZS1lbnRlci1kb25lLFxuICAgIC5zY2hlbWFQYW5lLWV4aXQge1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDApO1xuICAgICAgei1pbmRleDogNztcbiAgICB9XG5cbiAgICAuc2NoZW1hUGFuZS1leGl0LWFjdGl2ZSB7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTEyMCUpO1xuICAgIH1cblxuICAgIC5zY2hlbWFQYW5lLWVudGVyLWFjdGl2ZSB7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMCk7XG4gICAgICBtYXgtd2lkdGg6ICR7dGhlbWUuZ3JpZFVuaXQgKiA3NX1weDtcbiAgICB9XG5cbiAgICAuc2NoZW1hUGFuZS1lbnRlcixcbiAgICAuc2NoZW1hUGFuZS1leGl0LWRvbmUge1xuICAgICAgbWF4LXdpZHRoOiAwO1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC0xMjAlKTtcbiAgICAgIG92ZXJmbG93OiBoaWRkZW47XG4gICAgfVxuXG4gICAgLnNjaGVtYVBhbmUtZXhpdC1kb25lICsgLnF1ZXJ5UGFuZSB7XG4gICAgICBtYXJnaW4tbGVmdDogMDtcbiAgICB9XG5cbiAgICAuZ3V0dGVyIHtcbiAgICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAke3RoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbiAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAke3RoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbiAgICAgIHdpZHRoOiAzJTtcbiAgICAgIG1hcmdpbjogJHtTUUxfRURJVE9SX0dVVFRFUl9NQVJHSU59cHggNDclO1xuICAgIH1cblxuICAgIC5ndXR0ZXIuZ3V0dGVyLXZlcnRpY2FsIHtcbiAgICAgIGN1cnNvcjogcm93LXJlc2l6ZTtcbiAgICB9XG4gIGB9XG5gO1xuY29uc3QgZXh0ZW5zaW9uc1JlZ2lzdHJ5ID0gZ2V0RXh0ZW5zaW9uc1JlZ2lzdHJ5KCk7XG5jb25zdCBlbGVtZW50U3R5bGUgPSAoZGltZW5zaW9uLCBlbGVtZW50U2l6ZSwgZ3V0dGVyU2l6ZSkgPT4gKHtcbiAgICBbZGltZW5zaW9uXTogYGNhbGMoJHtlbGVtZW50U2l6ZX0lIC0gJHtndXR0ZXJTaXplICsgU1FMX0VESVRPUl9HVVRURVJfTUFSR0lOfXB4KWAsXG59KTtcbmNvbnN0IFNxbEVkaXRvciA9ICh7IHF1ZXJ5RWRpdG9yLCBkZWZhdWx0UXVlcnlMaW1pdCwgbWF4Um93LCBkaXNwbGF5TGltaXQsIHNhdmVRdWVyeVdhcm5pbmcsIHNjaGVkdWxlUXVlcnlXYXJuaW5nLCB9KSA9PiB7XG4gICAgY29uc3QgdGhlbWUgPSB1c2VUaGVtZSgpO1xuICAgIGNvbnN0IGRpc3BhdGNoID0gdXNlRGlzcGF0Y2goKTtcbiAgICBjb25zdCB7IGRhdGFiYXNlLCBsYXRlc3RRdWVyeSwgaGlkZUxlZnRCYXIsIGN1cnJlbnRRdWVyeUVkaXRvcklkLCBoYXNTcWxTdGF0ZW1lbnQsIH0gPSB1c2VTZWxlY3RvcigoeyBzcWxMYWI6IHsgdW5zYXZlZFF1ZXJ5RWRpdG9yLCBkYXRhYmFzZXMsIHF1ZXJpZXMsIHRhYkhpc3RvcnkgfSB9KSA9PiB7XG4gICAgICAgIGxldCB7IGRiSWQsIGxhdGVzdFF1ZXJ5SWQsIGhpZGVMZWZ0QmFyIH0gPSBxdWVyeUVkaXRvcjtcbiAgICAgICAgaWYgKHVuc2F2ZWRRdWVyeUVkaXRvcj8uaWQgPT09IHF1ZXJ5RWRpdG9yLmlkKSB7XG4gICAgICAgICAgICBkYklkID0gdW5zYXZlZFF1ZXJ5RWRpdG9yLmRiSWQgfHwgZGJJZDtcbiAgICAgICAgICAgIGxhdGVzdFF1ZXJ5SWQgPSB1bnNhdmVkUXVlcnlFZGl0b3IubGF0ZXN0UXVlcnlJZCB8fCBsYXRlc3RRdWVyeUlkO1xuICAgICAgICAgICAgaGlkZUxlZnRCYXIgPVxuICAgICAgICAgICAgICAgIHR5cGVvZiB1bnNhdmVkUXVlcnlFZGl0b3IuaGlkZUxlZnRCYXIgPT09ICdib29sZWFuJ1xuICAgICAgICAgICAgICAgICAgICA/IHVuc2F2ZWRRdWVyeUVkaXRvci5oaWRlTGVmdEJhclxuICAgICAgICAgICAgICAgICAgICA6IGhpZGVMZWZ0QmFyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBoYXNTcWxTdGF0ZW1lbnQ6IEJvb2xlYW4ocXVlcnlFZGl0b3Iuc3FsPy50cmltKCkubGVuZ3RoID4gMCksXG4gICAgICAgICAgICBkYXRhYmFzZTogZGF0YWJhc2VzW2RiSWQgfHwgJyddLFxuICAgICAgICAgICAgbGF0ZXN0UXVlcnk6IHF1ZXJpZXNbbGF0ZXN0UXVlcnlJZCB8fCAnJ10sXG4gICAgICAgICAgICBoaWRlTGVmdEJhcixcbiAgICAgICAgICAgIGN1cnJlbnRRdWVyeUVkaXRvcklkOiB0YWJIaXN0b3J5LnNsaWNlKC0xKVswXSxcbiAgICAgICAgfTtcbiAgICB9LCBzaGFsbG93RXF1YWwpO1xuICAgIGNvbnN0IGxvZ0FjdGlvbiA9IHVzZUxvZ0FjdGlvbih7IHF1ZXJ5RWRpdG9ySWQ6IHF1ZXJ5RWRpdG9yLmlkIH0pO1xuICAgIGNvbnN0IGlzQWN0aXZlID0gY3VycmVudFF1ZXJ5RWRpdG9ySWQgPT09IHF1ZXJ5RWRpdG9yLmlkO1xuICAgIGNvbnN0IFtoZWlnaHQsIHNldEhlaWdodF0gPSB1c2VTdGF0ZSgwKTtcbiAgICBjb25zdCBbYXV0b3J1biwgc2V0QXV0b3J1bl0gPSB1c2VTdGF0ZShxdWVyeUVkaXRvci5hdXRvcnVuKTtcbiAgICBjb25zdCBbY3Rhcywgc2V0Q3Rhc10gPSB1c2VTdGF0ZSgnJyk7XG4gICAgY29uc3QgW25vcnRoUGVyY2VudCwgc2V0Tm9ydGhQZXJjZW50XSA9IHVzZVN0YXRlKHF1ZXJ5RWRpdG9yLm5vcnRoUGVyY2VudCB8fCBJTklUSUFMX05PUlRIX1BFUkNFTlQpO1xuICAgIGNvbnN0IFtzb3V0aFBlcmNlbnQsIHNldFNvdXRoUGVyY2VudF0gPSB1c2VTdGF0ZShxdWVyeUVkaXRvci5zb3V0aFBlcmNlbnQgfHwgSU5JVElBTF9TT1VUSF9QRVJDRU5UKTtcbiAgICBjb25zdCBbYXV0b2NvbXBsZXRlRW5hYmxlZCwgc2V0QXV0b2NvbXBsZXRlRW5hYmxlZF0gPSB1c2VTdGF0ZShnZXRJdGVtKExvY2FsU3RvcmFnZUtleXMuU3FsbGFiSXNBdXRvY29tcGxldGVFbmFibGVkLCB0cnVlKSk7XG4gICAgY29uc3QgW3JlbmRlckhUTUxFbmFibGVkLCBzZXRSZW5kZXJIVE1MRW5hYmxlZF0gPSB1c2VTdGF0ZShnZXRJdGVtKExvY2FsU3RvcmFnZUtleXMuU3FsbGFiSXNSZW5kZXJIdG1sRW5hYmxlZCwgdHJ1ZSkpO1xuICAgIGNvbnN0IFtzaG93Q3JlYXRlQXNNb2RhbCwgc2V0U2hvd0NyZWF0ZUFzTW9kYWxdID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IFtjcmVhdGVBcywgc2V0Q3JlYXRlQXNdID0gdXNlU3RhdGUoJycpO1xuICAgIGNvbnN0IHNob3dFbXB0eVN0YXRlID0gdXNlTWVtbygoKSA9PiAhZGF0YWJhc2UgfHwgaXNFbXB0eShkYXRhYmFzZSksIFtkYXRhYmFzZV0pO1xuICAgIGNvbnN0IHNxbEVkaXRvclJlZiA9IHVzZVJlZihudWxsKTtcbiAgICBjb25zdCBub3J0aFBhbmVSZWYgPSB1c2VSZWYobnVsbCk7XG4gICAgY29uc3QgU3FsRm9ybUV4dGVuc2lvbiA9IGV4dGVuc2lvbnNSZWdpc3RyeS5nZXQoJ3NxbGVkaXRvci5leHRlbnNpb24uZm9ybScpO1xuICAgIGNvbnN0IHN0YXJ0UXVlcnkgPSB1c2VDYWxsYmFjaygoY3Rhc0FyZyA9IGZhbHNlLCBjdGFzX21ldGhvZCA9IEN0YXNFbnVtLlRhYmxlKSA9PiB7XG4gICAgICAgIGlmICghZGF0YWJhc2UpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBkaXNwYXRjaChydW5RdWVyeUZyb21TcWxFZGl0b3IoZGF0YWJhc2UsIHF1ZXJ5RWRpdG9yLCBkZWZhdWx0UXVlcnlMaW1pdCwgY3Rhc0FyZyA/IGN0YXMgOiAnJywgY3Rhc0FyZywgY3Rhc19tZXRob2QpKTtcbiAgICAgICAgZGlzcGF0Y2goc2V0QWN0aXZlU291dGhQYW5lVGFiKCdSZXN1bHRzJykpO1xuICAgIH0sIFtjdGFzLCBkYXRhYmFzZSwgZGVmYXVsdFF1ZXJ5TGltaXQsIGRpc3BhdGNoLCBxdWVyeUVkaXRvcl0pO1xuICAgIGNvbnN0IGZvcm1hdEN1cnJlbnRRdWVyeSA9IHVzZUNhbGxiYWNrKCh1c2VTaG9ydGN1dCkgPT4ge1xuICAgICAgICBsb2dBY3Rpb24oTE9HX0FDVElPTlNfU1FMTEFCX0ZPUk1BVF9TUUwsIHtcbiAgICAgICAgICAgIHNob3J0Y3V0OiBCb29sZWFuKHVzZVNob3J0Y3V0KSxcbiAgICAgICAgfSk7XG4gICAgICAgIGRpc3BhdGNoKGZvcm1hdFF1ZXJ5KHF1ZXJ5RWRpdG9yKSk7XG4gICAgfSwgW2Rpc3BhdGNoLCBxdWVyeUVkaXRvciwgbG9nQWN0aW9uXSk7XG4gICAgY29uc3Qgc3RvcFF1ZXJ5ID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgICBpZiAobGF0ZXN0UXVlcnkgJiYgWydydW5uaW5nJywgJ3BlbmRpbmcnXS5pbmRleE9mKGxhdGVzdFF1ZXJ5LnN0YXRlKSA+PSAwKSB7XG4gICAgICAgICAgICBkaXNwYXRjaChwb3N0U3RvcFF1ZXJ5KGxhdGVzdFF1ZXJ5KSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sIFtkaXNwYXRjaCwgbGF0ZXN0UXVlcnldKTtcbiAgICBjb25zdCBydW5RdWVyeSA9ICgpID0+IHtcbiAgICAgICAgaWYgKGRhdGFiYXNlKSB7XG4gICAgICAgICAgICBzdGFydFF1ZXJ5KCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmIChhdXRvcnVuKSB7XG4gICAgICAgICAgICBzZXRBdXRvcnVuKGZhbHNlKTtcbiAgICAgICAgICAgIGRpc3BhdGNoKHF1ZXJ5RWRpdG9yU2V0QXV0b3J1bihxdWVyeUVkaXRvciwgZmFsc2UpKTtcbiAgICAgICAgICAgIHN0YXJ0UXVlcnkoKTtcbiAgICAgICAgfVxuICAgIH0sIFthdXRvcnVuLCBkaXNwYXRjaCwgcXVlcnlFZGl0b3IsIHN0YXJ0UXVlcnldKTtcbiAgICAvLyBPbmUgbGF5ZXIgb2YgYWJzdHJhY3Rpb24gZm9yIGVhc3kgc3B5aW5nIGluIHVuaXQgdGVzdHNcbiAgICBjb25zdCBnZXRTcWxFZGl0b3JIZWlnaHQgPSAoKSA9PiBzcWxFZGl0b3JSZWYuY3VycmVudFxuICAgICAgICA/IHNxbEVkaXRvclJlZi5jdXJyZW50LmNsaWVudEhlaWdodCAtIFNRTF9FRElUT1JfUEFERElORyAqIDJcbiAgICAgICAgOiAwO1xuICAgIGNvbnN0IGdldEhvdGtleUNvbmZpZyA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgICAgLy8gR2V0IHRoZSB1c2VyJ3MgT1NcbiAgICAgICAgY29uc3QgdXNlck9TID0gZGV0ZWN0T1MoKTtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAncnVuUXVlcnkxJyxcbiAgICAgICAgICAgICAgICBrZXk6IEtleWJvYXJkU2hvcnRjdXQuQ3RybFIsXG4gICAgICAgICAgICAgICAgZGVzY3I6IEtFWV9NQVBbS2V5Ym9hcmRTaG9ydGN1dC5DdHJsUl0sXG4gICAgICAgICAgICAgICAgZnVuYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXVlcnlFZGl0b3Iuc3FsLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0FjdGlvbihMT0dfQUNUSU9OU19TUUxMQUJfUlVOX1FVRVJZLCB7IHNob3J0Y3V0OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRRdWVyeSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3J1blF1ZXJ5MicsXG4gICAgICAgICAgICAgICAga2V5OiBLZXlib2FyZFNob3J0Y3V0LkN0cmxFbnRlcixcbiAgICAgICAgICAgICAgICBkZXNjcjogS0VZX01BUFtLZXlib2FyZFNob3J0Y3V0LkN0cmxFbnRlcl0sXG4gICAgICAgICAgICAgICAgZnVuYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXVlcnlFZGl0b3Iuc3FsLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0FjdGlvbihMT0dfQUNUSU9OU19TUUxMQUJfUlVOX1FVRVJZLCB7IHNob3J0Y3V0OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRRdWVyeSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ25ld1RhYicsXG4gICAgICAgICAgICAgICAgLi4uKHVzZXJPUyA9PT0gJ1dpbmRvd3MnXG4gICAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBLZXlib2FyZFNob3J0Y3V0LkN0cmxRLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3I6IEtFWV9NQVBbS2V5Ym9hcmRTaG9ydGN1dC5DdHJsUV0sXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6IEtleWJvYXJkU2hvcnRjdXQuQ3RybFQsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcjogS0VZX01BUFtLZXlib2FyZFNob3J0Y3V0LkN0cmxUXSxcbiAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgZnVuYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBMb2dnZXIubWFya1RpbWVPcmlnaW4oKTtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2goYWRkTmV3UXVlcnlFZGl0b3IoKSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3N0b3BRdWVyeScsXG4gICAgICAgICAgICAgICAgLi4uKHVzZXJPUyA9PT0gJ01hY09TJ1xuICAgICAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleTogS2V5Ym9hcmRTaG9ydGN1dC5DdHJsWCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyOiBLRVlfTUFQW0tleWJvYXJkU2hvcnRjdXQuQ3RybFhdLFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBLZXlib2FyZFNob3J0Y3V0LkN0cmxFLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3I6IEtFWV9NQVBbS2V5Ym9hcmRTaG9ydGN1dC5DdHJsRV0sXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGZ1bmM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbG9nQWN0aW9uKExPR19BQ1RJT05TX1NRTExBQl9TVE9QX1FVRVJZLCB7IHNob3J0Y3V0OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICBzdG9wUXVlcnkoKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZm9ybWF0UXVlcnknLFxuICAgICAgICAgICAgICAgIGtleTogS2V5Ym9hcmRTaG9ydGN1dC5DdHJsU2hpZnRGLFxuICAgICAgICAgICAgICAgIGRlc2NyOiBLRVlfTUFQW0tleWJvYXJkU2hvcnRjdXQuQ3RybFNoaWZ0Rl0sXG4gICAgICAgICAgICAgICAgZnVuYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBmb3JtYXRDdXJyZW50UXVlcnkodHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3N3aXRjaFRhYlRvTGVmdCcsXG4gICAgICAgICAgICAgICAga2V5OiBLZXlib2FyZFNob3J0Y3V0LkN0cmxMZWZ0LFxuICAgICAgICAgICAgICAgIGRlc2NyOiBLRVlfTUFQW0tleWJvYXJkU2hvcnRjdXQuQ3RybExlZnRdLFxuICAgICAgICAgICAgICAgIGZ1bmM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2goc3dpdGNoUXVlcnlFZGl0b3IodHJ1ZSkpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdzd2l0Y2hUYWJUb1JpZ2h0JyxcbiAgICAgICAgICAgICAgICBrZXk6IEtleWJvYXJkU2hvcnRjdXQuQ3RybFJpZ2h0LFxuICAgICAgICAgICAgICAgIGRlc2NyOiBLRVlfTUFQW0tleWJvYXJkU2hvcnRjdXQuQ3RybFJpZ2h0XSxcbiAgICAgICAgICAgICAgICBmdW5jOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoKHN3aXRjaFF1ZXJ5RWRpdG9yKGZhbHNlKSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF07XG4gICAgfSwgW2Rpc3BhdGNoLCBxdWVyeUVkaXRvci5zcWwsIHN0YXJ0UXVlcnksIHN0b3BRdWVyeSwgZm9ybWF0Q3VycmVudFF1ZXJ5XSk7XG4gICAgY29uc3QgaG90a2V5cyA9IHVzZU1lbW8oKCkgPT4ge1xuICAgICAgICAvLyBHZXQgYWxsIGhvdGtleXMgaW5jbHVkaW5nIGFjZSBlZGl0b3IgaG90a2V5c1xuICAgICAgICAvLyBHZXQgdGhlIHVzZXIncyBPU1xuICAgICAgICBjb25zdCB1c2VyT1MgPSBkZXRlY3RPUygpO1xuICAgICAgICBjb25zdCBiYXNlID0gW1xuICAgICAgICAgICAgLi4uZ2V0SG90a2V5Q29uZmlnKCksXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3J1blF1ZXJ5MycsXG4gICAgICAgICAgICAgICAga2V5OiBLZXlib2FyZFNob3J0Y3V0LkN0cmxTaGlmdEVudGVyLFxuICAgICAgICAgICAgICAgIGRlc2NyOiBLRVlfTUFQW0tleWJvYXJkU2hvcnRjdXQuQ3RybFNoaWZ0RW50ZXJdLFxuICAgICAgICAgICAgICAgIGZ1bmM6IChlZGl0b3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlZGl0b3IuZ2V0VmFsdWUoKS50cmltKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzZXNzaW9uID0gZWRpdG9yLmdldFNlc3Npb24oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3Vyc29yUG9zaXRpb24gPSBlZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxMaW5lID0gc2Vzc2lvbi5nZXRMZW5ndGgoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFJvdyA9IGVkaXRvci5nZXRGaXJzdFZpc2libGVSb3coKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VtaWNvbG9uRW5kID0gZWRpdG9yLmZpbmQoJzsnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrd2FyZHM6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2tpcEN1cnJlbnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBsZXQgZW5kO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VtaWNvbG9uRW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAoeyBlbmQgfSA9IHNlbWljb2xvbkVuZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlbmQgfHwgZW5kLnJvdyA8IGN1cnNvclBvc2l0aW9uLnJvdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5kID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdzogdG90YWxMaW5lICsgMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbWljb2xvblN0YXJ0ID0gZWRpdG9yLmZpbmQoJzsnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrd2FyZHM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBza2lwQ3VycmVudDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGxldCBzdGFydDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbWljb2xvblN0YXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IHNlbWljb2xvblN0YXJ0LmVuZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsZXQgY3VycmVudExpbmUgPSBzdGFydD8ucm93O1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRMaW5lIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZSA+IGN1cnNvclBvc2l0aW9uLnJvdyB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgKGN1cnJlbnRMaW5lID09PSBjdXJzb3JQb3NpdGlvbi5yb3cgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc3RhcnQ/LmNvbHVtbiB8fCAwKSA+IGN1cnNvclBvc2l0aW9uLmNvbHVtbikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsZXQgY29udGVudCA9IGN1cnJlbnRMaW5lID09PSBzdGFydD8ucm93XG4gICAgICAgICAgICAgICAgICAgICAgICA/IHNlc3Npb24uZ2V0TGluZShjdXJyZW50TGluZSkuc2xpY2Uoc3RhcnQuY29sdW1uKS50cmltKClcbiAgICAgICAgICAgICAgICAgICAgICAgIDogc2Vzc2lvbi5nZXRMaW5lKGN1cnJlbnRMaW5lKS50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICghY29udGVudCAmJiBjdXJyZW50TGluZSA8IHRvdGFsTGluZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExpbmUgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBzZXNzaW9uLmdldExpbmUoY3VycmVudExpbmUpLnRyaW0oKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudExpbmUgIT09IHN0YXJ0Py5yb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0geyByb3c6IGN1cnJlbnRMaW5lLCBjb2x1bW46IDAgfTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNldFNlbGVjdGlvblJhbmdlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzdGFydCA/PyB7IHJvdzogMCwgY29sdW1uOiAwIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmQsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBzdGFydFF1ZXJ5KCk7XG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5zZWxlY3Rpb24uY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLm1vdmVDdXJzb3JUb1Bvc2l0aW9uKGN1cnNvclBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnNjcm9sbFRvUm93KGN1cnJlbnRSb3cpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICBdO1xuICAgICAgICBpZiAodXNlck9TID09PSAnTWFjT1MnKSB7XG4gICAgICAgICAgICBiYXNlLnB1c2goe1xuICAgICAgICAgICAgICAgIG5hbWU6ICdwcmV2aW91c0xpbmUnLFxuICAgICAgICAgICAgICAgIGtleTogS2V5Ym9hcmRTaG9ydGN1dC5DdHJsUCxcbiAgICAgICAgICAgICAgICBkZXNjcjogS0VZX01BUFtLZXlib2FyZFNob3J0Y3V0LkN0cmxQXSxcbiAgICAgICAgICAgICAgICBmdW5jOiBlZGl0b3IgPT4ge1xuICAgICAgICAgICAgICAgICAgICBlZGl0b3IubmF2aWdhdGVVcCgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYmFzZTtcbiAgICB9LCBbZ2V0SG90a2V5Q29uZmlnLCBzdGFydFF1ZXJ5XSk7XG4gICAgY29uc3Qgb25CZWZvcmVVbmxvYWQgPSB1c2VFZmZlY3RFdmVudChldmVudCA9PiB7XG4gICAgICAgIGlmIChkYXRhYmFzZT8uZXh0cmFfanNvbj8uY2FuY2VsX3F1ZXJ5X29uX3dpbmRvd3NfdW5sb2FkICYmXG4gICAgICAgICAgICBsYXRlc3RRdWVyeT8uc3RhdGUgPT09ICdydW5uaW5nJykge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHN0b3BRdWVyeSgpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgY29uc3Qgc2hvdWxkTG9hZFF1ZXJ5RWRpdG9yID0gaXNGZWF0dXJlRW5hYmxlZChGZWF0dXJlRmxhZy5TcWxsYWJCYWNrZW5kUGVyc2lzdGVuY2UpICYmXG4gICAgICAgICFxdWVyeUVkaXRvci5sb2FkZWQ7XG4gICAgY29uc3QgbG9hZFF1ZXJ5RWRpdG9yID0gdXNlRWZmZWN0RXZlbnQoKCkgPT4ge1xuICAgICAgICBjb25zdCBkdXJhdGlvbiA9IExvZ2dlci5nZXRUaW1lc3RhbXAoKTtcbiAgICAgICAgbG9nQWN0aW9uKExPR19BQ1RJT05TX1NRTExBQl9MT0FEX1RBQl9TVEFURSwge1xuICAgICAgICAgICAgZHVyYXRpb24sXG4gICAgICAgICAgICBxdWVyeUVkaXRvcklkOiBxdWVyeUVkaXRvci5pZCxcbiAgICAgICAgICAgIGluTG9jYWxTdG9yYWdlOiBCb29sZWFuKHF1ZXJ5RWRpdG9yLmluTG9jYWxTdG9yYWdlKSxcbiAgICAgICAgICAgIGhhc0xvYWRlZDogIXNob3VsZExvYWRRdWVyeUVkaXRvcixcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChzaG91bGRMb2FkUXVlcnlFZGl0b3IpIHtcbiAgICAgICAgICAgIGRpc3BhdGNoKGZldGNoUXVlcnlFZGl0b3IocXVlcnlFZGl0b3IsIGRpc3BsYXlMaW1pdCkpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgLy8gV2UgbmVlZCB0byBtZWFzdXJlIHRoZSBoZWlnaHQgb2YgdGhlIHNxbCBlZGl0b3IgcG9zdCByZW5kZXIgdG8gZmlndXJlIHRoZSBoZWlnaHQgb2ZcbiAgICAgICAgLy8gdGhlIHNvdXRoIHBhbmUgc28gaXQgZ2V0cyByZW5kZXJlZCBwcm9wZXJseVxuICAgICAgICBzZXRIZWlnaHQoZ2V0U3FsRWRpdG9ySGVpZ2h0KCkpO1xuICAgICAgICBjb25zdCBoYW5kbGVXaW5kb3dSZXNpemVXaXRoVGhyb3R0bGUgPSB0aHJvdHRsZSgoKSA9PiBzZXRIZWlnaHQoZ2V0U3FsRWRpdG9ySGVpZ2h0KCkpLCBXSU5ET1dfUkVTSVpFX1RIUk9UVExFX01TKTtcbiAgICAgICAgaWYgKGlzQWN0aXZlKSB7XG4gICAgICAgICAgICBsb2FkUXVlcnlFZGl0b3IoKTtcbiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBoYW5kbGVXaW5kb3dSZXNpemVXaXRoVGhyb3R0bGUpO1xuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIG9uQmVmb3JlVW5sb2FkKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGhhbmRsZVdpbmRvd1Jlc2l6ZVdpdGhUaHJvdHRsZSk7XG4gICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgb25CZWZvcmVVbmxvYWQpO1xuICAgICAgICB9O1xuICAgICAgICAvLyBUT0RPOiBSZW1vdmUgdXNlRWZmZWN0RXZlbnQgZGVwcyBvbmNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWFjdC9wdWxsLzI1ODgxIGlzIHJlbGVhc2VkXG4gICAgfSwgW29uQmVmb3JlVW5sb2FkLCBsb2FkUXVlcnlFZGl0b3IsIGlzQWN0aXZlXSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgLy8gc2V0dXAgaG90a2V5c1xuICAgICAgICBjb25zdCBob3RrZXlzID0gZ2V0SG90a2V5Q29uZmlnKCk7XG4gICAgICAgIGlmIChpc0FjdGl2ZSkge1xuICAgICAgICAgICAgLy8gTW91c2VUcmFwIGFsd2F5cyBvdmVycmlkZSB0aGUgc2FtZSBrZXlcbiAgICAgICAgICAgIC8vIFVuYmluZCAocmVzZXQpIHdpbGwgYmUgY2FsbGVkIHdoZW4gQXBwIGNvbXBvbmVudCB1bm1vdW50XG4gICAgICAgICAgICBob3RrZXlzLmZvckVhY2goa2V5Q29uZmlnID0+IHtcbiAgICAgICAgICAgICAgICBNb3VzZXRyYXAuYmluZChba2V5Q29uZmlnLmtleV0sIGtleUNvbmZpZy5mdW5jKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSwgW2dldEhvdGtleUNvbmZpZywgbGF0ZXN0UXVlcnksIGlzQWN0aXZlXSk7XG4gICAgY29uc3Qgb25SZXNpemVTdGFydCA9ICgpID0+IHtcbiAgICAgICAgLy8gU2V0IHRoZSBoZWlnaHRzIG9uIHRoZSBhY2UgZWRpdG9yIGFuZCB0aGUgYWNlIGNvbnRlbnQgYXJlYSBhZnRlciBkcmFnIHN0YXJ0c1xuICAgICAgICAvLyB0byBzbW9vdGggb3V0IHRoZSB2aXN1YWwgdHJhbnNpdGlvbiB0byB0aGUgbmV3IGhlaWdodHMgd2hlbiBkcmFnIGVuZHNcbiAgICAgICAgY29uc3QgZWRpdG9yRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdhY2VfY29udGVudCcpWzBdO1xuICAgICAgICBpZiAoZWRpdG9yRWwpIHtcbiAgICAgICAgICAgIGVkaXRvckVsLnN0eWxlLmhlaWdodCA9ICcxMDAlJztcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3Qgb25SZXNpemVFbmQgPSAoW25vcnRoUGVyY2VudCwgc291dGhQZXJjZW50XSkgPT4ge1xuICAgICAgICBzZXROb3J0aFBlcmNlbnQobm9ydGhQZXJjZW50KTtcbiAgICAgICAgc2V0U291dGhQZXJjZW50KHNvdXRoUGVyY2VudCk7XG4gICAgICAgIGlmIChub3J0aFBhbmVSZWYuY3VycmVudD8uY2xpZW50SGVpZ2h0KSB7XG4gICAgICAgICAgICBkaXNwYXRjaChwZXJzaXN0RWRpdG9ySGVpZ2h0KHF1ZXJ5RWRpdG9yLCBub3J0aFBlcmNlbnQsIHNvdXRoUGVyY2VudCkpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBzZXRRdWVyeUVkaXRvckFuZFNhdmVTcWwgPSB1c2VDYWxsYmFjayhzcWwgPT4ge1xuICAgICAgICBkaXNwYXRjaChxdWVyeUVkaXRvclNldEFuZFNhdmVTcWwocXVlcnlFZGl0b3IsIHNxbCkpO1xuICAgIH0sIFtkaXNwYXRjaCwgcXVlcnlFZGl0b3JdKTtcbiAgICBjb25zdCBzZXRRdWVyeUVkaXRvckFuZFNhdmVTcWxXaXRoRGVib3VuY2UgPSB1c2VNZW1vKCgpID0+IGRlYm91bmNlKHNldFF1ZXJ5RWRpdG9yQW5kU2F2ZVNxbCwgU0VUX1FVRVJZX0VESVRPUl9TUUxfREVCT1VOQ0VfTVMpLCBbc2V0UXVlcnlFZGl0b3JBbmRTYXZlU3FsXSk7XG4gICAgY29uc3Qgb25TcWxDaGFuZ2VkID0gdXNlRWZmZWN0RXZlbnQoKHNxbCkgPT4ge1xuICAgICAgICBkaXNwYXRjaChxdWVyeUVkaXRvclNldFNxbChxdWVyeUVkaXRvciwgc3FsKSk7XG4gICAgfSk7XG4gICAgLy8gUmV0dXJuIHRoZSBoZWlnaHRzIGZvciB0aGUgYWNlIGVkaXRvciBhbmQgdGhlIHNvdXRoIHBhbmUgYXMgYW4gb2JqZWN0XG4gICAgLy8gZ2l2ZW4gdGhlIGhlaWdodCBvZiB0aGUgc3FsIGVkaXRvciwgbm9ydGggcGFuZSBwZXJjZW50IGFuZCBzb3V0aCBwYW5lIHBlcmNlbnQuXG4gICAgY29uc3QgZ2V0QWNlRWRpdG9yQW5kU291dGhQYW5lSGVpZ2h0cyA9IChoZWlnaHQsIG5vcnRoUGVyY2VudCwgc291dGhQZXJjZW50KSA9PiAoe1xuICAgICAgICBhY2VFZGl0b3JIZWlnaHQ6IChoZWlnaHQgKiBub3J0aFBlcmNlbnQpIC8gKHRoZW1lLmdyaWRVbml0ICogMjUpIC1cbiAgICAgICAgICAgIChTUUxfRURJVE9SX0dVVFRFUl9IRUlHSFQgLyAyICsgU1FMX0VESVRPUl9HVVRURVJfTUFSR0lOKSAtXG4gICAgICAgICAgICBTUUxfVE9PTEJBUl9IRUlHSFQsXG4gICAgICAgIHNvdXRoUGFuZUhlaWdodDogKGhlaWdodCAqIHNvdXRoUGVyY2VudCkgLyAodGhlbWUuZ3JpZFVuaXQgKiAyNSkgLVxuICAgICAgICAgICAgKFNRTF9FRElUT1JfR1VUVEVSX0hFSUdIVCAvIDIgKyBTUUxfRURJVE9SX0dVVFRFUl9NQVJHSU4pLFxuICAgIH0pO1xuICAgIGNvbnN0IGdldFF1ZXJ5Q29zdEVzdGltYXRlID0gKCkgPT4ge1xuICAgICAgICBsb2dBY3Rpb24oTE9HX0FDVElPTlNfU1FMTEFCX0VTVElNQVRFX1FVRVJZX0NPU1QsIHsgc2hvcnRjdXQ6IGZhbHNlIH0pO1xuICAgICAgICBpZiAoZGF0YWJhc2UpIHtcbiAgICAgICAgICAgIGRpc3BhdGNoKGVzdGltYXRlUXVlcnlDb3N0KHF1ZXJ5RWRpdG9yKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGhhbmRsZVRvZ2dsZUF1dG9jb21wbGV0ZUVuYWJsZWQgPSAoKSA9PiB7XG4gICAgICAgIHNldEl0ZW0oTG9jYWxTdG9yYWdlS2V5cy5TcWxsYWJJc0F1dG9jb21wbGV0ZUVuYWJsZWQsICFhdXRvY29tcGxldGVFbmFibGVkKTtcbiAgICAgICAgc2V0QXV0b2NvbXBsZXRlRW5hYmxlZCghYXV0b2NvbXBsZXRlRW5hYmxlZCk7XG4gICAgfTtcbiAgICBjb25zdCBoYW5kbGVUb2dnbGVSZW5kZXJIVE1MRW5hYmxlZCA9ICgpID0+IHtcbiAgICAgICAgc2V0SXRlbShMb2NhbFN0b3JhZ2VLZXlzLlNxbGxhYklzUmVuZGVySHRtbEVuYWJsZWQsICFyZW5kZXJIVE1MRW5hYmxlZCk7XG4gICAgICAgIHNldFJlbmRlckhUTUxFbmFibGVkKCFyZW5kZXJIVE1MRW5hYmxlZCk7XG4gICAgfTtcbiAgICBjb25zdCBjcmVhdGVUYWJsZUFzID0gKCkgPT4ge1xuICAgICAgICBzdGFydFF1ZXJ5KHRydWUsIEN0YXNFbnVtLlRhYmxlKTtcbiAgICAgICAgc2V0U2hvd0NyZWF0ZUFzTW9kYWwoZmFsc2UpO1xuICAgICAgICBzZXRDdGFzKCcnKTtcbiAgICB9O1xuICAgIGNvbnN0IGNyZWF0ZVZpZXdBcyA9ICgpID0+IHtcbiAgICAgICAgc3RhcnRRdWVyeSh0cnVlLCBDdGFzRW51bS5WaWV3KTtcbiAgICAgICAgc2V0U2hvd0NyZWF0ZUFzTW9kYWwoZmFsc2UpO1xuICAgICAgICBzZXRDdGFzKCcnKTtcbiAgICB9O1xuICAgIGNvbnN0IGN0YXNDaGFuZ2VkID0gKGV2ZW50KSA9PiB7XG4gICAgICAgIHNldEN0YXMoZXZlbnQudGFyZ2V0LnZhbHVlKTtcbiAgICB9O1xuICAgIGNvbnN0IHJlbmRlckRyb3Bkb3duID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBxZSA9IHF1ZXJ5RWRpdG9yO1xuICAgICAgICBjb25zdCBzdWNjZXNzZnVsID0gbGF0ZXN0UXVlcnk/LnN0YXRlID09PSAnc3VjY2Vzcyc7XG4gICAgICAgIGNvbnN0IHNjaGVkdWxlVG9vbFRpcCA9IHN1Y2Nlc3NmdWxcbiAgICAgICAgICAgID8gdCgnU2NoZWR1bGUgdGhlIHF1ZXJ5IHBlcmlvZGljYWxseScpXG4gICAgICAgICAgICA6IHQoJ1lvdSBtdXN0IHJ1biB0aGUgcXVlcnkgc3VjY2Vzc2Z1bGx5IGZpcnN0Jyk7XG4gICAgICAgIHJldHVybiAoPE1lbnUgY3NzPXt7IHdpZHRoOiB0aGVtZS5ncmlkVW5pdCAqIDUwIH19PlxuICAgICAgICA8TWVudS5JdGVtIGNzcz17eyBkaXNwbGF5OiAnZmxleCcsIGp1c3RpZnlDb250ZW50OiAnc3BhY2UtYmV0d2VlbicgfX0+XG4gICAgICAgICAgeycgJ31cbiAgICAgICAgICA8c3Bhbj57dCgnUmVuZGVyIEhUTUwnKX08L3NwYW4+eycgJ31cbiAgICAgICAgICA8U3dpdGNoIGNoZWNrZWQ9e3JlbmRlckhUTUxFbmFibGVkfSBvbkNoYW5nZT17aGFuZGxlVG9nZ2xlUmVuZGVySFRNTEVuYWJsZWR9Lz57JyAnfVxuICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgICAgPE1lbnUuSXRlbSBjc3M9e3sgZGlzcGxheTogJ2ZsZXgnLCBqdXN0aWZ5Q29udGVudDogJ3NwYWNlLWJldHdlZW4nIH19PlxuICAgICAgICAgIHsnICd9XG4gICAgICAgICAgPHNwYW4+e3QoJ0F1dG9jb21wbGV0ZScpfTwvc3Bhbj57JyAnfVxuICAgICAgICAgIDxTd2l0Y2ggY2hlY2tlZD17YXV0b2NvbXBsZXRlRW5hYmxlZH0gb25DaGFuZ2U9e2hhbmRsZVRvZ2dsZUF1dG9jb21wbGV0ZUVuYWJsZWR9Lz57JyAnfVxuICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgICAge2lzRmVhdHVyZUVuYWJsZWQoRmVhdHVyZUZsYWcuRW5hYmxlVGVtcGxhdGVQcm9jZXNzaW5nKSAmJiAoPE1lbnUuSXRlbT5cbiAgICAgICAgICAgIDxUZW1wbGF0ZVBhcmFtc0VkaXRvciBsYW5ndWFnZT1cImpzb25cIiBvbkNoYW5nZT17cGFyYW1zID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2gocXVlcnlFZGl0b3JTZXRUZW1wbGF0ZVBhcmFtcyhxZSwgcGFyYW1zKSk7XG4gICAgICAgICAgICAgICAgfX0gcXVlcnlFZGl0b3JJZD17cWUuaWR9Lz5cbiAgICAgICAgICA8L01lbnUuSXRlbT4pfVxuICAgICAgICA8TWVudS5JdGVtIG9uQ2xpY2s9eygpID0+IGZvcm1hdEN1cnJlbnRRdWVyeSgpfT5cbiAgICAgICAgICB7dCgnRm9ybWF0IFNRTCcpfVxuICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgICAgeyFpc0VtcHR5KHNjaGVkdWxlZFF1ZXJpZXNDb25mKSAmJiAoPE1lbnUuSXRlbT5cbiAgICAgICAgICAgIDxTY2hlZHVsZVF1ZXJ5QnV0dG9uIGRlZmF1bHRMYWJlbD17cWUubmFtZX0gc3FsPXtxZS5zcWx9IG9uU2NoZWR1bGU9eyhxdWVyeSkgPT4gZGlzcGF0Y2goc2NoZWR1bGVRdWVyeShxdWVyeSkpfSBzY2hlbWE9e3FlLnNjaGVtYX0gZGJJZD17cWUuZGJJZH0gc2NoZWR1bGVRdWVyeVdhcm5pbmc9e3NjaGVkdWxlUXVlcnlXYXJuaW5nfSB0b29sdGlwPXtzY2hlZHVsZVRvb2xUaXB9IGRpc2FibGVkPXshc3VjY2Vzc2Z1bH0vPlxuICAgICAgICAgIDwvTWVudS5JdGVtPil9XG4gICAgICAgIDxNZW51Lkl0ZW0+XG4gICAgICAgICAgPEtleWJvYXJkU2hvcnRjdXRCdXR0b24+XG4gICAgICAgICAgICB7dCgnS2V5Ym9hcmQgc2hvcnRjdXRzJyl9XG4gICAgICAgICAgPC9LZXlib2FyZFNob3J0Y3V0QnV0dG9uPlxuICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgIDwvTWVudT4pO1xuICAgIH07XG4gICAgY29uc3Qgb25TYXZlUXVlcnkgPSBhc3luYyAocXVlcnksIGNsaWVudElkKSA9PiB7XG4gICAgICAgIGNvbnN0IHNhdmVkUXVlcnkgPSBhd2FpdCBkaXNwYXRjaChzYXZlUXVlcnkocXVlcnksIGNsaWVudElkKSk7XG4gICAgICAgIGRpc3BhdGNoKGFkZFNhdmVkUXVlcnlUb1RhYlN0YXRlKHF1ZXJ5RWRpdG9yLCBzYXZlZFF1ZXJ5KSk7XG4gICAgfTtcbiAgICBjb25zdCByZW5kZXJFZGl0b3JCb3R0b21CYXIgPSAoaGlkZUFjdGlvbnMpID0+IHtcbiAgICAgICAgY29uc3QgeyBhbGxvd19jdGFzOiBhbGxvd0NUQVMsIGFsbG93X2N2YXM6IGFsbG93Q1ZBUyB9ID0gZGF0YWJhc2UgfHwge307XG4gICAgICAgIGNvbnN0IHNob3dNZW51ID0gYWxsb3dDVEFTIHx8IGFsbG93Q1ZBUztcbiAgICAgICAgY29uc3QgcnVuTWVudUJ0biA9ICg8TWVudT5cbiAgICAgICAge2FsbG93Q1RBUyAmJiAoPE1lbnUuSXRlbSBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxvZ0FjdGlvbihMT0dfQUNUSU9OU19TUUxMQUJfQ1JFQVRFX1RBQkxFX0FTLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaG9ydGN1dDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBzZXRTaG93Q3JlYXRlQXNNb2RhbCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgc2V0Q3JlYXRlQXMoQ3Rhc0VudW0uVGFibGUpO1xuICAgICAgICAgICAgICAgIH19IGtleT1cIjFcIj5cbiAgICAgICAgICAgIHt0KCdDUkVBVEUgVEFCTEUgQVMnKX1cbiAgICAgICAgICA8L01lbnUuSXRlbT4pfVxuICAgICAgICB7YWxsb3dDVkFTICYmICg8TWVudS5JdGVtIG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbG9nQWN0aW9uKExPR19BQ1RJT05TX1NRTExBQl9DUkVBVEVfVklFV19BUywge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnRjdXQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgc2V0U2hvd0NyZWF0ZUFzTW9kYWwodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHNldENyZWF0ZUFzKEN0YXNFbnVtLlZpZXcpO1xuICAgICAgICAgICAgICAgIH19IGtleT1cIjJcIj5cbiAgICAgICAgICAgIHt0KCdDUkVBVEUgVklFVyBBUycpfVxuICAgICAgICAgIDwvTWVudS5JdGVtPil9XG4gICAgICA8L01lbnU+KTtcbiAgICAgICAgcmV0dXJuICg8U3R5bGVkVG9vbGJhciBjbGFzc05hbWU9XCJzcWwtdG9vbGJhclwiIGlkPVwianMtc3FsLXRvb2xiYXJcIj5cbiAgICAgICAge2hpZGVBY3Rpb25zID8gKDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG1lc3NhZ2U9e3QoJ1RoZSBkYXRhYmFzZSB0aGF0IHdhcyB1c2VkIHRvIGdlbmVyYXRlIHRoaXMgcXVlcnkgY291bGQgbm90IGJlIGZvdW5kJyl9IGRlc2NyaXB0aW9uPXt0KCdDaG9vc2Ugb25lIG9mIHRoZSBhdmFpbGFibGUgZGF0YWJhc2VzIG9uIHRoZSBsZWZ0IHBhbmVsLicpfSBjbG9zYWJsZT17ZmFsc2V9Lz4pIDogKDw+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxlZnRJdGVtc1wiPlxuICAgICAgICAgICAgICA8c3Bhbj5cbiAgICAgICAgICAgICAgICA8UnVuUXVlcnlBY3Rpb25CdXR0b24gYWxsb3dBc3luYz17ZGF0YWJhc2U/LmFsbG93X3J1bl9hc3luYyA9PT0gdHJ1ZX0gcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9IHF1ZXJ5U3RhdGU9e2xhdGVzdFF1ZXJ5Py5zdGF0ZX0gcnVuUXVlcnk9e3J1blF1ZXJ5fSBzdG9wUXVlcnk9e3N0b3BRdWVyeX0gb3ZlcmxheUNyZWF0ZUFzTWVudT17c2hvd01lbnUgPyBydW5NZW51QnRuIDogbnVsbH0vPlxuICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgIHtpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLkVzdGltYXRlUXVlcnlDb3N0KSAmJlxuICAgICAgICAgICAgICAgICAgICBkYXRhYmFzZT8uYWxsb3dzX2Nvc3RfZXN0aW1hdGUgJiYgKDxzcGFuPlxuICAgICAgICAgICAgICAgICAgICA8RXN0aW1hdGVRdWVyeUNvc3RCdXR0b24gZ2V0RXN0aW1hdGU9e2dldFF1ZXJ5Q29zdEVzdGltYXRlfSBxdWVyeUVkaXRvcklkPXtxdWVyeUVkaXRvci5pZH0gdG9vbHRpcD17dCgnRXN0aW1hdGUgdGhlIGNvc3QgYmVmb3JlIHJ1bm5pbmcgYSBxdWVyeScpfS8+XG4gICAgICAgICAgICAgICAgICA8L3NwYW4+KX1cbiAgICAgICAgICAgICAgPHNwYW4+XG4gICAgICAgICAgICAgICAgPFF1ZXJ5TGltaXRTZWxlY3QgcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9IG1heFJvdz17bWF4Um93fSBkZWZhdWx0UXVlcnlMaW1pdD17ZGVmYXVsdFF1ZXJ5TGltaXR9Lz5cbiAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICB7bGF0ZXN0UXVlcnkgJiYgKDxUaW1lciBzdGFydFRpbWU9e2xhdGVzdFF1ZXJ5LnN0YXJ0RHR0bX0gZW5kVGltZT17bGF0ZXN0UXVlcnkuZW5kRHR0bX0gc3RhdHVzPXtTVEFURV9UWVBFX01BUFtsYXRlc3RRdWVyeS5zdGF0ZV19IGlzUnVubmluZz17bGF0ZXN0UXVlcnkuc3RhdGUgPT09ICdydW5uaW5nJ30vPil9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicmlnaHRJdGVtc1wiPlxuICAgICAgICAgICAgICA8c3Bhbj5cbiAgICAgICAgICAgICAgICA8U2F2ZVF1ZXJ5IHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfSBjb2x1bW5zPXtsYXRlc3RRdWVyeT8ucmVzdWx0cz8uY29sdW1ucyB8fCBbXX0gb25TYXZlPXtvblNhdmVRdWVyeX0gb25VcGRhdGU9eyhxdWVyeSwgcmVtb3RlSWQpID0+IGRpc3BhdGNoKHVwZGF0ZVNhdmVkUXVlcnkocXVlcnksIHJlbW90ZUlkKSl9IHNhdmVRdWVyeVdhcm5pbmc9e3NhdmVRdWVyeVdhcm5pbmd9IGRhdGFiYXNlPXtkYXRhYmFzZX0vPlxuICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgIDxzcGFuPlxuICAgICAgICAgICAgICAgIDxTaGFyZVNxbExhYlF1ZXJ5IHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfS8+XG4gICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgPERyb3Bkb3duIGRyb3Bkb3duUmVuZGVyPXsoKSA9PiByZW5kZXJEcm9wZG93bigpfSB0cmlnZ2VyPXtbJ2NsaWNrJ119PlxuICAgICAgICAgICAgICAgIDxCdXR0b24gYnV0dG9uU2l6ZT1cInhzbWFsbFwiIHR5cGU9XCJsaW5rXCIgc2hvd01hcmdpblJpZ2h0PXtmYWxzZX0+XG4gICAgICAgICAgICAgICAgICA8SWNvbnMuRWxsaXBzaXNPdXRsaW5lZCAvPlxuICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICA8L0Ryb3Bkb3duPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC8+KX1cbiAgICAgIDwvU3R5bGVkVG9vbGJhcj4pO1xuICAgIH07XG4gICAgY29uc3QgaGFuZGxlQ3Vyc29yUG9zaXRpb25DaGFuZ2UgPSAobmV3UG9zaXRpb24pID0+IHtcbiAgICAgICAgZGlzcGF0Y2gocXVlcnlFZGl0b3JTZXRDdXJzb3JQb3NpdGlvbihxdWVyeUVkaXRvciwgbmV3UG9zaXRpb24pKTtcbiAgICB9O1xuICAgIGNvbnN0IHF1ZXJ5UGFuZSA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyBhY2VFZGl0b3JIZWlnaHQsIHNvdXRoUGFuZUhlaWdodCB9ID0gZ2V0QWNlRWRpdG9yQW5kU291dGhQYW5lSGVpZ2h0cyhoZWlnaHQsIG5vcnRoUGVyY2VudCwgc291dGhQZXJjZW50KTtcbiAgICAgICAgcmV0dXJuICg8U3BsaXQgZXhwYW5kVG9NaW4gY2xhc3NOYW1lPVwicXVlcnlQYW5lXCIgc2l6ZXM9e1tub3J0aFBlcmNlbnQsIHNvdXRoUGVyY2VudF19IGVsZW1lbnRTdHlsZT17ZWxlbWVudFN0eWxlfSBtaW5TaXplPXsyMDB9IGRpcmVjdGlvbj1cInZlcnRpY2FsXCIgZ3V0dGVyU2l6ZT17U1FMX0VESVRPUl9HVVRURVJfSEVJR0hUfSBvbkRyYWdTdGFydD17b25SZXNpemVTdGFydH0gb25EcmFnRW5kPXtvblJlc2l6ZUVuZH0+XG4gICAgICAgIDxkaXYgcmVmPXtub3J0aFBhbmVSZWZ9IGNsYXNzTmFtZT1cIm5vcnRoLXBhbmVcIj5cbiAgICAgICAgICB7U3FsRm9ybUV4dGVuc2lvbiAmJiAoPFNxbEZvcm1FeHRlbnNpb24gcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9IHNldFF1ZXJ5RWRpdG9yQW5kU2F2ZVNxbFdpdGhEZWJvdW5jZT17c2V0UXVlcnlFZGl0b3JBbmRTYXZlU3FsV2l0aERlYm91bmNlfSBzdGFydFF1ZXJ5PXtzdGFydFF1ZXJ5fS8+KX1cbiAgICAgICAgICB7aXNBY3RpdmUgJiYgKDxBY2VFZGl0b3JXcmFwcGVyIGF1dG9jb21wbGV0ZT17YXV0b2NvbXBsZXRlRW5hYmxlZH0gb25CbHVyPXtvblNxbENoYW5nZWR9IG9uQ2hhbmdlPXtvblNxbENoYW5nZWR9IHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfSBvbkN1cnNvclBvc2l0aW9uQ2hhbmdlPXtoYW5kbGVDdXJzb3JQb3NpdGlvbkNoYW5nZX0gaGVpZ2h0PXtgJHthY2VFZGl0b3JIZWlnaHR9cHhgfSBob3RrZXlzPXtob3RrZXlzfS8+KX1cbiAgICAgICAgICB7cmVuZGVyRWRpdG9yQm90dG9tQmFyKHNob3dFbXB0eVN0YXRlKX1cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxTb3V0aFBhbmUgcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9IGxhdGVzdFF1ZXJ5SWQ9e2xhdGVzdFF1ZXJ5Py5pZH0gaGVpZ2h0PXtzb3V0aFBhbmVIZWlnaHR9IGRpc3BsYXlMaW1pdD17ZGlzcGxheUxpbWl0fSBkZWZhdWx0UXVlcnlMaW1pdD17ZGVmYXVsdFF1ZXJ5TGltaXR9Lz5cbiAgICAgIDwvU3BsaXQ+KTtcbiAgICB9O1xuICAgIGNvbnN0IGNyZWF0ZVZpZXdNb2RhbFRpdGxlID0gY3JlYXRlQXMgPT09IEN0YXNFbnVtLlZpZXcgPyAnQ1JFQVRFIFZJRVcgQVMnIDogJ0NSRUFURSBUQUJMRSBBUyc7XG4gICAgY29uc3QgY3JlYXRlTW9kYWxQbGFjZUhvbGRlciA9IGNyZWF0ZUFzID09PSBDdGFzRW51bS5WaWV3XG4gICAgICAgID8gdCgnU3BlY2lmeSBuYW1lIHRvIENSRUFURSBWSUVXIEFTIHNjaGVtYSBpbjogcHVibGljJylcbiAgICAgICAgOiB0KCdTcGVjaWZ5IG5hbWUgdG8gQ1JFQVRFIFRBQkxFIEFTIHNjaGVtYSBpbjogcHVibGljJyk7XG4gICAgY29uc3QgbGVmdEJhclN0YXRlQ2xhc3MgPSBoaWRlTGVmdEJhclxuICAgICAgICA/ICdzY2hlbWFQYW5lLWV4aXQtZG9uZSdcbiAgICAgICAgOiAnc2NoZW1hUGFuZS1lbnRlci1kb25lJztcbiAgICByZXR1cm4gKDxTdHlsZWRTcWxFZGl0b3IgcmVmPXtzcWxFZGl0b3JSZWZ9IGNsYXNzTmFtZT1cIlNxbEVkaXRvclwiPlxuICAgICAgPENTU1RyYW5zaXRpb24gY2xhc3NOYW1lcz1cInNjaGVtYVBhbmVcIiBpbj17IWhpZGVMZWZ0QmFyfSB0aW1lb3V0PXszMDB9PlxuICAgICAgICA8UmVzaXphYmxlU2lkZWJhciBpZD17YHNxbGxhYjoke3F1ZXJ5RWRpdG9yLmlkfWB9IG1pbldpZHRoPXtTUUxfRURJVE9SX0xFRlRCQVJfV0lEVEh9IGluaXRpYWxXaWR0aD17U1FMX0VESVRPUl9MRUZUQkFSX1dJRFRIfSBlbmFibGU9eyFoaWRlTGVmdEJhcn0+XG4gICAgICAgICAge2FkanVzdGVkV2lkdGggPT4gKDxTdHlsZWRTaWRlYmFyIGNsYXNzTmFtZT17YHNjaGVtYVBhbmUgJHtsZWZ0QmFyU3RhdGVDbGFzc31gfSB3aWR0aD17YWRqdXN0ZWRXaWR0aH0gaGlkZT17aGlkZUxlZnRCYXJ9PlxuICAgICAgICAgICAgICA8U3FsRWRpdG9yTGVmdEJhciBkYXRhYmFzZT17ZGF0YWJhc2V9IHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfS8+XG4gICAgICAgICAgICA8L1N0eWxlZFNpZGViYXI+KX1cbiAgICAgICAgPC9SZXNpemFibGVTaWRlYmFyPlxuICAgICAgPC9DU1NUcmFuc2l0aW9uPlxuICAgICAge3Nob3VsZExvYWRRdWVyeUVkaXRvciA/ICg8ZGl2IGRhdGEtdGVzdD1cInNxbEVkaXRvci1sb2FkaW5nXCIgY3NzPXtjc3MgYFxuICAgICAgICAgICAgZmxleDogMTtcbiAgICAgICAgICAgIHBhZGRpbmc6ICR7dGhlbWUuZ3JpZFVuaXQgKiA0fXB4O1xuICAgICAgICAgIGB9PlxuICAgICAgICAgIDxTa2VsZXRvbiBhY3RpdmUvPlxuICAgICAgICA8L2Rpdj4pIDogc2hvd0VtcHR5U3RhdGUgJiYgIWhhc1NxbFN0YXRlbWVudCA/ICg8RW1wdHlTdGF0ZSBpbWFnZT1cInZlY3Rvci5zdmdcIiBzaXplPVwibGFyZ2VcIiB0aXRsZT17dCgnU2VsZWN0IGEgZGF0YWJhc2UgdG8gd3JpdGUgYSBxdWVyeScpfSBkZXNjcmlwdGlvbj17dCgnQ2hvb3NlIG9uZSBvZiB0aGUgYXZhaWxhYmxlIGRhdGFiYXNlcyBmcm9tIHRoZSBwYW5lbCBvbiB0aGUgbGVmdC4nKX0vPikgOiAocXVlcnlQYW5lKCkpfVxuICAgICAgPE1vZGFsIHNob3c9e3Nob3dDcmVhdGVBc01vZGFsfSB0aXRsZT17dChjcmVhdGVWaWV3TW9kYWxUaXRsZSl9IG9uSGlkZT17KCkgPT4gc2V0U2hvd0NyZWF0ZUFzTW9kYWwoZmFsc2UpfSBmb290ZXI9ezw+XG4gICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9eygpID0+IHNldFNob3dDcmVhdGVBc01vZGFsKGZhbHNlKX0+XG4gICAgICAgICAgICAgIHt0KCdDYW5jZWwnKX1cbiAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAge2NyZWF0ZUFzID09PSBDdGFzRW51bS5UYWJsZSAmJiAoPEJ1dHRvbiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBkaXNhYmxlZD17Y3Rhcy5sZW5ndGggPT09IDB9IG9uQ2xpY2s9e2NyZWF0ZVRhYmxlQXN9PlxuICAgICAgICAgICAgICAgIHt0KCdDcmVhdGUnKX1cbiAgICAgICAgICAgICAgPC9CdXR0b24+KX1cbiAgICAgICAgICAgIHtjcmVhdGVBcyA9PT0gQ3Rhc0VudW0uVmlldyAmJiAoPEJ1dHRvbiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBkaXNhYmxlZD17Y3Rhcy5sZW5ndGggPT09IDB9IG9uQ2xpY2s9e2NyZWF0ZVZpZXdBc30+XG4gICAgICAgICAgICAgICAge3QoJ0NyZWF0ZScpfVxuICAgICAgICAgICAgICA8L0J1dHRvbj4pfVxuICAgICAgICAgIDwvPn0+XG4gICAgICAgIDxzcGFuPnt0KCdOYW1lJyl9PC9zcGFuPlxuICAgICAgICA8SW5wdXQgcGxhY2Vob2xkZXI9e2NyZWF0ZU1vZGFsUGxhY2VIb2xkZXJ9IG9uQ2hhbmdlPXtjdGFzQ2hhbmdlZH0vPlxuICAgICAgPC9Nb2RhbD5cbiAgICA8L1N0eWxlZFNxbEVkaXRvcj4pO1xufTtcbmV4cG9ydCBkZWZhdWx0IFNxbEVkaXRvcjtcbiJdfQ== */\", toString: _EMOTION_STRINGIFIED_CSS_ERROR__ };var _ref2 = process.env.NODE_ENV === \"production\" ? { name: \"1eoy87d\", styles: \"display:flex;justify-content:space-between\" } : { name: \"1egglng-renderDropdown\", styles: \"display:flex;justify-content:space-between;label:renderDropdown;/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2FkZWwvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL1NxbExhYi9jb21wb25lbnRzL1NxbEVkaXRvci9pbmRleC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBOGZtQiIsImZpbGUiOiIvaG9tZS9hZGVsL3N1cGVyc2V0L3N1cGVyc2V0LWZyb250ZW5kL3NyYy9TcWxMYWIvY29tcG9uZW50cy9TcWxFZGl0b3IvaW5kZXgudHN4Iiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyogZXNsaW50LWRpc2FibGUganN4LWExMXkvYW5jaG9yLWlzLXZhbGlkICovXG4vKiBlc2xpbnQtZGlzYWJsZSBqc3gtYTExeS9uby1zdGF0aWMtZWxlbWVudC1pbnRlcmFjdGlvbnMgKi9cbmltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZU1lbW8sIHVzZVJlZiwgdXNlQ2FsbGJhY2ssIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHVzZUVmZmVjdEV2ZW50IGZyb20gJ3NyYy9ob29rcy91c2VFZmZlY3RFdmVudCc7XG5pbXBvcnQgeyBDU1NUcmFuc2l0aW9uIH0gZnJvbSAncmVhY3QtdHJhbnNpdGlvbi1ncm91cCc7XG5pbXBvcnQgeyBzaGFsbG93RXF1YWwsIHVzZURpc3BhdGNoLCB1c2VTZWxlY3RvciB9IGZyb20gJ3JlYWN0LXJlZHV4JztcbmltcG9ydCBTcGxpdCBmcm9tICdyZWFjdC1zcGxpdCc7XG5pbXBvcnQgeyBjc3MsIEZlYXR1cmVGbGFnLCBpc0ZlYXR1cmVFbmFibGVkLCBzdHlsZWQsIHQsIHVzZVRoZW1lLCBnZXRFeHRlbnNpb25zUmVnaXN0cnksIH0gZnJvbSAnQHN1cGVyc2V0LXVpL2NvcmUnO1xuaW1wb3J0IHsgZGVib3VuY2UsIHRocm90dGxlLCBpc0VtcHR5IH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBNb2RhbCBmcm9tICdzcmMvY29tcG9uZW50cy9Nb2RhbCc7XG5pbXBvcnQgTW91c2V0cmFwIGZyb20gJ21vdXNldHJhcCc7XG5pbXBvcnQgQnV0dG9uIGZyb20gJ3NyYy9jb21wb25lbnRzL0J1dHRvbic7XG5pbXBvcnQgVGltZXIgZnJvbSAnc3JjL2NvbXBvbmVudHMvVGltZXInO1xuaW1wb3J0IFJlc2l6YWJsZVNpZGViYXIgZnJvbSAnc3JjL2NvbXBvbmVudHMvUmVzaXphYmxlU2lkZWJhcic7XG5pbXBvcnQgeyBEcm9wZG93biB9IGZyb20gJ3NyYy9jb21wb25lbnRzL0Ryb3Bkb3duJztcbmltcG9ydCB7IFNrZWxldG9uIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMnO1xuaW1wb3J0IHsgU3dpdGNoIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvU3dpdGNoJztcbmltcG9ydCB7IElucHV0IH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvSW5wdXQnO1xuaW1wb3J0IHsgTWVudSB9IGZyb20gJ3NyYy9jb21wb25lbnRzL01lbnUnO1xuaW1wb3J0IEljb25zIGZyb20gJ3NyYy9jb21wb25lbnRzL0ljb25zJztcbmltcG9ydCB7IGRldGVjdE9TIH0gZnJvbSAnc3JjL3V0aWxzL2NvbW1vbic7XG5pbXBvcnQgeyBhZGROZXdRdWVyeUVkaXRvciwgQ3Rhc0VudW0sIGVzdGltYXRlUXVlcnlDb3N0LCBwZXJzaXN0RWRpdG9ySGVpZ2h0LCBwb3N0U3RvcFF1ZXJ5LCBxdWVyeUVkaXRvclNldEF1dG9ydW4sIHF1ZXJ5RWRpdG9yU2V0U3FsLCBxdWVyeUVkaXRvclNldEN1cnNvclBvc2l0aW9uLCBxdWVyeUVkaXRvclNldEFuZFNhdmVTcWwsIHF1ZXJ5RWRpdG9yU2V0VGVtcGxhdGVQYXJhbXMsIHJ1blF1ZXJ5RnJvbVNxbEVkaXRvciwgc2F2ZVF1ZXJ5LCBhZGRTYXZlZFF1ZXJ5VG9UYWJTdGF0ZSwgc2NoZWR1bGVRdWVyeSwgc2V0QWN0aXZlU291dGhQYW5lVGFiLCB1cGRhdGVTYXZlZFF1ZXJ5LCBmb3JtYXRRdWVyeSwgZmV0Y2hRdWVyeUVkaXRvciwgc3dpdGNoUXVlcnlFZGl0b3IsIH0gZnJvbSAnc3JjL1NxbExhYi9hY3Rpb25zL3NxbExhYic7XG5pbXBvcnQgeyBTVEFURV9UWVBFX01BUCwgU1FMX0VESVRPUl9HVVRURVJfSEVJR0hULCBTUUxfRURJVE9SX0dVVFRFUl9NQVJHSU4sIFNRTF9UT09MQkFSX0hFSUdIVCwgU1FMX0VESVRPUl9MRUZUQkFSX1dJRFRILCBTUUxfRURJVE9SX1BBRERJTkcsIElOSVRJQUxfTk9SVEhfUEVSQ0VOVCwgSU5JVElBTF9TT1VUSF9QRVJDRU5ULCBTRVRfUVVFUllfRURJVE9SX1NRTF9ERUJPVU5DRV9NUywgV0lORE9XX1JFU0laRV9USFJPVFRMRV9NUywgfSBmcm9tICdzcmMvU3FsTGFiL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBnZXRJdGVtLCBMb2NhbFN0b3JhZ2VLZXlzLCBzZXRJdGVtLCB9IGZyb20gJ3NyYy91dGlscy9sb2NhbFN0b3JhZ2VIZWxwZXJzJztcbmltcG9ydCB7IEVtcHR5U3RhdGUgfSBmcm9tICdzcmMvY29tcG9uZW50cy9FbXB0eVN0YXRlJztcbmltcG9ydCBBbGVydCBmcm9tICdzcmMvY29tcG9uZW50cy9BbGVydCc7XG5pbXBvcnQgZ2V0Qm9vdHN0cmFwRGF0YSBmcm9tICdzcmMvdXRpbHMvZ2V0Qm9vdHN0cmFwRGF0YSc7XG5pbXBvcnQgdXNlTG9nQWN0aW9uIGZyb20gJ3NyYy9sb2dnZXIvdXNlTG9nQWN0aW9uJztcbmltcG9ydCB7IExPR19BQ1RJT05TX1NRTExBQl9DUkVBVEVfVEFCTEVfQVMsIExPR19BQ1RJT05TX1NRTExBQl9DUkVBVEVfVklFV19BUywgTE9HX0FDVElPTlNfU1FMTEFCX0VTVElNQVRFX1FVRVJZX0NPU1QsIExPR19BQ1RJT05TX1NRTExBQl9GT1JNQVRfU1FMLCBMT0dfQUNUSU9OU19TUUxMQUJfTE9BRF9UQUJfU1RBVEUsIExPR19BQ1RJT05TX1NRTExBQl9SVU5fUVVFUlksIExPR19BQ1RJT05TX1NRTExBQl9TVE9QX1FVRVJZLCBMb2dnZXIsIH0gZnJvbSAnc3JjL2xvZ2dlci9Mb2dVdGlscyc7XG5pbXBvcnQgVGVtcGxhdGVQYXJhbXNFZGl0b3IgZnJvbSAnLi4vVGVtcGxhdGVQYXJhbXNFZGl0b3InO1xuaW1wb3J0IFNvdXRoUGFuZSBmcm9tICcuLi9Tb3V0aFBhbmUnO1xuaW1wb3J0IFNhdmVRdWVyeSBmcm9tICcuLi9TYXZlUXVlcnknO1xuaW1wb3J0IFNjaGVkdWxlUXVlcnlCdXR0b24gZnJvbSAnLi4vU2NoZWR1bGVRdWVyeUJ1dHRvbic7XG5pbXBvcnQgRXN0aW1hdGVRdWVyeUNvc3RCdXR0b24gZnJvbSAnLi4vRXN0aW1hdGVRdWVyeUNvc3RCdXR0b24nO1xuaW1wb3J0IFNoYXJlU3FsTGFiUXVlcnkgZnJvbSAnLi4vU2hhcmVTcWxMYWJRdWVyeSc7XG5pbXBvcnQgU3FsRWRpdG9yTGVmdEJhciBmcm9tICcuLi9TcWxFZGl0b3JMZWZ0QmFyJztcbmltcG9ydCBBY2VFZGl0b3JXcmFwcGVyIGZyb20gJy4uL0FjZUVkaXRvcldyYXBwZXInO1xuaW1wb3J0IFJ1blF1ZXJ5QWN0aW9uQnV0dG9uIGZyb20gJy4uL1J1blF1ZXJ5QWN0aW9uQnV0dG9uJztcbmltcG9ydCBRdWVyeUxpbWl0U2VsZWN0IGZyb20gJy4uL1F1ZXJ5TGltaXRTZWxlY3QnO1xuaW1wb3J0IEtleWJvYXJkU2hvcnRjdXRCdXR0b24sIHsgS0VZX01BUCwgS2V5Ym9hcmRTaG9ydGN1dCwgfSBmcm9tICcuLi9LZXlib2FyZFNob3J0Y3V0QnV0dG9uJztcbmNvbnN0IGJvb3RzdHJhcERhdGEgPSBnZXRCb290c3RyYXBEYXRhKCk7XG5jb25zdCBzY2hlZHVsZWRRdWVyaWVzQ29uZiA9IGJvb3RzdHJhcERhdGE/LmNvbW1vbj8uY29uZj8uU0NIRURVTEVEX1FVRVJJRVM7XG5jb25zdCBTdHlsZWRUb29sYmFyID0gc3R5bGVkLmRpdiBgXG4gIHBhZGRpbmc6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICBiYWNrZ3JvdW5kOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQ1fTtcbiAgZGlzcGxheTogZmxleDtcbiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuICBib3JkZXI6IDFweCBzb2xpZCAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbiAgYm9yZGVyLXRvcDogMDtcbiAgY29sdW1uLWdhcDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdH1weDtcblxuICBmb3JtIHtcbiAgICBtYXJnaW4tYmxvY2stZW5kOiAwO1xuICB9XG5cbiAgLmxlZnRJdGVtcyxcbiAgLnJpZ2h0SXRlbXMge1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAmID4gc3BhbiB7XG4gICAgICBtYXJnaW4tcmlnaHQ6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuXG4gICAgICAmOmxhc3QtY2hpbGQge1xuICAgICAgICBtYXJnaW4tcmlnaHQ6IDA7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLmxpbWl0RHJvcGRvd24ge1xuICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7XG4gIH1cbmA7XG5jb25zdCBTdHlsZWRTaWRlYmFyID0gc3R5bGVkLmRpdiBgXG4gIGZsZXg6IDAgMCAkeyh7IHdpZHRoIH0pID0+IHdpZHRofXB4O1xuICB3aWR0aDogJHsoeyB3aWR0aCB9KSA9PiB3aWR0aH1weDtcbiAgcGFkZGluZzogJHsoeyB0aGVtZSwgaGlkZSB9KSA9PiAoaGlkZSA/IDAgOiB0aGVtZS5ncmlkVW5pdCAqIDIuNSl9cHg7XG4gIGJvcmRlci1yaWdodDogMXB4IHNvbGlkXG4gICAgJHsoeyB0aGVtZSwgaGlkZSB9KSA9PiBoaWRlID8gJ3RyYW5zcGFyZW50JyA6IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbmA7XG5jb25zdCBTdHlsZWRTcWxFZGl0b3IgPSBzdHlsZWQuZGl2IGBcbiAgJHsoeyB0aGVtZSB9KSA9PiBjc3MgYFxuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IHJvdztcbiAgICBoZWlnaHQ6IDEwMCU7XG5cbiAgICAuc2NoZW1hUGFuZSB7XG4gICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gJHt0aGVtZS50cmFuc2l0aW9uVGltaW5nfXMgZWFzZS1pbi1vdXQ7XG4gICAgfVxuXG4gICAgLnF1ZXJ5UGFuZSB7XG4gICAgICBmbGV4OiAxIDEgYXV0bztcbiAgICAgIHBhZGRpbmc6ICR7dGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICAgICAgb3ZlcmZsb3cteTogYXV0bztcbiAgICAgIG92ZXJmbG93LXg6IHNjcm9sbDtcbiAgICB9XG5cbiAgICAuc2NoZW1hUGFuZS1lbnRlci1kb25lLFxuICAgIC5zY2hlbWFQYW5lLWV4aXQge1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDApO1xuICAgICAgei1pbmRleDogNztcbiAgICB9XG5cbiAgICAuc2NoZW1hUGFuZS1leGl0LWFjdGl2ZSB7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTEyMCUpO1xuICAgIH1cblxuICAgIC5zY2hlbWFQYW5lLWVudGVyLWFjdGl2ZSB7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMCk7XG4gICAgICBtYXgtd2lkdGg6ICR7dGhlbWUuZ3JpZFVuaXQgKiA3NX1weDtcbiAgICB9XG5cbiAgICAuc2NoZW1hUGFuZS1lbnRlcixcbiAgICAuc2NoZW1hUGFuZS1leGl0LWRvbmUge1xuICAgICAgbWF4LXdpZHRoOiAwO1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC0xMjAlKTtcbiAgICAgIG92ZXJmbG93OiBoaWRkZW47XG4gICAgfVxuXG4gICAgLnNjaGVtYVBhbmUtZXhpdC1kb25lICsgLnF1ZXJ5UGFuZSB7XG4gICAgICBtYXJnaW4tbGVmdDogMDtcbiAgICB9XG5cbiAgICAuZ3V0dGVyIHtcbiAgICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAke3RoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbiAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAke3RoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbiAgICAgIHdpZHRoOiAzJTtcbiAgICAgIG1hcmdpbjogJHtTUUxfRURJVE9SX0dVVFRFUl9NQVJHSU59cHggNDclO1xuICAgIH1cblxuICAgIC5ndXR0ZXIuZ3V0dGVyLXZlcnRpY2FsIHtcbiAgICAgIGN1cnNvcjogcm93LXJlc2l6ZTtcbiAgICB9XG4gIGB9XG5gO1xuY29uc3QgZXh0ZW5zaW9uc1JlZ2lzdHJ5ID0gZ2V0RXh0ZW5zaW9uc1JlZ2lzdHJ5KCk7XG5jb25zdCBlbGVtZW50U3R5bGUgPSAoZGltZW5zaW9uLCBlbGVtZW50U2l6ZSwgZ3V0dGVyU2l6ZSkgPT4gKHtcbiAgICBbZGltZW5zaW9uXTogYGNhbGMoJHtlbGVtZW50U2l6ZX0lIC0gJHtndXR0ZXJTaXplICsgU1FMX0VESVRPUl9HVVRURVJfTUFSR0lOfXB4KWAsXG59KTtcbmNvbnN0IFNxbEVkaXRvciA9ICh7IHF1ZXJ5RWRpdG9yLCBkZWZhdWx0UXVlcnlMaW1pdCwgbWF4Um93LCBkaXNwbGF5TGltaXQsIHNhdmVRdWVyeVdhcm5pbmcsIHNjaGVkdWxlUXVlcnlXYXJuaW5nLCB9KSA9PiB7XG4gICAgY29uc3QgdGhlbWUgPSB1c2VUaGVtZSgpO1xuICAgIGNvbnN0IGRpc3BhdGNoID0gdXNlRGlzcGF0Y2goKTtcbiAgICBjb25zdCB7IGRhdGFiYXNlLCBsYXRlc3RRdWVyeSwgaGlkZUxlZnRCYXIsIGN1cnJlbnRRdWVyeUVkaXRvcklkLCBoYXNTcWxTdGF0ZW1lbnQsIH0gPSB1c2VTZWxlY3RvcigoeyBzcWxMYWI6IHsgdW5zYXZlZFF1ZXJ5RWRpdG9yLCBkYXRhYmFzZXMsIHF1ZXJpZXMsIHRhYkhpc3RvcnkgfSB9KSA9PiB7XG4gICAgICAgIGxldCB7IGRiSWQsIGxhdGVzdFF1ZXJ5SWQsIGhpZGVMZWZ0QmFyIH0gPSBxdWVyeUVkaXRvcjtcbiAgICAgICAgaWYgKHVuc2F2ZWRRdWVyeUVkaXRvcj8uaWQgPT09IHF1ZXJ5RWRpdG9yLmlkKSB7XG4gICAgICAgICAgICBkYklkID0gdW5zYXZlZFF1ZXJ5RWRpdG9yLmRiSWQgfHwgZGJJZDtcbiAgICAgICAgICAgIGxhdGVzdFF1ZXJ5SWQgPSB1bnNhdmVkUXVlcnlFZGl0b3IubGF0ZXN0UXVlcnlJZCB8fCBsYXRlc3RRdWVyeUlkO1xuICAgICAgICAgICAgaGlkZUxlZnRCYXIgPVxuICAgICAgICAgICAgICAgIHR5cGVvZiB1bnNhdmVkUXVlcnlFZGl0b3IuaGlkZUxlZnRCYXIgPT09ICdib29sZWFuJ1xuICAgICAgICAgICAgICAgICAgICA/IHVuc2F2ZWRRdWVyeUVkaXRvci5oaWRlTGVmdEJhclxuICAgICAgICAgICAgICAgICAgICA6IGhpZGVMZWZ0QmFyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBoYXNTcWxTdGF0ZW1lbnQ6IEJvb2xlYW4ocXVlcnlFZGl0b3Iuc3FsPy50cmltKCkubGVuZ3RoID4gMCksXG4gICAgICAgICAgICBkYXRhYmFzZTogZGF0YWJhc2VzW2RiSWQgfHwgJyddLFxuICAgICAgICAgICAgbGF0ZXN0UXVlcnk6IHF1ZXJpZXNbbGF0ZXN0UXVlcnlJZCB8fCAnJ10sXG4gICAgICAgICAgICBoaWRlTGVmdEJhcixcbiAgICAgICAgICAgIGN1cnJlbnRRdWVyeUVkaXRvcklkOiB0YWJIaXN0b3J5LnNsaWNlKC0xKVswXSxcbiAgICAgICAgfTtcbiAgICB9LCBzaGFsbG93RXF1YWwpO1xuICAgIGNvbnN0IGxvZ0FjdGlvbiA9IHVzZUxvZ0FjdGlvbih7IHF1ZXJ5RWRpdG9ySWQ6IHF1ZXJ5RWRpdG9yLmlkIH0pO1xuICAgIGNvbnN0IGlzQWN0aXZlID0gY3VycmVudFF1ZXJ5RWRpdG9ySWQgPT09IHF1ZXJ5RWRpdG9yLmlkO1xuICAgIGNvbnN0IFtoZWlnaHQsIHNldEhlaWdodF0gPSB1c2VTdGF0ZSgwKTtcbiAgICBjb25zdCBbYXV0b3J1biwgc2V0QXV0b3J1bl0gPSB1c2VTdGF0ZShxdWVyeUVkaXRvci5hdXRvcnVuKTtcbiAgICBjb25zdCBbY3Rhcywgc2V0Q3Rhc10gPSB1c2VTdGF0ZSgnJyk7XG4gICAgY29uc3QgW25vcnRoUGVyY2VudCwgc2V0Tm9ydGhQZXJjZW50XSA9IHVzZVN0YXRlKHF1ZXJ5RWRpdG9yLm5vcnRoUGVyY2VudCB8fCBJTklUSUFMX05PUlRIX1BFUkNFTlQpO1xuICAgIGNvbnN0IFtzb3V0aFBlcmNlbnQsIHNldFNvdXRoUGVyY2VudF0gPSB1c2VTdGF0ZShxdWVyeUVkaXRvci5zb3V0aFBlcmNlbnQgfHwgSU5JVElBTF9TT1VUSF9QRVJDRU5UKTtcbiAgICBjb25zdCBbYXV0b2NvbXBsZXRlRW5hYmxlZCwgc2V0QXV0b2NvbXBsZXRlRW5hYmxlZF0gPSB1c2VTdGF0ZShnZXRJdGVtKExvY2FsU3RvcmFnZUtleXMuU3FsbGFiSXNBdXRvY29tcGxldGVFbmFibGVkLCB0cnVlKSk7XG4gICAgY29uc3QgW3JlbmRlckhUTUxFbmFibGVkLCBzZXRSZW5kZXJIVE1MRW5hYmxlZF0gPSB1c2VTdGF0ZShnZXRJdGVtKExvY2FsU3RvcmFnZUtleXMuU3FsbGFiSXNSZW5kZXJIdG1sRW5hYmxlZCwgdHJ1ZSkpO1xuICAgIGNvbnN0IFtzaG93Q3JlYXRlQXNNb2RhbCwgc2V0U2hvd0NyZWF0ZUFzTW9kYWxdID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IFtjcmVhdGVBcywgc2V0Q3JlYXRlQXNdID0gdXNlU3RhdGUoJycpO1xuICAgIGNvbnN0IHNob3dFbXB0eVN0YXRlID0gdXNlTWVtbygoKSA9PiAhZGF0YWJhc2UgfHwgaXNFbXB0eShkYXRhYmFzZSksIFtkYXRhYmFzZV0pO1xuICAgIGNvbnN0IHNxbEVkaXRvclJlZiA9IHVzZVJlZihudWxsKTtcbiAgICBjb25zdCBub3J0aFBhbmVSZWYgPSB1c2VSZWYobnVsbCk7XG4gICAgY29uc3QgU3FsRm9ybUV4dGVuc2lvbiA9IGV4dGVuc2lvbnNSZWdpc3RyeS5nZXQoJ3NxbGVkaXRvci5leHRlbnNpb24uZm9ybScpO1xuICAgIGNvbnN0IHN0YXJ0UXVlcnkgPSB1c2VDYWxsYmFjaygoY3Rhc0FyZyA9IGZhbHNlLCBjdGFzX21ldGhvZCA9IEN0YXNFbnVtLlRhYmxlKSA9PiB7XG4gICAgICAgIGlmICghZGF0YWJhc2UpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBkaXNwYXRjaChydW5RdWVyeUZyb21TcWxFZGl0b3IoZGF0YWJhc2UsIHF1ZXJ5RWRpdG9yLCBkZWZhdWx0UXVlcnlMaW1pdCwgY3Rhc0FyZyA/IGN0YXMgOiAnJywgY3Rhc0FyZywgY3Rhc19tZXRob2QpKTtcbiAgICAgICAgZGlzcGF0Y2goc2V0QWN0aXZlU291dGhQYW5lVGFiKCdSZXN1bHRzJykpO1xuICAgIH0sIFtjdGFzLCBkYXRhYmFzZSwgZGVmYXVsdFF1ZXJ5TGltaXQsIGRpc3BhdGNoLCBxdWVyeUVkaXRvcl0pO1xuICAgIGNvbnN0IGZvcm1hdEN1cnJlbnRRdWVyeSA9IHVzZUNhbGxiYWNrKCh1c2VTaG9ydGN1dCkgPT4ge1xuICAgICAgICBsb2dBY3Rpb24oTE9HX0FDVElPTlNfU1FMTEFCX0ZPUk1BVF9TUUwsIHtcbiAgICAgICAgICAgIHNob3J0Y3V0OiBCb29sZWFuKHVzZVNob3J0Y3V0KSxcbiAgICAgICAgfSk7XG4gICAgICAgIGRpc3BhdGNoKGZvcm1hdFF1ZXJ5KHF1ZXJ5RWRpdG9yKSk7XG4gICAgfSwgW2Rpc3BhdGNoLCBxdWVyeUVkaXRvciwgbG9nQWN0aW9uXSk7XG4gICAgY29uc3Qgc3RvcFF1ZXJ5ID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgICBpZiAobGF0ZXN0UXVlcnkgJiYgWydydW5uaW5nJywgJ3BlbmRpbmcnXS5pbmRleE9mKGxhdGVzdFF1ZXJ5LnN0YXRlKSA+PSAwKSB7XG4gICAgICAgICAgICBkaXNwYXRjaChwb3N0U3RvcFF1ZXJ5KGxhdGVzdFF1ZXJ5KSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sIFtkaXNwYXRjaCwgbGF0ZXN0UXVlcnldKTtcbiAgICBjb25zdCBydW5RdWVyeSA9ICgpID0+IHtcbiAgICAgICAgaWYgKGRhdGFiYXNlKSB7XG4gICAgICAgICAgICBzdGFydFF1ZXJ5KCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmIChhdXRvcnVuKSB7XG4gICAgICAgICAgICBzZXRBdXRvcnVuKGZhbHNlKTtcbiAgICAgICAgICAgIGRpc3BhdGNoKHF1ZXJ5RWRpdG9yU2V0QXV0b3J1bihxdWVyeUVkaXRvciwgZmFsc2UpKTtcbiAgICAgICAgICAgIHN0YXJ0UXVlcnkoKTtcbiAgICAgICAgfVxuICAgIH0sIFthdXRvcnVuLCBkaXNwYXRjaCwgcXVlcnlFZGl0b3IsIHN0YXJ0UXVlcnldKTtcbiAgICAvLyBPbmUgbGF5ZXIgb2YgYWJzdHJhY3Rpb24gZm9yIGVhc3kgc3B5aW5nIGluIHVuaXQgdGVzdHNcbiAgICBjb25zdCBnZXRTcWxFZGl0b3JIZWlnaHQgPSAoKSA9PiBzcWxFZGl0b3JSZWYuY3VycmVudFxuICAgICAgICA/IHNxbEVkaXRvclJlZi5jdXJyZW50LmNsaWVudEhlaWdodCAtIFNRTF9FRElUT1JfUEFERElORyAqIDJcbiAgICAgICAgOiAwO1xuICAgIGNvbnN0IGdldEhvdGtleUNvbmZpZyA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgICAgLy8gR2V0IHRoZSB1c2VyJ3MgT1NcbiAgICAgICAgY29uc3QgdXNlck9TID0gZGV0ZWN0T1MoKTtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAncnVuUXVlcnkxJyxcbiAgICAgICAgICAgICAgICBrZXk6IEtleWJvYXJkU2hvcnRjdXQuQ3RybFIsXG4gICAgICAgICAgICAgICAgZGVzY3I6IEtFWV9NQVBbS2V5Ym9hcmRTaG9ydGN1dC5DdHJsUl0sXG4gICAgICAgICAgICAgICAgZnVuYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXVlcnlFZGl0b3Iuc3FsLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0FjdGlvbihMT0dfQUNUSU9OU19TUUxMQUJfUlVOX1FVRVJZLCB7IHNob3J0Y3V0OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRRdWVyeSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3J1blF1ZXJ5MicsXG4gICAgICAgICAgICAgICAga2V5OiBLZXlib2FyZFNob3J0Y3V0LkN0cmxFbnRlcixcbiAgICAgICAgICAgICAgICBkZXNjcjogS0VZX01BUFtLZXlib2FyZFNob3J0Y3V0LkN0cmxFbnRlcl0sXG4gICAgICAgICAgICAgICAgZnVuYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXVlcnlFZGl0b3Iuc3FsLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0FjdGlvbihMT0dfQUNUSU9OU19TUUxMQUJfUlVOX1FVRVJZLCB7IHNob3J0Y3V0OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRRdWVyeSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ25ld1RhYicsXG4gICAgICAgICAgICAgICAgLi4uKHVzZXJPUyA9PT0gJ1dpbmRvd3MnXG4gICAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBLZXlib2FyZFNob3J0Y3V0LkN0cmxRLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3I6IEtFWV9NQVBbS2V5Ym9hcmRTaG9ydGN1dC5DdHJsUV0sXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6IEtleWJvYXJkU2hvcnRjdXQuQ3RybFQsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcjogS0VZX01BUFtLZXlib2FyZFNob3J0Y3V0LkN0cmxUXSxcbiAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgZnVuYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBMb2dnZXIubWFya1RpbWVPcmlnaW4oKTtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2goYWRkTmV3UXVlcnlFZGl0b3IoKSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3N0b3BRdWVyeScsXG4gICAgICAgICAgICAgICAgLi4uKHVzZXJPUyA9PT0gJ01hY09TJ1xuICAgICAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleTogS2V5Ym9hcmRTaG9ydGN1dC5DdHJsWCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyOiBLRVlfTUFQW0tleWJvYXJkU2hvcnRjdXQuQ3RybFhdLFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBLZXlib2FyZFNob3J0Y3V0LkN0cmxFLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3I6IEtFWV9NQVBbS2V5Ym9hcmRTaG9ydGN1dC5DdHJsRV0sXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGZ1bmM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbG9nQWN0aW9uKExPR19BQ1RJT05TX1NRTExBQl9TVE9QX1FVRVJZLCB7IHNob3J0Y3V0OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICBzdG9wUXVlcnkoKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZm9ybWF0UXVlcnknLFxuICAgICAgICAgICAgICAgIGtleTogS2V5Ym9hcmRTaG9ydGN1dC5DdHJsU2hpZnRGLFxuICAgICAgICAgICAgICAgIGRlc2NyOiBLRVlfTUFQW0tleWJvYXJkU2hvcnRjdXQuQ3RybFNoaWZ0Rl0sXG4gICAgICAgICAgICAgICAgZnVuYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBmb3JtYXRDdXJyZW50UXVlcnkodHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3N3aXRjaFRhYlRvTGVmdCcsXG4gICAgICAgICAgICAgICAga2V5OiBLZXlib2FyZFNob3J0Y3V0LkN0cmxMZWZ0LFxuICAgICAgICAgICAgICAgIGRlc2NyOiBLRVlfTUFQW0tleWJvYXJkU2hvcnRjdXQuQ3RybExlZnRdLFxuICAgICAgICAgICAgICAgIGZ1bmM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2goc3dpdGNoUXVlcnlFZGl0b3IodHJ1ZSkpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdzd2l0Y2hUYWJUb1JpZ2h0JyxcbiAgICAgICAgICAgICAgICBrZXk6IEtleWJvYXJkU2hvcnRjdXQuQ3RybFJpZ2h0LFxuICAgICAgICAgICAgICAgIGRlc2NyOiBLRVlfTUFQW0tleWJvYXJkU2hvcnRjdXQuQ3RybFJpZ2h0XSxcbiAgICAgICAgICAgICAgICBmdW5jOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoKHN3aXRjaFF1ZXJ5RWRpdG9yKGZhbHNlKSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF07XG4gICAgfSwgW2Rpc3BhdGNoLCBxdWVyeUVkaXRvci5zcWwsIHN0YXJ0UXVlcnksIHN0b3BRdWVyeSwgZm9ybWF0Q3VycmVudFF1ZXJ5XSk7XG4gICAgY29uc3QgaG90a2V5cyA9IHVzZU1lbW8oKCkgPT4ge1xuICAgICAgICAvLyBHZXQgYWxsIGhvdGtleXMgaW5jbHVkaW5nIGFjZSBlZGl0b3IgaG90a2V5c1xuICAgICAgICAvLyBHZXQgdGhlIHVzZXIncyBPU1xuICAgICAgICBjb25zdCB1c2VyT1MgPSBkZXRlY3RPUygpO1xuICAgICAgICBjb25zdCBiYXNlID0gW1xuICAgICAgICAgICAgLi4uZ2V0SG90a2V5Q29uZmlnKCksXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3J1blF1ZXJ5MycsXG4gICAgICAgICAgICAgICAga2V5OiBLZXlib2FyZFNob3J0Y3V0LkN0cmxTaGlmdEVudGVyLFxuICAgICAgICAgICAgICAgIGRlc2NyOiBLRVlfTUFQW0tleWJvYXJkU2hvcnRjdXQuQ3RybFNoaWZ0RW50ZXJdLFxuICAgICAgICAgICAgICAgIGZ1bmM6IChlZGl0b3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlZGl0b3IuZ2V0VmFsdWUoKS50cmltKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzZXNzaW9uID0gZWRpdG9yLmdldFNlc3Npb24oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3Vyc29yUG9zaXRpb24gPSBlZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxMaW5lID0gc2Vzc2lvbi5nZXRMZW5ndGgoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFJvdyA9IGVkaXRvci5nZXRGaXJzdFZpc2libGVSb3coKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VtaWNvbG9uRW5kID0gZWRpdG9yLmZpbmQoJzsnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrd2FyZHM6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2tpcEN1cnJlbnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBsZXQgZW5kO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VtaWNvbG9uRW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAoeyBlbmQgfSA9IHNlbWljb2xvbkVuZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlbmQgfHwgZW5kLnJvdyA8IGN1cnNvclBvc2l0aW9uLnJvdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5kID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdzogdG90YWxMaW5lICsgMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbWljb2xvblN0YXJ0ID0gZWRpdG9yLmZpbmQoJzsnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrd2FyZHM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBza2lwQ3VycmVudDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGxldCBzdGFydDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbWljb2xvblN0YXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IHNlbWljb2xvblN0YXJ0LmVuZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsZXQgY3VycmVudExpbmUgPSBzdGFydD8ucm93O1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRMaW5lIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZSA+IGN1cnNvclBvc2l0aW9uLnJvdyB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgKGN1cnJlbnRMaW5lID09PSBjdXJzb3JQb3NpdGlvbi5yb3cgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc3RhcnQ/LmNvbHVtbiB8fCAwKSA+IGN1cnNvclBvc2l0aW9uLmNvbHVtbikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsZXQgY29udGVudCA9IGN1cnJlbnRMaW5lID09PSBzdGFydD8ucm93XG4gICAgICAgICAgICAgICAgICAgICAgICA/IHNlc3Npb24uZ2V0TGluZShjdXJyZW50TGluZSkuc2xpY2Uoc3RhcnQuY29sdW1uKS50cmltKClcbiAgICAgICAgICAgICAgICAgICAgICAgIDogc2Vzc2lvbi5nZXRMaW5lKGN1cnJlbnRMaW5lKS50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICghY29udGVudCAmJiBjdXJyZW50TGluZSA8IHRvdGFsTGluZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExpbmUgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBzZXNzaW9uLmdldExpbmUoY3VycmVudExpbmUpLnRyaW0oKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudExpbmUgIT09IHN0YXJ0Py5yb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0geyByb3c6IGN1cnJlbnRMaW5lLCBjb2x1bW46IDAgfTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNldFNlbGVjdGlvblJhbmdlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzdGFydCA/PyB7IHJvdzogMCwgY29sdW1uOiAwIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmQsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBzdGFydFF1ZXJ5KCk7XG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5zZWxlY3Rpb24uY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLm1vdmVDdXJzb3JUb1Bvc2l0aW9uKGN1cnNvclBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnNjcm9sbFRvUm93KGN1cnJlbnRSb3cpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICBdO1xuICAgICAgICBpZiAodXNlck9TID09PSAnTWFjT1MnKSB7XG4gICAgICAgICAgICBiYXNlLnB1c2goe1xuICAgICAgICAgICAgICAgIG5hbWU6ICdwcmV2aW91c0xpbmUnLFxuICAgICAgICAgICAgICAgIGtleTogS2V5Ym9hcmRTaG9ydGN1dC5DdHJsUCxcbiAgICAgICAgICAgICAgICBkZXNjcjogS0VZX01BUFtLZXlib2FyZFNob3J0Y3V0LkN0cmxQXSxcbiAgICAgICAgICAgICAgICBmdW5jOiBlZGl0b3IgPT4ge1xuICAgICAgICAgICAgICAgICAgICBlZGl0b3IubmF2aWdhdGVVcCgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYmFzZTtcbiAgICB9LCBbZ2V0SG90a2V5Q29uZmlnLCBzdGFydFF1ZXJ5XSk7XG4gICAgY29uc3Qgb25CZWZvcmVVbmxvYWQgPSB1c2VFZmZlY3RFdmVudChldmVudCA9PiB7XG4gICAgICAgIGlmIChkYXRhYmFzZT8uZXh0cmFfanNvbj8uY2FuY2VsX3F1ZXJ5X29uX3dpbmRvd3NfdW5sb2FkICYmXG4gICAgICAgICAgICBsYXRlc3RRdWVyeT8uc3RhdGUgPT09ICdydW5uaW5nJykge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHN0b3BRdWVyeSgpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgY29uc3Qgc2hvdWxkTG9hZFF1ZXJ5RWRpdG9yID0gaXNGZWF0dXJlRW5hYmxlZChGZWF0dXJlRmxhZy5TcWxsYWJCYWNrZW5kUGVyc2lzdGVuY2UpICYmXG4gICAgICAgICFxdWVyeUVkaXRvci5sb2FkZWQ7XG4gICAgY29uc3QgbG9hZFF1ZXJ5RWRpdG9yID0gdXNlRWZmZWN0RXZlbnQoKCkgPT4ge1xuICAgICAgICBjb25zdCBkdXJhdGlvbiA9IExvZ2dlci5nZXRUaW1lc3RhbXAoKTtcbiAgICAgICAgbG9nQWN0aW9uKExPR19BQ1RJT05TX1NRTExBQl9MT0FEX1RBQl9TVEFURSwge1xuICAgICAgICAgICAgZHVyYXRpb24sXG4gICAgICAgICAgICBxdWVyeUVkaXRvcklkOiBxdWVyeUVkaXRvci5pZCxcbiAgICAgICAgICAgIGluTG9jYWxTdG9yYWdlOiBCb29sZWFuKHF1ZXJ5RWRpdG9yLmluTG9jYWxTdG9yYWdlKSxcbiAgICAgICAgICAgIGhhc0xvYWRlZDogIXNob3VsZExvYWRRdWVyeUVkaXRvcixcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChzaG91bGRMb2FkUXVlcnlFZGl0b3IpIHtcbiAgICAgICAgICAgIGRpc3BhdGNoKGZldGNoUXVlcnlFZGl0b3IocXVlcnlFZGl0b3IsIGRpc3BsYXlMaW1pdCkpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgLy8gV2UgbmVlZCB0byBtZWFzdXJlIHRoZSBoZWlnaHQgb2YgdGhlIHNxbCBlZGl0b3IgcG9zdCByZW5kZXIgdG8gZmlndXJlIHRoZSBoZWlnaHQgb2ZcbiAgICAgICAgLy8gdGhlIHNvdXRoIHBhbmUgc28gaXQgZ2V0cyByZW5kZXJlZCBwcm9wZXJseVxuICAgICAgICBzZXRIZWlnaHQoZ2V0U3FsRWRpdG9ySGVpZ2h0KCkpO1xuICAgICAgICBjb25zdCBoYW5kbGVXaW5kb3dSZXNpemVXaXRoVGhyb3R0bGUgPSB0aHJvdHRsZSgoKSA9PiBzZXRIZWlnaHQoZ2V0U3FsRWRpdG9ySGVpZ2h0KCkpLCBXSU5ET1dfUkVTSVpFX1RIUk9UVExFX01TKTtcbiAgICAgICAgaWYgKGlzQWN0aXZlKSB7XG4gICAgICAgICAgICBsb2FkUXVlcnlFZGl0b3IoKTtcbiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBoYW5kbGVXaW5kb3dSZXNpemVXaXRoVGhyb3R0bGUpO1xuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIG9uQmVmb3JlVW5sb2FkKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGhhbmRsZVdpbmRvd1Jlc2l6ZVdpdGhUaHJvdHRsZSk7XG4gICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgb25CZWZvcmVVbmxvYWQpO1xuICAgICAgICB9O1xuICAgICAgICAvLyBUT0RPOiBSZW1vdmUgdXNlRWZmZWN0RXZlbnQgZGVwcyBvbmNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWFjdC9wdWxsLzI1ODgxIGlzIHJlbGVhc2VkXG4gICAgfSwgW29uQmVmb3JlVW5sb2FkLCBsb2FkUXVlcnlFZGl0b3IsIGlzQWN0aXZlXSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgLy8gc2V0dXAgaG90a2V5c1xuICAgICAgICBjb25zdCBob3RrZXlzID0gZ2V0SG90a2V5Q29uZmlnKCk7XG4gICAgICAgIGlmIChpc0FjdGl2ZSkge1xuICAgICAgICAgICAgLy8gTW91c2VUcmFwIGFsd2F5cyBvdmVycmlkZSB0aGUgc2FtZSBrZXlcbiAgICAgICAgICAgIC8vIFVuYmluZCAocmVzZXQpIHdpbGwgYmUgY2FsbGVkIHdoZW4gQXBwIGNvbXBvbmVudCB1bm1vdW50XG4gICAgICAgICAgICBob3RrZXlzLmZvckVhY2goa2V5Q29uZmlnID0+IHtcbiAgICAgICAgICAgICAgICBNb3VzZXRyYXAuYmluZChba2V5Q29uZmlnLmtleV0sIGtleUNvbmZpZy5mdW5jKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSwgW2dldEhvdGtleUNvbmZpZywgbGF0ZXN0UXVlcnksIGlzQWN0aXZlXSk7XG4gICAgY29uc3Qgb25SZXNpemVTdGFydCA9ICgpID0+IHtcbiAgICAgICAgLy8gU2V0IHRoZSBoZWlnaHRzIG9uIHRoZSBhY2UgZWRpdG9yIGFuZCB0aGUgYWNlIGNvbnRlbnQgYXJlYSBhZnRlciBkcmFnIHN0YXJ0c1xuICAgICAgICAvLyB0byBzbW9vdGggb3V0IHRoZSB2aXN1YWwgdHJhbnNpdGlvbiB0byB0aGUgbmV3IGhlaWdodHMgd2hlbiBkcmFnIGVuZHNcbiAgICAgICAgY29uc3QgZWRpdG9yRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdhY2VfY29udGVudCcpWzBdO1xuICAgICAgICBpZiAoZWRpdG9yRWwpIHtcbiAgICAgICAgICAgIGVkaXRvckVsLnN0eWxlLmhlaWdodCA9ICcxMDAlJztcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3Qgb25SZXNpemVFbmQgPSAoW25vcnRoUGVyY2VudCwgc291dGhQZXJjZW50XSkgPT4ge1xuICAgICAgICBzZXROb3J0aFBlcmNlbnQobm9ydGhQZXJjZW50KTtcbiAgICAgICAgc2V0U291dGhQZXJjZW50KHNvdXRoUGVyY2VudCk7XG4gICAgICAgIGlmIChub3J0aFBhbmVSZWYuY3VycmVudD8uY2xpZW50SGVpZ2h0KSB7XG4gICAgICAgICAgICBkaXNwYXRjaChwZXJzaXN0RWRpdG9ySGVpZ2h0KHF1ZXJ5RWRpdG9yLCBub3J0aFBlcmNlbnQsIHNvdXRoUGVyY2VudCkpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBzZXRRdWVyeUVkaXRvckFuZFNhdmVTcWwgPSB1c2VDYWxsYmFjayhzcWwgPT4ge1xuICAgICAgICBkaXNwYXRjaChxdWVyeUVkaXRvclNldEFuZFNhdmVTcWwocXVlcnlFZGl0b3IsIHNxbCkpO1xuICAgIH0sIFtkaXNwYXRjaCwgcXVlcnlFZGl0b3JdKTtcbiAgICBjb25zdCBzZXRRdWVyeUVkaXRvckFuZFNhdmVTcWxXaXRoRGVib3VuY2UgPSB1c2VNZW1vKCgpID0+IGRlYm91bmNlKHNldFF1ZXJ5RWRpdG9yQW5kU2F2ZVNxbCwgU0VUX1FVRVJZX0VESVRPUl9TUUxfREVCT1VOQ0VfTVMpLCBbc2V0UXVlcnlFZGl0b3JBbmRTYXZlU3FsXSk7XG4gICAgY29uc3Qgb25TcWxDaGFuZ2VkID0gdXNlRWZmZWN0RXZlbnQoKHNxbCkgPT4ge1xuICAgICAgICBkaXNwYXRjaChxdWVyeUVkaXRvclNldFNxbChxdWVyeUVkaXRvciwgc3FsKSk7XG4gICAgfSk7XG4gICAgLy8gUmV0dXJuIHRoZSBoZWlnaHRzIGZvciB0aGUgYWNlIGVkaXRvciBhbmQgdGhlIHNvdXRoIHBhbmUgYXMgYW4gb2JqZWN0XG4gICAgLy8gZ2l2ZW4gdGhlIGhlaWdodCBvZiB0aGUgc3FsIGVkaXRvciwgbm9ydGggcGFuZSBwZXJjZW50IGFuZCBzb3V0aCBwYW5lIHBlcmNlbnQuXG4gICAgY29uc3QgZ2V0QWNlRWRpdG9yQW5kU291dGhQYW5lSGVpZ2h0cyA9IChoZWlnaHQsIG5vcnRoUGVyY2VudCwgc291dGhQZXJjZW50KSA9PiAoe1xuICAgICAgICBhY2VFZGl0b3JIZWlnaHQ6IChoZWlnaHQgKiBub3J0aFBlcmNlbnQpIC8gKHRoZW1lLmdyaWRVbml0ICogMjUpIC1cbiAgICAgICAgICAgIChTUUxfRURJVE9SX0dVVFRFUl9IRUlHSFQgLyAyICsgU1FMX0VESVRPUl9HVVRURVJfTUFSR0lOKSAtXG4gICAgICAgICAgICBTUUxfVE9PTEJBUl9IRUlHSFQsXG4gICAgICAgIHNvdXRoUGFuZUhlaWdodDogKGhlaWdodCAqIHNvdXRoUGVyY2VudCkgLyAodGhlbWUuZ3JpZFVuaXQgKiAyNSkgLVxuICAgICAgICAgICAgKFNRTF9FRElUT1JfR1VUVEVSX0hFSUdIVCAvIDIgKyBTUUxfRURJVE9SX0dVVFRFUl9NQVJHSU4pLFxuICAgIH0pO1xuICAgIGNvbnN0IGdldFF1ZXJ5Q29zdEVzdGltYXRlID0gKCkgPT4ge1xuICAgICAgICBsb2dBY3Rpb24oTE9HX0FDVElPTlNfU1FMTEFCX0VTVElNQVRFX1FVRVJZX0NPU1QsIHsgc2hvcnRjdXQ6IGZhbHNlIH0pO1xuICAgICAgICBpZiAoZGF0YWJhc2UpIHtcbiAgICAgICAgICAgIGRpc3BhdGNoKGVzdGltYXRlUXVlcnlDb3N0KHF1ZXJ5RWRpdG9yKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGhhbmRsZVRvZ2dsZUF1dG9jb21wbGV0ZUVuYWJsZWQgPSAoKSA9PiB7XG4gICAgICAgIHNldEl0ZW0oTG9jYWxTdG9yYWdlS2V5cy5TcWxsYWJJc0F1dG9jb21wbGV0ZUVuYWJsZWQsICFhdXRvY29tcGxldGVFbmFibGVkKTtcbiAgICAgICAgc2V0QXV0b2NvbXBsZXRlRW5hYmxlZCghYXV0b2NvbXBsZXRlRW5hYmxlZCk7XG4gICAgfTtcbiAgICBjb25zdCBoYW5kbGVUb2dnbGVSZW5kZXJIVE1MRW5hYmxlZCA9ICgpID0+IHtcbiAgICAgICAgc2V0SXRlbShMb2NhbFN0b3JhZ2VLZXlzLlNxbGxhYklzUmVuZGVySHRtbEVuYWJsZWQsICFyZW5kZXJIVE1MRW5hYmxlZCk7XG4gICAgICAgIHNldFJlbmRlckhUTUxFbmFibGVkKCFyZW5kZXJIVE1MRW5hYmxlZCk7XG4gICAgfTtcbiAgICBjb25zdCBjcmVhdGVUYWJsZUFzID0gKCkgPT4ge1xuICAgICAgICBzdGFydFF1ZXJ5KHRydWUsIEN0YXNFbnVtLlRhYmxlKTtcbiAgICAgICAgc2V0U2hvd0NyZWF0ZUFzTW9kYWwoZmFsc2UpO1xuICAgICAgICBzZXRDdGFzKCcnKTtcbiAgICB9O1xuICAgIGNvbnN0IGNyZWF0ZVZpZXdBcyA9ICgpID0+IHtcbiAgICAgICAgc3RhcnRRdWVyeSh0cnVlLCBDdGFzRW51bS5WaWV3KTtcbiAgICAgICAgc2V0U2hvd0NyZWF0ZUFzTW9kYWwoZmFsc2UpO1xuICAgICAgICBzZXRDdGFzKCcnKTtcbiAgICB9O1xuICAgIGNvbnN0IGN0YXNDaGFuZ2VkID0gKGV2ZW50KSA9PiB7XG4gICAgICAgIHNldEN0YXMoZXZlbnQudGFyZ2V0LnZhbHVlKTtcbiAgICB9O1xuICAgIGNvbnN0IHJlbmRlckRyb3Bkb3duID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBxZSA9IHF1ZXJ5RWRpdG9yO1xuICAgICAgICBjb25zdCBzdWNjZXNzZnVsID0gbGF0ZXN0UXVlcnk/LnN0YXRlID09PSAnc3VjY2Vzcyc7XG4gICAgICAgIGNvbnN0IHNjaGVkdWxlVG9vbFRpcCA9IHN1Y2Nlc3NmdWxcbiAgICAgICAgICAgID8gdCgnU2NoZWR1bGUgdGhlIHF1ZXJ5IHBlcmlvZGljYWxseScpXG4gICAgICAgICAgICA6IHQoJ1lvdSBtdXN0IHJ1biB0aGUgcXVlcnkgc3VjY2Vzc2Z1bGx5IGZpcnN0Jyk7XG4gICAgICAgIHJldHVybiAoPE1lbnUgY3NzPXt7IHdpZHRoOiB0aGVtZS5ncmlkVW5pdCAqIDUwIH19PlxuICAgICAgICA8TWVudS5JdGVtIGNzcz17eyBkaXNwbGF5OiAnZmxleCcsIGp1c3RpZnlDb250ZW50OiAnc3BhY2UtYmV0d2VlbicgfX0+XG4gICAgICAgICAgeycgJ31cbiAgICAgICAgICA8c3Bhbj57dCgnUmVuZGVyIEhUTUwnKX08L3NwYW4+eycgJ31cbiAgICAgICAgICA8U3dpdGNoIGNoZWNrZWQ9e3JlbmRlckhUTUxFbmFibGVkfSBvbkNoYW5nZT17aGFuZGxlVG9nZ2xlUmVuZGVySFRNTEVuYWJsZWR9Lz57JyAnfVxuICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgICAgPE1lbnUuSXRlbSBjc3M9e3sgZGlzcGxheTogJ2ZsZXgnLCBqdXN0aWZ5Q29udGVudDogJ3NwYWNlLWJldHdlZW4nIH19PlxuICAgICAgICAgIHsnICd9XG4gICAgICAgICAgPHNwYW4+e3QoJ0F1dG9jb21wbGV0ZScpfTwvc3Bhbj57JyAnfVxuICAgICAgICAgIDxTd2l0Y2ggY2hlY2tlZD17YXV0b2NvbXBsZXRlRW5hYmxlZH0gb25DaGFuZ2U9e2hhbmRsZVRvZ2dsZUF1dG9jb21wbGV0ZUVuYWJsZWR9Lz57JyAnfVxuICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgICAge2lzRmVhdHVyZUVuYWJsZWQoRmVhdHVyZUZsYWcuRW5hYmxlVGVtcGxhdGVQcm9jZXNzaW5nKSAmJiAoPE1lbnUuSXRlbT5cbiAgICAgICAgICAgIDxUZW1wbGF0ZVBhcmFtc0VkaXRvciBsYW5ndWFnZT1cImpzb25cIiBvbkNoYW5nZT17cGFyYW1zID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2gocXVlcnlFZGl0b3JTZXRUZW1wbGF0ZVBhcmFtcyhxZSwgcGFyYW1zKSk7XG4gICAgICAgICAgICAgICAgfX0gcXVlcnlFZGl0b3JJZD17cWUuaWR9Lz5cbiAgICAgICAgICA8L01lbnUuSXRlbT4pfVxuICAgICAgICA8TWVudS5JdGVtIG9uQ2xpY2s9eygpID0+IGZvcm1hdEN1cnJlbnRRdWVyeSgpfT5cbiAgICAgICAgICB7dCgnRm9ybWF0IFNRTCcpfVxuICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgICAgeyFpc0VtcHR5KHNjaGVkdWxlZFF1ZXJpZXNDb25mKSAmJiAoPE1lbnUuSXRlbT5cbiAgICAgICAgICAgIDxTY2hlZHVsZVF1ZXJ5QnV0dG9uIGRlZmF1bHRMYWJlbD17cWUubmFtZX0gc3FsPXtxZS5zcWx9IG9uU2NoZWR1bGU9eyhxdWVyeSkgPT4gZGlzcGF0Y2goc2NoZWR1bGVRdWVyeShxdWVyeSkpfSBzY2hlbWE9e3FlLnNjaGVtYX0gZGJJZD17cWUuZGJJZH0gc2NoZWR1bGVRdWVyeVdhcm5pbmc9e3NjaGVkdWxlUXVlcnlXYXJuaW5nfSB0b29sdGlwPXtzY2hlZHVsZVRvb2xUaXB9IGRpc2FibGVkPXshc3VjY2Vzc2Z1bH0vPlxuICAgICAgICAgIDwvTWVudS5JdGVtPil9XG4gICAgICAgIDxNZW51Lkl0ZW0+XG4gICAgICAgICAgPEtleWJvYXJkU2hvcnRjdXRCdXR0b24+XG4gICAgICAgICAgICB7dCgnS2V5Ym9hcmQgc2hvcnRjdXRzJyl9XG4gICAgICAgICAgPC9LZXlib2FyZFNob3J0Y3V0QnV0dG9uPlxuICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgIDwvTWVudT4pO1xuICAgIH07XG4gICAgY29uc3Qgb25TYXZlUXVlcnkgPSBhc3luYyAocXVlcnksIGNsaWVudElkKSA9PiB7XG4gICAgICAgIGNvbnN0IHNhdmVkUXVlcnkgPSBhd2FpdCBkaXNwYXRjaChzYXZlUXVlcnkocXVlcnksIGNsaWVudElkKSk7XG4gICAgICAgIGRpc3BhdGNoKGFkZFNhdmVkUXVlcnlUb1RhYlN0YXRlKHF1ZXJ5RWRpdG9yLCBzYXZlZFF1ZXJ5KSk7XG4gICAgfTtcbiAgICBjb25zdCByZW5kZXJFZGl0b3JCb3R0b21CYXIgPSAoaGlkZUFjdGlvbnMpID0+IHtcbiAgICAgICAgY29uc3QgeyBhbGxvd19jdGFzOiBhbGxvd0NUQVMsIGFsbG93X2N2YXM6IGFsbG93Q1ZBUyB9ID0gZGF0YWJhc2UgfHwge307XG4gICAgICAgIGNvbnN0IHNob3dNZW51ID0gYWxsb3dDVEFTIHx8IGFsbG93Q1ZBUztcbiAgICAgICAgY29uc3QgcnVuTWVudUJ0biA9ICg8TWVudT5cbiAgICAgICAge2FsbG93Q1RBUyAmJiAoPE1lbnUuSXRlbSBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxvZ0FjdGlvbihMT0dfQUNUSU9OU19TUUxMQUJfQ1JFQVRFX1RBQkxFX0FTLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaG9ydGN1dDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBzZXRTaG93Q3JlYXRlQXNNb2RhbCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgc2V0Q3JlYXRlQXMoQ3Rhc0VudW0uVGFibGUpO1xuICAgICAgICAgICAgICAgIH19IGtleT1cIjFcIj5cbiAgICAgICAgICAgIHt0KCdDUkVBVEUgVEFCTEUgQVMnKX1cbiAgICAgICAgICA8L01lbnUuSXRlbT4pfVxuICAgICAgICB7YWxsb3dDVkFTICYmICg8TWVudS5JdGVtIG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbG9nQWN0aW9uKExPR19BQ1RJT05TX1NRTExBQl9DUkVBVEVfVklFV19BUywge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnRjdXQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgc2V0U2hvd0NyZWF0ZUFzTW9kYWwodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHNldENyZWF0ZUFzKEN0YXNFbnVtLlZpZXcpO1xuICAgICAgICAgICAgICAgIH19IGtleT1cIjJcIj5cbiAgICAgICAgICAgIHt0KCdDUkVBVEUgVklFVyBBUycpfVxuICAgICAgICAgIDwvTWVudS5JdGVtPil9XG4gICAgICA8L01lbnU+KTtcbiAgICAgICAgcmV0dXJuICg8U3R5bGVkVG9vbGJhciBjbGFzc05hbWU9XCJzcWwtdG9vbGJhclwiIGlkPVwianMtc3FsLXRvb2xiYXJcIj5cbiAgICAgICAge2hpZGVBY3Rpb25zID8gKDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG1lc3NhZ2U9e3QoJ1RoZSBkYXRhYmFzZSB0aGF0IHdhcyB1c2VkIHRvIGdlbmVyYXRlIHRoaXMgcXVlcnkgY291bGQgbm90IGJlIGZvdW5kJyl9IGRlc2NyaXB0aW9uPXt0KCdDaG9vc2Ugb25lIG9mIHRoZSBhdmFpbGFibGUgZGF0YWJhc2VzIG9uIHRoZSBsZWZ0IHBhbmVsLicpfSBjbG9zYWJsZT17ZmFsc2V9Lz4pIDogKDw+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxlZnRJdGVtc1wiPlxuICAgICAgICAgICAgICA8c3Bhbj5cbiAgICAgICAgICAgICAgICA8UnVuUXVlcnlBY3Rpb25CdXR0b24gYWxsb3dBc3luYz17ZGF0YWJhc2U/LmFsbG93X3J1bl9hc3luYyA9PT0gdHJ1ZX0gcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9IHF1ZXJ5U3RhdGU9e2xhdGVzdFF1ZXJ5Py5zdGF0ZX0gcnVuUXVlcnk9e3J1blF1ZXJ5fSBzdG9wUXVlcnk9e3N0b3BRdWVyeX0gb3ZlcmxheUNyZWF0ZUFzTWVudT17c2hvd01lbnUgPyBydW5NZW51QnRuIDogbnVsbH0vPlxuICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgIHtpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLkVzdGltYXRlUXVlcnlDb3N0KSAmJlxuICAgICAgICAgICAgICAgICAgICBkYXRhYmFzZT8uYWxsb3dzX2Nvc3RfZXN0aW1hdGUgJiYgKDxzcGFuPlxuICAgICAgICAgICAgICAgICAgICA8RXN0aW1hdGVRdWVyeUNvc3RCdXR0b24gZ2V0RXN0aW1hdGU9e2dldFF1ZXJ5Q29zdEVzdGltYXRlfSBxdWVyeUVkaXRvcklkPXtxdWVyeUVkaXRvci5pZH0gdG9vbHRpcD17dCgnRXN0aW1hdGUgdGhlIGNvc3QgYmVmb3JlIHJ1bm5pbmcgYSBxdWVyeScpfS8+XG4gICAgICAgICAgICAgICAgICA8L3NwYW4+KX1cbiAgICAgICAgICAgICAgPHNwYW4+XG4gICAgICAgICAgICAgICAgPFF1ZXJ5TGltaXRTZWxlY3QgcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9IG1heFJvdz17bWF4Um93fSBkZWZhdWx0UXVlcnlMaW1pdD17ZGVmYXVsdFF1ZXJ5TGltaXR9Lz5cbiAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICB7bGF0ZXN0UXVlcnkgJiYgKDxUaW1lciBzdGFydFRpbWU9e2xhdGVzdFF1ZXJ5LnN0YXJ0RHR0bX0gZW5kVGltZT17bGF0ZXN0UXVlcnkuZW5kRHR0bX0gc3RhdHVzPXtTVEFURV9UWVBFX01BUFtsYXRlc3RRdWVyeS5zdGF0ZV19IGlzUnVubmluZz17bGF0ZXN0UXVlcnkuc3RhdGUgPT09ICdydW5uaW5nJ30vPil9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicmlnaHRJdGVtc1wiPlxuICAgICAgICAgICAgICA8c3Bhbj5cbiAgICAgICAgICAgICAgICA8U2F2ZVF1ZXJ5IHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfSBjb2x1bW5zPXtsYXRlc3RRdWVyeT8ucmVzdWx0cz8uY29sdW1ucyB8fCBbXX0gb25TYXZlPXtvblNhdmVRdWVyeX0gb25VcGRhdGU9eyhxdWVyeSwgcmVtb3RlSWQpID0+IGRpc3BhdGNoKHVwZGF0ZVNhdmVkUXVlcnkocXVlcnksIHJlbW90ZUlkKSl9IHNhdmVRdWVyeVdhcm5pbmc9e3NhdmVRdWVyeVdhcm5pbmd9IGRhdGFiYXNlPXtkYXRhYmFzZX0vPlxuICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgIDxzcGFuPlxuICAgICAgICAgICAgICAgIDxTaGFyZVNxbExhYlF1ZXJ5IHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfS8+XG4gICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgPERyb3Bkb3duIGRyb3Bkb3duUmVuZGVyPXsoKSA9PiByZW5kZXJEcm9wZG93bigpfSB0cmlnZ2VyPXtbJ2NsaWNrJ119PlxuICAgICAgICAgICAgICAgIDxCdXR0b24gYnV0dG9uU2l6ZT1cInhzbWFsbFwiIHR5cGU9XCJsaW5rXCIgc2hvd01hcmdpblJpZ2h0PXtmYWxzZX0+XG4gICAgICAgICAgICAgICAgICA8SWNvbnMuRWxsaXBzaXNPdXRsaW5lZCAvPlxuICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICA8L0Ryb3Bkb3duPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC8+KX1cbiAgICAgIDwvU3R5bGVkVG9vbGJhcj4pO1xuICAgIH07XG4gICAgY29uc3QgaGFuZGxlQ3Vyc29yUG9zaXRpb25DaGFuZ2UgPSAobmV3UG9zaXRpb24pID0+IHtcbiAgICAgICAgZGlzcGF0Y2gocXVlcnlFZGl0b3JTZXRDdXJzb3JQb3NpdGlvbihxdWVyeUVkaXRvciwgbmV3UG9zaXRpb24pKTtcbiAgICB9O1xuICAgIGNvbnN0IHF1ZXJ5UGFuZSA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyBhY2VFZGl0b3JIZWlnaHQsIHNvdXRoUGFuZUhlaWdodCB9ID0gZ2V0QWNlRWRpdG9yQW5kU291dGhQYW5lSGVpZ2h0cyhoZWlnaHQsIG5vcnRoUGVyY2VudCwgc291dGhQZXJjZW50KTtcbiAgICAgICAgcmV0dXJuICg8U3BsaXQgZXhwYW5kVG9NaW4gY2xhc3NOYW1lPVwicXVlcnlQYW5lXCIgc2l6ZXM9e1tub3J0aFBlcmNlbnQsIHNvdXRoUGVyY2VudF19IGVsZW1lbnRTdHlsZT17ZWxlbWVudFN0eWxlfSBtaW5TaXplPXsyMDB9IGRpcmVjdGlvbj1cInZlcnRpY2FsXCIgZ3V0dGVyU2l6ZT17U1FMX0VESVRPUl9HVVRURVJfSEVJR0hUfSBvbkRyYWdTdGFydD17b25SZXNpemVTdGFydH0gb25EcmFnRW5kPXtvblJlc2l6ZUVuZH0+XG4gICAgICAgIDxkaXYgcmVmPXtub3J0aFBhbmVSZWZ9IGNsYXNzTmFtZT1cIm5vcnRoLXBhbmVcIj5cbiAgICAgICAgICB7U3FsRm9ybUV4dGVuc2lvbiAmJiAoPFNxbEZvcm1FeHRlbnNpb24gcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9IHNldFF1ZXJ5RWRpdG9yQW5kU2F2ZVNxbFdpdGhEZWJvdW5jZT17c2V0UXVlcnlFZGl0b3JBbmRTYXZlU3FsV2l0aERlYm91bmNlfSBzdGFydFF1ZXJ5PXtzdGFydFF1ZXJ5fS8+KX1cbiAgICAgICAgICB7aXNBY3RpdmUgJiYgKDxBY2VFZGl0b3JXcmFwcGVyIGF1dG9jb21wbGV0ZT17YXV0b2NvbXBsZXRlRW5hYmxlZH0gb25CbHVyPXtvblNxbENoYW5nZWR9IG9uQ2hhbmdlPXtvblNxbENoYW5nZWR9IHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfSBvbkN1cnNvclBvc2l0aW9uQ2hhbmdlPXtoYW5kbGVDdXJzb3JQb3NpdGlvbkNoYW5nZX0gaGVpZ2h0PXtgJHthY2VFZGl0b3JIZWlnaHR9cHhgfSBob3RrZXlzPXtob3RrZXlzfS8+KX1cbiAgICAgICAgICB7cmVuZGVyRWRpdG9yQm90dG9tQmFyKHNob3dFbXB0eVN0YXRlKX1cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxTb3V0aFBhbmUgcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9IGxhdGVzdFF1ZXJ5SWQ9e2xhdGVzdFF1ZXJ5Py5pZH0gaGVpZ2h0PXtzb3V0aFBhbmVIZWlnaHR9IGRpc3BsYXlMaW1pdD17ZGlzcGxheUxpbWl0fSBkZWZhdWx0UXVlcnlMaW1pdD17ZGVmYXVsdFF1ZXJ5TGltaXR9Lz5cbiAgICAgIDwvU3BsaXQ+KTtcbiAgICB9O1xuICAgIGNvbnN0IGNyZWF0ZVZpZXdNb2RhbFRpdGxlID0gY3JlYXRlQXMgPT09IEN0YXNFbnVtLlZpZXcgPyAnQ1JFQVRFIFZJRVcgQVMnIDogJ0NSRUFURSBUQUJMRSBBUyc7XG4gICAgY29uc3QgY3JlYXRlTW9kYWxQbGFjZUhvbGRlciA9IGNyZWF0ZUFzID09PSBDdGFzRW51bS5WaWV3XG4gICAgICAgID8gdCgnU3BlY2lmeSBuYW1lIHRvIENSRUFURSBWSUVXIEFTIHNjaGVtYSBpbjogcHVibGljJylcbiAgICAgICAgOiB0KCdTcGVjaWZ5IG5hbWUgdG8gQ1JFQVRFIFRBQkxFIEFTIHNjaGVtYSBpbjogcHVibGljJyk7XG4gICAgY29uc3QgbGVmdEJhclN0YXRlQ2xhc3MgPSBoaWRlTGVmdEJhclxuICAgICAgICA/ICdzY2hlbWFQYW5lLWV4aXQtZG9uZSdcbiAgICAgICAgOiAnc2NoZW1hUGFuZS1lbnRlci1kb25lJztcbiAgICByZXR1cm4gKDxTdHlsZWRTcWxFZGl0b3IgcmVmPXtzcWxFZGl0b3JSZWZ9IGNsYXNzTmFtZT1cIlNxbEVkaXRvclwiPlxuICAgICAgPENTU1RyYW5zaXRpb24gY2xhc3NOYW1lcz1cInNjaGVtYVBhbmVcIiBpbj17IWhpZGVMZWZ0QmFyfSB0aW1lb3V0PXszMDB9PlxuICAgICAgICA8UmVzaXphYmxlU2lkZWJhciBpZD17YHNxbGxhYjoke3F1ZXJ5RWRpdG9yLmlkfWB9IG1pbldpZHRoPXtTUUxfRURJVE9SX0xFRlRCQVJfV0lEVEh9IGluaXRpYWxXaWR0aD17U1FMX0VESVRPUl9MRUZUQkFSX1dJRFRIfSBlbmFibGU9eyFoaWRlTGVmdEJhcn0+XG4gICAgICAgICAge2FkanVzdGVkV2lkdGggPT4gKDxTdHlsZWRTaWRlYmFyIGNsYXNzTmFtZT17YHNjaGVtYVBhbmUgJHtsZWZ0QmFyU3RhdGVDbGFzc31gfSB3aWR0aD17YWRqdXN0ZWRXaWR0aH0gaGlkZT17aGlkZUxlZnRCYXJ9PlxuICAgICAgICAgICAgICA8U3FsRWRpdG9yTGVmdEJhciBkYXRhYmFzZT17ZGF0YWJhc2V9IHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfS8+XG4gICAgICAgICAgICA8L1N0eWxlZFNpZGViYXI+KX1cbiAgICAgICAgPC9SZXNpemFibGVTaWRlYmFyPlxuICAgICAgPC9DU1NUcmFuc2l0aW9uPlxuICAgICAge3Nob3VsZExvYWRRdWVyeUVkaXRvciA/ICg8ZGl2IGRhdGEtdGVzdD1cInNxbEVkaXRvci1sb2FkaW5nXCIgY3NzPXtjc3MgYFxuICAgICAgICAgICAgZmxleDogMTtcbiAgICAgICAgICAgIHBhZGRpbmc6ICR7dGhlbWUuZ3JpZFVuaXQgKiA0fXB4O1xuICAgICAgICAgIGB9PlxuICAgICAgICAgIDxTa2VsZXRvbiBhY3RpdmUvPlxuICAgICAgICA8L2Rpdj4pIDogc2hvd0VtcHR5U3RhdGUgJiYgIWhhc1NxbFN0YXRlbWVudCA/ICg8RW1wdHlTdGF0ZSBpbWFnZT1cInZlY3Rvci5zdmdcIiBzaXplPVwibGFyZ2VcIiB0aXRsZT17dCgnU2VsZWN0IGEgZGF0YWJhc2UgdG8gd3JpdGUgYSBxdWVyeScpfSBkZXNjcmlwdGlvbj17dCgnQ2hvb3NlIG9uZSBvZiB0aGUgYXZhaWxhYmxlIGRhdGFiYXNlcyBmcm9tIHRoZSBwYW5lbCBvbiB0aGUgbGVmdC4nKX0vPikgOiAocXVlcnlQYW5lKCkpfVxuICAgICAgPE1vZGFsIHNob3c9e3Nob3dDcmVhdGVBc01vZGFsfSB0aXRsZT17dChjcmVhdGVWaWV3TW9kYWxUaXRsZSl9IG9uSGlkZT17KCkgPT4gc2V0U2hvd0NyZWF0ZUFzTW9kYWwoZmFsc2UpfSBmb290ZXI9ezw+XG4gICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9eygpID0+IHNldFNob3dDcmVhdGVBc01vZGFsKGZhbHNlKX0+XG4gICAgICAgICAgICAgIHt0KCdDYW5jZWwnKX1cbiAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAge2NyZWF0ZUFzID09PSBDdGFzRW51bS5UYWJsZSAmJiAoPEJ1dHRvbiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBkaXNhYmxlZD17Y3Rhcy5sZW5ndGggPT09IDB9IG9uQ2xpY2s9e2NyZWF0ZVRhYmxlQXN9PlxuICAgICAgICAgICAgICAgIHt0KCdDcmVhdGUnKX1cbiAgICAgICAgICAgICAgPC9CdXR0b24+KX1cbiAgICAgICAgICAgIHtjcmVhdGVBcyA9PT0gQ3Rhc0VudW0uVmlldyAmJiAoPEJ1dHRvbiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBkaXNhYmxlZD17Y3Rhcy5sZW5ndGggPT09IDB9IG9uQ2xpY2s9e2NyZWF0ZVZpZXdBc30+XG4gICAgICAgICAgICAgICAge3QoJ0NyZWF0ZScpfVxuICAgICAgICAgICAgICA8L0J1dHRvbj4pfVxuICAgICAgICAgIDwvPn0+XG4gICAgICAgIDxzcGFuPnt0KCdOYW1lJyl9PC9zcGFuPlxuICAgICAgICA8SW5wdXQgcGxhY2Vob2xkZXI9e2NyZWF0ZU1vZGFsUGxhY2VIb2xkZXJ9IG9uQ2hhbmdlPXtjdGFzQ2hhbmdlZH0vPlxuICAgICAgPC9Nb2RhbD5cbiAgICA8L1N0eWxlZFNxbEVkaXRvcj4pO1xufTtcbmV4cG9ydCBkZWZhdWx0IFNxbEVkaXRvcjtcbiJdfQ== */\", toString: _EMOTION_STRINGIFIED_CSS_ERROR__ };\nconst SqlEditor = ({ queryEditor, defaultQueryLimit, maxRow, displayLimit, saveQueryWarning, scheduleQueryWarning }) => {\n  const theme = useTheme();\n  const dispatch = useDispatch();\n  const { database, latestQuery, hideLeftBar, currentQueryEditorId, hasSqlStatement } = useSelector(({ sqlLab: { unsavedQueryEditor, databases, queries, tabHistory } }) => {var _queryEditor$sql;\n    let { dbId, latestQueryId, hideLeftBar } = queryEditor;\n    if ((unsavedQueryEditor == null ? void 0 : unsavedQueryEditor.id) === queryEditor.id) {\n      dbId = unsavedQueryEditor.dbId || dbId;\n      latestQueryId = unsavedQueryEditor.latestQueryId || latestQueryId;\n      hideLeftBar =\n      typeof unsavedQueryEditor.hideLeftBar === 'boolean' ?\n      unsavedQueryEditor.hideLeftBar :\n      hideLeftBar;\n    }\n    return {\n      hasSqlStatement: Boolean(((_queryEditor$sql = queryEditor.sql) == null ? void 0 : _queryEditor$sql.trim().length) > 0),\n      database: databases[dbId || ''],\n      latestQuery: queries[latestQueryId || ''],\n      hideLeftBar,\n      currentQueryEditorId: tabHistory.slice(-1)[0]\n    };\n  }, shallowEqual);\n  const logAction = useLogAction({ queryEditorId: queryEditor.id });\n  const isActive = currentQueryEditorId === queryEditor.id;\n  const [height, setHeight] = useState(0);\n  const [autorun, setAutorun] = useState(queryEditor.autorun);\n  const [ctas, setCtas] = useState('');\n  const [northPercent, setNorthPercent] = useState(queryEditor.northPercent || INITIAL_NORTH_PERCENT);\n  const [southPercent, setSouthPercent] = useState(queryEditor.southPercent || INITIAL_SOUTH_PERCENT);\n  const [autocompleteEnabled, setAutocompleteEnabled] = useState(getItem(LocalStorageKeys.SqllabIsAutocompleteEnabled, true));\n  const [renderHTMLEnabled, setRenderHTMLEnabled] = useState(getItem(LocalStorageKeys.SqllabIsRenderHtmlEnabled, true));\n  const [showCreateAsModal, setShowCreateAsModal] = useState(false);\n  const [createAs, setCreateAs] = useState('');\n  const showEmptyState = useMemo(() => !database || _isEmpty(database), [database]);\n  const sqlEditorRef = useRef(null);\n  const northPaneRef = useRef(null);\n  const SqlFormExtension = extensionsRegistry.get('sqleditor.extension.form');\n  const startQuery = useCallback((ctasArg = false, ctas_method = CtasEnum.Table) => {\n    if (!database) {\n      return;\n    }\n    dispatch(runQueryFromSqlEditor(database, queryEditor, defaultQueryLimit, ctasArg ? ctas : '', ctasArg, ctas_method));\n    dispatch(setActiveSouthPaneTab('Results'));\n  }, [ctas, database, defaultQueryLimit, dispatch, queryEditor]);\n  const formatCurrentQuery = useCallback((useShortcut) => {\n    logAction(LOG_ACTIONS_SQLLAB_FORMAT_SQL, {\n      shortcut: Boolean(useShortcut)\n    });\n    dispatch(formatQuery(queryEditor));\n  }, [dispatch, queryEditor, logAction]);\n  const stopQuery = useCallback(() => {\n    if (latestQuery && ['running', 'pending'].indexOf(latestQuery.state) >= 0) {\n      dispatch(postStopQuery(latestQuery));\n    }\n    return false;\n  }, [dispatch, latestQuery]);\n  const runQuery = () => {\n    if (database) {\n      startQuery();\n    }\n  };\n  useEffect(() => {\n    if (autorun) {\n      setAutorun(false);\n      dispatch(queryEditorSetAutorun(queryEditor, false));\n      startQuery();\n    }\n  }, [autorun, dispatch, queryEditor, startQuery]);\n  // One layer of abstraction for easy spying in unit tests\n  const getSqlEditorHeight = () => sqlEditorRef.current ?\n  sqlEditorRef.current.clientHeight - SQL_EDITOR_PADDING * 2 :\n  0;\n  const getHotkeyConfig = useCallback(() => {\n    // Get the user's OS\n    const userOS = detectOS();\n    return [\n    {\n      name: 'runQuery1',\n      key: KeyboardShortcut.CtrlR,\n      descr: KEY_MAP[KeyboardShortcut.CtrlR],\n      func: () => {\n        if (queryEditor.sql.trim() !== '') {\n          logAction(LOG_ACTIONS_SQLLAB_RUN_QUERY, { shortcut: true });\n          startQuery();\n        }\n      }\n    },\n    {\n      name: 'runQuery2',\n      key: KeyboardShortcut.CtrlEnter,\n      descr: KEY_MAP[KeyboardShortcut.CtrlEnter],\n      func: () => {\n        if (queryEditor.sql.trim() !== '') {\n          logAction(LOG_ACTIONS_SQLLAB_RUN_QUERY, { shortcut: true });\n          startQuery();\n        }\n      }\n    },\n    {\n      name: 'newTab',\n      ...(userOS === 'Windows' ?\n      {\n        key: KeyboardShortcut.CtrlQ,\n        descr: KEY_MAP[KeyboardShortcut.CtrlQ]\n      } :\n      {\n        key: KeyboardShortcut.CtrlT,\n        descr: KEY_MAP[KeyboardShortcut.CtrlT]\n      }),\n      func: () => {\n        Logger.markTimeOrigin();\n        dispatch(addNewQueryEditor());\n      }\n    },\n    {\n      name: 'stopQuery',\n      ...(userOS === 'MacOS' ?\n      {\n        key: KeyboardShortcut.CtrlX,\n        descr: KEY_MAP[KeyboardShortcut.CtrlX]\n      } :\n      {\n        key: KeyboardShortcut.CtrlE,\n        descr: KEY_MAP[KeyboardShortcut.CtrlE]\n      }),\n      func: () => {\n        logAction(LOG_ACTIONS_SQLLAB_STOP_QUERY, { shortcut: true });\n        stopQuery();\n      }\n    },\n    {\n      name: 'formatQuery',\n      key: KeyboardShortcut.CtrlShiftF,\n      descr: KEY_MAP[KeyboardShortcut.CtrlShiftF],\n      func: () => {\n        formatCurrentQuery(true);\n      }\n    },\n    {\n      name: 'switchTabToLeft',\n      key: KeyboardShortcut.CtrlLeft,\n      descr: KEY_MAP[KeyboardShortcut.CtrlLeft],\n      func: () => {\n        dispatch(switchQueryEditor(true));\n      }\n    },\n    {\n      name: 'switchTabToRight',\n      key: KeyboardShortcut.CtrlRight,\n      descr: KEY_MAP[KeyboardShortcut.CtrlRight],\n      func: () => {\n        dispatch(switchQueryEditor(false));\n      }\n    }];\n\n  }, [dispatch, queryEditor.sql, startQuery, stopQuery, formatCurrentQuery]);\n  const hotkeys = useMemo(() => {\n    // Get all hotkeys including ace editor hotkeys\n    // Get the user's OS\n    const userOS = detectOS();\n    const base = [\n    ...getHotkeyConfig(),\n    {\n      name: 'runQuery3',\n      key: KeyboardShortcut.CtrlShiftEnter,\n      descr: KEY_MAP[KeyboardShortcut.CtrlShiftEnter],\n      func: (editor) => {var _start, _start2, _start3, _start4, _start5;\n        if (!editor.getValue().trim()) {\n          return;\n        }\n        const session = editor.getSession();\n        const cursorPosition = editor.getCursorPosition();\n        const totalLine = session.getLength();\n        const currentRow = editor.getFirstVisibleRow();\n        const semicolonEnd = editor.find(';', {\n          backwards: false,\n          skipCurrent: true\n        });\n        let end;\n        if (semicolonEnd) {\n          ({ end } = semicolonEnd);\n        }\n        if (!end || end.row < cursorPosition.row) {\n          end = {\n            row: totalLine + 1,\n            column: 0\n          };\n        }\n        const semicolonStart = editor.find(';', {\n          backwards: true,\n          skipCurrent: true\n        });\n        let start;\n        if (semicolonStart) {\n          start = semicolonStart.end;\n        }\n        let currentLine = (_start = start) == null ? void 0 : _start.row;\n        if (!currentLine ||\n        currentLine > cursorPosition.row ||\n        currentLine === cursorPosition.row &&\n        (((_start2 = start) == null ? void 0 : _start2.column) || 0) > cursorPosition.column) {\n          currentLine = 0;\n        }\n        let content = currentLine === ((_start3 = start) == null ? void 0 : _start3.row) ?\n        session.getLine(currentLine).slice(start.column).trim() :\n        session.getLine(currentLine).trim();\n        while (!content && currentLine < totalLine) {\n          currentLine += 1;\n          content = session.getLine(currentLine).trim();\n        }\n        if (currentLine !== ((_start4 = start) == null ? void 0 : _start4.row)) {\n          start = { row: currentLine, column: 0 };\n        }\n        editor.selection.setSelectionRange({\n          start: (_start5 = start) != null ? _start5 : { row: 0, column: 0 },\n          end\n        });\n        startQuery();\n        editor.selection.clearSelection();\n        editor.moveCursorToPosition(cursorPosition);\n        editor.scrollToRow(currentRow);\n      }\n    }];\n\n    if (userOS === 'MacOS') {\n      base.push({\n        name: 'previousLine',\n        key: KeyboardShortcut.CtrlP,\n        descr: KEY_MAP[KeyboardShortcut.CtrlP],\n        func: (editor) => {\n          editor.navigateUp();\n        }\n      });\n    }\n    return base;\n  }, [getHotkeyConfig, startQuery]);\n  const onBeforeUnload = useEffectEvent((event) => {var _database$extra_json;\n    if (database != null && (_database$extra_json = database.extra_json) != null && _database$extra_json.cancel_query_on_windows_unload &&\n    (latestQuery == null ? void 0 : latestQuery.state) === 'running') {\n      event.preventDefault();\n      stopQuery();\n    }\n  });\n  const shouldLoadQueryEditor = isFeatureEnabled(FeatureFlag.SqllabBackendPersistence) &&\n  !queryEditor.loaded;\n  const loadQueryEditor = useEffectEvent(() => {\n    const duration = Logger.getTimestamp();\n    logAction(LOG_ACTIONS_SQLLAB_LOAD_TAB_STATE, {\n      duration,\n      queryEditorId: queryEditor.id,\n      inLocalStorage: Boolean(queryEditor.inLocalStorage),\n      hasLoaded: !shouldLoadQueryEditor\n    });\n    if (shouldLoadQueryEditor) {\n      dispatch(fetchQueryEditor(queryEditor, displayLimit));\n    }\n  });\n  useEffect(() => {\n    // We need to measure the height of the sql editor post render to figure the height of\n    // the south pane so it gets rendered properly\n    setHeight(getSqlEditorHeight());\n    const handleWindowResizeWithThrottle = _throttle(() => setHeight(getSqlEditorHeight()), WINDOW_RESIZE_THROTTLE_MS);\n    if (isActive) {\n      loadQueryEditor();\n      window.addEventListener('resize', handleWindowResizeWithThrottle);\n      window.addEventListener('beforeunload', onBeforeUnload);\n    }\n    return () => {\n      window.removeEventListener('resize', handleWindowResizeWithThrottle);\n      window.removeEventListener('beforeunload', onBeforeUnload);\n    };\n    // TODO: Remove useEffectEvent deps once https://github.com/facebook/react/pull/25881 is released\n  }, [onBeforeUnload, loadQueryEditor, isActive]);\n  useEffect(() => {\n    // setup hotkeys\n    const hotkeys = getHotkeyConfig();\n    if (isActive) {\n      // MouseTrap always override the same key\n      // Unbind (reset) will be called when App component unmount\n      hotkeys.forEach((keyConfig) => {\n        Mousetrap.bind([keyConfig.key], keyConfig.func);\n      });\n    }\n  }, [getHotkeyConfig, latestQuery, isActive]);\n  const onResizeStart = () => {\n    // Set the heights on the ace editor and the ace content area after drag starts\n    // to smooth out the visual transition to the new heights when drag ends\n    const editorEl = document.getElementsByClassName('ace_content')[0];\n    if (editorEl) {\n      editorEl.style.height = '100%';\n    }\n  };\n  const onResizeEnd = ([northPercent, southPercent]) => {var _northPaneRef$current;\n    setNorthPercent(northPercent);\n    setSouthPercent(southPercent);\n    if ((_northPaneRef$current = northPaneRef.current) != null && _northPaneRef$current.clientHeight) {\n      dispatch(persistEditorHeight(queryEditor, northPercent, southPercent));\n    }\n  };\n  const setQueryEditorAndSaveSql = useCallback((sql) => {\n    dispatch(queryEditorSetAndSaveSql(queryEditor, sql));\n  }, [dispatch, queryEditor]);\n  const setQueryEditorAndSaveSqlWithDebounce = useMemo(() => _debounce(setQueryEditorAndSaveSql, SET_QUERY_EDITOR_SQL_DEBOUNCE_MS), [setQueryEditorAndSaveSql]);\n  const onSqlChanged = useEffectEvent((sql) => {\n    dispatch(queryEditorSetSql(queryEditor, sql));\n  });\n  // Return the heights for the ace editor and the south pane as an object\n  // given the height of the sql editor, north pane percent and south pane percent.\n  const getAceEditorAndSouthPaneHeights = (height, northPercent, southPercent) => ({\n    aceEditorHeight: height * northPercent / (theme.gridUnit * 25) - (\n    SQL_EDITOR_GUTTER_HEIGHT / 2 + SQL_EDITOR_GUTTER_MARGIN) -\n    SQL_TOOLBAR_HEIGHT,\n    southPaneHeight: height * southPercent / (theme.gridUnit * 25) - (\n    SQL_EDITOR_GUTTER_HEIGHT / 2 + SQL_EDITOR_GUTTER_MARGIN)\n  });\n  const getQueryCostEstimate = () => {\n    logAction(LOG_ACTIONS_SQLLAB_ESTIMATE_QUERY_COST, { shortcut: false });\n    if (database) {\n      dispatch(estimateQueryCost(queryEditor));\n    }\n  };\n  const handleToggleAutocompleteEnabled = () => {\n    setItem(LocalStorageKeys.SqllabIsAutocompleteEnabled, !autocompleteEnabled);\n    setAutocompleteEnabled(!autocompleteEnabled);\n  };\n  const handleToggleRenderHTMLEnabled = () => {\n    setItem(LocalStorageKeys.SqllabIsRenderHtmlEnabled, !renderHTMLEnabled);\n    setRenderHTMLEnabled(!renderHTMLEnabled);\n  };\n  const createTableAs = () => {\n    startQuery(true, CtasEnum.Table);\n    setShowCreateAsModal(false);\n    setCtas('');\n  };\n  const createViewAs = () => {\n    startQuery(true, CtasEnum.View);\n    setShowCreateAsModal(false);\n    setCtas('');\n  };\n  const ctasChanged = (event) => {\n    setCtas(event.target.value);\n  };\n  const renderDropdown = () => {\n    const qe = queryEditor;\n    const successful = (latestQuery == null ? void 0 : latestQuery.state) === 'success';\n    const scheduleToolTip = successful ?\n    t('Schedule the query periodically') :\n    t('You must run the query successfully first');\n    return _jsxs(Menu, { css: /*#__PURE__*/_css({ width: theme.gridUnit * 50 }, process.env.NODE_ENV === \"production\" ? \"\" : \";label:renderDropdown;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2FkZWwvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL1NxbExhYi9jb21wb25lbnRzL1NxbEVkaXRvci9pbmRleC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBd2ZzQiIsImZpbGUiOiIvaG9tZS9hZGVsL3N1cGVyc2V0L3N1cGVyc2V0LWZyb250ZW5kL3NyYy9TcWxMYWIvY29tcG9uZW50cy9TcWxFZGl0b3IvaW5kZXgudHN4Iiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyogZXNsaW50LWRpc2FibGUganN4LWExMXkvYW5jaG9yLWlzLXZhbGlkICovXG4vKiBlc2xpbnQtZGlzYWJsZSBqc3gtYTExeS9uby1zdGF0aWMtZWxlbWVudC1pbnRlcmFjdGlvbnMgKi9cbmltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZU1lbW8sIHVzZVJlZiwgdXNlQ2FsbGJhY2ssIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHVzZUVmZmVjdEV2ZW50IGZyb20gJ3NyYy9ob29rcy91c2VFZmZlY3RFdmVudCc7XG5pbXBvcnQgeyBDU1NUcmFuc2l0aW9uIH0gZnJvbSAncmVhY3QtdHJhbnNpdGlvbi1ncm91cCc7XG5pbXBvcnQgeyBzaGFsbG93RXF1YWwsIHVzZURpc3BhdGNoLCB1c2VTZWxlY3RvciB9IGZyb20gJ3JlYWN0LXJlZHV4JztcbmltcG9ydCBTcGxpdCBmcm9tICdyZWFjdC1zcGxpdCc7XG5pbXBvcnQgeyBjc3MsIEZlYXR1cmVGbGFnLCBpc0ZlYXR1cmVFbmFibGVkLCBzdHlsZWQsIHQsIHVzZVRoZW1lLCBnZXRFeHRlbnNpb25zUmVnaXN0cnksIH0gZnJvbSAnQHN1cGVyc2V0LXVpL2NvcmUnO1xuaW1wb3J0IHsgZGVib3VuY2UsIHRocm90dGxlLCBpc0VtcHR5IH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBNb2RhbCBmcm9tICdzcmMvY29tcG9uZW50cy9Nb2RhbCc7XG5pbXBvcnQgTW91c2V0cmFwIGZyb20gJ21vdXNldHJhcCc7XG5pbXBvcnQgQnV0dG9uIGZyb20gJ3NyYy9jb21wb25lbnRzL0J1dHRvbic7XG5pbXBvcnQgVGltZXIgZnJvbSAnc3JjL2NvbXBvbmVudHMvVGltZXInO1xuaW1wb3J0IFJlc2l6YWJsZVNpZGViYXIgZnJvbSAnc3JjL2NvbXBvbmVudHMvUmVzaXphYmxlU2lkZWJhcic7XG5pbXBvcnQgeyBEcm9wZG93biB9IGZyb20gJ3NyYy9jb21wb25lbnRzL0Ryb3Bkb3duJztcbmltcG9ydCB7IFNrZWxldG9uIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMnO1xuaW1wb3J0IHsgU3dpdGNoIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvU3dpdGNoJztcbmltcG9ydCB7IElucHV0IH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvSW5wdXQnO1xuaW1wb3J0IHsgTWVudSB9IGZyb20gJ3NyYy9jb21wb25lbnRzL01lbnUnO1xuaW1wb3J0IEljb25zIGZyb20gJ3NyYy9jb21wb25lbnRzL0ljb25zJztcbmltcG9ydCB7IGRldGVjdE9TIH0gZnJvbSAnc3JjL3V0aWxzL2NvbW1vbic7XG5pbXBvcnQgeyBhZGROZXdRdWVyeUVkaXRvciwgQ3Rhc0VudW0sIGVzdGltYXRlUXVlcnlDb3N0LCBwZXJzaXN0RWRpdG9ySGVpZ2h0LCBwb3N0U3RvcFF1ZXJ5LCBxdWVyeUVkaXRvclNldEF1dG9ydW4sIHF1ZXJ5RWRpdG9yU2V0U3FsLCBxdWVyeUVkaXRvclNldEN1cnNvclBvc2l0aW9uLCBxdWVyeUVkaXRvclNldEFuZFNhdmVTcWwsIHF1ZXJ5RWRpdG9yU2V0VGVtcGxhdGVQYXJhbXMsIHJ1blF1ZXJ5RnJvbVNxbEVkaXRvciwgc2F2ZVF1ZXJ5LCBhZGRTYXZlZFF1ZXJ5VG9UYWJTdGF0ZSwgc2NoZWR1bGVRdWVyeSwgc2V0QWN0aXZlU291dGhQYW5lVGFiLCB1cGRhdGVTYXZlZFF1ZXJ5LCBmb3JtYXRRdWVyeSwgZmV0Y2hRdWVyeUVkaXRvciwgc3dpdGNoUXVlcnlFZGl0b3IsIH0gZnJvbSAnc3JjL1NxbExhYi9hY3Rpb25zL3NxbExhYic7XG5pbXBvcnQgeyBTVEFURV9UWVBFX01BUCwgU1FMX0VESVRPUl9HVVRURVJfSEVJR0hULCBTUUxfRURJVE9SX0dVVFRFUl9NQVJHSU4sIFNRTF9UT09MQkFSX0hFSUdIVCwgU1FMX0VESVRPUl9MRUZUQkFSX1dJRFRILCBTUUxfRURJVE9SX1BBRERJTkcsIElOSVRJQUxfTk9SVEhfUEVSQ0VOVCwgSU5JVElBTF9TT1VUSF9QRVJDRU5ULCBTRVRfUVVFUllfRURJVE9SX1NRTF9ERUJPVU5DRV9NUywgV0lORE9XX1JFU0laRV9USFJPVFRMRV9NUywgfSBmcm9tICdzcmMvU3FsTGFiL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBnZXRJdGVtLCBMb2NhbFN0b3JhZ2VLZXlzLCBzZXRJdGVtLCB9IGZyb20gJ3NyYy91dGlscy9sb2NhbFN0b3JhZ2VIZWxwZXJzJztcbmltcG9ydCB7IEVtcHR5U3RhdGUgfSBmcm9tICdzcmMvY29tcG9uZW50cy9FbXB0eVN0YXRlJztcbmltcG9ydCBBbGVydCBmcm9tICdzcmMvY29tcG9uZW50cy9BbGVydCc7XG5pbXBvcnQgZ2V0Qm9vdHN0cmFwRGF0YSBmcm9tICdzcmMvdXRpbHMvZ2V0Qm9vdHN0cmFwRGF0YSc7XG5pbXBvcnQgdXNlTG9nQWN0aW9uIGZyb20gJ3NyYy9sb2dnZXIvdXNlTG9nQWN0aW9uJztcbmltcG9ydCB7IExPR19BQ1RJT05TX1NRTExBQl9DUkVBVEVfVEFCTEVfQVMsIExPR19BQ1RJT05TX1NRTExBQl9DUkVBVEVfVklFV19BUywgTE9HX0FDVElPTlNfU1FMTEFCX0VTVElNQVRFX1FVRVJZX0NPU1QsIExPR19BQ1RJT05TX1NRTExBQl9GT1JNQVRfU1FMLCBMT0dfQUNUSU9OU19TUUxMQUJfTE9BRF9UQUJfU1RBVEUsIExPR19BQ1RJT05TX1NRTExBQl9SVU5fUVVFUlksIExPR19BQ1RJT05TX1NRTExBQl9TVE9QX1FVRVJZLCBMb2dnZXIsIH0gZnJvbSAnc3JjL2xvZ2dlci9Mb2dVdGlscyc7XG5pbXBvcnQgVGVtcGxhdGVQYXJhbXNFZGl0b3IgZnJvbSAnLi4vVGVtcGxhdGVQYXJhbXNFZGl0b3InO1xuaW1wb3J0IFNvdXRoUGFuZSBmcm9tICcuLi9Tb3V0aFBhbmUnO1xuaW1wb3J0IFNhdmVRdWVyeSBmcm9tICcuLi9TYXZlUXVlcnknO1xuaW1wb3J0IFNjaGVkdWxlUXVlcnlCdXR0b24gZnJvbSAnLi4vU2NoZWR1bGVRdWVyeUJ1dHRvbic7XG5pbXBvcnQgRXN0aW1hdGVRdWVyeUNvc3RCdXR0b24gZnJvbSAnLi4vRXN0aW1hdGVRdWVyeUNvc3RCdXR0b24nO1xuaW1wb3J0IFNoYXJlU3FsTGFiUXVlcnkgZnJvbSAnLi4vU2hhcmVTcWxMYWJRdWVyeSc7XG5pbXBvcnQgU3FsRWRpdG9yTGVmdEJhciBmcm9tICcuLi9TcWxFZGl0b3JMZWZ0QmFyJztcbmltcG9ydCBBY2VFZGl0b3JXcmFwcGVyIGZyb20gJy4uL0FjZUVkaXRvcldyYXBwZXInO1xuaW1wb3J0IFJ1blF1ZXJ5QWN0aW9uQnV0dG9uIGZyb20gJy4uL1J1blF1ZXJ5QWN0aW9uQnV0dG9uJztcbmltcG9ydCBRdWVyeUxpbWl0U2VsZWN0IGZyb20gJy4uL1F1ZXJ5TGltaXRTZWxlY3QnO1xuaW1wb3J0IEtleWJvYXJkU2hvcnRjdXRCdXR0b24sIHsgS0VZX01BUCwgS2V5Ym9hcmRTaG9ydGN1dCwgfSBmcm9tICcuLi9LZXlib2FyZFNob3J0Y3V0QnV0dG9uJztcbmNvbnN0IGJvb3RzdHJhcERhdGEgPSBnZXRCb290c3RyYXBEYXRhKCk7XG5jb25zdCBzY2hlZHVsZWRRdWVyaWVzQ29uZiA9IGJvb3RzdHJhcERhdGE/LmNvbW1vbj8uY29uZj8uU0NIRURVTEVEX1FVRVJJRVM7XG5jb25zdCBTdHlsZWRUb29sYmFyID0gc3R5bGVkLmRpdiBgXG4gIHBhZGRpbmc6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICBiYWNrZ3JvdW5kOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQ1fTtcbiAgZGlzcGxheTogZmxleDtcbiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuICBib3JkZXI6IDFweCBzb2xpZCAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbiAgYm9yZGVyLXRvcDogMDtcbiAgY29sdW1uLWdhcDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdH1weDtcblxuICBmb3JtIHtcbiAgICBtYXJnaW4tYmxvY2stZW5kOiAwO1xuICB9XG5cbiAgLmxlZnRJdGVtcyxcbiAgLnJpZ2h0SXRlbXMge1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAmID4gc3BhbiB7XG4gICAgICBtYXJnaW4tcmlnaHQ6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuXG4gICAgICAmOmxhc3QtY2hpbGQge1xuICAgICAgICBtYXJnaW4tcmlnaHQ6IDA7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLmxpbWl0RHJvcGRvd24ge1xuICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7XG4gIH1cbmA7XG5jb25zdCBTdHlsZWRTaWRlYmFyID0gc3R5bGVkLmRpdiBgXG4gIGZsZXg6IDAgMCAkeyh7IHdpZHRoIH0pID0+IHdpZHRofXB4O1xuICB3aWR0aDogJHsoeyB3aWR0aCB9KSA9PiB3aWR0aH1weDtcbiAgcGFkZGluZzogJHsoeyB0aGVtZSwgaGlkZSB9KSA9PiAoaGlkZSA/IDAgOiB0aGVtZS5ncmlkVW5pdCAqIDIuNSl9cHg7XG4gIGJvcmRlci1yaWdodDogMXB4IHNvbGlkXG4gICAgJHsoeyB0aGVtZSwgaGlkZSB9KSA9PiBoaWRlID8gJ3RyYW5zcGFyZW50JyA6IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbmA7XG5jb25zdCBTdHlsZWRTcWxFZGl0b3IgPSBzdHlsZWQuZGl2IGBcbiAgJHsoeyB0aGVtZSB9KSA9PiBjc3MgYFxuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IHJvdztcbiAgICBoZWlnaHQ6IDEwMCU7XG5cbiAgICAuc2NoZW1hUGFuZSB7XG4gICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gJHt0aGVtZS50cmFuc2l0aW9uVGltaW5nfXMgZWFzZS1pbi1vdXQ7XG4gICAgfVxuXG4gICAgLnF1ZXJ5UGFuZSB7XG4gICAgICBmbGV4OiAxIDEgYXV0bztcbiAgICAgIHBhZGRpbmc6ICR7dGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICAgICAgb3ZlcmZsb3cteTogYXV0bztcbiAgICAgIG92ZXJmbG93LXg6IHNjcm9sbDtcbiAgICB9XG5cbiAgICAuc2NoZW1hUGFuZS1lbnRlci1kb25lLFxuICAgIC5zY2hlbWFQYW5lLWV4aXQge1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDApO1xuICAgICAgei1pbmRleDogNztcbiAgICB9XG5cbiAgICAuc2NoZW1hUGFuZS1leGl0LWFjdGl2ZSB7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTEyMCUpO1xuICAgIH1cblxuICAgIC5zY2hlbWFQYW5lLWVudGVyLWFjdGl2ZSB7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMCk7XG4gICAgICBtYXgtd2lkdGg6ICR7dGhlbWUuZ3JpZFVuaXQgKiA3NX1weDtcbiAgICB9XG5cbiAgICAuc2NoZW1hUGFuZS1lbnRlcixcbiAgICAuc2NoZW1hUGFuZS1leGl0LWRvbmUge1xuICAgICAgbWF4LXdpZHRoOiAwO1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC0xMjAlKTtcbiAgICAgIG92ZXJmbG93OiBoaWRkZW47XG4gICAgfVxuXG4gICAgLnNjaGVtYVBhbmUtZXhpdC1kb25lICsgLnF1ZXJ5UGFuZSB7XG4gICAgICBtYXJnaW4tbGVmdDogMDtcbiAgICB9XG5cbiAgICAuZ3V0dGVyIHtcbiAgICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAke3RoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbiAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAke3RoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbiAgICAgIHdpZHRoOiAzJTtcbiAgICAgIG1hcmdpbjogJHtTUUxfRURJVE9SX0dVVFRFUl9NQVJHSU59cHggNDclO1xuICAgIH1cblxuICAgIC5ndXR0ZXIuZ3V0dGVyLXZlcnRpY2FsIHtcbiAgICAgIGN1cnNvcjogcm93LXJlc2l6ZTtcbiAgICB9XG4gIGB9XG5gO1xuY29uc3QgZXh0ZW5zaW9uc1JlZ2lzdHJ5ID0gZ2V0RXh0ZW5zaW9uc1JlZ2lzdHJ5KCk7XG5jb25zdCBlbGVtZW50U3R5bGUgPSAoZGltZW5zaW9uLCBlbGVtZW50U2l6ZSwgZ3V0dGVyU2l6ZSkgPT4gKHtcbiAgICBbZGltZW5zaW9uXTogYGNhbGMoJHtlbGVtZW50U2l6ZX0lIC0gJHtndXR0ZXJTaXplICsgU1FMX0VESVRPUl9HVVRURVJfTUFSR0lOfXB4KWAsXG59KTtcbmNvbnN0IFNxbEVkaXRvciA9ICh7IHF1ZXJ5RWRpdG9yLCBkZWZhdWx0UXVlcnlMaW1pdCwgbWF4Um93LCBkaXNwbGF5TGltaXQsIHNhdmVRdWVyeVdhcm5pbmcsIHNjaGVkdWxlUXVlcnlXYXJuaW5nLCB9KSA9PiB7XG4gICAgY29uc3QgdGhlbWUgPSB1c2VUaGVtZSgpO1xuICAgIGNvbnN0IGRpc3BhdGNoID0gdXNlRGlzcGF0Y2goKTtcbiAgICBjb25zdCB7IGRhdGFiYXNlLCBsYXRlc3RRdWVyeSwgaGlkZUxlZnRCYXIsIGN1cnJlbnRRdWVyeUVkaXRvcklkLCBoYXNTcWxTdGF0ZW1lbnQsIH0gPSB1c2VTZWxlY3RvcigoeyBzcWxMYWI6IHsgdW5zYXZlZFF1ZXJ5RWRpdG9yLCBkYXRhYmFzZXMsIHF1ZXJpZXMsIHRhYkhpc3RvcnkgfSB9KSA9PiB7XG4gICAgICAgIGxldCB7IGRiSWQsIGxhdGVzdFF1ZXJ5SWQsIGhpZGVMZWZ0QmFyIH0gPSBxdWVyeUVkaXRvcjtcbiAgICAgICAgaWYgKHVuc2F2ZWRRdWVyeUVkaXRvcj8uaWQgPT09IHF1ZXJ5RWRpdG9yLmlkKSB7XG4gICAgICAgICAgICBkYklkID0gdW5zYXZlZFF1ZXJ5RWRpdG9yLmRiSWQgfHwgZGJJZDtcbiAgICAgICAgICAgIGxhdGVzdFF1ZXJ5SWQgPSB1bnNhdmVkUXVlcnlFZGl0b3IubGF0ZXN0UXVlcnlJZCB8fCBsYXRlc3RRdWVyeUlkO1xuICAgICAgICAgICAgaGlkZUxlZnRCYXIgPVxuICAgICAgICAgICAgICAgIHR5cGVvZiB1bnNhdmVkUXVlcnlFZGl0b3IuaGlkZUxlZnRCYXIgPT09ICdib29sZWFuJ1xuICAgICAgICAgICAgICAgICAgICA/IHVuc2F2ZWRRdWVyeUVkaXRvci5oaWRlTGVmdEJhclxuICAgICAgICAgICAgICAgICAgICA6IGhpZGVMZWZ0QmFyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBoYXNTcWxTdGF0ZW1lbnQ6IEJvb2xlYW4ocXVlcnlFZGl0b3Iuc3FsPy50cmltKCkubGVuZ3RoID4gMCksXG4gICAgICAgICAgICBkYXRhYmFzZTogZGF0YWJhc2VzW2RiSWQgfHwgJyddLFxuICAgICAgICAgICAgbGF0ZXN0UXVlcnk6IHF1ZXJpZXNbbGF0ZXN0UXVlcnlJZCB8fCAnJ10sXG4gICAgICAgICAgICBoaWRlTGVmdEJhcixcbiAgICAgICAgICAgIGN1cnJlbnRRdWVyeUVkaXRvcklkOiB0YWJIaXN0b3J5LnNsaWNlKC0xKVswXSxcbiAgICAgICAgfTtcbiAgICB9LCBzaGFsbG93RXF1YWwpO1xuICAgIGNvbnN0IGxvZ0FjdGlvbiA9IHVzZUxvZ0FjdGlvbih7IHF1ZXJ5RWRpdG9ySWQ6IHF1ZXJ5RWRpdG9yLmlkIH0pO1xuICAgIGNvbnN0IGlzQWN0aXZlID0gY3VycmVudFF1ZXJ5RWRpdG9ySWQgPT09IHF1ZXJ5RWRpdG9yLmlkO1xuICAgIGNvbnN0IFtoZWlnaHQsIHNldEhlaWdodF0gPSB1c2VTdGF0ZSgwKTtcbiAgICBjb25zdCBbYXV0b3J1biwgc2V0QXV0b3J1bl0gPSB1c2VTdGF0ZShxdWVyeUVkaXRvci5hdXRvcnVuKTtcbiAgICBjb25zdCBbY3Rhcywgc2V0Q3Rhc10gPSB1c2VTdGF0ZSgnJyk7XG4gICAgY29uc3QgW25vcnRoUGVyY2VudCwgc2V0Tm9ydGhQZXJjZW50XSA9IHVzZVN0YXRlKHF1ZXJ5RWRpdG9yLm5vcnRoUGVyY2VudCB8fCBJTklUSUFMX05PUlRIX1BFUkNFTlQpO1xuICAgIGNvbnN0IFtzb3V0aFBlcmNlbnQsIHNldFNvdXRoUGVyY2VudF0gPSB1c2VTdGF0ZShxdWVyeUVkaXRvci5zb3V0aFBlcmNlbnQgfHwgSU5JVElBTF9TT1VUSF9QRVJDRU5UKTtcbiAgICBjb25zdCBbYXV0b2NvbXBsZXRlRW5hYmxlZCwgc2V0QXV0b2NvbXBsZXRlRW5hYmxlZF0gPSB1c2VTdGF0ZShnZXRJdGVtKExvY2FsU3RvcmFnZUtleXMuU3FsbGFiSXNBdXRvY29tcGxldGVFbmFibGVkLCB0cnVlKSk7XG4gICAgY29uc3QgW3JlbmRlckhUTUxFbmFibGVkLCBzZXRSZW5kZXJIVE1MRW5hYmxlZF0gPSB1c2VTdGF0ZShnZXRJdGVtKExvY2FsU3RvcmFnZUtleXMuU3FsbGFiSXNSZW5kZXJIdG1sRW5hYmxlZCwgdHJ1ZSkpO1xuICAgIGNvbnN0IFtzaG93Q3JlYXRlQXNNb2RhbCwgc2V0U2hvd0NyZWF0ZUFzTW9kYWxdID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IFtjcmVhdGVBcywgc2V0Q3JlYXRlQXNdID0gdXNlU3RhdGUoJycpO1xuICAgIGNvbnN0IHNob3dFbXB0eVN0YXRlID0gdXNlTWVtbygoKSA9PiAhZGF0YWJhc2UgfHwgaXNFbXB0eShkYXRhYmFzZSksIFtkYXRhYmFzZV0pO1xuICAgIGNvbnN0IHNxbEVkaXRvclJlZiA9IHVzZVJlZihudWxsKTtcbiAgICBjb25zdCBub3J0aFBhbmVSZWYgPSB1c2VSZWYobnVsbCk7XG4gICAgY29uc3QgU3FsRm9ybUV4dGVuc2lvbiA9IGV4dGVuc2lvbnNSZWdpc3RyeS5nZXQoJ3NxbGVkaXRvci5leHRlbnNpb24uZm9ybScpO1xuICAgIGNvbnN0IHN0YXJ0UXVlcnkgPSB1c2VDYWxsYmFjaygoY3Rhc0FyZyA9IGZhbHNlLCBjdGFzX21ldGhvZCA9IEN0YXNFbnVtLlRhYmxlKSA9PiB7XG4gICAgICAgIGlmICghZGF0YWJhc2UpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBkaXNwYXRjaChydW5RdWVyeUZyb21TcWxFZGl0b3IoZGF0YWJhc2UsIHF1ZXJ5RWRpdG9yLCBkZWZhdWx0UXVlcnlMaW1pdCwgY3Rhc0FyZyA/IGN0YXMgOiAnJywgY3Rhc0FyZywgY3Rhc19tZXRob2QpKTtcbiAgICAgICAgZGlzcGF0Y2goc2V0QWN0aXZlU291dGhQYW5lVGFiKCdSZXN1bHRzJykpO1xuICAgIH0sIFtjdGFzLCBkYXRhYmFzZSwgZGVmYXVsdFF1ZXJ5TGltaXQsIGRpc3BhdGNoLCBxdWVyeUVkaXRvcl0pO1xuICAgIGNvbnN0IGZvcm1hdEN1cnJlbnRRdWVyeSA9IHVzZUNhbGxiYWNrKCh1c2VTaG9ydGN1dCkgPT4ge1xuICAgICAgICBsb2dBY3Rpb24oTE9HX0FDVElPTlNfU1FMTEFCX0ZPUk1BVF9TUUwsIHtcbiAgICAgICAgICAgIHNob3J0Y3V0OiBCb29sZWFuKHVzZVNob3J0Y3V0KSxcbiAgICAgICAgfSk7XG4gICAgICAgIGRpc3BhdGNoKGZvcm1hdFF1ZXJ5KHF1ZXJ5RWRpdG9yKSk7XG4gICAgfSwgW2Rpc3BhdGNoLCBxdWVyeUVkaXRvciwgbG9nQWN0aW9uXSk7XG4gICAgY29uc3Qgc3RvcFF1ZXJ5ID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgICBpZiAobGF0ZXN0UXVlcnkgJiYgWydydW5uaW5nJywgJ3BlbmRpbmcnXS5pbmRleE9mKGxhdGVzdFF1ZXJ5LnN0YXRlKSA+PSAwKSB7XG4gICAgICAgICAgICBkaXNwYXRjaChwb3N0U3RvcFF1ZXJ5KGxhdGVzdFF1ZXJ5KSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sIFtkaXNwYXRjaCwgbGF0ZXN0UXVlcnldKTtcbiAgICBjb25zdCBydW5RdWVyeSA9ICgpID0+IHtcbiAgICAgICAgaWYgKGRhdGFiYXNlKSB7XG4gICAgICAgICAgICBzdGFydFF1ZXJ5KCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmIChhdXRvcnVuKSB7XG4gICAgICAgICAgICBzZXRBdXRvcnVuKGZhbHNlKTtcbiAgICAgICAgICAgIGRpc3BhdGNoKHF1ZXJ5RWRpdG9yU2V0QXV0b3J1bihxdWVyeUVkaXRvciwgZmFsc2UpKTtcbiAgICAgICAgICAgIHN0YXJ0UXVlcnkoKTtcbiAgICAgICAgfVxuICAgIH0sIFthdXRvcnVuLCBkaXNwYXRjaCwgcXVlcnlFZGl0b3IsIHN0YXJ0UXVlcnldKTtcbiAgICAvLyBPbmUgbGF5ZXIgb2YgYWJzdHJhY3Rpb24gZm9yIGVhc3kgc3B5aW5nIGluIHVuaXQgdGVzdHNcbiAgICBjb25zdCBnZXRTcWxFZGl0b3JIZWlnaHQgPSAoKSA9PiBzcWxFZGl0b3JSZWYuY3VycmVudFxuICAgICAgICA/IHNxbEVkaXRvclJlZi5jdXJyZW50LmNsaWVudEhlaWdodCAtIFNRTF9FRElUT1JfUEFERElORyAqIDJcbiAgICAgICAgOiAwO1xuICAgIGNvbnN0IGdldEhvdGtleUNvbmZpZyA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgICAgLy8gR2V0IHRoZSB1c2VyJ3MgT1NcbiAgICAgICAgY29uc3QgdXNlck9TID0gZGV0ZWN0T1MoKTtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAncnVuUXVlcnkxJyxcbiAgICAgICAgICAgICAgICBrZXk6IEtleWJvYXJkU2hvcnRjdXQuQ3RybFIsXG4gICAgICAgICAgICAgICAgZGVzY3I6IEtFWV9NQVBbS2V5Ym9hcmRTaG9ydGN1dC5DdHJsUl0sXG4gICAgICAgICAgICAgICAgZnVuYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXVlcnlFZGl0b3Iuc3FsLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0FjdGlvbihMT0dfQUNUSU9OU19TUUxMQUJfUlVOX1FVRVJZLCB7IHNob3J0Y3V0OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRRdWVyeSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3J1blF1ZXJ5MicsXG4gICAgICAgICAgICAgICAga2V5OiBLZXlib2FyZFNob3J0Y3V0LkN0cmxFbnRlcixcbiAgICAgICAgICAgICAgICBkZXNjcjogS0VZX01BUFtLZXlib2FyZFNob3J0Y3V0LkN0cmxFbnRlcl0sXG4gICAgICAgICAgICAgICAgZnVuYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocXVlcnlFZGl0b3Iuc3FsLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0FjdGlvbihMT0dfQUNUSU9OU19TUUxMQUJfUlVOX1FVRVJZLCB7IHNob3J0Y3V0OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRRdWVyeSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ25ld1RhYicsXG4gICAgICAgICAgICAgICAgLi4uKHVzZXJPUyA9PT0gJ1dpbmRvd3MnXG4gICAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBLZXlib2FyZFNob3J0Y3V0LkN0cmxRLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3I6IEtFWV9NQVBbS2V5Ym9hcmRTaG9ydGN1dC5DdHJsUV0sXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6IEtleWJvYXJkU2hvcnRjdXQuQ3RybFQsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcjogS0VZX01BUFtLZXlib2FyZFNob3J0Y3V0LkN0cmxUXSxcbiAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgZnVuYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBMb2dnZXIubWFya1RpbWVPcmlnaW4oKTtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2goYWRkTmV3UXVlcnlFZGl0b3IoKSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3N0b3BRdWVyeScsXG4gICAgICAgICAgICAgICAgLi4uKHVzZXJPUyA9PT0gJ01hY09TJ1xuICAgICAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleTogS2V5Ym9hcmRTaG9ydGN1dC5DdHJsWCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyOiBLRVlfTUFQW0tleWJvYXJkU2hvcnRjdXQuQ3RybFhdLFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBLZXlib2FyZFNob3J0Y3V0LkN0cmxFLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3I6IEtFWV9NQVBbS2V5Ym9hcmRTaG9ydGN1dC5DdHJsRV0sXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGZ1bmM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbG9nQWN0aW9uKExPR19BQ1RJT05TX1NRTExBQl9TVE9QX1FVRVJZLCB7IHNob3J0Y3V0OiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgICBzdG9wUXVlcnkoKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZm9ybWF0UXVlcnknLFxuICAgICAgICAgICAgICAgIGtleTogS2V5Ym9hcmRTaG9ydGN1dC5DdHJsU2hpZnRGLFxuICAgICAgICAgICAgICAgIGRlc2NyOiBLRVlfTUFQW0tleWJvYXJkU2hvcnRjdXQuQ3RybFNoaWZ0Rl0sXG4gICAgICAgICAgICAgICAgZnVuYzogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBmb3JtYXRDdXJyZW50UXVlcnkodHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3N3aXRjaFRhYlRvTGVmdCcsXG4gICAgICAgICAgICAgICAga2V5OiBLZXlib2FyZFNob3J0Y3V0LkN0cmxMZWZ0LFxuICAgICAgICAgICAgICAgIGRlc2NyOiBLRVlfTUFQW0tleWJvYXJkU2hvcnRjdXQuQ3RybExlZnRdLFxuICAgICAgICAgICAgICAgIGZ1bmM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2goc3dpdGNoUXVlcnlFZGl0b3IodHJ1ZSkpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdzd2l0Y2hUYWJUb1JpZ2h0JyxcbiAgICAgICAgICAgICAgICBrZXk6IEtleWJvYXJkU2hvcnRjdXQuQ3RybFJpZ2h0LFxuICAgICAgICAgICAgICAgIGRlc2NyOiBLRVlfTUFQW0tleWJvYXJkU2hvcnRjdXQuQ3RybFJpZ2h0XSxcbiAgICAgICAgICAgICAgICBmdW5jOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoKHN3aXRjaFF1ZXJ5RWRpdG9yKGZhbHNlKSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF07XG4gICAgfSwgW2Rpc3BhdGNoLCBxdWVyeUVkaXRvci5zcWwsIHN0YXJ0UXVlcnksIHN0b3BRdWVyeSwgZm9ybWF0Q3VycmVudFF1ZXJ5XSk7XG4gICAgY29uc3QgaG90a2V5cyA9IHVzZU1lbW8oKCkgPT4ge1xuICAgICAgICAvLyBHZXQgYWxsIGhvdGtleXMgaW5jbHVkaW5nIGFjZSBlZGl0b3IgaG90a2V5c1xuICAgICAgICAvLyBHZXQgdGhlIHVzZXIncyBPU1xuICAgICAgICBjb25zdCB1c2VyT1MgPSBkZXRlY3RPUygpO1xuICAgICAgICBjb25zdCBiYXNlID0gW1xuICAgICAgICAgICAgLi4uZ2V0SG90a2V5Q29uZmlnKCksXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3J1blF1ZXJ5MycsXG4gICAgICAgICAgICAgICAga2V5OiBLZXlib2FyZFNob3J0Y3V0LkN0cmxTaGlmdEVudGVyLFxuICAgICAgICAgICAgICAgIGRlc2NyOiBLRVlfTUFQW0tleWJvYXJkU2hvcnRjdXQuQ3RybFNoaWZ0RW50ZXJdLFxuICAgICAgICAgICAgICAgIGZ1bmM6IChlZGl0b3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlZGl0b3IuZ2V0VmFsdWUoKS50cmltKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzZXNzaW9uID0gZWRpdG9yLmdldFNlc3Npb24oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3Vyc29yUG9zaXRpb24gPSBlZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxMaW5lID0gc2Vzc2lvbi5nZXRMZW5ndGgoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFJvdyA9IGVkaXRvci5nZXRGaXJzdFZpc2libGVSb3coKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VtaWNvbG9uRW5kID0gZWRpdG9yLmZpbmQoJzsnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrd2FyZHM6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2tpcEN1cnJlbnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBsZXQgZW5kO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VtaWNvbG9uRW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAoeyBlbmQgfSA9IHNlbWljb2xvbkVuZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlbmQgfHwgZW5kLnJvdyA8IGN1cnNvclBvc2l0aW9uLnJvdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5kID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdzogdG90YWxMaW5lICsgMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbWljb2xvblN0YXJ0ID0gZWRpdG9yLmZpbmQoJzsnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrd2FyZHM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBza2lwQ3VycmVudDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGxldCBzdGFydDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbWljb2xvblN0YXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IHNlbWljb2xvblN0YXJ0LmVuZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsZXQgY3VycmVudExpbmUgPSBzdGFydD8ucm93O1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRMaW5lIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZSA+IGN1cnNvclBvc2l0aW9uLnJvdyB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgKGN1cnJlbnRMaW5lID09PSBjdXJzb3JQb3NpdGlvbi5yb3cgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc3RhcnQ/LmNvbHVtbiB8fCAwKSA+IGN1cnNvclBvc2l0aW9uLmNvbHVtbikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsZXQgY29udGVudCA9IGN1cnJlbnRMaW5lID09PSBzdGFydD8ucm93XG4gICAgICAgICAgICAgICAgICAgICAgICA/IHNlc3Npb24uZ2V0TGluZShjdXJyZW50TGluZSkuc2xpY2Uoc3RhcnQuY29sdW1uKS50cmltKClcbiAgICAgICAgICAgICAgICAgICAgICAgIDogc2Vzc2lvbi5nZXRMaW5lKGN1cnJlbnRMaW5lKS50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICghY29udGVudCAmJiBjdXJyZW50TGluZSA8IHRvdGFsTGluZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExpbmUgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBzZXNzaW9uLmdldExpbmUoY3VycmVudExpbmUpLnRyaW0oKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudExpbmUgIT09IHN0YXJ0Py5yb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0geyByb3c6IGN1cnJlbnRMaW5lLCBjb2x1bW46IDAgfTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNldFNlbGVjdGlvblJhbmdlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzdGFydCA/PyB7IHJvdzogMCwgY29sdW1uOiAwIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmQsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBzdGFydFF1ZXJ5KCk7XG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5zZWxlY3Rpb24uY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLm1vdmVDdXJzb3JUb1Bvc2l0aW9uKGN1cnNvclBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnNjcm9sbFRvUm93KGN1cnJlbnRSb3cpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICBdO1xuICAgICAgICBpZiAodXNlck9TID09PSAnTWFjT1MnKSB7XG4gICAgICAgICAgICBiYXNlLnB1c2goe1xuICAgICAgICAgICAgICAgIG5hbWU6ICdwcmV2aW91c0xpbmUnLFxuICAgICAgICAgICAgICAgIGtleTogS2V5Ym9hcmRTaG9ydGN1dC5DdHJsUCxcbiAgICAgICAgICAgICAgICBkZXNjcjogS0VZX01BUFtLZXlib2FyZFNob3J0Y3V0LkN0cmxQXSxcbiAgICAgICAgICAgICAgICBmdW5jOiBlZGl0b3IgPT4ge1xuICAgICAgICAgICAgICAgICAgICBlZGl0b3IubmF2aWdhdGVVcCgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYmFzZTtcbiAgICB9LCBbZ2V0SG90a2V5Q29uZmlnLCBzdGFydFF1ZXJ5XSk7XG4gICAgY29uc3Qgb25CZWZvcmVVbmxvYWQgPSB1c2VFZmZlY3RFdmVudChldmVudCA9PiB7XG4gICAgICAgIGlmIChkYXRhYmFzZT8uZXh0cmFfanNvbj8uY2FuY2VsX3F1ZXJ5X29uX3dpbmRvd3NfdW5sb2FkICYmXG4gICAgICAgICAgICBsYXRlc3RRdWVyeT8uc3RhdGUgPT09ICdydW5uaW5nJykge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHN0b3BRdWVyeSgpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgY29uc3Qgc2hvdWxkTG9hZFF1ZXJ5RWRpdG9yID0gaXNGZWF0dXJlRW5hYmxlZChGZWF0dXJlRmxhZy5TcWxsYWJCYWNrZW5kUGVyc2lzdGVuY2UpICYmXG4gICAgICAgICFxdWVyeUVkaXRvci5sb2FkZWQ7XG4gICAgY29uc3QgbG9hZFF1ZXJ5RWRpdG9yID0gdXNlRWZmZWN0RXZlbnQoKCkgPT4ge1xuICAgICAgICBjb25zdCBkdXJhdGlvbiA9IExvZ2dlci5nZXRUaW1lc3RhbXAoKTtcbiAgICAgICAgbG9nQWN0aW9uKExPR19BQ1RJT05TX1NRTExBQl9MT0FEX1RBQl9TVEFURSwge1xuICAgICAgICAgICAgZHVyYXRpb24sXG4gICAgICAgICAgICBxdWVyeUVkaXRvcklkOiBxdWVyeUVkaXRvci5pZCxcbiAgICAgICAgICAgIGluTG9jYWxTdG9yYWdlOiBCb29sZWFuKHF1ZXJ5RWRpdG9yLmluTG9jYWxTdG9yYWdlKSxcbiAgICAgICAgICAgIGhhc0xvYWRlZDogIXNob3VsZExvYWRRdWVyeUVkaXRvcixcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChzaG91bGRMb2FkUXVlcnlFZGl0b3IpIHtcbiAgICAgICAgICAgIGRpc3BhdGNoKGZldGNoUXVlcnlFZGl0b3IocXVlcnlFZGl0b3IsIGRpc3BsYXlMaW1pdCkpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgLy8gV2UgbmVlZCB0byBtZWFzdXJlIHRoZSBoZWlnaHQgb2YgdGhlIHNxbCBlZGl0b3IgcG9zdCByZW5kZXIgdG8gZmlndXJlIHRoZSBoZWlnaHQgb2ZcbiAgICAgICAgLy8gdGhlIHNvdXRoIHBhbmUgc28gaXQgZ2V0cyByZW5kZXJlZCBwcm9wZXJseVxuICAgICAgICBzZXRIZWlnaHQoZ2V0U3FsRWRpdG9ySGVpZ2h0KCkpO1xuICAgICAgICBjb25zdCBoYW5kbGVXaW5kb3dSZXNpemVXaXRoVGhyb3R0bGUgPSB0aHJvdHRsZSgoKSA9PiBzZXRIZWlnaHQoZ2V0U3FsRWRpdG9ySGVpZ2h0KCkpLCBXSU5ET1dfUkVTSVpFX1RIUk9UVExFX01TKTtcbiAgICAgICAgaWYgKGlzQWN0aXZlKSB7XG4gICAgICAgICAgICBsb2FkUXVlcnlFZGl0b3IoKTtcbiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBoYW5kbGVXaW5kb3dSZXNpemVXaXRoVGhyb3R0bGUpO1xuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIG9uQmVmb3JlVW5sb2FkKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGhhbmRsZVdpbmRvd1Jlc2l6ZVdpdGhUaHJvdHRsZSk7XG4gICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgb25CZWZvcmVVbmxvYWQpO1xuICAgICAgICB9O1xuICAgICAgICAvLyBUT0RPOiBSZW1vdmUgdXNlRWZmZWN0RXZlbnQgZGVwcyBvbmNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWFjdC9wdWxsLzI1ODgxIGlzIHJlbGVhc2VkXG4gICAgfSwgW29uQmVmb3JlVW5sb2FkLCBsb2FkUXVlcnlFZGl0b3IsIGlzQWN0aXZlXSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgLy8gc2V0dXAgaG90a2V5c1xuICAgICAgICBjb25zdCBob3RrZXlzID0gZ2V0SG90a2V5Q29uZmlnKCk7XG4gICAgICAgIGlmIChpc0FjdGl2ZSkge1xuICAgICAgICAgICAgLy8gTW91c2VUcmFwIGFsd2F5cyBvdmVycmlkZSB0aGUgc2FtZSBrZXlcbiAgICAgICAgICAgIC8vIFVuYmluZCAocmVzZXQpIHdpbGwgYmUgY2FsbGVkIHdoZW4gQXBwIGNvbXBvbmVudCB1bm1vdW50XG4gICAgICAgICAgICBob3RrZXlzLmZvckVhY2goa2V5Q29uZmlnID0+IHtcbiAgICAgICAgICAgICAgICBNb3VzZXRyYXAuYmluZChba2V5Q29uZmlnLmtleV0sIGtleUNvbmZpZy5mdW5jKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSwgW2dldEhvdGtleUNvbmZpZywgbGF0ZXN0UXVlcnksIGlzQWN0aXZlXSk7XG4gICAgY29uc3Qgb25SZXNpemVTdGFydCA9ICgpID0+IHtcbiAgICAgICAgLy8gU2V0IHRoZSBoZWlnaHRzIG9uIHRoZSBhY2UgZWRpdG9yIGFuZCB0aGUgYWNlIGNvbnRlbnQgYXJlYSBhZnRlciBkcmFnIHN0YXJ0c1xuICAgICAgICAvLyB0byBzbW9vdGggb3V0IHRoZSB2aXN1YWwgdHJhbnNpdGlvbiB0byB0aGUgbmV3IGhlaWdodHMgd2hlbiBkcmFnIGVuZHNcbiAgICAgICAgY29uc3QgZWRpdG9yRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdhY2VfY29udGVudCcpWzBdO1xuICAgICAgICBpZiAoZWRpdG9yRWwpIHtcbiAgICAgICAgICAgIGVkaXRvckVsLnN0eWxlLmhlaWdodCA9ICcxMDAlJztcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3Qgb25SZXNpemVFbmQgPSAoW25vcnRoUGVyY2VudCwgc291dGhQZXJjZW50XSkgPT4ge1xuICAgICAgICBzZXROb3J0aFBlcmNlbnQobm9ydGhQZXJjZW50KTtcbiAgICAgICAgc2V0U291dGhQZXJjZW50KHNvdXRoUGVyY2VudCk7XG4gICAgICAgIGlmIChub3J0aFBhbmVSZWYuY3VycmVudD8uY2xpZW50SGVpZ2h0KSB7XG4gICAgICAgICAgICBkaXNwYXRjaChwZXJzaXN0RWRpdG9ySGVpZ2h0KHF1ZXJ5RWRpdG9yLCBub3J0aFBlcmNlbnQsIHNvdXRoUGVyY2VudCkpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBzZXRRdWVyeUVkaXRvckFuZFNhdmVTcWwgPSB1c2VDYWxsYmFjayhzcWwgPT4ge1xuICAgICAgICBkaXNwYXRjaChxdWVyeUVkaXRvclNldEFuZFNhdmVTcWwocXVlcnlFZGl0b3IsIHNxbCkpO1xuICAgIH0sIFtkaXNwYXRjaCwgcXVlcnlFZGl0b3JdKTtcbiAgICBjb25zdCBzZXRRdWVyeUVkaXRvckFuZFNhdmVTcWxXaXRoRGVib3VuY2UgPSB1c2VNZW1vKCgpID0+IGRlYm91bmNlKHNldFF1ZXJ5RWRpdG9yQW5kU2F2ZVNxbCwgU0VUX1FVRVJZX0VESVRPUl9TUUxfREVCT1VOQ0VfTVMpLCBbc2V0UXVlcnlFZGl0b3JBbmRTYXZlU3FsXSk7XG4gICAgY29uc3Qgb25TcWxDaGFuZ2VkID0gdXNlRWZmZWN0RXZlbnQoKHNxbCkgPT4ge1xuICAgICAgICBkaXNwYXRjaChxdWVyeUVkaXRvclNldFNxbChxdWVyeUVkaXRvciwgc3FsKSk7XG4gICAgfSk7XG4gICAgLy8gUmV0dXJuIHRoZSBoZWlnaHRzIGZvciB0aGUgYWNlIGVkaXRvciBhbmQgdGhlIHNvdXRoIHBhbmUgYXMgYW4gb2JqZWN0XG4gICAgLy8gZ2l2ZW4gdGhlIGhlaWdodCBvZiB0aGUgc3FsIGVkaXRvciwgbm9ydGggcGFuZSBwZXJjZW50IGFuZCBzb3V0aCBwYW5lIHBlcmNlbnQuXG4gICAgY29uc3QgZ2V0QWNlRWRpdG9yQW5kU291dGhQYW5lSGVpZ2h0cyA9IChoZWlnaHQsIG5vcnRoUGVyY2VudCwgc291dGhQZXJjZW50KSA9PiAoe1xuICAgICAgICBhY2VFZGl0b3JIZWlnaHQ6IChoZWlnaHQgKiBub3J0aFBlcmNlbnQpIC8gKHRoZW1lLmdyaWRVbml0ICogMjUpIC1cbiAgICAgICAgICAgIChTUUxfRURJVE9SX0dVVFRFUl9IRUlHSFQgLyAyICsgU1FMX0VESVRPUl9HVVRURVJfTUFSR0lOKSAtXG4gICAgICAgICAgICBTUUxfVE9PTEJBUl9IRUlHSFQsXG4gICAgICAgIHNvdXRoUGFuZUhlaWdodDogKGhlaWdodCAqIHNvdXRoUGVyY2VudCkgLyAodGhlbWUuZ3JpZFVuaXQgKiAyNSkgLVxuICAgICAgICAgICAgKFNRTF9FRElUT1JfR1VUVEVSX0hFSUdIVCAvIDIgKyBTUUxfRURJVE9SX0dVVFRFUl9NQVJHSU4pLFxuICAgIH0pO1xuICAgIGNvbnN0IGdldFF1ZXJ5Q29zdEVzdGltYXRlID0gKCkgPT4ge1xuICAgICAgICBsb2dBY3Rpb24oTE9HX0FDVElPTlNfU1FMTEFCX0VTVElNQVRFX1FVRVJZX0NPU1QsIHsgc2hvcnRjdXQ6IGZhbHNlIH0pO1xuICAgICAgICBpZiAoZGF0YWJhc2UpIHtcbiAgICAgICAgICAgIGRpc3BhdGNoKGVzdGltYXRlUXVlcnlDb3N0KHF1ZXJ5RWRpdG9yKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGhhbmRsZVRvZ2dsZUF1dG9jb21wbGV0ZUVuYWJsZWQgPSAoKSA9PiB7XG4gICAgICAgIHNldEl0ZW0oTG9jYWxTdG9yYWdlS2V5cy5TcWxsYWJJc0F1dG9jb21wbGV0ZUVuYWJsZWQsICFhdXRvY29tcGxldGVFbmFibGVkKTtcbiAgICAgICAgc2V0QXV0b2NvbXBsZXRlRW5hYmxlZCghYXV0b2NvbXBsZXRlRW5hYmxlZCk7XG4gICAgfTtcbiAgICBjb25zdCBoYW5kbGVUb2dnbGVSZW5kZXJIVE1MRW5hYmxlZCA9ICgpID0+IHtcbiAgICAgICAgc2V0SXRlbShMb2NhbFN0b3JhZ2VLZXlzLlNxbGxhYklzUmVuZGVySHRtbEVuYWJsZWQsICFyZW5kZXJIVE1MRW5hYmxlZCk7XG4gICAgICAgIHNldFJlbmRlckhUTUxFbmFibGVkKCFyZW5kZXJIVE1MRW5hYmxlZCk7XG4gICAgfTtcbiAgICBjb25zdCBjcmVhdGVUYWJsZUFzID0gKCkgPT4ge1xuICAgICAgICBzdGFydFF1ZXJ5KHRydWUsIEN0YXNFbnVtLlRhYmxlKTtcbiAgICAgICAgc2V0U2hvd0NyZWF0ZUFzTW9kYWwoZmFsc2UpO1xuICAgICAgICBzZXRDdGFzKCcnKTtcbiAgICB9O1xuICAgIGNvbnN0IGNyZWF0ZVZpZXdBcyA9ICgpID0+IHtcbiAgICAgICAgc3RhcnRRdWVyeSh0cnVlLCBDdGFzRW51bS5WaWV3KTtcbiAgICAgICAgc2V0U2hvd0NyZWF0ZUFzTW9kYWwoZmFsc2UpO1xuICAgICAgICBzZXRDdGFzKCcnKTtcbiAgICB9O1xuICAgIGNvbnN0IGN0YXNDaGFuZ2VkID0gKGV2ZW50KSA9PiB7XG4gICAgICAgIHNldEN0YXMoZXZlbnQudGFyZ2V0LnZhbHVlKTtcbiAgICB9O1xuICAgIGNvbnN0IHJlbmRlckRyb3Bkb3duID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBxZSA9IHF1ZXJ5RWRpdG9yO1xuICAgICAgICBjb25zdCBzdWNjZXNzZnVsID0gbGF0ZXN0UXVlcnk/LnN0YXRlID09PSAnc3VjY2Vzcyc7XG4gICAgICAgIGNvbnN0IHNjaGVkdWxlVG9vbFRpcCA9IHN1Y2Nlc3NmdWxcbiAgICAgICAgICAgID8gdCgnU2NoZWR1bGUgdGhlIHF1ZXJ5IHBlcmlvZGljYWxseScpXG4gICAgICAgICAgICA6IHQoJ1lvdSBtdXN0IHJ1biB0aGUgcXVlcnkgc3VjY2Vzc2Z1bGx5IGZpcnN0Jyk7XG4gICAgICAgIHJldHVybiAoPE1lbnUgY3NzPXt7IHdpZHRoOiB0aGVtZS5ncmlkVW5pdCAqIDUwIH19PlxuICAgICAgICA8TWVudS5JdGVtIGNzcz17eyBkaXNwbGF5OiAnZmxleCcsIGp1c3RpZnlDb250ZW50OiAnc3BhY2UtYmV0d2VlbicgfX0+XG4gICAgICAgICAgeycgJ31cbiAgICAgICAgICA8c3Bhbj57dCgnUmVuZGVyIEhUTUwnKX08L3NwYW4+eycgJ31cbiAgICAgICAgICA8U3dpdGNoIGNoZWNrZWQ9e3JlbmRlckhUTUxFbmFibGVkfSBvbkNoYW5nZT17aGFuZGxlVG9nZ2xlUmVuZGVySFRNTEVuYWJsZWR9Lz57JyAnfVxuICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgICAgPE1lbnUuSXRlbSBjc3M9e3sgZGlzcGxheTogJ2ZsZXgnLCBqdXN0aWZ5Q29udGVudDogJ3NwYWNlLWJldHdlZW4nIH19PlxuICAgICAgICAgIHsnICd9XG4gICAgICAgICAgPHNwYW4+e3QoJ0F1dG9jb21wbGV0ZScpfTwvc3Bhbj57JyAnfVxuICAgICAgICAgIDxTd2l0Y2ggY2hlY2tlZD17YXV0b2NvbXBsZXRlRW5hYmxlZH0gb25DaGFuZ2U9e2hhbmRsZVRvZ2dsZUF1dG9jb21wbGV0ZUVuYWJsZWR9Lz57JyAnfVxuICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgICAge2lzRmVhdHVyZUVuYWJsZWQoRmVhdHVyZUZsYWcuRW5hYmxlVGVtcGxhdGVQcm9jZXNzaW5nKSAmJiAoPE1lbnUuSXRlbT5cbiAgICAgICAgICAgIDxUZW1wbGF0ZVBhcmFtc0VkaXRvciBsYW5ndWFnZT1cImpzb25cIiBvbkNoYW5nZT17cGFyYW1zID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2gocXVlcnlFZGl0b3JTZXRUZW1wbGF0ZVBhcmFtcyhxZSwgcGFyYW1zKSk7XG4gICAgICAgICAgICAgICAgfX0gcXVlcnlFZGl0b3JJZD17cWUuaWR9Lz5cbiAgICAgICAgICA8L01lbnUuSXRlbT4pfVxuICAgICAgICA8TWVudS5JdGVtIG9uQ2xpY2s9eygpID0+IGZvcm1hdEN1cnJlbnRRdWVyeSgpfT5cbiAgICAgICAgICB7dCgnRm9ybWF0IFNRTCcpfVxuICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgICAgeyFpc0VtcHR5KHNjaGVkdWxlZFF1ZXJpZXNDb25mKSAmJiAoPE1lbnUuSXRlbT5cbiAgICAgICAgICAgIDxTY2hlZHVsZVF1ZXJ5QnV0dG9uIGRlZmF1bHRMYWJlbD17cWUubmFtZX0gc3FsPXtxZS5zcWx9IG9uU2NoZWR1bGU9eyhxdWVyeSkgPT4gZGlzcGF0Y2goc2NoZWR1bGVRdWVyeShxdWVyeSkpfSBzY2hlbWE9e3FlLnNjaGVtYX0gZGJJZD17cWUuZGJJZH0gc2NoZWR1bGVRdWVyeVdhcm5pbmc9e3NjaGVkdWxlUXVlcnlXYXJuaW5nfSB0b29sdGlwPXtzY2hlZHVsZVRvb2xUaXB9IGRpc2FibGVkPXshc3VjY2Vzc2Z1bH0vPlxuICAgICAgICAgIDwvTWVudS5JdGVtPil9XG4gICAgICAgIDxNZW51Lkl0ZW0+XG4gICAgICAgICAgPEtleWJvYXJkU2hvcnRjdXRCdXR0b24+XG4gICAgICAgICAgICB7dCgnS2V5Ym9hcmQgc2hvcnRjdXRzJyl9XG4gICAgICAgICAgPC9LZXlib2FyZFNob3J0Y3V0QnV0dG9uPlxuICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgIDwvTWVudT4pO1xuICAgIH07XG4gICAgY29uc3Qgb25TYXZlUXVlcnkgPSBhc3luYyAocXVlcnksIGNsaWVudElkKSA9PiB7XG4gICAgICAgIGNvbnN0IHNhdmVkUXVlcnkgPSBhd2FpdCBkaXNwYXRjaChzYXZlUXVlcnkocXVlcnksIGNsaWVudElkKSk7XG4gICAgICAgIGRpc3BhdGNoKGFkZFNhdmVkUXVlcnlUb1RhYlN0YXRlKHF1ZXJ5RWRpdG9yLCBzYXZlZFF1ZXJ5KSk7XG4gICAgfTtcbiAgICBjb25zdCByZW5kZXJFZGl0b3JCb3R0b21CYXIgPSAoaGlkZUFjdGlvbnMpID0+IHtcbiAgICAgICAgY29uc3QgeyBhbGxvd19jdGFzOiBhbGxvd0NUQVMsIGFsbG93X2N2YXM6IGFsbG93Q1ZBUyB9ID0gZGF0YWJhc2UgfHwge307XG4gICAgICAgIGNvbnN0IHNob3dNZW51ID0gYWxsb3dDVEFTIHx8IGFsbG93Q1ZBUztcbiAgICAgICAgY29uc3QgcnVuTWVudUJ0biA9ICg8TWVudT5cbiAgICAgICAge2FsbG93Q1RBUyAmJiAoPE1lbnUuSXRlbSBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxvZ0FjdGlvbihMT0dfQUNUSU9OU19TUUxMQUJfQ1JFQVRFX1RBQkxFX0FTLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaG9ydGN1dDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBzZXRTaG93Q3JlYXRlQXNNb2RhbCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgc2V0Q3JlYXRlQXMoQ3Rhc0VudW0uVGFibGUpO1xuICAgICAgICAgICAgICAgIH19IGtleT1cIjFcIj5cbiAgICAgICAgICAgIHt0KCdDUkVBVEUgVEFCTEUgQVMnKX1cbiAgICAgICAgICA8L01lbnUuSXRlbT4pfVxuICAgICAgICB7YWxsb3dDVkFTICYmICg8TWVudS5JdGVtIG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbG9nQWN0aW9uKExPR19BQ1RJT05TX1NRTExBQl9DUkVBVEVfVklFV19BUywge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnRjdXQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgc2V0U2hvd0NyZWF0ZUFzTW9kYWwodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHNldENyZWF0ZUFzKEN0YXNFbnVtLlZpZXcpO1xuICAgICAgICAgICAgICAgIH19IGtleT1cIjJcIj5cbiAgICAgICAgICAgIHt0KCdDUkVBVEUgVklFVyBBUycpfVxuICAgICAgICAgIDwvTWVudS5JdGVtPil9XG4gICAgICA8L01lbnU+KTtcbiAgICAgICAgcmV0dXJuICg8U3R5bGVkVG9vbGJhciBjbGFzc05hbWU9XCJzcWwtdG9vbGJhclwiIGlkPVwianMtc3FsLXRvb2xiYXJcIj5cbiAgICAgICAge2hpZGVBY3Rpb25zID8gKDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG1lc3NhZ2U9e3QoJ1RoZSBkYXRhYmFzZSB0aGF0IHdhcyB1c2VkIHRvIGdlbmVyYXRlIHRoaXMgcXVlcnkgY291bGQgbm90IGJlIGZvdW5kJyl9IGRlc2NyaXB0aW9uPXt0KCdDaG9vc2Ugb25lIG9mIHRoZSBhdmFpbGFibGUgZGF0YWJhc2VzIG9uIHRoZSBsZWZ0IHBhbmVsLicpfSBjbG9zYWJsZT17ZmFsc2V9Lz4pIDogKDw+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxlZnRJdGVtc1wiPlxuICAgICAgICAgICAgICA8c3Bhbj5cbiAgICAgICAgICAgICAgICA8UnVuUXVlcnlBY3Rpb25CdXR0b24gYWxsb3dBc3luYz17ZGF0YWJhc2U/LmFsbG93X3J1bl9hc3luYyA9PT0gdHJ1ZX0gcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9IHF1ZXJ5U3RhdGU9e2xhdGVzdFF1ZXJ5Py5zdGF0ZX0gcnVuUXVlcnk9e3J1blF1ZXJ5fSBzdG9wUXVlcnk9e3N0b3BRdWVyeX0gb3ZlcmxheUNyZWF0ZUFzTWVudT17c2hvd01lbnUgPyBydW5NZW51QnRuIDogbnVsbH0vPlxuICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgIHtpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLkVzdGltYXRlUXVlcnlDb3N0KSAmJlxuICAgICAgICAgICAgICAgICAgICBkYXRhYmFzZT8uYWxsb3dzX2Nvc3RfZXN0aW1hdGUgJiYgKDxzcGFuPlxuICAgICAgICAgICAgICAgICAgICA8RXN0aW1hdGVRdWVyeUNvc3RCdXR0b24gZ2V0RXN0aW1hdGU9e2dldFF1ZXJ5Q29zdEVzdGltYXRlfSBxdWVyeUVkaXRvcklkPXtxdWVyeUVkaXRvci5pZH0gdG9vbHRpcD17dCgnRXN0aW1hdGUgdGhlIGNvc3QgYmVmb3JlIHJ1bm5pbmcgYSBxdWVyeScpfS8+XG4gICAgICAgICAgICAgICAgICA8L3NwYW4+KX1cbiAgICAgICAgICAgICAgPHNwYW4+XG4gICAgICAgICAgICAgICAgPFF1ZXJ5TGltaXRTZWxlY3QgcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9IG1heFJvdz17bWF4Um93fSBkZWZhdWx0UXVlcnlMaW1pdD17ZGVmYXVsdFF1ZXJ5TGltaXR9Lz5cbiAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICB7bGF0ZXN0UXVlcnkgJiYgKDxUaW1lciBzdGFydFRpbWU9e2xhdGVzdFF1ZXJ5LnN0YXJ0RHR0bX0gZW5kVGltZT17bGF0ZXN0UXVlcnkuZW5kRHR0bX0gc3RhdHVzPXtTVEFURV9UWVBFX01BUFtsYXRlc3RRdWVyeS5zdGF0ZV19IGlzUnVubmluZz17bGF0ZXN0UXVlcnkuc3RhdGUgPT09ICdydW5uaW5nJ30vPil9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicmlnaHRJdGVtc1wiPlxuICAgICAgICAgICAgICA8c3Bhbj5cbiAgICAgICAgICAgICAgICA8U2F2ZVF1ZXJ5IHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfSBjb2x1bW5zPXtsYXRlc3RRdWVyeT8ucmVzdWx0cz8uY29sdW1ucyB8fCBbXX0gb25TYXZlPXtvblNhdmVRdWVyeX0gb25VcGRhdGU9eyhxdWVyeSwgcmVtb3RlSWQpID0+IGRpc3BhdGNoKHVwZGF0ZVNhdmVkUXVlcnkocXVlcnksIHJlbW90ZUlkKSl9IHNhdmVRdWVyeVdhcm5pbmc9e3NhdmVRdWVyeVdhcm5pbmd9IGRhdGFiYXNlPXtkYXRhYmFzZX0vPlxuICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgIDxzcGFuPlxuICAgICAgICAgICAgICAgIDxTaGFyZVNxbExhYlF1ZXJ5IHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfS8+XG4gICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgPERyb3Bkb3duIGRyb3Bkb3duUmVuZGVyPXsoKSA9PiByZW5kZXJEcm9wZG93bigpfSB0cmlnZ2VyPXtbJ2NsaWNrJ119PlxuICAgICAgICAgICAgICAgIDxCdXR0b24gYnV0dG9uU2l6ZT1cInhzbWFsbFwiIHR5cGU9XCJsaW5rXCIgc2hvd01hcmdpblJpZ2h0PXtmYWxzZX0+XG4gICAgICAgICAgICAgICAgICA8SWNvbnMuRWxsaXBzaXNPdXRsaW5lZCAvPlxuICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICA8L0Ryb3Bkb3duPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC8+KX1cbiAgICAgIDwvU3R5bGVkVG9vbGJhcj4pO1xuICAgIH07XG4gICAgY29uc3QgaGFuZGxlQ3Vyc29yUG9zaXRpb25DaGFuZ2UgPSAobmV3UG9zaXRpb24pID0+IHtcbiAgICAgICAgZGlzcGF0Y2gocXVlcnlFZGl0b3JTZXRDdXJzb3JQb3NpdGlvbihxdWVyeUVkaXRvciwgbmV3UG9zaXRpb24pKTtcbiAgICB9O1xuICAgIGNvbnN0IHF1ZXJ5UGFuZSA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyBhY2VFZGl0b3JIZWlnaHQsIHNvdXRoUGFuZUhlaWdodCB9ID0gZ2V0QWNlRWRpdG9yQW5kU291dGhQYW5lSGVpZ2h0cyhoZWlnaHQsIG5vcnRoUGVyY2VudCwgc291dGhQZXJjZW50KTtcbiAgICAgICAgcmV0dXJuICg8U3BsaXQgZXhwYW5kVG9NaW4gY2xhc3NOYW1lPVwicXVlcnlQYW5lXCIgc2l6ZXM9e1tub3J0aFBlcmNlbnQsIHNvdXRoUGVyY2VudF19IGVsZW1lbnRTdHlsZT17ZWxlbWVudFN0eWxlfSBtaW5TaXplPXsyMDB9IGRpcmVjdGlvbj1cInZlcnRpY2FsXCIgZ3V0dGVyU2l6ZT17U1FMX0VESVRPUl9HVVRURVJfSEVJR0hUfSBvbkRyYWdTdGFydD17b25SZXNpemVTdGFydH0gb25EcmFnRW5kPXtvblJlc2l6ZUVuZH0+XG4gICAgICAgIDxkaXYgcmVmPXtub3J0aFBhbmVSZWZ9IGNsYXNzTmFtZT1cIm5vcnRoLXBhbmVcIj5cbiAgICAgICAgICB7U3FsRm9ybUV4dGVuc2lvbiAmJiAoPFNxbEZvcm1FeHRlbnNpb24gcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9IHNldFF1ZXJ5RWRpdG9yQW5kU2F2ZVNxbFdpdGhEZWJvdW5jZT17c2V0UXVlcnlFZGl0b3JBbmRTYXZlU3FsV2l0aERlYm91bmNlfSBzdGFydFF1ZXJ5PXtzdGFydFF1ZXJ5fS8+KX1cbiAgICAgICAgICB7aXNBY3RpdmUgJiYgKDxBY2VFZGl0b3JXcmFwcGVyIGF1dG9jb21wbGV0ZT17YXV0b2NvbXBsZXRlRW5hYmxlZH0gb25CbHVyPXtvblNxbENoYW5nZWR9IG9uQ2hhbmdlPXtvblNxbENoYW5nZWR9IHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfSBvbkN1cnNvclBvc2l0aW9uQ2hhbmdlPXtoYW5kbGVDdXJzb3JQb3NpdGlvbkNoYW5nZX0gaGVpZ2h0PXtgJHthY2VFZGl0b3JIZWlnaHR9cHhgfSBob3RrZXlzPXtob3RrZXlzfS8+KX1cbiAgICAgICAgICB7cmVuZGVyRWRpdG9yQm90dG9tQmFyKHNob3dFbXB0eVN0YXRlKX1cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxTb3V0aFBhbmUgcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9IGxhdGVzdFF1ZXJ5SWQ9e2xhdGVzdFF1ZXJ5Py5pZH0gaGVpZ2h0PXtzb3V0aFBhbmVIZWlnaHR9IGRpc3BsYXlMaW1pdD17ZGlzcGxheUxpbWl0fSBkZWZhdWx0UXVlcnlMaW1pdD17ZGVmYXVsdFF1ZXJ5TGltaXR9Lz5cbiAgICAgIDwvU3BsaXQ+KTtcbiAgICB9O1xuICAgIGNvbnN0IGNyZWF0ZVZpZXdNb2RhbFRpdGxlID0gY3JlYXRlQXMgPT09IEN0YXNFbnVtLlZpZXcgPyAnQ1JFQVRFIFZJRVcgQVMnIDogJ0NSRUFURSBUQUJMRSBBUyc7XG4gICAgY29uc3QgY3JlYXRlTW9kYWxQbGFjZUhvbGRlciA9IGNyZWF0ZUFzID09PSBDdGFzRW51bS5WaWV3XG4gICAgICAgID8gdCgnU3BlY2lmeSBuYW1lIHRvIENSRUFURSBWSUVXIEFTIHNjaGVtYSBpbjogcHVibGljJylcbiAgICAgICAgOiB0KCdTcGVjaWZ5IG5hbWUgdG8gQ1JFQVRFIFRBQkxFIEFTIHNjaGVtYSBpbjogcHVibGljJyk7XG4gICAgY29uc3QgbGVmdEJhclN0YXRlQ2xhc3MgPSBoaWRlTGVmdEJhclxuICAgICAgICA/ICdzY2hlbWFQYW5lLWV4aXQtZG9uZSdcbiAgICAgICAgOiAnc2NoZW1hUGFuZS1lbnRlci1kb25lJztcbiAgICByZXR1cm4gKDxTdHlsZWRTcWxFZGl0b3IgcmVmPXtzcWxFZGl0b3JSZWZ9IGNsYXNzTmFtZT1cIlNxbEVkaXRvclwiPlxuICAgICAgPENTU1RyYW5zaXRpb24gY2xhc3NOYW1lcz1cInNjaGVtYVBhbmVcIiBpbj17IWhpZGVMZWZ0QmFyfSB0aW1lb3V0PXszMDB9PlxuICAgICAgICA8UmVzaXphYmxlU2lkZWJhciBpZD17YHNxbGxhYjoke3F1ZXJ5RWRpdG9yLmlkfWB9IG1pbldpZHRoPXtTUUxfRURJVE9SX0xFRlRCQVJfV0lEVEh9IGluaXRpYWxXaWR0aD17U1FMX0VESVRPUl9MRUZUQkFSX1dJRFRIfSBlbmFibGU9eyFoaWRlTGVmdEJhcn0+XG4gICAgICAgICAge2FkanVzdGVkV2lkdGggPT4gKDxTdHlsZWRTaWRlYmFyIGNsYXNzTmFtZT17YHNjaGVtYVBhbmUgJHtsZWZ0QmFyU3RhdGVDbGFzc31gfSB3aWR0aD17YWRqdXN0ZWRXaWR0aH0gaGlkZT17aGlkZUxlZnRCYXJ9PlxuICAgICAgICAgICAgICA8U3FsRWRpdG9yTGVmdEJhciBkYXRhYmFzZT17ZGF0YWJhc2V9IHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfS8+XG4gICAgICAgICAgICA8L1N0eWxlZFNpZGViYXI+KX1cbiAgICAgICAgPC9SZXNpemFibGVTaWRlYmFyPlxuICAgICAgPC9DU1NUcmFuc2l0aW9uPlxuICAgICAge3Nob3VsZExvYWRRdWVyeUVkaXRvciA/ICg8ZGl2IGRhdGEtdGVzdD1cInNxbEVkaXRvci1sb2FkaW5nXCIgY3NzPXtjc3MgYFxuICAgICAgICAgICAgZmxleDogMTtcbiAgICAgICAgICAgIHBhZGRpbmc6ICR7dGhlbWUuZ3JpZFVuaXQgKiA0fXB4O1xuICAgICAgICAgIGB9PlxuICAgICAgICAgIDxTa2VsZXRvbiBhY3RpdmUvPlxuICAgICAgICA8L2Rpdj4pIDogc2hvd0VtcHR5U3RhdGUgJiYgIWhhc1NxbFN0YXRlbWVudCA/ICg8RW1wdHlTdGF0ZSBpbWFnZT1cInZlY3Rvci5zdmdcIiBzaXplPVwibGFyZ2VcIiB0aXRsZT17dCgnU2VsZWN0IGEgZGF0YWJhc2UgdG8gd3JpdGUgYSBxdWVyeScpfSBkZXNjcmlwdGlvbj17dCgnQ2hvb3NlIG9uZSBvZiB0aGUgYXZhaWxhYmxlIGRhdGFiYXNlcyBmcm9tIHRoZSBwYW5lbCBvbiB0aGUgbGVmdC4nKX0vPikgOiAocXVlcnlQYW5lKCkpfVxuICAgICAgPE1vZGFsIHNob3c9e3Nob3dDcmVhdGVBc01vZGFsfSB0aXRsZT17dChjcmVhdGVWaWV3TW9kYWxUaXRsZSl9IG9uSGlkZT17KCkgPT4gc2V0U2hvd0NyZWF0ZUFzTW9kYWwoZmFsc2UpfSBmb290ZXI9ezw+XG4gICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9eygpID0+IHNldFNob3dDcmVhdGVBc01vZGFsKGZhbHNlKX0+XG4gICAgICAgICAgICAgIHt0KCdDYW5jZWwnKX1cbiAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAge2NyZWF0ZUFzID09PSBDdGFzRW51bS5UYWJsZSAmJiAoPEJ1dHRvbiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBkaXNhYmxlZD17Y3Rhcy5sZW5ndGggPT09IDB9IG9uQ2xpY2s9e2NyZWF0ZVRhYmxlQXN9PlxuICAgICAgICAgICAgICAgIHt0KCdDcmVhdGUnKX1cbiAgICAgICAgICAgICAgPC9CdXR0b24+KX1cbiAgICAgICAgICAgIHtjcmVhdGVBcyA9PT0gQ3Rhc0VudW0uVmlldyAmJiAoPEJ1dHRvbiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBkaXNhYmxlZD17Y3Rhcy5sZW5ndGggPT09IDB9IG9uQ2xpY2s9e2NyZWF0ZVZpZXdBc30+XG4gICAgICAgICAgICAgICAge3QoJ0NyZWF0ZScpfVxuICAgICAgICAgICAgICA8L0J1dHRvbj4pfVxuICAgICAgICAgIDwvPn0+XG4gICAgICAgIDxzcGFuPnt0KCdOYW1lJyl9PC9zcGFuPlxuICAgICAgICA8SW5wdXQgcGxhY2Vob2xkZXI9e2NyZWF0ZU1vZGFsUGxhY2VIb2xkZXJ9IG9uQ2hhbmdlPXtjdGFzQ2hhbmdlZH0vPlxuICAgICAgPC9Nb2RhbD5cbiAgICA8L1N0eWxlZFNxbEVkaXRvcj4pO1xufTtcbmV4cG9ydCBkZWZhdWx0IFNxbEVkaXRvcjtcbiJdfQ== */\"), children: [\n      _jsxs(Menu.Item, { css: _ref, children: [\n        ' ',\n        _jsx(\"span\", { children: t('Render HTML') }), ' ',\n        _jsx(Switch, { checked: renderHTMLEnabled, onChange: handleToggleRenderHTMLEnabled }), ' '] }\n      ),\n      _jsxs(Menu.Item, { css: _ref2, children: [\n        ' ',\n        _jsx(\"span\", { children: t('Autocomplete') }), ' ',\n        _jsx(Switch, { checked: autocompleteEnabled, onChange: handleToggleAutocompleteEnabled }), ' '] }\n      ),\n      isFeatureEnabled(FeatureFlag.EnableTemplateProcessing) && _jsx(Menu.Item, { children:\n        _jsx(TemplateParamsEditor, { language: \"json\", onChange: (params) => {\n            dispatch(queryEditorSetTemplateParams(qe, params));\n          }, queryEditorId: qe.id }) }\n      ),\n      _jsx(Menu.Item, { onClick: () => formatCurrentQuery(), children:\n        t('Format SQL') }\n      ),\n      !_isEmpty(scheduledQueriesConf) && _jsx(Menu.Item, { children:\n        _jsx(ScheduleQueryButton, { defaultLabel: qe.name, sql: qe.sql, onSchedule: (query) => dispatch(scheduleQuery(query)), schema: qe.schema, dbId: qe.dbId, scheduleQueryWarning: scheduleQueryWarning, tooltip: scheduleToolTip, disabled: !successful }) }\n      ),\n      _jsx(Menu.Item, { children:\n        _jsx(KeyboardShortcutButton, { children:\n          t('Keyboard shortcuts') }\n        ) }\n      )] }\n    );\n  };\n  const onSaveQuery = async (query, clientId) => {\n    const savedQuery = await dispatch(saveQuery(query, clientId));\n    dispatch(addSavedQueryToTabState(queryEditor, savedQuery));\n  };\n  const renderEditorBottomBar = (hideActions) => {var _latestQuery$results;\n    const { allow_ctas: allowCTAS, allow_cvas: allowCVAS } = database || {};\n    const showMenu = allowCTAS || allowCVAS;\n    const runMenuBtn = _jsxs(Menu, { children: [\n      allowCTAS && _jsx(Menu.Item, { onClick: () => {\n          logAction(LOG_ACTIONS_SQLLAB_CREATE_TABLE_AS, {\n            shortcut: false\n          });\n          setShowCreateAsModal(true);\n          setCreateAs(CtasEnum.Table);\n        }, children:\n        t('CREATE TABLE AS') }, \"1\"\n      ),\n      allowCVAS && _jsx(Menu.Item, { onClick: () => {\n          logAction(LOG_ACTIONS_SQLLAB_CREATE_VIEW_AS, {\n            shortcut: false\n          });\n          setShowCreateAsModal(true);\n          setCreateAs(CtasEnum.View);\n        }, children:\n        t('CREATE VIEW AS') }, \"2\"\n      )] }\n    );\n    return _jsx(StyledToolbar, { className: \"sql-toolbar\", id: \"js-sql-toolbar\", children:\n      hideActions ? _jsx(Alert, { type: \"warning\", message: t('The database that was used to generate this query could not be found'), description: t('Choose one of the available databases on the left panel.'), closable: false }) : _jsxs(_Fragment, { children: [\n        _jsxs(\"div\", { className: \"leftItems\", children: [\n          _jsx(\"span\", { children:\n            _jsx(RunQueryActionButton, { allowAsync: (database == null ? void 0 : database.allow_run_async) === true, queryEditorId: queryEditor.id, queryState: latestQuery == null ? void 0 : latestQuery.state, runQuery: runQuery, stopQuery: stopQuery, overlayCreateAsMenu: showMenu ? runMenuBtn : null }) }\n          ),\n          isFeatureEnabled(FeatureFlag.EstimateQueryCost) && (\n          database == null ? void 0 : database.allows_cost_estimate) && _jsx(\"span\", { children:\n            _jsx(EstimateQueryCostButton, { getEstimate: getQueryCostEstimate, queryEditorId: queryEditor.id, tooltip: t('Estimate the cost before running a query') }) }\n          ),\n          _jsx(\"span\", { children:\n            _jsx(QueryLimitSelect, { queryEditorId: queryEditor.id, maxRow: maxRow, defaultQueryLimit: defaultQueryLimit }) }\n          ),\n          latestQuery && _jsx(Timer, { startTime: latestQuery.startDttm, endTime: latestQuery.endDttm, status: STATE_TYPE_MAP[latestQuery.state], isRunning: latestQuery.state === 'running' })] }\n        ),\n        _jsxs(\"div\", { className: \"rightItems\", children: [\n          _jsx(\"span\", { children:\n            _jsx(SaveQuery, { queryEditorId: queryEditor.id, columns: (latestQuery == null ? void 0 : (_latestQuery$results = latestQuery.results) == null ? void 0 : _latestQuery$results.columns) || [], onSave: onSaveQuery, onUpdate: (query, remoteId) => dispatch(updateSavedQuery(query, remoteId)), saveQueryWarning: saveQueryWarning, database: database }) }\n          ),\n          _jsx(\"span\", { children:\n            _jsx(ShareSqlLabQuery, { queryEditorId: queryEditor.id }) }\n          ),\n          _jsx(Dropdown, { dropdownRender: () => renderDropdown(), trigger: ['click'], children:\n            _jsx(Button, { buttonSize: \"xsmall\", type: \"link\", showMarginRight: false, children:\n              _jsx(Icons.EllipsisOutlined, {}) }\n            ) }\n          )] }\n        )] }\n      ) }\n    );\n  };\n  const handleCursorPositionChange = (newPosition) => {\n    dispatch(queryEditorSetCursorPosition(queryEditor, newPosition));\n  };\n  const queryPane = () => {\n    const { aceEditorHeight, southPaneHeight } = getAceEditorAndSouthPaneHeights(height, northPercent, southPercent);\n    return _jsxs(Split, { expandToMin: true, className: \"queryPane\", sizes: [northPercent, southPercent], elementStyle: elementStyle, minSize: 200, direction: \"vertical\", gutterSize: SQL_EDITOR_GUTTER_HEIGHT, onDragStart: onResizeStart, onDragEnd: onResizeEnd, children: [\n      _jsxs(\"div\", { ref: northPaneRef, className: \"north-pane\", children: [\n        SqlFormExtension && _jsx(SqlFormExtension, { queryEditorId: queryEditor.id, setQueryEditorAndSaveSqlWithDebounce: setQueryEditorAndSaveSqlWithDebounce, startQuery: startQuery }),\n        isActive && _jsx(AceEditorWrapper, { autocomplete: autocompleteEnabled, onBlur: onSqlChanged, onChange: onSqlChanged, queryEditorId: queryEditor.id, onCursorPositionChange: handleCursorPositionChange, height: `${aceEditorHeight}px`, hotkeys: hotkeys }),\n        renderEditorBottomBar(showEmptyState)] }\n      ),\n      _jsx(SouthPane, { queryEditorId: queryEditor.id, latestQueryId: latestQuery == null ? void 0 : latestQuery.id, height: southPaneHeight, displayLimit: displayLimit, defaultQueryLimit: defaultQueryLimit })] }\n    );\n  };\n  const createViewModalTitle = createAs === CtasEnum.View ? 'CREATE VIEW AS' : 'CREATE TABLE AS';\n  const createModalPlaceHolder = createAs === CtasEnum.View ?\n  t('Specify name to CREATE VIEW AS schema in: public') :\n  t('Specify name to CREATE TABLE AS schema in: public');\n  const leftBarStateClass = hideLeftBar ?\n  'schemaPane-exit-done' :\n  'schemaPane-enter-done';\n  return _jsxs(StyledSqlEditor, { ref: sqlEditorRef, className: \"SqlEditor\", children: [\n    _jsx(CSSTransition, { classNames: \"schemaPane\", in: !hideLeftBar, timeout: 300, children:\n      _jsx(ResizableSidebar, { id: `sqllab:${queryEditor.id}`, minWidth: SQL_EDITOR_LEFTBAR_WIDTH, initialWidth: SQL_EDITOR_LEFTBAR_WIDTH, enable: !hideLeftBar, children:\n        (adjustedWidth) => _jsx(StyledSidebar, { className: `schemaPane ${leftBarStateClass}`, width: adjustedWidth, hide: hideLeftBar, children:\n          _jsx(SqlEditorLeftBar, { database: database, queryEditorId: queryEditor.id }) }\n        ) }\n      ) }\n    ),\n    shouldLoadQueryEditor ? _jsx(\"div\", { css: css`\n            flex: 1;\n            padding: ${theme.gridUnit * 4}px;\n          `, children:\n      _jsx(Skeleton, { active: true }) }\n    ) : showEmptyState && !hasSqlStatement ? _jsx(EmptyState, { image: \"vector.svg\", size: \"large\", title: t('Select a database to write a query'), description: t('Choose one of the available databases from the panel on the left.') }) : queryPane(),\n    _jsxs(Modal, { show: showCreateAsModal, title: t(createViewModalTitle), onHide: () => setShowCreateAsModal(false), footer: _jsxs(_Fragment, { children: [\n        _jsx(Button, { onClick: () => setShowCreateAsModal(false), children:\n          t('Cancel') }\n        ),\n        createAs === CtasEnum.Table && _jsx(Button, { buttonStyle: \"primary\", disabled: ctas.length === 0, onClick: createTableAs, children:\n          t('Create') }\n        ),\n        createAs === CtasEnum.View && _jsx(Button, { buttonStyle: \"primary\", disabled: ctas.length === 0, onClick: createViewAs, children:\n          t('Create') }\n        )] }\n      ), children: [\n      _jsx(\"span\", { children: t('Name') }),\n      _jsx(Input, { placeholder: createModalPlaceHolder, onChange: ctasChanged })] }\n    )] }\n  );\n};\nexport default SqlEditor;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}