{"ast":null,"code":"import _omit from \"lodash/omit\"; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\n// eslint-disable-next-line import/no-extraneous-dependencies\n\nimport { SET_REPORT, ADD_REPORT, EDIT_REPORT, DELETE_REPORT } from './actions';\n\nexport default function reportsReducer(state = {}, action) {\n  const actionHandlers = {\n    [SET_REPORT]() {var _report$result, _state$creationMethod;\n      const { report, resourceId, creationMethod, filterField } = action;\n      // For now report count should only be one, but we are checking in case\n      // functionality changes.\n      const reportObject = (_report$result = report.result) == null ? void 0 : _report$result.find(\n        (report) => report[filterField] === resourceId\n      );\n\n      if (reportObject) {\n        return {\n          ...state,\n          [creationMethod]: {\n            ...state[creationMethod],\n            [resourceId]: reportObject\n          }\n        };\n      }\n      if (state != null && (_state$creationMethod = state[creationMethod]) != null && _state$creationMethod[resourceId]) {\n        // remove the empty report from state\n        const newState = { ...state };\n        delete newState[creationMethod][resourceId];\n        return newState;\n      }\n      return { ...state };\n    },\n\n    [ADD_REPORT]() {\n      const { result, id } = action.json;\n      const report = { ...result, id };\n      const reportTypeId = report.dashboard || report.chart;\n      // this is the id of either the chart or the dashboard associated with the report.\n\n      return {\n        ...state,\n        [report.creation_method]: {\n          ...state[report.creation_method],\n          [reportTypeId]: report\n        }\n      };\n    },\n\n    [EDIT_REPORT]() {\n      const report = {\n        ...action.json.result,\n        id: action.json.id\n      };\n      const reportTypeId = report.dashboard || report.chart;\n\n      return {\n        ...state,\n        [report.creation_method]: {\n          ...state[report.creation_method],\n          [reportTypeId]: report\n        }\n      };\n    },\n\n    [DELETE_REPORT]() {\n      const { report } = action;\n      const reportTypeId = report.dashboard || report.chart;\n      return {\n        ...state,\n        [report.creation_method]: {\n          ..._omit(state[report.creation_method], reportTypeId)\n        }\n      };\n    }\n  };\n\n  if (action.type in actionHandlers) {\n    return actionHandlers[action.type]();\n  }\n  return state;\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}